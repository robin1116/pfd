/*
 * client3d.js - v5.0.3.2
 * Compiled Wed Aug 28 2024 16:10:36 GMT+0800 (GMT+08:00)
 * Copyright (c) 2024 www.hightopo.com
 */

var hteditor3d=function(){"use strict";function E(E){return/^scenes/.test(E)}function F(E){return/^models/.test(E)}function D(E){return/^symbols/.test(E)}function g(E){return/^assets/.test(E)}function f(E){return/^materials/.test(E)}function T(E){return/\.obj$/i.test(E)}function a(E){return/\.mtl$/i.test(E)}function K(E){return/\.(png|jpg|gif|jpeg|bmp|svg|hdr)$/i.test(E)}function b(E){return/\.json$/i.test(E)}function B(E){return/\.fbx$/i.test(E)}function $(E){return/\.gltf$/i.test(E)}function p(E){return/\.glb$/i.test(E)}function W(E){return/\.hdr$/i.test(E)}function Y(E){return E&&"object"==typeof E}function o(E){return"string"==typeof E||E instanceof String}function h(E){var F=ht.Default.getImageMap();if(F[E])return delete F[E],!0;var D=ht.Default.getCompTypeMap();if(D[E])return delete D[E],!0;var g=ht.Default.getShape3dModelMap();return!!g[E]&&(delete g[E],!0)}function u(E,F,D,g){var f=new ht.Tab;return f.setName(F),f.setView(D),E.getTabModel().add(f),g&&E.getTabModel().sm().ss(f),f}function U(E){var F=new RegExp("(^|&)"+E+"=([^&]*)(&|$)"),D=window.location.search.substr(1).match(F);return null!=D?decodeURIComponent(D[2]):null}function H(E,F,D){if(E instanceof Array)for(var g=0,f=E.length;g<f;g++)H(E[g],F,D);else if(E instanceof Object)for(var T in E)if(E.hasOwnProperty(T)){var a=E[T];if(!Y(a))continue;if(o(a.func)&&V.test(a.func)){var K=a.func.slice(5);F&&void 0===F[K]&&(F[K]=T),D&&void 0===D[K]&&(D[K]=a.value)}else H(a,F,D)}}function t(E,F){var D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.encodeJSON;return ht.Default.stringify(E,F,D)}function Z(E){ht.Default.setImage("editor."+E,{dataBindings:[{attr:"text",valueType:"Multiline",defaultValue:E.toUpperCase()},{attr:"textScale",valueType:"Number",defaultValue:3===E.length?1:.7}],width:64,height:64,comps:[{type:"image",name:"editor.fileIcon",rect:[0,0,64,64]},{type:"text",text:{func:"attr@text",value:E.toUpperCase()},align:"right",vAlign:"top",font:"bold 20px sans-serif, Arial",anchorX:1,anchorY:1,scaleX:{func:"attr@textScale"},scaleY:{func:"attr@textScale"},rect:[15.38966,42.52406,44.54901,19.55378]}]})}var m=hteditor,r=(m.getString,m.config);m.createTablePane=function(){var E=new ht.widget.TablePane;return E.getView().style.border=hteditor.config.color_line+" solid 1px",E};var s=m.FileNode.prototype.getFileImage;m.FileNode.prototype.getFileImage=function(E){return/\.(json|tga|hdr|fbx|gltf|glb|htb|cob|obj|mtl|glsl)$/i.test(E)?"editor."+this.postfix.toLowerCase():s.call(this,E)};var k=function(){},V=/^attr@/,i=m.formatString,j=ht.Default,n=m.config;!function(E){for(var F in E)void 0===n[F]&&(n[F]=E[F])}({texureImage3D:!0,modelDialogClasses:{},modelViewSize:{width:800,height:500},imageViewSize:{width:600,height:500},materialViewSize:{width:800,height:500},sceneGridEnabled:!0,sceneGridBlockCount:50,sceneGridBlockSize:40,sceneGridColor:"rgb(191, 191, 191)",sceneEye:j.graph3dViewEye,sceneCenter:j.graph3dViewCenter,sceneNear:j.graph3dViewNear,sceneFar:j.graph3dViewFar,sceneFovy:j.graph3dViewFovy,sceneBloom:!1,sceneBloomStrength:1.5,sceneBloomThreshold:.55,sceneBloomRadius:.4,sceneDof:!1,sceneDofAperture:.025,sceneDofImage:null,sceneHighlightMode:"style",sceneHighlightType:"hard",sceneHighlightColor:ht.Style["highlight.color"],sceneHighlightWidth:ht.Style["highlight.width"],sceneHighlightGlow:.8,sceneHighlightStrength:2,sceneDashEnable:!1,sceneSkyboxType:"sphere",sceneSkyboxLight:ht.Style["shape3d.light"],sceneSkyboxLightMask:ht.Style["light.mask"],sceneSkyboxColor:"#ffffff",sceneSkyboxBlurSize:ht.Style["skybox.blur.size"],sceneHeadlightEnable:!j.graph3dViewHeadlightDisabled,sceneHeadlightRange:j.graph3dViewHeadlightRange,sceneHeadlightColor:"rgb(255,255,255)",sceneHeadlightIntensity:j.graph3dViewHeadlightIntensity,sceneHeadlightAmbientIntensity:j.graph3dViewHeadlightAmbientIntensity,sceneHueSaturation:!1,sceneHueSaturationColorIndex:0,sceneHueSaturationHue:[0,0,0,0,0,0,0],sceneHueSaturationSaturation:[0,0,0,0,0,0,0],sceneHueSaturationLightness:[0,0,0,0,0,0,0],sceneFogEnable:!j.graph3dViewFogDisabled,sceneFogMode:j.graph3dViewFogMode,sceneFogColor:j.graph3dViewFogColor,sceneFogNear:j.graph3dViewFogNear,sceneFogFar:j.graph3dViewFogFar,sceneFogDensity:j.graph3dViewFogDensity,sceneBatchBrightnessDisabled:j.graph3dViewBatchBrightnessDisabled,sceneBatchBlendDisabled:j.graph3dViewBatchBlendDisabled,sceneBatchColorDisabled:j.graph3dViewBatchColorDisabled,sceneBatchInstancedDisabled:j.graph3dViewBatchInstancedDisabled,sceneShadowEnabled:!1,sceneShadowDegreeX:ht.Default.graph3dViewShadowDegreeX,sceneShadowDegreeZ:ht.Default.graph3dViewShadowDegreeZ,sceneShadowIntensity:ht.Default.graph3dViewShadowIntensity,sceneShadowQuality:ht.Default.graph3dViewShadowQuality,sceneShadowType:ht.Default.graph3dViewShadowType,sceneShadowRadius:ht.Default.graph3dViewShadowRadius,sceneShadowBias:ht.Default.graph3dViewShadowBias,sceneEditHelperDisabled:!1,sceneOrthographic:!1,batchEditable:!0}),["TitleScenes"].forEach(function(E){null==n.expandedTitles[E]&&(n.expandedTitles[E]=!0)}),function(E,F,D){function g(E){var F,g=(E.key||"").toLowerCase(),E=E.keyCode;return 65<=E&&E<=90?(F=String.fromCharCode(E).toLowerCase())!==g?F:g:48<=E&&E<=57?(F=String.fromCharCode(E))!==g?F:g:96<=E&&E<=105?"numpad"+(g=(F=String.fromCharCode(E-48))!==g?F:g):112<=E&&E<=123?(F="f"+(E-111))!==g?F:g:(F=r[E])!==D?F:g}function f(E){var F=0;"keydown"===E.type?(E.ctrlKey&&(F+=8),E.metaKey&&(F+=4),E.altKey&&(F+=2),E.shiftKey&&(F+=1)):"keyup"===E.type&&(F=s,"control"===(E=T(g(E)))&&8&F?F-=8:"meta"===E&&4&F?F-=4:"alt"===E&&2&F?F-=2:"shift"===E&&1&F&&--F),s=F}function T(E){return"spacebar"===E?E=" ":0<=["left","right","up","down"].indexOf(E)?E="arrow"+E:"os"===E?E="meta":"help"===E&&(E="insert"),E}function a(E,F){var D=(E=Z(E)?E.split(" + "):E).length,g=0,f={};if(F)g=16;else for(var a=0;a<D-1;a++){var K=E[a].toLowerCase();f[K]||(f[K]=1,null!=(K=k[K])&&(g+=1<<K))}return g+"_"+T(E[D-1].toLowerCase())}function K(E,F){var D=0,F=(E.ctrlKey&&(D+=8),E.metaKey&&(D+=4),E.altKey&&(D+=2),E.shiftKey&&(D+=1),F&&(D=16),T(g(E)));return D+"_"+F}function b(){}function B(E,F,D){E.setViewport(F,D[0],D[1],D[2],D[3])}function $(E){d||((d=document.createElement("canvas")).style.position="absolute");var F,D,g,f=H.Default.getImage("editinteractor3d.cursor."+E);return f?(F=H.Default.devicePixelRatio,D=f.width,g=f.height,d.width=D*F,d.height=g*F,d.style.width=D+"px",d.style.height=g+"px",D=(F=f).width,g=F.height,(f=d.getContext("2d")).save(),f.scale(H.Default.devicePixelRatio,H.Default.devicePixelRatio),f.clearRect(0,0,D,g),H.Default.drawImage(f,F,0,0,D,g),f.restore()):H.Default.callLater(function(){$(E)}),d}function p(E,F,D){var g=E.getFinalScale3d(),f=(F=NE(bE.copy(F).scale(BE.set(1/g[0],1/g[1],1/g[2])))).position,T=F.scale;E.p3(f.x,f.y,f.z),E.setQuaternion(F.quaternion),D||(f=E.s3(),E.setScale3d(T.x*g[0]/f[0],T.y*g[1]/f[1],T.z*g[2]/f[2]))}function W(E,F){return rE||(VE.setFromMatrixColumn(E,3),iE.subVectors(VE,kE).normalize()),F?(jE.setFromMatrixColumn(E,0).normalize(),nE.crossVectors(iE,jE),yE.crossVectors(jE,nE),yE.dot(iE)):(jE.setFromMatrixColumn(E,0).normalize(),jE.dot(iE))}function Y(E){return(E=Math.abs(E))<sE[0]?1:E>sE[1]?0:(sE[1]-E)/(sE[1]-sE[0])}function o(E){var F=xE.clone();return xE.multiply(E),F}function h(E,F,D){var g=vE(E,F,"vs"),f=(LE.aPosition=EF(g),vE(E,F,"uv")),f=(LE.aUv=!!f&&EF(f),vE(E,F,"is")),T=(cE||1===D||(T=(T=vE(E,F,"ns"))||(E.ns=w(g,f)),LE.aNormal=EF(T)),vE(E,F,"range")),E=f?f.length:g.length/3;if(T){var a,F=1===D?2:3,g=E/F,K=Math.round(T[0]*g)*F;if((a=Math.round(T[1]*g)*F-K)<=0)return}else K=0,a=E;f?(FF(f),z(CE,K,a,D,f instanceof Uint32Array?5125:null)):l(CE,K,a,D)}function u(E,F){var D,g,f;0!=vE(E,F,"visible")&&(D=vE(E,F,"matrix"),D=$E(D),D=o(D),(f=vE(E,F,"color"))&&(g=eE,eE=f),E.forEach(function(E){var D=E.model,g=E.path||D,f=g?F+g+".":F;if(PE[D])u(PE[D],f);else if(0!=(g=vE(E,f,"visible"))){var g=!!_E._picking||vE(E,f,"fixColor"),g=((cE=!1!==g)?(JE.uFix=!0,LE.aNormal=!1):JE.uFix=!1,vE(E,f,"reverseCull")),T=(g&&(OE.cullFace.enabled=!0),vE(E,f,"matrix")),T=$E(T),T=o(T);XE.multiplyMatrices(lE,xE),vE(E,f,"autorotate")&&(pE(XE,XE),xE.multiplyMatrices(zE,XE)),JE.uModelMatrix=xE.getElements();var a=XE.getElements(),a=(JE.uModelViewMatrix=a,JE.uNormalMatrix=c(a,wE),vE(E,f,"color")||eE),K=vE(E,f,"transparent"),b=(K&&(($=vE(E,f,"opacity"))<=1&&0<=$?(OE.blend.enabled=!0,a=[(b=H.Default.toColorData(a))[0]/255,b[1]/255,b[2]/255,$]):K=!1),vE(E,f,"image")),B=(b&&($=_E.getTexture(b,null,null,{filter:9728}),JE.uTexture=!0,JE.uDiscardSelectable=!1,JE.uSampler=$,$=vE(E,f,"uvScale")||[1,1],B=vE(E,f,"uvOffset")||[0,0],AE.setFromTransform(0,B[0],B[1],$[0],$[1]),JE.uUvMatrix=[AE.a,AE.b,0,AE.c,AE.d,0,AE.tx,AE.ty,1],K&&(JE.uTransparent=K,JE.uPartOpacity=vE(E,f,"opacity")||1)),cE?JE.uFixPickReverseColor=a||"gray":JE.uDiffuse=a||"gray",DF[D]);if(B)B(E,f);else{var $=RE[D];if(!$)return;for(var a=$[0],p=$[1],B=$[2]||{},W=[],Y=0,h=p.length;Y<h;Y+=2){var U=p[Y],t=p[Y+1],U=vE(E,f,U)||t;W.push(U)}$=D+"_"+W.join("_"),D=(D=qE[$])||(qE[$]=a.apply(this,W)),GE=D,$=B.type||"triangles",DF[$](E,f),GE=null}K&&(OE.blend.enabled=!1),g&&(OE.cullFace.enabled=!1),b&&(JE.uTexture=!1,K&&(JE.uTransparent=!1,JE.uPartOpacity=1)),xE=T}}),xE=D,eE=g)}function U(){gE(U,this),this.s({"2d.visible":!1,"3d.visible":!1}),this.clear(),this.isCurvePoint=!0}var H=E.ht,t=H.Default,Z=t.isString,m=H.Default.isFunction,r=(H.Default.clone,{192:"`",189:"-",187:"=",219:"[",221:"]",220:"\\",186:";",222:"'",188:",",190:".",191:"/",111:"numpad/",106:"numpad*",109:"numpad-",107:"numpad+",110:"numpad.",32:" ",33:"pageup",34:"pagedown"}),s=0;E.addEventListener("keydown",f,!0),E.addEventListener("keyup",f,!0);var k={};k.ctrl=3,k.meta=2,k.alt=1,k.shift=0,H.ShortcutManager=function(){this._actionMap={},this._lastEvent=D,this._keyEventNotifier=new H.Notifier,this._target=D,this._global=!1,this._stopPropagation=!1},t.def(H.ShortcutManager,F,{registerShortcut:function(E,F,D){E&&(E=a(E,D),m(F)&&(F={action:F}),this._actionMap[E]=F)},unregisterShortcut:function(E,F){E&&(E=a(E,F),this._actionMap[E]=D)},clearShortcuts:function(){this._actionMap={},this._keyEventNotifier=new H.Notifier},enableShortcut:function(F){this.disableShortcut();var F=this._target=F||this._target||E,D=(this._global=F===E,this._keydownListenerFunc=this.keydownListener.bind(this)),g=this._keyupListenerFunc=this.keyupListener.bind(this);F.addEventListener("keydown",D,!0),F.addEventListener("keyup",g,!0)},disableShortcut:function(){var E=this._target;E&&(E.removeEventListener("keydown",this._keydownListenerFunc,!0),E.removeEventListener("keyup",this._keyupListenerFunc,!0))},keydownListener:function(E){if(!H.Default.ignoreKeyEvent&&(this.fireKeyEvent({kind:"down",event:E}),!H.Default.ignoreShortcuts)){var F=K(this._lastEvent=E),D=this._actionMap[F];if(D||(F=K(E,!0),D=this._actionMap[F]),D){var g,f={kind:"down",shortcut:F,event:E};for(g in D)f[g]=D[g];!1!==this.beforeShortcutAction(E,f)&&(D.action(f),this.stopPropagation&&(E.preventDefault(),E.stopImmediatePropagation()))}}},keyupListener:function(E){if(!H.Default.ignoreKeyEvent&&(this.fireKeyEvent({kind:"up",event:E}),!H.Default.ignoreShortcuts)){for(var f="_"+T(g(E)),a=F.keys(this._actionMap),K=0,b=a.length;K<b;K++){var B=a[K];if(!(B.indexOf(f)<0)){var $=this._actionMap[B];if($){var p,W={kind:"up",shortcut:B,event:E};for(p in $)W[p]=$[p];!1!==this.beforeShortcutAction(E,W)&&$.action(W)}}}this._lastEvent=D}},beforeShortcutAction:function(E,F){},addKeyListener:function(E,F,D){this._keyEventNotifier.add(E,F,D)},removeKeyListener:function(E,F){this._keyEventNotifier.remove(E,F)},fireKeyEvent:function(E){this._keyEventNotifier.fire(E)},isShiftDown:function(){return H.ShortcutManager.isShiftDown()},isCtrlDown:function(){return H.ShortcutManager.isCtrlDown()},isMetaDown:function(){return H.ShortcutManager.isMetaDown()},isAltDown:function(){return H.ShortcutManager.isAltDown()}}),F.defineProperties(H.ShortcutManager.prototype,{global:{get:function(){return this._global}},stopPropagation:{get:function(){return this._stopPropagation},set:function(E){this._stopPropagation=E}}}),H.ShortcutManager.getKey=function(E){return T(g(E))},H.ShortcutManager.isShiftDown=function(){return!0&s},H.ShortcutManager.isCtrlDown=function(){return!0&s},H.ShortcutManager.isMetaDown=function(){return!0&s},H.ShortcutManager.isAltDown=function(){return!0&s};var V,i,j,n,y,I,N,P,q,R,Q,d,_=(H=E.ht).Math,C=_.Vector3,S=_.Vector2,J=_.Matrix4,O=_.Plane,L=_.Quaternion,M=(_.Euler,H.Default.getInternal()),G=M.glUploadData,c=M.createNormalMatrix,l=M.glDrawArray,x=M.glUploadElementData,z=M.glDrawElement,X=M.pickValueToColor,w=M.createNormals,e=(M.addEventListener,M.removeEventListener,H.Default.createDiv),A=H.Default.appendChild,v=H.Default.unionPoint,EE=H.Default.layout,FE=H.Default.removeHTML,DE=M.to3dPointsArray,gE=M.superCall,t=H.Default.def,fE=H.graph._editor.Math.CubicBezier,TE=_.fequal,aE="undefined"!=typeof Float32Array?Float32Array:Array,KE=(new C,new J),bE=new J,BE=new C,$E=(V=/[TRS]\(([\+\-\d\., ]*)\)/i,i=new J,j=new C,function(E){if(E instanceof J)return E;var F=new J;if(!E)return F;for(var D,g,f,T,a=E.split(";"),K=0,b=a.length;K<b;K++)if(D=a[K].trim(),g=V.exec(D)){switch(D=D[0],f=g[1].split(","),j.set(parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])),D){case"T":i.setPosition(j);break;case"R":T=parseFloat(f[3]),i.makeRotationAxis(j.normalize(),T*Math.PI/180);break;case"S":i.scale(j)}F.premultiply(i),i.identity()}return F}),pE=(n=new C,function(E,F){var D=(F=F||E.clone()).getElements(),g=n.setFromMatrixColumn(E,0).length(),f=n.setFromMatrixColumn(E,1).length(),E=n.setFromMatrixColumn(E,2).length();return D[1]=D[2]=D[3]=D[4]=D[6]=D[7]=D[8]=D[9]=D[11]=0,D[0]=g,D[5]=f,D[10]=E,F}),WE=(y=new L,I=(new C).set(1,0,0),function(E,F,D,g){var f=E.extractScale(),E=E.getPosition();return y.setFromUnitVectors(I,g),D.compose(E,y,f).premultiply(F)}),YE=(N=new C,function(E,F,D,g){var f=F,D=(N.subVectors(E,D),f.dot(g)),f=f.dot(N),g=g.dot(N),T=1-D*D,D=T<1e-5?0:(D*g-f)/T;return F.clone().multiplyScalar(D).add(E)}),oE=(P=new C,q=new C,function(E,F,D,g){return E.isOrtho()?(P.copy(E.getEye()),q.copy(E.getCenter()).sub(P).normalize(),P.copy(E.unproject(F))):(P.copy(E.getEye()),q.copy(E.unproject(F)).sub(P).normalize()),YE(D,g,P,q)}),hE=(R=new S,Q=new S,function(E,F){return R.copy(E),Q.copy(F),R.equals(Q)}),uE=(bF=E.navigator?E.navigator.userAgent.toLowerCase():"",/mac/.test(bF));UE=new J,HE=new C,tE=new C,ZE=new L;var UE,HE,tE,ZE,mE,rE,sE,kE,VE,iE,jE,nE,yE,IE,NE=function(E){return UE.copy(E).decompose(HE,ZE,tE),{position:HE,scale:tE,quaternion:ZE}},PE=(H.Default.setImage("editinteractor3d.scenegizmo.persp",{width:28,height:28,comps:[{type:"shape",borderWidth:2,borderColor:"rgb(247,247,247)",borderCap:"round",points:[14,3,14,7,6,11,6,21,2,23,14,7,22,11,22,21,26,23,6,11,14,15,14,25,6,21,22,11,14,15,22,21,14,25],segments:[1,2,2,2,2,1,2,2,2,1,2,2,2,1,2,1,2]}]}),H.Default.setImage("editinteractor3d.scenegizmo.iso",{width:28,height:28,comps:[{type:"shape",borderWidth:2,borderColor:"rgb(247,247,247)",borderCap:"round",points:[4,4,4,24,24,24,21,7,8,7,8,20,21,20,21,7],segments:[1,2,2,1,2,2,2,2]}]}),H.Default.setImage("editinteractor3d.scenegizmo.item",H.Default.parse(H.Default.stringify({dataBindings:[{attr:"text",valueType:"String",defaultValue:"ISO"},{attr:"mode",valueType:"String",defaultValue:"iso"}],width:112,height:36,comps:[{type:"roundRect",background:"rgba(0,0,0,0.2)",borderColor:"#979797",rect:[0,0,112,36]},{type:"text",text:{func:"attr@text",value:"Persp"},align:"center",color:"rgb(247,247,247)",font:'bold 16px -apple-system , BlinkMacSystemFont , "Segoe UI" , Roboto , "Helvetica Neue", "PingFang SC", "Noto Sans" , "Noto Sans CJK SC" , "Microsoft YaHei" , "\u5fae\u8f6f\u96c5\u9ed1" , sans-serif',shadow:!1,shadowColor:"rgb(190,190,190)",shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1,displayName:"Persp",rect:[45,5,50,30]},{type:"image",name:"editinteractor3d.scenegizmo.persp",visible:{func:"__ht__function(data, view) {\nreturn data && data.ca('mode') !== 'iso';\n}"},shadow:!1,shadowColor:"rgb(190,190,190)",shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1,displayName:"persp",rect:[14,4,28,28]},{type:"image",name:"editinteractor3d.scenegizmo.iso",visible:{func:"__ht__function(data, view) {\nreturn data && data.ca('mode') === 'iso';\n}",value:!1},shadow:!1,shadowColor:"rgb(190,190,190)",shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1,displayName:"iso",rect:[14,4,28,28]}]}))),H.Default.setImage("gizmoAtlas",{width:120,height:532,comps:[{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"1",rect:[4,1,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"2",rect:[4,39,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"3",rect:[4,77,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"4",rect:[4,115,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"5",rect:[4,153,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"6",rect:[4,191,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"7",rect:[4,229,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"8",rect:[4,267,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"9",rect:[4,305,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"10",rect:[4,343,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"11",rect:[4,381,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"12",rect:[4,419,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"13",rect:[4,457,112,36]},{type:"image",name:"editinteractor3d.scenegizmo.item",prefix:"14",rect:[4,495,112,36]}]}),H.Default.setImage("gizmoLock",{width:32,height:64,comps:[{type:"circle",background:"rgba(0,0,0,0.2)",borderColor:"#979797",rect:[0,32,32,32]},{type:"circle",background:"rgba(0,0,0,0.2)",borderColor:"#979797",rect:[0,0,32,32]},{type:"roundRect",borderWidth:2,borderColor:"rgb(255,59,59)",cornerRadius:4,rect:[12,6,8,12]},{type:"roundRect",background:"rgb(255,59,59)",borderColor:"#979797",cornerRadius:1,rect:[8,14,16,12]},{type:"arc",borderWidth:2,borderColor:"rgb(247,247,247)",borderCap:"round",arcClose:!1,rect:[12,38,8,8]},{type:"roundRect",background:"rgb(247,247,247)",borderColor:"#979797",cornerRadius:1,rect:[8,46,16,12]},{type:"shape",borderWidth:2,borderColor:"rgb(247,247,247)",points:[12,42,12,47]}]}),H.Default.setImage("editinteractor3d.cursor.ew-resize",{width:24,height:12,comps:[{type:"shape",background:"rgb(255,255,255)",points:[6.58514,1.5,1.58514,6,6.58514,10.5,6.58514,7.5,17.41486,7.5,17.41486,10.5,22.41486,6,17.41486,1.5,17.41486,4.5,6.58514,4.5,6.58514,1.5],segments:[1,2,2,2,2,2,2,2,2,2,2,5]},{type:"shape",borderWidth:.8,borderWidthAbsolute:!0,borderColor:"#000000",points:[6.58514,1.5,1.58514,6,6.58514,10.5,6.58514,7.5,17.41486,7.5,17.41486,10.5,22.41486,6,17.41486,1.5,17.41486,4.5,6.58514,4.5,6.58514,1.5],segments:[1,2,2,2,2,2,2,2,2,2,2,5]}]}),{Axis:[{model:"lines",vs:[0,0,0,.5,0,0]},{model:"cone",matrix:"S(0.05,0.1,0.05);R(0,0,1,-90);T(0.45,0,0)"}],Plane:[{model:"lines",vs:[-.5,-.5,0,-.5,.5,0,-.5,.5,0,.5,.5,0,.5,.5,0,.5,-.5,0,.5,-.5,0,-.5,-.5,0]},{model:"triangles",vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]}],ScaleAxis:[{model:"lines",vs:[0,0,0,.5,0,0]},{model:"cube",matrix:"S(0.06,0.06,0.06);R(0,0,1,-90);T(0.47,0,0)"},{model:"lines",path:"lineNegative",vs:[.12,0,0,-.12,0,0],visible:!1}],ScaleAxisWhenTransform:[{model:"lines",vs:[.6,0,0,.8,0,0]},{model:"cube",matrix:"S(0.06,0.06,0.06);R(0,0,1,-90);T(0.77,0,0)"},{model:"lines",path:"lineNegative",vs:[.12,0,0,-.12,0,0],visible:!1}],RotateCircle:[{model:"halfCircle",path:"front"},{model:"halfCircle",path:"back",matrix:"R(1,0,0,180)",transparent:!0,opacity:.36}],RotatePlane:[{model:"circlePlane",transparent:!0,opacity:.3,range:[0,1]}],SceneGizmo:[{model:"cube",fixColor:!1,reverseCull:!0,matrix:"S(0.2,0.2,0.2)"},{model:"cone",path:"x",fixColor:!1,reverseCull:!0,side:8,matrix:"S(0.18,0.3,0.18);R(0,0,1,90);T(0.25,0,0)"},{model:"cone",path:"x2",fixColor:!1,reverseCull:!0,side:8,matrix:"S(0.18,0.3,0.18);R(0,0,1,-90);T(-0.25,0,0)"},{model:"cone",path:"y",fixColor:!1,reverseCull:!0,side:8,matrix:"S(0.18,0.3,0.18);R(0,0,1,180);T(0,0.25,0)"},{model:"cone",path:"y2",fixColor:!1,reverseCull:!0,side:8,matrix:"S(0.18,0.3,0.18);R(0,0,1,0);T(0,-0.25,0)"},{model:"cone",path:"z",fixColor:!1,reverseCull:!0,side:8,matrix:"S(0.18,0.3,0.18);R(1,0,0,-90);T(0,0,0.25)"},{model:"cone",path:"z2",fixColor:!1,reverseCull:!0,side:8,matrix:"S(0.18,0.3,0.18);R(1,0,0,90);T(0,0,-0.25)"}],SceneGizmoDesc:[{model:"billboard",path:"cameraType",autorotate:!0,fixColor:!1,matrix:"S(0.6,0.2,0.01)",transparent:!0,opacity:.8}],SceneGizmoLock:[{model:"billboard",path:"lock",autorotate:!0,fixColor:!1,transparent:!0,opacity:.8}],ShapeDiamond:[{model:"diamond",color:"red"}],ShapeLine:[{model:"lines",color:"blue"}],ShapeControlLine:[{model:"dashLine"}],LightCtrlPoint:[{path:"ctrl",model:"billboard",autorotate:!0,matrix:"S(0.1,0.1,0.1)"}],LightDirectional:[{path:"directional",model:"directionalLight"}],LightRectarea:[{model:"lines",vs:[-.5,-.5,0,-.5,.5,0,.5,.5,0,.5,-.5,0,0,0,0,0,0,.5],is:[0,1,1,2,2,3,3,0,4,5]}],LightSpot:[{path:"spot",model:"spotLight"}]}),qE={},RE={cone:[function(E){return E=H.Default.createConeModel(E,0,E,!1,!1,!0),{vs:E.vs.concat(E.bottom_vs)}},["side",12]],billboard:[function(E){var F=E[0],D=E[1],g=E[2],E=E[3];return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[F,D,F,E,g,D,g,D,F,E,g,E],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},["uvRange",[0,0,1,1]]],cube:[function(){var E=H.Default.createBoxModel();return{vs:E.vs,is:E.is}},[]],halfCircle:[function(E){for(var F,D=[],g=[],f=0;f<=E;f++)F=f*Math.PI/E,D.push(0,.5*Math.cos(F),.5*Math.sin(F)),f&&g.push(f-1,f);return{vs:D,is:g}},["resolution",32],{type:"lines"}],directionalLight:[function(E,F,D){for(var g,f=[],T=[],a=0;a<=E;a++){var K=a*Math.PI*2/E,b=.5*Math.cos(K),B=.5*Math.sin(K);f.push(b,B,0),a&&T.push(a-1,a)}for(g=0;g<D;g++)K=g*Math.PI*2/D,b=.5*Math.cos(K),B=.5*Math.sin(K),f.push(b,B,0,b,B,F),T.push(a+2*g,a+2*g+1);return{vs:f,is:T}},["resolution",64,"length",3,"lines",24],{type:"lines"}],spotLight:[function(E,F){for(var D,g=[],f=[],T=0;T<=E;T++){var a=T*Math.PI*2/E,K=.5*Math.cos(a),b=.5*Math.sin(a);g.push(K,b,.5),T&&f.push(T-1,T)}for(F=4*Math.ceil(F/4),g.push(0,0,0),D=0;D<F;D++)a=D*Math.PI*2/F,g.push(.5*Math.cos(a),.5*Math.sin(a),.5),f.push(T,T+1+D);return{vs:g,is:f}},["resolution",64,"lines",12],{type:"lines"}],circlePlane:[function(E){for(var F,D=[0,0,0],g=[],f=0;f<E;f++)F=2*f*Math.PI/E,D.push(0,.5*Math.cos(F),.5*Math.sin(F)),f&&g.push(0,f,f+1);return g.push(0,E,1),{vs:D,is:g}},["resolution",360]],diamond:[function(E){for(var F,D=[0,-.5,0,0,.5,0],g=[],f=0;f<E;f++)F=2*f*Math.PI/E,D.push(.5*Math.cos(F),0,.5*Math.sin(F)),f&&g.push(0,f+1,f+2,1,f+2,f+1);return g.push(0,E+1,2,1,2,E+1),{vs:D,is:g}},["resolution",16]],dashLine:[function(E){for(var F=[],D=[],g=1/E,f=0;f<E;f++)F.push(0,0,f*g),f%2==1&&D.push(f-1,f);return E%2==1&&(F.push(0,0,1),D.push(E-1,E)),{vs:F,is:D}},["resolution",32],{type:"lines"}]},QE=H.graph3d.EditInteractor=function(E,F){var g=this,F=(g.gv=E,g._single=F=F===D||F,g._0R={},g._1R=[new QE.SceneGizmo(g),new QE.Rotate(g),new QE.Translate(g),new QE.Scale(g),new QE.Light(g),new QE.Curve(g),new QE.Point(g),new QE.Camera(g)],g.space=QE.Space.World,g.editMode=QE.Mode.transform,g._3R=new QE.ModelRenderer(E),g._4R=!1,E.getView());F.requestPointerLock=F.requestPointerLock||F.mozRequestPointerLock||F.webkitRequestPointerLock||F.msRequestPointerLock||D},dE=(QE.Space={Local:0,World:1},QE.Mode={transform:4,translate:1,rotate:2,scale:3,moveAnchor:5},H.Default.def(QE,H.graph3d.Interactor,{ms_fire:1}),F.defineProperties(QE.prototype,{space:{get:function(){return this._space},set:function(E){var F;this._space!==E&&(F=this._space,this._space=E,this.redraw(),this.fp("space",F,E))}},editMode:{get:function(){return this._editMode},set:function(E){var F;this.editMode!==E&&(F=this._editMode,this._editMode=E,this.redraw(),this.fp("editMode",F,E))}},lockAngleOfView:{get:function(){return this._4R},set:function(E){var F;this._4R!==E&&(F=this._4R,this._4R=E,this.redraw(),this.fp("lockAngleOfView",F,E))}},editDetail:{get:function(){return!!this._editDetail},set:function(E){var F;!!this._editDetail!=(E=!!E)&&(F=this._editDetail,this._editDetail=E,this._9R("handleEditDetail",!1,E),this.redraw(),this.fp("editDetail",F,E),this.fp("pointsEditingMode",F,E))}},shortcutManager:{get:function(){if(!H.ShortcutManager)return D;var E=this._shortcutManager;return E||((E=this._shortcutManager=new H.ShortcutManager).beforeShortcutAction=function(E,F){if(H.Default.isInput(E.target))return!1}),E}},globalShortcutManager:{get:function(){if(!H.ShortcutManager)return D;var E=this._globalShortcutManager;return E||((E=this._globalShortcutManager=new H.ShortcutManager).beforeShortcutAction=function(E,F){if(H.Default.isInput(E.target))return!1}),E}}}),QE.prototype.setUp=function(){var E=this,F=E.gv;E.log("setUp"),QE.superClass.setUp.call(E),E._5R(),F.sm().ms(E.handleSelectionChange,E),E.initShortcuts(),E.enableShortcut(),E._9R("setUp")},QE.prototype.tearDown=function(){var E=this,F=E.gv;E._9R("tearDown"),E.disableShortcut(),E.clearShortcuts(),F.sm().ums(E.handleSelectionChange,E),E._7R(),QE.superClass.tearDown.call(E),E.log("tearDown")},QE.prototype.handleSelectionChange=function(){this._tryQuitEditDetailMode({smTrigger:!0})},QE.prototype.getCurrentEditingData=function(){if(this._activeMod)return this._activeMod.getEditingData()},QE.prototype.getCurveEditingData=function(){return this.getSubModule("Curve").getEditingData()},QE.prototype.redraw=function(){this.gv.iv()},QE.prototype._6R=function(){for(var E in{_42:!0})break;return function(){var F=this,D=F.gv,g=D.getGL();this._pickValue=200,F._dR?F._activeMod&&F._activeMod[E](D,g):(this._3R.preRender(D),F._9R(E,!1,D,g),this._3R.postRender(D))}}(),QE.prototype.switchSpace=function(){this.space=1-this.space},QE.prototype.isWorldSpace=function(){var E=this.space===QE.Space.World&&!this.inScaleMode();return!(!this.editDetail||!this.invokeActiveMod("isWorldSpace"))||E},QE.prototype.isLocalSpace=function(){return!(!this.editDetail||!this.invokeActiveMod("isLocalSpace"))||!this.isWorldSpace()},QE.prototype.inTranslateMode=function(){return!(!this.editDetail||!this.invokeActiveMod("translateInAllModes"))||this.editMode===QE.Mode.translate&&(!this.editDetail||this.invokeActiveMod("canTranslate"))},QE.prototype.inRotateMode=function(){return this.editMode===QE.Mode.rotate&&(!this.editDetail||this.invokeActiveMod("canRotate"))},QE.prototype.inScaleMode=function(){return this.editMode===QE.Mode.scale&&(!this.editDetail||this.invokeActiveMod("canScale"))},QE.prototype.inTransformMode=function(){return this.editMode===QE.Mode.transform&&(!this.editDetail||this.invokeActiveMod("canTransform"))},QE.prototype.inMoveAnchorMode=function(){return this.editMode===QE.Mode.moveAnchor&&!this.editDetail},QE.prototype.log=function(){},QE.prototype._5R=function(){var E=this,F=E.gv;E._oldEditHelperDrawFunc=F._30O._42,F._30O._42=E._aR.bind(E),E._oldAxisHelperDrawFunc=F._32O._42,F._32O._42=function(){}},QE.prototype._7R=function(){var E=this.gv;E._30O._42=this._oldEditHelperDrawFunc,E._32O._42=this._oldAxisHelperDrawFunc},QE.prototype.getSubModule=function(E){for(var F,D=this._1R,g=0,f=D.length;g<f;g++)if((F=D[g]).catalog===E)return F},QE.prototype._9R=function(E,F){for(var g,f,T=this._1R,a=Array.prototype.slice.call(arguments,2),K=0,b=T.length;K<b;K++)if((f=(g=T[K])[E])&&f.apply(g,a)!=D&&F)return g},QE.prototype._aR=function(){return this._6R()},QE.prototype.handle_touchmove=function(E){return this.handle_mousemove(E)},QE.prototype.handle_mousemove=function(E){H.Default.isDragging()||this._hR(E)},QE.prototype.handle_touchstart=function(E){return this.handle_mousedown(E)},QE.prototype.handle_mousedown=function(E){var F,D,g,f;H.Default.preventDefault(E),H.Default.isDragging()||(D=(F=this).gv).setFocus(E)&&(f=D.getWidth(),g=D.getHeight(),f&&g&&(F._fR=F._getLogicalPoint(E),(!(f=F._hR(E,!0))||F.editDetail&&f===F._activeMod)&&H.Default.isCtrlDown(E)&&H.Default.isLeftButton(E)&&D.isRectSelectable()&&(F._dR=!0,F._bR=F._fR,F.editDetail?F._cR=F.getCurrentEditingData().editing:F._cR=F.gv.sm().toSelection().toArray()),(f||F._dR)&&(F.startDragging(E),f&&f.startEdit(E),F.editing=!0)))},QE.prototype.handleWindowTouchMove=function(E){return this.handleWindowMouseMove(E)},QE.prototype.handleWindowMouseMove=function(E){var F,D,g,f,T,a,K,b,B=this,$=B._fR;if($){if(B._getLogicalPoint(E).distanceTo($)<B.getStyle("moveSensitivity"))return;delete B._fR}B._dR&&($=B.gv,B._betweenRectSelect||($.fi({kind:"beginRectSelect",event:E,selection:B._cR}),B._betweenRectSelect=!0),F="ellipse"===B.getStyle("rectSelectShape"),D=B.div,p=B._getLogicalPoint(E),D||(D=B.div=e(),A(B.getView(),D),D.style.background=$.getRectSelectBackground()),D.rect=v(B._bR,p),F&&(B._bR.x<p.x&&(D.rect.x=D.rect.x-D.rect.width),B._bR.y<p.y&&(D.rect.y=D.rect.y-D.rect.height),D.rect.width=2*D.rect.width,D.rect.height=2*D.rect.height,D.style.borderRadius=D.rect.width/2+"px/"+D.rect.height/2+"px"),EE(D,D.rect),g=B._cR,B.editDetail&&B._activeMod?B._activeMod.handleRectSelection(D.rect,g,E):(T=$.getDatasInRect(D.rect,function(E,g,f){return!E.edit&&(F?(E=2*(g-D.rect.x)/D.rect.width-1)*E+(g=2*(f-D.rect.y)/D.rect.height-1)*g<=1:void 0)}),f={},T=T.toArray(),p=$.sm(),a=new H.List,K=H.Default.isShiftDown(E),(b=E.altKey)&&!K?g.forEach(function(E){T.indexOf(E)<0&&a.add(E)}):g.concat(T).forEach(function(E){f[E.getId()]||(f[E.getId()]=!0,(K&&!b||0<=g.indexOf(E)^0<=T.indexOf(E))&&a.add(E))}),p.ss(a)),$.fi({kind:"betweenRectSelect",event:E,rect:D.rect}));var p=B._eR;p&&p.handleEdit(E)},QE.prototype.handleWindowTouchEnd=function(E){return this.handleWindowMouseUp(E)},QE.prototype._getValidSelection=function(){var E=this.gv,F=[];return E.sm().getSelection().each(function(D){E.isVisible(D)&&E.isEditable(D)&&F.push(D)}),F},QE.prototype.handleWindowMouseUp=function(){for(var E in{endEdit:!0})break;return function(F){var D,g,f=this,T=f.gv,a=(f.editing=!1,f._eR),a=(a&&a[E](F),!F.__endSceneGizmoEdit__&&f._fR&&H.Default.isLeftButton(F)&&(f.invokeActiveMod("cancelSelection",F),H.Default.isDoubleClick(F)&&!f._9R("handleDoubleClick",!0,F)&&(f.editDetail?f._tryQuitEditDetailMode(F):f._tryEnterEditDetailMode(F)),f.editDetail||F.clickThrough||(T=f.gv,D=(a=f.getDataInfoAt(F))?a.data:null,g=T.sm(),D?(H.Default.isCtrlDown(F)?g.co(D)?g.rs(D):g.as(D):g.co(D)?D instanceof H.Block&&D.isClickThroughEnabled()&&(a=f.getDataInfoAt(F,!0))&&(F.clickThrough=!0,this.gv.sm().ss(a.data)):g.ss(D),H.Default.isDoubleClick(F)?T.fi({kind:"doubleClickData",event:F,data:D}):T.fi({kind:"clickData",event:F,data:D})):(g.clearSelection(),H.Default.isDoubleClick(F)?T.fi({kind:"doubleClickBackground",event:F}):T.fi({kind:"clickBackground",event:F})))),f.div);f._betweenRectSelect&&(T.fi({kind:"endRectSelect",event:F,rect:a.rect}),f._dR=null,FE(a),f.div=null,f.redraw()),f.editDetail&&T.fi({kind:"betweenEditDetail",event:F}),f._fR=f._dR=f._bR=f._cR=f._betweenRectSelect=null}}(),QE.prototype.getDataInfoAt=function(E,F){return this.gv.getDataInfoDuringInteract(E,F)},QE.prototype.handle_DOMMouseScroll=function(E){2===E.axis&&this.handleScroll(E,-E.detail)},QE.prototype.handle_mousewheel=function(E){this.handleScroll(E,E.wheelDelta/40)},QE.prototype.handleScroll=function(E,F){var D=this.gv,g=this.isAltDown(E);g&&(D.__oldZoomToCenter__=D.getZoomToCenter(),D.setZoomToCenter(!1)),D.handleScroll(E,F),g&&(D.setZoomToCenter(D.__oldZoomToCenter__),delete D.__oldZoomToCenter__)},QE.prototype.handle_contextmenu=function(E){H.Default.preventDefault(E)},QE.prototype.setStyle=function(E,F){var D=this;D.getStyle(E)!==F&&(F===QE.BaseStyleMap[E]?delete D._0R[E]:D._0R[E]=F,"locale"===E&&this.getSubModule("SceneGizmo").clearCachedImage(),D.fp("styleChanged",null,{key:E,value:F}),D.redraw())},QE.prototype.getStyle=function(E){var F=this._0R[E];return F!==D?F:QE.BaseStyleMap[E]},QE.prototype.getKeysMap=function(){
return this.getStyle("keysMap")[uE?"mac":"windows"]},QE.prototype.requestPickColor=function(E,F){var D=this.gv.pickColorMap,g=this._pickValue++;return D[g]={data:E,type:F,edit:!0},X(g)},QE.prototype._tryEnterEditDetailMode=function(E){var F=this;if(!F.editDetail){var D=F._9R("canEnterEditDetailMode",!0,E);if(D)return F._activeMod=D,F.editDetail=!0,F.gv.fi({kind:"beginEditDetail",event:E}),!0}},QE.prototype.enterEditDetailMode=function(E){if(E=this.getSubModule(E),this.editDetail){if(E===this._activeMod)return;this._tryQuitEditDetailMode({smTrigger:!0})}return this._tryEnterEditDetailMode({apiTrigger:!0})},QE.prototype._tryQuitEditDetailMode=function(E){var F=this;return!(!F.editDetail||E&&!F.invokeActiveMod("canQuitEditDetailMode",E)||(F.editDetail=!1,F.gv.fi({kind:"selectPoint"}),F.gv.fi({kind:"endEditDetail",event:E}),F._activeMod=null))},QE.prototype.eachSelection=function(E,F){this.gv.sm().each(function(D){F&&!1===F(D)||E(D)})},QE.prototype._getLogicalPoint=QE.prototype.lp=function(E){return E=this.gv.lp(E),new _.Vector2(E)},QE.prototype._hR=function(E,F){var D=this,g=D.gv,f=D.getStyle("pickRange"),T=D.editDetail?(T=(T=g.getDataInfoAt(E,f,function(E){if(!E.edit||0!==E.type.indexOf("curveControlPoint"))return!1}))||g.getDataInfoAt(E,f,function(E){if(!E.edit||0!==E.type.indexOf("translate"))return!1}))||g.getDataInfoAt(E,f,function(E){if(!E.edit)return!1}):D.inTransformMode()?(T=g.getDataInfoAt(E,f,function(E){if(!E.edit||0!==E.type.indexOf("scale")&&0!==E.type.indexOf("light"))return!1}))||g.getDataInfoAt(E,f,function(E){if(!E.edit||0!==E.type.indexOf("translate"))return!1})||g.getDataInfoAt(E,f,function(E){if(!E.edit)return!1}):g.getDataInfoAt(E,f,function(E){if(!E.edit)return!1}),f=D._getLogicalPoint(E),g=(D._9R("prepareCheck",!1,g,E,f,T),D._9R("check",!0,g,E,f,T,F)||null);return D._eR=g},QE.prototype.isAltDown=function(E){return!(!E||!E.altKey)||H.Default.getCurrentKeyCodeMap()[18]},QE.prototype._jR=function(E,F){this._3R.render(E,F)},QE.prototype.getDataEditMatrix=(mE=new J,function(E,F){var D=new J,g=this.nodePosition(E),f=this.gv.getPositionInfo(g).width*this.getStyle("gizmoSize")/(this.gv.getWidth()||100);return D.scale({x:f,y:f,z:f}),"world"!==F&&("local"===F||this.isLocalSpace())&&(mE.makeRotationFromQuaternion(this.nodeQuaternion(E)),D.premultiply(mE)),D.setPosition({x:g[0],y:g[1],z:g[2]}),D}),new _.Ray);QE.prototype._kR=function(E,F){var D=this.gv;return D.isOrtho()?(dE.origin.copy(D.getEye()),dE.direction.copy(D.getCenter()).sub(dE.origin),dE.origin.copy(dE.direction).setLength(-D.getFar()-D.getNear()).add(new C(D.unproject(E))),dE.direction.normalize()):(dE.origin.copy(D.getEye()),dE.direction.copy(D.unproject(E)).sub(dE.origin).normalize()),dE.intersectPlane(F)},QE.prototype._lR=(kE=new C,VE=new C,iE=new C,jE=new C,nE=new C,yE=new C,IE=new J,function(E,F,D,g,f){var T=this.gv,T=(rE=T.isOrtho(),kE.copy(T.getEye()),rE&&iE.copy(T.getCenter()).sub(kE).normalize(),sE=this.getStyle("parallelFactorSection"),W(IE.copy(E).multiply(F||KE),f)),F=W(IE.copy(E).multiply(D||KE),f),D=W(IE.copy(E).multiply(g||KE),f),E=null;return TE(T,1)?E="left":TE(T,-1)?E="right":TE(F,1,1e-5)?E="bottom":TE(F,-1,1e-5)?E="top":TE(D,1)?E="back":TE(D,-1)&&(E="front"),{x:Y(T),y:Y(F),z:Y(D),face:E}}),QE.prototype.getString=function(E){var F=this.getStyle("locale");return this.getStyle("locales")[F][E]},QE.prototype.initShortcuts=function(){function E(E){"down"===E.kind&&(g.beginTransaction(),E=E.event,(g.editDetail&&g._activeMod?g._activeMod:T).handleDelete(E),g.endTransaction())}this.clearShortcuts();var F,g=this,f=g.getKeysMap(),T=g.gv,a=g.shortcutManager,K=(a.registerShortcut([uE?"meta":"ctrl","a"],{tag:"selectAll",action:function(E){"down"!==E.kind||g.invokeActiveMod("selectAll")||T.selectAll()}}),a.registerShortcut("delete",{tag:"delete",action:E},!0),a.registerShortcut("backspace",{tag:"backspace",action:E},!0),a.registerShortcut("enter",{tag:"editDetail",action:function(E){"down"===E.kind&&(g.editDetail?g.editDetail=!1:g._tryEnterEditDetailMode(E.event))}}),a.registerShortcut("escape",{tag:"cancelEdit",action:function(E){"down"===E.kind&&g.editDetail&&g._tryQuitEditDetailMode({forceQuit:!0})}}),g.globalShortcutManager),b=(K.stopPropagation=!0,f.mode);for(F in b)K.registerShortcut(b[F],{tag:"mode."+F,action:function(E,F){"down"===F.kind&&(g.editMode=QE.Mode[E])}.bind(D,F)});K.registerShortcut(f.space,{tag:"mode.space",action:function(E){"down"===E.kind&&g.switchSpace()}}),K.registerShortcut(f.focus,{tag:"focus",action:function(E){var F;"down"===E.kind&&(g.editDetail&&g._activeMod?(E=T.getEye(),F=T.getCenter(),T.flyTo(D,{animation:g.getStyle("focusAnimation"),center:g._activeMod.getEditingData().p3(),distance:H.Default.getDistance(E,F)})):T.flyTo(T.dm().sm().getSelection(),{animation:g.getStyle("focusAnimation")}))}}),K.registerShortcut(f.reset,{tag:"reset",action:function(E){"down"===E.kind&&T.isResettable()&&T.reset()}}),g._9R("initShortcuts")},QE.prototype.clearShortcuts=function(){this.shortcutManager.clearShortcuts(),this.globalShortcutManager.clearShortcuts()},QE.prototype.enableShortcut=function(){this.shortcutManager.enableShortcut(this.gv.getView()),this.globalShortcutManager.enableShortcut()},QE.prototype.disableShortcut=function(){this.shortcutManager.disableShortcut(),this.globalShortcutManager.disableShortcut()},QE.prototype.beginTransaction=function(){this.gv.dm().beginTransaction()},QE.prototype.endTransaction=function(){this.gv.dm().endTransaction()},QE.prototype.invokeActiveMod=function(E,F){return this._activeMod&&this._activeMod[E]&&this._activeMod[E](F)},QE.prototype.nodePosition=function(E){var F=this.gv;if(!F.hasModelMatrixProcess())return 1===(D=arguments.length)?E.p3():2===D?E.p3(arguments[1]):E.p3(arguments[1],arguments[2],arguments[3]);var D=F.createNodeFinalMatrix(E);if(1===arguments.length)return[D[12],D[13],D[14]];var g=arguments[1],f=arguments[2],T=arguments[3];2===arguments.length&&(f=g[1],T=g[2],g=g[0]),D[12]=g,D[13]=f,D[14]=T,D=F.reverseProcessModelMatrix(D),p(E,D,!0)},QE.prototype.nodeQuaternion=function(E){var F=this.gv,D=1===arguments.length;if(!F.hasModelMatrixProcess())return D?E.getQuaternion():E.setQuaternion(arguments[1]);var g=F.createNodeFinalMatrix(E);if(D)return NE(g).quaternion.clone();D=NE(g),g=F.reverseProcessModelMatrix(bE.compose(D.position,arguments[1],D.scale).getElements()),p(E,g,!0)},QE.prototype.moveSelection=function(E,F,D){var g=this.gv;if(!g.hasModelMatrixProcess())return g.moveSelection(E,F,D);var f=this,T=g.sm().toSelection(g.isMovable,g),a={};T.forEach(function(E){E.hasOwnProperty("translate3d")&&(a[E.getId()]=E.translate3d),E.translate3d=function(F,D,g){1===arguments.length&&(D=F[1],g=F[2],F=F[0]);var T=f.nodePosition(this);f.nodePosition(E,T[0]+F,T[1]+D,T[2]+g)}}),g.moveSelection(E,F,D),T.forEach(function(E){var F=a[E.getId()];F?E.translate3d=F:delete E.translate3d})},QE.BaseStyleMap={locale:"zh",locales:{zh:{persp:"\u900f\u89c6",iso:"\u6b63\u4ea4",front:"\u524d",back:"\u540e",top:"\u9876",bottom:"\u5e95",left:"\u5de6",right:"\u53f3"},en:{persp:"Persp",iso:"Iso",front:"Front",back:"Back",top:"Top",bottom:"Bottom",left:"Left",right:"Right"}},moveSensitivity:10,moveStep:0,mouseMoveZoomIncrement:1,rotateCameraSpeed:1,roamingSpeed:1,moveOnSurface:!1,moveAlignNormal:!1,moveCheckOffset:[0,500,0],moveOnPlane:[0,1,0],colorX:"rgb(245,62,35)",colorY:"rgb(180,245,45)",colorZ:"rgb(58,125,245)",colorXYZ:"rgb(188,188,188)",colorTranslateXYZ:"rgb(180,180,10)",colorHighlight:"rgb(255,255,0)",colorGray:"rgb(128,128,128)",colorRotateBack:"rgb(128,128,128)",colorRotateScreen:"rgb(150,150,150)",pickRange:6,rectSelectShape:"rect",rotateSpeed:.3*Math.PI/180,rotateStep:0,rotateGlobeEnabled:!0,shapeDiamondSize:[15,30,15],shapeDiamondSizeInEditing:[6,6,6],shapeDiamondColor:"blue",shapeStartDiamondColor:"red",shapeDiamondHighlight:"yellow",shapeColorGray:"rgba(0,0,255,0.3)",shapeDiamondActive:"red",shapeControlColor:"#868686",shapeDashLineGap:10,gizmoSize:200,gizmoAtlasScale:1.82,sceneGizmoSize:110,sceneGizmoOffset:[0,0],lockGizmoSize:28,lightLineColor:"#FEB64D",lightCtrlPointColor:"#FFC773",gizmoColorXYZ:"rgb(255,255,255)",gizmoColorBack:"rgb(245,245,245)",colorX2:"rgb(245,210,210)",colorY2:"rgb(210,245,210)",colorZ2:"rgb(210,210,245)",gizmoRotateAnimDuration:160,highlightColor:"rgb(212,0,0)",wireframeColor:"rgb(124,145,155)",shiftAcceleration:5,parallelFactorSection:[.93,.97],ignoreKeysList:["ctrl + s","cmd + s"],focusAnimation:!0,keysMap:(bF={focus:"f",space:"`",reset:" ",mode:{transform:"1",translate:"2",rotate:"3",scale:"4",moveAnchor:"5"},pan:{left:"a",right:"d",up:"q",down:"e"},rotate:{left:"arrowleft",right:"arrowright",up:"arrowup",down:"arrowdown"},zoom:{in:"w",out:"s"},ortho:{left:"j",right:"l",top:"i",bottom:"k",front:"u",back:"o"}},(gF=JSON.stringify(bF)).replace(/ctrl/g,"meta"),{mac:JSON.parse(gF),windows:bF})};var _E,CE,SE,JE,OE,LE,ME,GE,cE,lE,xE,zE,XE,wE,eE,AE,vE,EF,FF,DF,gF=QE.ModelRenderer=function(E){this.gv=E};gF.prototype.preRender=function(E){E.getRenderState().directUniforms().uLight=!0},gF.prototype.postRender=function(E){},gF.prototype.render=(lE=$E(),xE=$E(),zE=$E(),XE=$E(),wE=[],eE="white",AE=new H.Math.Matrix2d,vE=function(E,F,g){return(F=ME[F+g])!=D?F:(F=E[g],F==D&&GE&&(E=GE[g])!=D?E:F)},EF=function(E){var F=E instanceof aE?E:(F=E._buffer32)||(E._buffer32=new aE(E));return G(CE,null,F)},FF=function(E){if(E instanceof Uint32Array||E instanceof Uint16Array)F=E;else{for(var F=E._buffer32,D=-1/0,g=0,f=E.length;g<f;g++){var T=E[g];D<T&&(D=T)}F=F||(E._buffer32=new(65535<D?Uint32Array:Uint16Array)(E))}return x(CE,null,F)},DF={lines:function(E,F){return h(E,F,1)},triangles:function(E,F){return h(E,F,null)}},function(E,F,D){var g,f,T;_E=this.gv,(CE=_E.getGL())&&(SE=_E.getRenderState(),JE=SE.directUniforms(),LE=SE.directAttribs(),OE=SE.directState(),f=!1,(g=F.state)&&(g.enableDepth&&(f=!0),g.clearDepth&&CE.clear(256),g.viewport&&(T=_E.getViewport(CE),B(_E,CE,g.viewport))),OE.depth.enabled=f,JE.uBlend=!1,JE.uSampler=CE._emptyTexture,JE.uBlendSampler=CE._emptyBlendTexture,lE.fromArray(_E._viewMatrix),zE.getInverse(lE),xE.identity(),ME=F||{},u(E,D||""),JE.uFix=!1,T&&B(_E,CE,T))});var fF=new H.Math.Quaternion,TF=(t(U,H.Node,{getUIClass:function(){return TF},get3dUIClass:function(){return TF},setPosition:b,setElevation:b,setRotation:b,setRotationX:b,setRotationZ:b,setScale:b,setTall:b,setSize:b,isPresenting:function(){return 0<this._editing.length},isSingle:function(){return 1===this._editing.length},clear:function(){this.detachTarget(),this._editing=[]},setCurrent:function(E,F){var D=this._editing,g=D.indexOf(E);F?this._editing=[E]:0<=g?this._editing.splice(g,1):D.splice(0,0,E)},attachTarget:function(E){this.target=E},detachTarget:function(){this.target=null},getQuaternion:function(){var E=this.target;return!E||this.isCylinder(E)?fF:E.getQuaternion()},isCylinder:function(E){return(E=E||this._target)instanceof H.Polyline||E instanceof H.Edge},isActive:function(E){return 0<=this._editing.indexOf(E)},_locateByRealPointIndex:function(E,F){for(var D=E.getSegments(),g=-1,f=-1,f=(D.length,0),T=(D=D instanceof H.List?D.getArray():D).length;f<T;f++){var a=D[f],K=1;if(3===a)K=2;else if(4===a)K=3;else if(5===a)continue;if(g+=K,f===F)return this._locateByPointIndex(E,g)}return null},_locateByPointIndex:function(E,F){var F=E.getPoints().get(F),D=E.getElevation();return(new C).setY(this.isCylinder(E)&&"number"==typeof F.e?F.e:D).setX(F.x).setZ(F.y)},p3:function(E,F,g){var f=this.target;if(f){var T=this._editing[0];if(T!=D){var a=f.getPointsMatrix3d(),f=this._locateByPointIndex(f,T);if(f.applyMatrix4(a),0===arguments.length)return f.toArray();1===arguments.length&&(F=E[1],g=E[2],E=E[0]),this.moveSelection(f.clone().set(E,F,g).sub(f))}}},_findAllPointsIncludePair:function(E){if(E=E||this._editing,!(F=this._target.getSegments()))return E;for(var F=F.getArray(),D=E.slice(0),g=-1,f=0,T=F.length;f<T;f++){var a=F[f],K=1;if(3===a)K=2;else if(4===a)K=3;else if(5===a)continue;g+=K,4===a?(0<=D.indexOf(g-3)&&D.push(g-2),0<=D.indexOf(g)&&D.push(g-1)):3===a&&0<=D.indexOf(g-2)&&0<=D.indexOf(g)&&D.push(g-1)}return D},moveSelection:function(E){var F,g,f,T,a,K,b,B=this,$=B.target;!$||(F=B._editing[0])!==D&&(f=(g=$.getPointsMatrix3d()).clone().getInverse(g),T=B._locateByPointIndex($,F),a=T.clone().applyMatrix4(g).add(E).applyMatrix4(f).sub(T),K=H.Default.clone($.getPoints()),b=$.getElevation(),B._findAllPointsIncludePair().forEach(function(E){E=K.get(E),"number"!=typeof E.e&&(E.e=b),E.x+=a.x,E.y+=a.z,E.e+=a.y}),$.setPoints(K.getArray()),E=new C($.p3()).applyMatrix4(g),$.p3(E.toArray()),(T=B._locateByPointIndex($,F)).applyMatrix4(g),0!==a.length&&this.fp("p3",D,T))},handleRectSelect:function(E,F,D){var g=E.concat(F),f=[],T={},a=H.Default.isShiftDown(D),K=D.altKey;if(K&&!a)for(var b=0,B=F.length;b<B;b++){var $=F[b];E.indexOf($)<0&&f.push($)}else for(var b=0,p=g.length;b<p;b++)T[$=g[b]]||(T[$]=!0,(a&&!K||0<=F.indexOf($)^0<=E.indexOf($))&&f.push($));this._editing=f}}),F.defineProperties(U.prototype,{target:{get:function(){return this._target},set:function(E){E instanceof H.Data||(E=null),this._target!==E&&(this._target=E)}},editing:{get:function(){return this._editing},set:function(E){this._editing=E}}}),function(){}),aF=(t(TF,F,{drawBody:b}),QE.SceneGizmo=function(E){function F(E,F){var D=E.getRenderState().directUniforms();E._fovy=F,E._81O=null,E._setupPVMatrix(),E.getPVMatrix(!0),D.uProjectMatrix=E._projectMatrix}var g,f,T,a=new H.Node,K=$E("R(0, 0, 1, 90)"),b=$E("R(0, 1, 0, -90)"),B=null,$=-1,p="",W=-1,Y={default:0,front:1,back:2,top:3,bottom:4,left:5,right:6};this.catalog="SceneGizmo",this._42=function(){var g=E.gv,f=g.getWidth(),o=g.getHeight();if(f&&o){var h,u,U,t,Z,m=g._picking,r=E.lockAngleOfView,s=g.isOrtho(),k=(s||.001<Math.abs(g.getFovy()-.25*Math.PI)&&(h=g.getFovy(),F(g,.25*Math.PI)),new J),V=g.getNear(),i=new C(g.getEye()),j=new C(g.getCenter()),n=j.clone().sub(i).setLength(V).add(i),y=g.getPositionInfo(n.toArray()),I=E.getStyle("sceneGizmoSize"),N=E.getStyle("sceneGizmoOffset"),y=y.width*I/f,V=(s&&(y*=.88),k.scale({x:y,y:y,z:y}),n=j.clone().sub(i).setLength(V+1.5*y).add(i),g.getHitPosition({x:f/2,y:o/2},n.toArray(),i.sub(j).normalize().toArray())),y=(k.setPosition({x:V[0],y:V[1],z:V[2]}),g.getViewport(g.getGL())),i=[y[0]+(1-(2*N[0]+I)/f)*y[2]/2,y[1]+(1-(2*N[1]+I)/o)*y[3]/2,y[2],y[3]],P=(m?(_=E.requestPickColor(a,"sceneGizmoX"),S=E.requestPickColor(a,"sceneGizmoY"),O=E.requestPickColor(a,"sceneGizmoZ"),L=E.requestPickColor(a,"sceneGizmoX2"),M=E.requestPickColor(a,"sceneGizmoY2"),G=E.requestPickColor(a,"sceneGizmoZ2"),d=E.requestPickColor(a,"sceneGizmoXYZ")):(L=M=G=d=E.getStyle("colorXYZ"),_=E.getStyle("colorX"),S=E.getStyle("colorY"),O=E.getStyle("colorZ")),{matrix:k,state:{enableDepth:!0,clearDepth:!0,viewport:i},"g.color":d,"g.x.color":_,"g.y.color":S,"g.z.color":O,"g.x2.color":L,"g.y2.color":M,"g.z2.color":G}),q=E._lR(k,null,K,b);for(u in q)"face"!==u&&(Z=(t="g."+u)+"2",(U=q[u])<1&&(0===U?(P[t+".visible"]=!1,P[Z+".visible"]=!1):m||(P[t+".transparent"]=!0,P[t+".opacity"]=U,P[Z+".transparent"]=!0,P[Z+".opacity"]=U)));!m&&r&&["x","y","z","x2","y2","z2","cube"].forEach(function(E){!1!==P[(E="g."+E+".")+"visible"]&&(P[E+"reverseCull"]=!0,P[E+"transparent"]=!0,P[E+"opacity"]=.35)}),m&&r||E._jR([{path:"g",model:"SceneGizmo"}],P);var R,Q,j=E.getStyle("gizmoAtlasScale"),V="interactor3d.gizmo.atlas."+E.getStyle("locale"),d=H.Default.getImage("gizmoAtlas"),_=$E("S(0.6,0.6,0.06);S("+[j,j*d.height*(1/14)/d.width,j].join(",")+")"),S=(new J).fromArray(g._viewMatrix),O=(new J).getInverse(S),L=pE(S.multiply(k).multiply(_)).premultiply(O),M=n.set(-.5,0,0).applyMatrix4(L).toArray(),G=n.set(.5,0,0).applyMatrix4(L).toArray(),S=Math.abs(g.toViewPosition(M).x-g.toViewPosition(G).x)*devicePixelRatio,O=Math.round(S),n=O/S,L=(_.multiply($E("S("+[n,n,n].join(",")+")")),B&&$===O&&p===V||($=O,p=V,R=new H.Data,Q=1,["","front","back","top","bottom","left","right"].forEach(function(F){["persp","iso"].forEach(function(D){R.a(Q+".mode",D),R.a(Q+".text",E.getString(F||D)),Q++})}),B=H.Default.toCanvas(d,$,$*d.height/d.width,D,R),g.deleteTexture(V),H.Default.setImage(V,B)),i[1]-=(10*j+I)/o*y[3]/2,s?1:0),M=(q.face&&(L+=2*Y[q.face]),{matrix:k,state:{enableDepth:!0,clearDepth:!0,viewport:i},"d.cameraType.transparent":!0,"d.cameraType.opacity":1,"d.cameraType.matrix":_,"d.cameraType.image":V,"d.cameraType.uvScale":[1,1/14],"d.cameraType.uvOffset":[0,1/14*L]}),S=(m&&(M["d.cameraType.image"]=null,M["d.cameraType.fixColor"]=!0,M["d.cameraType.transparent"]=!1,M["d.cameraType.color"]=E.requestPickColor(a,"sceneGizmoCameraType")),!m&&r&&(M["d.cameraType.transparent"]=!0,M["d.cameraType.opacity"]=.1),m&&r||E._jR([{path:"d",model:"SceneGizmoDesc"}],M),I=E.getStyle("lockGizmoSize"),W!==I&&(W=I,d=H.Default.getImage("gizmoLock"),G=W/d.width,T=H.Default.toCanvas(d,W,d.height*G),H.Default.setImage("interactor3d.gizmo.lock",T)),i[0]=y[0]+(1-(2*N[0]+I)/f)*y[2]/2,i[1]=y[1]+(1-(2*N[1]+I)/o)*y[3]/2,r?0:.5),n={matrix:k,state:{enableDepth:!0,clearDepth:!0,viewport:i},"l.lock.image":"interactor3d.gizmo.lock","l.lock.matrix":"S(0.2, 0.2, 0.2)","l.lock.uvScale":[1,.5],"l.lock.uvOffset":[0,S]};m&&(n["l.lock.image"]=null,n["l.lock.fixColor"]=!0,n["l.lock.transparent"]=!1,n["l.lock.color"]=E.requestPickColor(a,"sceneGizmoLock")),E._jR([{path:"l",model:"SceneGizmoLock"}],n),h!==D&&F(g,h)}},this.check=function(E,F,D,g){if((g=g&&g.type)&&0===g.indexOf("sceneGizmo"))return f=g,!0;f=null},this.startEdit=function(F){E.gv._flyAnim||(g={type:f,start:new S(E.gv.lp(F))})};var o=new S,h=(this.handleEdit=function(F){g&&g.type&&(o.copy(E.gv.lp(F)),1e-5<g.start.distanceToSquared(o)&&(g.moved=!0))},{sceneGizmoX:[1,0,0],sceneGizmoX2:[-1,0,0],sceneGizmoY:[0,1,0],sceneGizmoY2:[0,-1,0],sceneGizmoZ:[0,0,1],sceneGizmoZ2:[0,0,-1]}),u=(this.endEdit=function(F){var D,f,T=E.gv;g&&!g.moved&&(H.Default.isLeftButton(F)&&("sceneGizmoXYZ"===(f=g.type)||"sceneGizmoCameraType"===f?((D=T.isOrtho())||T.setOrthoWidth(T.getCenterInfo().width),T.setOrtho(!D)):"sceneGizmoLock"===f?E.lockAngleOfView=!E.lockAngleOfView:U(h[f]),F.__endSceneGizmoEdit__=!0),T.fi({kind:"clickSceneGizmo",event:F})),g=null},this.clearCachedImage=function(){B=null},{left:"sceneGizmoX2",right:"sceneGizmoX",top:"sceneGizmoY",bottom:"sceneGizmoY2",front:"sceneGizmoZ",back:"sceneGizmoZ2"}),U=(this.initShortcuts=function(){var F,g=E.shortcutManager,f=E.getKeysMap().ortho;for(F in f)g.registerShortcut(f[F],{tag:"ortho."+F,action:function(E,F){"down"===F.kind&&U(h[u[E]])}.bind(D,F)})},function(F){var D=E.gv,g=new C(D.getEye()),f=new C(D.getCenter()),g=g.distanceTo(f);D.flyTo(null,{worldDirection:F,center:D.getCenter(),animation:{duration:E.getStyle("gizmoRotateAnimDuration")},distance:g})})},QE.Translate=function(E){function F(F){F!=f&&(f=F,E.gv.iv())}E.log("start"),this.catalog="Translate";var D,g,f=null,T=[{path:"x",model:"Axis"},{path:"y",model:"Axis"},{path:"z",model:"Axis"},{path:"xy",model:"Plane"},{path:"xz",model:"Plane"},{path:"yz",model:"Plane"},{path:"xyz",model:"Plane"}],a=$E("R(0, 0, 1, 90)"),K=$E("R(0, 1, 0, -90)"),b=[.12,.2],B=$E("S(0.1, 0.1, 0.1); T("+[b[0],b[0],0].join(",")+")"),$=$E("S(0.1, 0.1, 0.1); R(1, 0, 0, -90); T("+[b[0],0,b[0]].join(",")+")"),p=$E("S(0.1, 0.1, 0.1); R(0, 1, 0, 90); T("+[0,b[0],b[0]].join(",")+")"),W=$E("S(0.1, 0.1, 0.1); T("+[b[1],b[1],0].join(",")+")"),Y=$E("S(0.1, 0.1, 0.1); R(1, 0, 0, -90); T("+[b[1],0,b[1]].join(",")+")"),o=$E("S(0.1, 0.1, 0.1); R(0, 1, 0, 90); T("+[0,b[1],b[1]].join(",")+")"),h=new J,u=new C,U=(this._42=function(){var F=E.inTransformMode(),b=E.inMoveAnchorMode();if(E.inTranslateMode()||b||F&&!E.getSubModule("Scale").isEditing()&&!E.getSubModule("Rotate").isEditing()){var U,H=E.gv;if(E.editDetail){if(!(U=E.getCurrentEditingData())||!U.isPresenting())return}else if(!(U=H.sm().ld())||!H.isEditable(U)||!b&&!H.isMovable(U))return;var t,Z,m,r,b=E.getDataEditMatrix(U),s=H._picking,k=!0,V=!0,i=!0,j=!F;if(s)n=E.requestPickColor(U,"translateX"),y=E.requestPickColor(U,"translateY"),I=E.requestPickColor(U,"translateZ"),t=E.requestPickColor(U,"translateXY"),Z=E.requestPickColor(U,"translateXZ"),m=E.requestPickColor(U,"translateYZ"),N=E.requestPickColor(U,"translateXYZ"),P=r=!1;else{n=m=E.getStyle("colorX");var n,y=Z=E.getStyle("colorY"),I=t=E.getStyle("colorZ"),N=E.getStyle("colorTranslateXYZ"),P=r=!0,q=E.getStyle("colorHighlight");if(D||f)switch(D?(d=D.type,n=y=I=t=Z=m=E.getStyle("colorGray"),i="translateXY"===d,k="translateXZ"===d,V="translateYZ"===d,j="translateXYZ"===d):d=f,d){case"translateX":n=q;break;case"translateY":y=q;break;case"translateZ":I=q;break;case"translateXY":t=n=y=q;break;case"translateXZ":Z=n=I=q;break;case"translateYZ":m=y=I=q;break;case"translateXYZ":N=n=y=I=q}}j&&(d=H.getEye(),R=H.getCenter(),h.lookAtDirection(u.set(d[0]-R[0],d[1]-R[1],d[2]-R[2]),new C(H.getUp())).scale(u.set(.1,.1,.1)));var R,Q={data:U,matrix:b,"x.matrix":null,"x.color":n,"y.matrix":a,"y.color":y,"z.matrix":K,"z.color":I,"xy.matrix":F?B:W,"xy.visible":i,"xy.color":t,"xy.lines.visible":P,"xy.triangles.transparent":r,"xy.triangles.opacity":.25,"xz.matrix":F?$:Y,"xz.visible":k,"xz.color":Z,"xz.lines.visible":P,"xz.triangles.transparent":r,"xz.triangles.opacity":.25,"yz.matrix":F?p:o,"yz.visible":V,"yz.color":m,"yz.lines.visible":P,"yz.triangles.transparent":r,"yz.triangles.opacity":.25,"xyz.matrix":h,"xyz.visible":j,"xyz.color":N,"xyz.lines.visible":P,"xyz.lines.autorotate":P,"xyz.triangles.transparent":r,"xyz.triangles.autorotate":r,"xyz.triangles.opacity":.25},d=!1;if(U.isCurvePoint&&!U.isCylinder()&&(Q["y.visible"]=!(d=!0)),!D){var _,S,J,O=E._lR(b,null,a,K);for(_ in d&&(O.y=0),O)"face"!==_&&(S=O[_])<1&&(0===S?Q[_+".visible"]=!1:s||(Q[_+".lines.transparent"]=!0,Q[_+".lines.opacity"]=S,Q[_+".cone.transparent"]=!0,Q[_+".cone.opacity"]=S));for(_ in O=E._lR(b,null,a,K,!0),d&&(O.x=O.z=0),O)"face"!==_&&(J="x"===_?"yz":"y"===_?"xz":"xy",(S=O[_])<1&&(0===S?(Q[J+".visible"]=!1,Q[J+".visible"]=!1):s||(Q[J+".lines.transparent"]=!0,Q[J+".lines.opacity"]=S,Q[J+".triangles.transparent"]=!0,Q[J+".triangles.opacity"]=.25*S)))}E._jR(T,Q),s||(g=Q)}},this.prepareCheck=function(){F(null)},this.check=function(E,D,g,f,T){if((f=f&&f.type)&&0===f.indexOf("translate")&&(!T||H.Default.isLeftButton(D)))return F(f),!0},this.isEditing=function(){return D},new C),t=new C,Z=new C,m=new C;this.startEdit=function(F){var T,a=E.gv,K=g.data,b=E.inMoveAnchorMode();K&&(b||a.isMovable(K))&&H.Default.isLeftButton(F)&&(T=g.matrix.clone(),U.copy(E.nodePosition(K)),D={type:f,anchorMoving:b,startPosition:U.clone()},b&&(!(b=(new J).fromArray(H.Default.getInternal().createNodeMatrix(K,a.getMat(K)))).determinant()&&K.getTall&&0===K.getTall()&&(b.getElements()[5]=.001,D.anchorY=!1),b.setPosition({x:0,y:0,z:0}).invert(),D.nodeMatrix=b),"translateXYZ"===f?(K=a.getEye(),b=a.getCenter(),t.set(K[0]-b[0],K[1]-b[1],K[2]-b[2]).normalize(),D.plane=(new O).setFromNormalAndCoplanarPoint(t,U),D.startHit=E._kR(F,D.plane)):"translateXZ"===f||"translateXY"===f||"translateYZ"===f?("translateXY"===f?t.setFromMatrixColumn(T,2):"translateXZ"===f?t.setFromMatrixColumn(T,1):t.setFromMatrixColumn(T,0),t.normalize(),D.plane=(new O).setFromNormalAndCoplanarPoint(t,U),D.startHit=E._kR(F,D.plane)):("translateZ"===f?t.setFromMatrixColumn(T,2):"translateY"===f?t.setFromMatrixColumn(T,1):t.setFromMatrixColumn(T,0),t.normalize(),D.direction=t,D.startHit=oE(E.gv,F,U,t)),E.gv.redraw(),E.beginTransaction())},this.handleEdit=function(F){var f,T,a;!D||(f=g.data)&&(T=E.gv,(a=D.plane?E._kR(F,D.plane):oE(T,F,D.startPosition,D.direction))&&(m.copy(E.nodePosition(f)),Z.subVectors(a,D.startHit).add(D.startPosition),Z.sub(m),a=E.getStyle("moveStep"),H.Default.isNumber(a)&&0<a&&(Z.divideScalar(a),Z.set(Math.floor(Z.x),Math.floor(Z.y),Math.floor(Z.z)),Z.multiplyScalar(a)),D.betweenMove||(E.editDetail?T.fi({kind:"beginMoveDetail",event:F}):T.fi({kind:"beginMove",event:F}),D.betweenMove=!0),f.isCurvePoint?f.moveSelection(Z):D.anchorMoving?(Z.applyMatrix4(D.nodeMatrix),a=f.getAnchor3d(),f.setAnchor3d(a.x+Z.x,!1===D.anchorY?a.y:a.y+Z.y,a.z+Z.z,!0)):E.moveSelection(Z.x,Z.y,Z.z),E.editDetail?T.fi({kind:"betweenMoveDetail",event:F}):T.fi({kind:"betweenMove",event:F})))},this.endEdit=function(F){D&&D.betweenMove&&(E.editDetail?E.gv.fi({kind:"endMoveDetail",event:F}):E.gv.fi({kind:"endMove",event:F})),D=null,E.gv.redraw(),E.endTransaction()}},QE.Rotate=function(F){function D(E){E!=a&&(a=E,F.gv.iv())}function g(E,F,D,g){return E=E.clone().multiply(D),u.setFromMatrixColumn(E,0).normalize(),U.setFromMatrixColumn(E,2).normalize(),Z.copy(g),t.crossVectors(Z,u).normalize(),t.lengthSq()<1e-6?D:(Z.crossVectors(u,t).normalize(),U.dot(Z)+1<1e-7?r.set(u.x,u.y,u.z,0):r.setFromUnitVectors(U,Z),m.makeRotationFromQuaternion(r),g=E.getPosition(),E.setPosition({x:0,y:0,z:0}).premultiply(m).setPosition(g),F&&E.premultiply(F),E)}this.catalog="Rotate";var f,T,a=null,K=[{path:"sxy",model:"RotatePlane"},{path:"x",model:"RotateCircle"},{path:"y",model:"RotateCircle"},{path:"z",model:"RotateCircle"},{path:"sz",model:"RotateCircle"},{path:"viewCircle",model:"RotateCircle"},{path:"rotating",model:"RotatePlane"}],b="S(0.91,0.91,0.91)",B=$E(b),p=$E(b+";R(0, 0, 1, 90)"),W=$E(b+";R(0, 1, 0, -90)"),Y=$E(),o=new C,h=new C,u=(this._42=function(){var E=F.inTransformMode();if((F.inRotateMode()||E&&!F.getSubModule("Translate").isEditing()&&!F.getSubModule("Scale").isEditing())&&(!F.editDetail||F.invokeActiveMod("canRotate"))){var D=F.gv,D=F.gv;if(F.editDetail){if(!(n=F.getCurrentEditingData())||!n.isPresenting())return}else if(!(n=D.sm().ld())||!D.isEditable(n)||!D.isRotationEditable(n))return;var b,$,u,U,H,t,Z=D._picking,m=F.getDataEditMatrix(n),r=F.getStyle("rotateGlobeEnabled"),E=(E&&m.scale({x:1.2,y:1.2,z:1.2}),o.copy(D.getCenter()),h.copy(D.getEye()),h.sub(o).normalize()),D=new J;if(D.getInverse(m),WE(m,D,Y,E),b=F.getStyle("colorRotateBack"),u=g(m,D,B,E),U=g(m,D,p,E),E=g(m,D,W,E),Z)s=F.requestPickColor(n,"rotateX"),k=F.requestPickColor(n,"rotateY"),V=F.requestPickColor(n,"rotateZ"),i=F.requestPickColor(n,"rotateSZ"),$=F.requestPickColor(n,"rotateSXY");else{var s=F.getStyle("colorX"),k=F.getStyle("colorY"),V=F.getStyle("colorZ"),i=F.getStyle("colorRotateScreen"),j=F.getStyle("colorHighlight");if(f||a)switch(t=f?f.type:a){case"rotateX":s=j,H="x";break;case"rotateY":k=j,H="y";break;case"rotateZ":V=j,H="z";break;case"rotateSZ":i=j}}var n={data:n,matrix:m,"x.matrix":u,"x.front.color":s,"x.back.visible":!Z,"x.back.color":b,"y.matrix":U,"y.front.color":k,"y.back.visible":!Z,"y.back.color":b,"z.matrix":E,"z.front.color":V,"z.back.visible":!Z,"z.back.color":b,"sz.matrix":Y,"sz.front.color":i,"sz.back.color":i,"sz.back.transparent":!1,"sxy.visible":Z&&r,"sxy.matrix":Y.clone().scale({x:.91,y:.91,z:.91}),"sxy.color":$,"sxy.circlePlane.transparent":!1,"viewCircle.visible":!1,"rotating.visible":!1};f&&!Z&&(H&&(n[H+".back.opacity"]=.6,n[H+".back.color"]=n[H+".front.color"]),"rotateSZ"!==t&&"rotateSXY"!==t&&(n["sz.visible"]=!1),"rotateSXY"!==t&&(n["viewCircle.visible"]=!0,n["viewCircle.matrix"]=Y.clone().scale({x:.91,y:.91,z:.91}),n["viewCircle.front.color"]=n["viewCircle.back.color"]=F.getStyle("colorRotateScreen"),n["viewCircle.front.transparent"]=!0,n["viewCircle.front.opacity"]=n["viewCircle.back.opacity"]=.6,n["rotating.visible"]=!0,n["rotating.circlePlane.color"]=F.getStyle("colorHighlight"),n["rotating.matrix"]=f._mR.clone().premultiply(D),m=(f.angle||0)/(2*Math.PI)%1,n["rotating.circlePlane.range"]=m<0?[1+m,1]:[0,m])),F._jR(K,n),Z||(T=n)}},new C),U=new C,t=new C,Z=new C,m=new J,r=new L;this.prepareCheck=function(){D(null)},this.check=function(E,g,f,T,a){if(T&&(T=T.type)&&0===T.indexOf("rotate")&&(!a||H.Default.isLeftButton(g)))return a=E.getDataInfoAt(g,F.getStyle("pickRange"),function(E){return!!E.edit&&"rotateSXY"!==E.type&&void 0}),D(T=a&&(E=a.type)&&0===E.indexOf("rotate")?E:T),!0},this.isEditing=function(){return f},this.startEdit=function(E){var D=T.data;if(D&&F.gv.isRotationEditable(D)&&H.Default.isLeftButton(E)){var K,b,B,$,p=T.matrix.clone(),W=new C,Y=new C,u=new C,U=1/0,t=F._getLogicalPoint(E),Z=new S,m=F.gv,E=new S;if("rotateSXY"!==a){switch(a){case"rotateX":b=T["x.matrix"];break;case"rotateY":b=T["y.matrix"];break;case"rotateZ":b=T["z.matrix"];break;default:b=T["sz.matrix"]}K=p.clone().multiply(b),W.setFromMatrixColumn(K,0).normalize(),K.getPosition(Y);for(var r,s=0,k="rotateSZ"===a?360:180;s<k;s++)r=s*Math.PI/180,u.set(0,.5*Math.cos(r),.5*Math.sin(r)).applyMatrix4(K),Z.copy(m.toViewPosition(u.toArray())),(r=t.distanceToSquared(Z))<U&&(U=r,B=u.clone(),$=Z.clone());u.subVectors(B,Y).normalize().cross(W);var Y=g(p,null,b,u.clone().multiplyScalar(-1)),V=m.toViewPosition(u.add(B).toArray());E.set($.x-V.x,$.y-V.y),E.normalize(),f={type:a,data:D,matrix:p,_mR:Y,subMatrix:b.clone(),screenDirection:E,axis:W,startPoint:$,angle:0}}else o.copy(m.getCenter()),h.copy(m.getEye()).sub(o).normalize(),V=F.nodePosition(D),f={type:a,data:D,matrix:p,startPosition:(new C).copy(V),eyeDirection:h.toArray(),startPoint:m.toViewPosition(V),lastPoint:t.clone()};F.gv.redraw(),F.beginTransaction()}},this.handleEdit=function(D){var g=f.data;if(g){var T=F.gv,a=new S(T.lp(D));if(f.startPoint){var K,b,B,p,W,Y=F.getStyle("rotateSpeed"),o=F.getStyle("rotateStep"),h=H.Default.isNumber(o)&&0<o;if("rotateSXY"!==f.type){if(/^((?!chrome|android).)*safari/i.test(E.navigator.userAgent)||(this._cursorCanvas?(u={x:D.movementX,y:D.movementY},200<Math.abs(u.x)&&(u.x=0),200<Math.abs(u.y)&&(u.y=0),f.lastPoint&&a.copy(f.lastPoint),a.add(u)):(u=T.getView()).requestPointerLock&&(u.requestPointerLock(),B=this._cursorCanvas=$("ew-resize"),p=this._cursorCanvasOffset={x:parseInt(B.style.width)/2,y:parseInt(B.style.height)/2},B.style.left=a.x-p.x+"px",B.style.top=a.y-p.y+"px",u.appendChild(B))),!(p=a.clone().sub(f.startPoint).dot(f.screenDirection)))return;var u=p*Y-f.angle;0!==(u=h?Math.floor(u/o)*o:u)&&(f.angle=u+f.angle,W=f.axis)}else{if(!(p=(W=a.clone().sub(f.lastPoint)).length()))return;u=p*Y*2,0!==(u=h?Math.floor(u/o)*o:u)&&(W.set(W.y,-W.x).normalize(),p=W.add(f.startPoint),Y=F.gv.getHitPosition(p,f.startPosition.toArray(),f.eyeDirection),W=(new C).copy(Y).sub(f.startPosition).normalize())}f.lastPoint=a,0!==u&&(f.betweenRotate||(F.editDetail?T.fi({kind:"beginRotateDetail",event:D}):T.fi({kind:"beginRotate",event:D}),f.betweenRotate=!0),K=(new L).setFromAxisAngle(W,u),b=new L,g.isCurvePoint?g.rotateSelection(K):T.sm().each(function(E){E instanceof H.Node&&T.isRotationEditable(E)&&(b=F.nodeQuaternion(E),F.nodeQuaternion(E,b.premultiply(K)))}),(B=this._cursorCanvas)&&(h=f.screenDirection,B.style.rotate=Math.round(Math.atan2(h.y,h.x)/Math.PI*180)+"deg",o=a.clone().sub(f.startPoint),o=h.clone().setLength(h.dot(o)).add(f.startPoint),p=function(E,F,D){var g=E[0],f=E[1],T=g+E[2],a=f+E[3],E=D.x-F.x,D=D.y-F.y;if(0==E)return[{x:F.x,y:f},{x:F.x,y:a}];var D=D/E,E=F.y-D*F.x,K=[];return[{x:g,y:D*g+E},{x:T,y:D*T+E},{x:(f-E)/D,y:f},{x:(a-E)/D,y:a}].forEach(function(E){E.x>=g&&E.x<=T&&E.y>=f&&E.y<=a&&K.push(E)}),K.sort(function(E,F){return E.x-F.x})}([0,0,T.getWidth(),T.getHeight()],f.startPoint,o),Y=new S(p[0]),u=(W=new S(p[1]).sub(Y)).length(),g=o.sub(Y).dot(W.normalize()),a=H.Math.modToPositive(g,u),o=W.setLength(a).add(Y).sub(this._cursorCanvasOffset),B.style.left=o.x+"px",B.style.top=o.y+"px"),F.editDetail?T.fi({kind:"betweenRotateDetail",event:D}):T.fi({kind:"betweenRotate",event:D}))}}},this.endEdit=function(E){f&&f.betweenRotate&&(F.editDetail?F.gv.fi({kind:"endRotateDetail",event:E}):F.gv.fi({kind:"endRotate",event:E})),f=null,document.exitPointerLock&&document.exitPointerLock(),E=this._cursorCanvas,E&&E.parentNode&&E.parentNode.removeChild(E),this._cursorCanvas=null,this._cursorCanvasOffset=null,F.gv.redraw(),F.endTransaction()}},QE.Scale=function(E){function F(F){F!=T&&(T=F,E.gv.iv())}this.catalog="Scale";var g,f,T=null,a=[{path:"x",model:"ScaleAxis"},{path:"y",model:"ScaleAxis"},{path:"z",model:"ScaleAxis"},{path:"xyz",model:"cube"}],K=[{path:"x",model:"ScaleAxisWhenTransform"},{path:"y",model:"ScaleAxisWhenTransform"},{path:"z",model:"ScaleAxisWhenTransform"},{path:"xyz",model:"cube"
}],b=$E(),B=$E("R(0, 0, 1, 90)"),$=$E("R(0, 1, 0, -90)"),p=$E("S(0.06, 0.06, 0.06)"),W=(this._42=function(){var F=E.inTransformMode();if((E.inScaleMode()||F&&!E.getSubModule("Translate").isEditing()&&!E.getSubModule("Rotate").isEditing())&&(!E.editDetail||E.invokeActiveMod("canScale"))){var D,W=E.gv;if(E.editDetail){if(!(D=E.getCurrentEditingData())||!D.isPresenting())return}else if(!(D=W.sm().ld())||!W.isEditable(D))return;var Y=W._picking,W=E.getDataEditMatrix(D);if(Y)h=E.requestPickColor(D,"scaleX"),u=E.requestPickColor(D,"scaleY"),U=E.requestPickColor(D,"scaleZ"),H=E.requestPickColor(D,"scaleXYZ");else{h=E.getStyle("colorX");var o,h,u=E.getStyle("colorY"),U=E.getStyle("colorZ"),H=E.getStyle("colorXYZ"),t=E.getStyle("colorHighlight");if(g||T)switch(g?(o=g.type,h=u=U=H=E.getStyle("colorGray")):o=T,o){case"scaleX":h=t;break;case"scaleY":u=t;break;case"scaleZ":U=t;break;case"scaleXYZ":H=h=u=U=t}}var Z={data:D,matrix:W,"x.matrix":b,"x.color":h,"y.matrix":B,"y.color":u,"z.matrix":$,"z.color":U,"xyz.matrix":p,"xyz.color":H};if(g)Y||(Z["x.lineNegative.visible"]=!0,Z["y.lineNegative.visible"]=!0,Z["z.lineNegative.visible"]=!0,Z["x.lineNegative.color"]=E.getStyle("colorX"),Z["y.lineNegative.color"]=E.getStyle("colorY"),Z["z.lineNegative.color"]=E.getStyle("colorZ"),"scaleXYZ"!==g.type&&(Z["xyz.visible"]=!1));else{var m,r,s=E._lR(W,null,B,$);for(m in s)"face"!==m&&(r=s[m])<1&&(0===r?Z[m+".visible"]=!1:Y||(Z[m+".lines.transparent"]=!0,Z[m+".lines.opacity"]=r,Z[m+".cube.transparent"]=!0,Z[m+".cube.opacity"]=r))}E._jR(F?K:a,Z),Y||(f=Z)}},this.prepareCheck=function(){F(null)},this.check=function(E,D,g,f,T){if((f=f&&f.type)&&0===f.indexOf("scale")&&(!T||H.Default.isLeftButton(D)))return F(f),!0},new C),Y=new C,o=(this.isEditing=function(){return g},this.startEdit=function(F){var D,a,K,b=f.data;b&&E.gv.isSizeEditable(b)&&H.Default.isLeftButton(F)&&(K=f.matrix.clone(),D=new S,a=E.gv,g={type:T,matrix:K,data:b,screenDirection:D,startPoint:new S(a.lp(F)),scale:(new C).copy(b.getScale3d()),lastScale:1},"scaleXYZ"===T?(D.set(1,-1),g.unit=E.getStyle("gizmoSize")/2):("scaleZ"===T?Y.setFromMatrixColumn(K,2):"scaleY"===T?Y.setFromMatrixColumn(K,1):Y.setFromMatrixColumn(K,0),F=b.p3(),W.copy(F),K=a.toViewPosition(b.p3()),F=a.toViewPosition(W.add(Y).toArray()),D.set(F.x-K.x,F.y-K.y),g.unit=D.length()/2,g.unit<20&&(g.unit=20)),D.normalize(),a.redraw(),E.beginTransaction())},function(E,F){var D;E instanceof H.Block&&(D=E.hasOwnProperty("__scaleModeBackup__"),F&&D||(F&&!D?(E.__scaleModeBackup__=E._scaleMode,E._scaleMode="3d"):!F&&D&&(E._scaleMode=E.__scaleModeBackup__,delete E.__scaleModeBackup__),0!==E.size()&&E.eachChild(function(E){o(E,F)})))});this.handleEdit=function(F){var D=E.gv,f=g.data;if(f){f instanceof H.Block&&(g.hasOwnProperty("freezeFlag")||(g.freezeFlag=f._freezeSyncFromChildren,f._freezeSyncFromChildren=!0),o(f,!0)),E.gv.sm().each(function(E){E!==f&&o(E,!0)}),g.betweenScale||(E.editDetail?D.fi({kind:"beginScaleDetail",event:F,type:g.type}):D.fi({kind:"beginScale",event:F,type:g.type}),g.betweenScale=!0);var T,a,K,b=new S(E.gv.lp(F)).sub(g.startPoint).dot(g.screenDirection)/g.unit+1,B=(Math.abs(b)<1e-5&&(b=1e-5),g.lastScale),$=(g.lastScale=b)/B,p=g.scale,W=[p.x,p.y,p.z],Y=[1,1,1];switch(g.type){case"scaleX":W[0]=p.x*b,Y[0]=$;break;case"scaleY":W[1]=p.y*b,Y[1]=$;break;case"scaleZ":W[2]=p.z*b,Y[2]=$;break;case"scaleXYZ":W=[p.x*b,p.y*b,p.z*b],Y=[$,$,$]}f.isCurvePoint?f.scaleSelection(Y):(f.setScale3d(W[0],W[1],W[2]),T=function(E){var F=E.getScale3d();E.setScale3d(F[0]*Y[0],F[1]*Y[1],F[2]*Y[2])},a=f,(K=E.gv).sm().each(function(E){E!==a&&K.isSizeEditable(E)&&(E instanceof H.Block&&o(E,!0),T(E))})),g.ratio=b,E.editDetail?D.fi({kind:"betweenScaleDetail",event:F,type:g.type}):D.fi({kind:"betweenScale",event:F,type:g.type})}},this.endEdit=function(F){var f=g.freezeFlag,T=g.data;T instanceof H.Block&&(f===D?delete T._freezeSyncFromChildren:T._freezeSyncFromChildren=f,T.updateFromChildren(),o(T,!1)),E.gv.sm().each(function(E){E!==T&&o(E,!1)}),g&&g.betweenScale&&(E.editDetail?E.gv.fi({kind:"endScaleDetail",event:F}):E.gv.fi({kind:"endScale",event:F})),g=null,E.gv.redraw(),E.endTransaction()}},QE.Light=function(E){function F(F){F!=f&&(f=F,E.gv.iv())}this.catalog="Light";var D,g,f=null,T=[{path:"p",model:"LightDirectional"}],a=[{path:"rect",model:"LightRectarea"},{path:"rx0",model:"LightCtrlPoint"},{path:"rx1",model:"LightCtrlPoint"},{path:"rx2",model:"LightCtrlPoint"},{path:"rx3",model:"LightCtrlPoint"}],K=[{path:"x",model:"RotateCircle"},{path:"y",model:"RotateCircle"},{path:"z",model:"RotateCircle"},{path:"sz",model:"RotateCircle"},{path:"px0",model:"LightCtrlPoint"},{path:"px1",model:"LightCtrlPoint"},{path:"px2",model:"LightCtrlPoint"},{path:"px3",model:"LightCtrlPoint"},{path:"px4",model:"LightCtrlPoint"},{path:"px5",model:"LightCtrlPoint"}],b=[{path:"spot",model:"LightSpot"},{path:"sx0",model:"LightCtrlPoint"},{path:"sx1",model:"LightCtrlPoint"},{path:"sx2",model:"LightCtrlPoint"},{path:"sx3",model:"LightCtrlPoint"},{path:"sx4",model:"LightCtrlPoint"}],B=$E(),$=$E("R(0, 0, 1, 90)"),p=$E("R(0, 1, 0, -90)"),W=$E(),Y=new C,o=new C,h=(this._42=function(){if(!E.editDetail){var F,D=E.gv,g=D.sm().ld();if(g&&D.isEditable(g)&&g instanceof H.Light)return"point"===(F=g.s("light.type"))?this.drawPointLight(D,g):"directional"===F?this.drawDirectionalLight(D,g):"rect"===F?this.drawRectareaLight(D,g):"spot"===F?this.drawSpotLight(D,g):void 0}},[new C(1,0,0),new C(-1,0,0),new C(0,1,0),new C(0,-1,0),new C(0,0,1),new C(0,0,-1)]),u=(this.drawPointLight=function(F,T){var a,b,u,U,H,t,Z,m,r,s,k,V,i,j,n,y=T.s("light.range");y&&(y*=2,a=F._picking,b=T.p3(),u=(new J).scale({x:y,y:y,z:y}).setPosition({x:b[0],y:b[1],z:b[2]}),Y.copy(F.getCenter()),o.copy(F.getEye()),H=o.sub(Y).normalize(),(U=new J).getInverse(u),WE(u,U,W,H),U=o.copy(F.getEye()).sub(Y.copy(b)),H=1/Math.sqrt(1-.25*y*y/U.lengthSq()),W.scale({x:H,y:H,z:H}),k=E.getStyle("lightCtrlPointColor"),a?t=Z=m=r=!1:(t=Z=m=r=!0,s=E.getStyle("lightLineColor"),(D||f)&&(V=D?D.type:f)),i={data:T,matrix:u,"x.visible":t,"x.matrix":B,"x.front.color":s,"x.back.color":s,"x.back.transparent":!1,"y.visible":Z,"y.matrix":$,"y.front.color":s,"y.back.color":s,"y.back.transparent":!1,"z.visible":m,"z.matrix":p,"z.front.color":s,"z.back.color":s,"z.back.transparent":!1,"sz.visible":r,"sz.matrix":W,"sz.front.color":s,"sz.back.color":s,"sz.back.transparent":!1},j=E._lR(u,null,$,p),n=0,h.forEach(function(D){var D=D.clone().multiplyScalar(.5),g=$E().translate(D),f="light"+n,K="px"+n+".";if(0===j[n<2?"x":n<4?"y":"z"])return i[K+"visible"]=!1,void n++;f=V===f,Y.copy(b).add(D.multiplyScalar(y)),D=F.getPositionInfo(Y.toArray()).width*E.getStyle("gizmoSize")/(F.getWidth()||100),g.scale({x:D*=.5/y*(f?1.2:1),y:D,z:D}),i[K+"matrix"]=g,D=a?E.requestPickColor(T,"light"+n):f?E.getStyle("colorHighlight"):k,i[K+"color"]=D,n++}),E._jR(K,i),a||(g=i))},this.drawDirectionalLight=function(F,D){var g;F._picking||(F=E.getDataEditMatrix(D,"world"),g=D.s("light.rotation.enable")?Y.set(0,0,1).applyEuler(D.getEuler()):Y.copy(D.p3()).multiplyScalar(-1),D={data:D,matrix:F,"p.matrix":(new J).lookAtDirection(g).scale({x:.3,y:.3,z:.3}),"p.color":E.getStyle("lightLineColor")},E._jR(T,D))},this.drawRectareaLight=function(F,T){for(var K=F._picking,b=T.s("light.size"),B=b[0],W=b[1],o=T.p3(),u=F.getPositionInfo(o).width*E.getStyle("gizmoSize")/(F.getWidth()||100),B=(new J).scale({x:B,y:W,z:2*u}).premultiply((new J).makeRotationFromEuler(T.getEuler())).setPosition({x:o[0],y:o[1],z:o[2]}),U={data:T,matrix:B,"rect.matrix":new J,"rect.visible":!K,"rect.lines.color":E.getStyle("lightLineColor"),"rect.triangles.visible":!1},H=E._lR(B,null,$,p),t=D||f?D?D.type:f:null,Z=E.getStyle("lightCtrlPointColor"),m=0;m<4;m++){var r=h[m].clone().multiplyScalar(.5),s=$E().translate(r),k="light"+m,V="rx"+m+".",i=m<2?b[0]:b[1];0===H[m<2?"x":m<4?"y":"z"]?U[V+"visible"]=!1:(k=t===k,Y.copy(o).add(r.multiplyScalar(i)),u=F.getPositionInfo(Y.toArray()).width*E.getStyle("gizmoSize")/(F.getWidth()||100),u*=.5/i*(k?1.2:1),m<2?s.scale({x:u,y:u*b[0]/b[1],z:u}):s.scale({x:u*b[1]/b[0],y:u,z:u}),U[V+"matrix"]=s,r=K?E.requestPickColor(T,"light"+m):k?E.getStyle("colorHighlight"):Z,U[V+"color"]=r)}E._jR(a,U),K||(g=U)},[new C(.5,0,.5),new C(-.5,0,.5),new C(0,.5,.5),new C(0,-.5,.5),new C(0,0,.5)]),U=(this.drawSpotLight=function(F,T){var a,K,B,W,h,U,H,t,Z,m,r,s=2*T.s("light.range");s&&(a=F._picking,B=Math.tan(T.s("light.angle")/2),K=s*B,B=T.p3(),W=new J,T.s("light.rotation.enable")?W.makeRotationFromEuler(T.getEuler()):W.lookAtDirection(Y.copy(T.s("light.center")).sub(o.copy(B))),h=(new J).scale({x:K,y:K,z:s}).premultiply(W).setPosition({x:B[0],y:B[1],z:B[2]}),U={data:T,matrix:h,"spot.visible":!a,"spot.color":E.getStyle("lightLineColor")},H=0,t=D||f?D?D.type:f:null,m=E.getStyle("lightCtrlPointColor"),r=$E(),u.forEach(function(D){var g,f="light"+H,b="sx"+H+".",B=t===f,W=(Y.copy(D).applyMatrix4(h),Z=F.getPositionInfo(Y.toArray()),Z=Z.width*E.getStyle("gizmoSize")/(F.getWidth()||100),Z*=.5*(B?1.2:1),$E().translate(D).scale({x:Z/K,y:Z/K,z:Z/s}));if(H<2?g=E._lR(h,W).x:H<4&&(g=E._lR(h,null,W.clone().multiply($)).y),0===(g=4===H?E._lR(h,null,null,r.lookAtDirection(D).multiply(p)).z:g))return U[b+"visible"]=!1,void H++;U[b+"matrix"]=W,D=a?E.requestPickColor(T,f):B?E.getStyle("colorHighlight"):m,U[b+"color"]=D,H++}),E._jR(b,U),a||(g=U))},this.prepareCheck=function(){F(null)},this.check=function(E,D,g,f,T){if((f=f&&f.type)&&0===f.indexOf("light")&&(!T||H.Default.isLeftButton(D)))return F(f),!0},this.isEditing=function(){return D},new C),t=new C,Z=new C;new C,this.startEdit=function(F){var T=E.gv,a=g.data;a&&T.isEditable(a)&&a instanceof H.Light&&(T=g.matrix.clone(),"spot"===a.s("light.type")&&"light4"!==f?U.copy(u[4]).applyMatrix4(T):U.copy(a.p3()),D={type:f,startPosition:U.clone(),range:a.s("light.range"),size:a.s("light.size"),angle:a.s("light.angle")},"light2"===f||"light3"===f?t.setFromMatrixColumn(T,1):"light4"===f||"light5"===f?t.setFromMatrixColumn(T,2):t.setFromMatrixColumn(T,0),t.normalize(),D.direction=t,D.startHit=oE(E.gv,F,U,t),E.gv.redraw(),E.beginTransaction())},this.handleEdit=function(F){var f,T,a,K;!D||(f=g.data)&&(T=E.gv,(a=oE(T,F,D.startPosition,D.direction))&&(Z.subVectors(a,D.startPosition),a=E.getStyle("moveStep"),H.Default.isNumber(a)&&0<a&&(Z.divideScalar(a),Z.set(Math.floor(Z.x),Math.floor(Z.y),Math.floor(Z.z)),Z.multiplyScalar(a)),D.betweenEidtLight||(T.fi({kind:"beginEidtLight",event:F}),D.betweenEidtLight=!0),"rect"===(a=f.s("light.type"))?(K=f.s("light.size"),"light0"===D.type||"light1"===D.type?f.s("light.size",[2*Z.length(),K[1]]):f.s("light.size",[K[0],2*Z.length()])):"spot"!==a||"light4"===D.type?f.s("light.range",Z.length()):(K=Z.length(),f.s("light.angle",2*Math.atan2(K,D.range))),T.fi({kind:"betweenEidtLight",event:F})))},this.endEdit=function(F){D&&D.betweenEidtLight&&E.gv.fi({kind:"endEditLight",event:F}),D=null,E.gv.redraw(),E.endTransaction()}},QE.Curve=function(E){function F(){var E=!1;if(P!==N||Q.length!=N.editing.length)E=!0;else{var F,D=Q.length;if(0<D)for(F=0;F<D;F++)if(Q[F]!==N.editing[F]){E=!0;break}}(G||E)&&X(q,R,I.editing.slice(0),y.editing.slice(0),P,N,p,n.getEditingPointType(),B,"movePoint")}function g(F){F!==_&&(0<=(_=F)&&(L=W=O=null),E.gv.redraw())}function f(F){O!==F&&((O=F)&&(L=_=null),E.gv.redraw())}function T(F){L!==F&&(0<=(L=F)&&(W=O=_=null),E.gv.redraw())}function a(F,D,g){var f=new J;return A.set(D.x,D.e,D.y).applyMatrix4(F),D=E.gv.getPositionInfo(A.toArray()).width/(E.gv.getWidth()||100),F=g&&g.betweenMove?E.getStyle("shapeDiamondSizeInEditing"):E.getStyle("shapeDiamondSize"),f.scale({x:F[0]*D,y:F[1]*D,z:F[2]*D}),f.setPosition(A),f}var K,b,B,$,p,W,Y,o,h,u,t,Z,m,r,s,k,V,i,j,n=this,y=new U,I=new U,N=I,P=N,q=[],R=[],Q=[],d=I.onPropertyChanged,_=(I.onPropertyChanged=function(D){d.call(this,D),"p3"===D.property&&(F(),D=D.newValue,E.fi({kind:"selectPoint",x:D.x,y:D.z,e:D.y}))},y.onPropertyChanged=function(D){var g,f,T,a,b,$,p,W,Y,o,h,u;d.call(this,D),"p3"===D.property&&(g=x(),T=this.editing[0],Y=new H.Math.Vector3,o=new H.Math.Vector3,h=g.get(I.editing[0]),h=new H.Math.Vector3(h.x,h.e,h.y),0===K?(a=(u=v(I.editing[0]))[0],b=u[1],W=T===a.index?($=a.pos,p=b.pos,a.index,b.index):($=b.pos,p=a.pos,b.index,a.index),Y.set($.x,$.e,$.y).sub(h),o.copy(Y.negate()).add(h),f=H.Default.clone(g),z(f,W,o)):3===K&&(a=(u=v(I.editing[0]))[0],b=u[1],W=T===a.index?($=a.pos,p=b.pos,a.index,b.index):($=b.pos,p=a.pos,b.index,a.index),Y.set($.x,$.e,$.y).sub(h),o.set(p.x,p.e,p.y).sub(h),o.copy(Y.negate().setLength(o.length())).add(h),f=H.Default.clone(g),z(f,W,o)),f&&(B.setPoints3d?B.setPoints3d(f,!0):B.setPoints(f,!0)),F(),u=D.newValue,E.fi({kind:"selectPoint",x:u.x,y:u.z,e:u.y}))},null),O=null,L=null,G=!0,c=(n.catalog="Curve",n.isCylinder=function(){return!!$},n.canEnterEditDetailMode=function(){n._auxEdit=!1;var F=M.canEnterEditDetailMode(E);if(F||(D=E.gv.sm().ld())&&D.getSupportInteractor&&D.getSupportInteractor()===n.catalog&&D.getEditHelperClass&&(F=new(D.getEditHelperClass())(E.gv,D),n._auxEdit=!0),F){var D=F.getPoints().size();if(!(1500<D))return $=I.isCylinder(F),G=!0,B=F}},n.canQuitEditDetailMode=function(F){if(F=E.getDataInfoAt(F),!(F=F?F.data:null)||F!==B)return!0},n.check=function(F,D,a,K,b){var B;if(g(null),T(null),f(null),K&&(B=K.type)&&0===B.indexOf("curve")&&(!b||H.Default.isLeftButton(D)))return 0===B.indexOf("curvePoint")?g(Math.round(B.substr(10))):0===B.indexOf("curveLine")?(K=Math.round(B.substr(9)),c(a,K),f(K),E.gv.redraw()):0===B.indexOf("curveControlPoint")&&T(Math.round(B.substr(17))),!0},h=new J,u=new H.Math.Vector4,t=new H.Math.Vector4,Z=new C,m=new C,r=new S,s=new S,k=new S,V=new S,i=new S,j=new S,function(F,D){var g=Y["curveLine"+D+".lines.vs"],D=E.gv,f=!D.isOrtho(),T=D.getWidth()/2,a=D.getHeight()/2,K=B.getPointsMatrix3d(),b=n._auxEdit&&B.getEditData3dUI?B.getEditData3dUI():D.getData3dUI(B);b._vsTranslation&&K.multiply(b._vsTranslation),h.fromArray(D.getPVMatrix()).multiply(K);for(var $,p,o,U,H,y,I=1/0,N=0,P=0,q=0,R=g.length;q<R;q+=6)u.fromArray(g,q).setW(1).applyMatrix4(h),r.set(T+T*u.x/u.w,a-a*u.y/u.w),t.fromArray(g,q+3).setW(1).applyMatrix4(h),s.set(T+T*t.x/t.w,a-a*t.y/t.w),k.subVectors(F,r),V.subVectors(s,r),($=V.length())&&((p=k.dot(V)/$)<0?p=0:$<p&&(p=$),i.lerpVectors(r,s,p/$),U=j.subVectors(i,F).lengthSq(),o=Z.fromArray(g,q).applyMatrix4(K).sub(m.fromArray(g,q+3).applyMatrix4(K)).length(),U<I&&(I=U,y=q,P=N+(H=f?-((U=u.x/u.w+p/$*(t.x/t.w-u.x/u.w))*u.w-u.x)/(U*(t.w-u.w)-(t.x-u.x)):p/$)*o),N+=o);Z.fromArray(g,y),m.fromArray(g,y+3),W={closest:y,percentage:H,closestPoint:Z.clone().lerp(m,H),segmentPercent:P/N}}),l=function(){if(E=B.getSegments())return E;for(var E=new H.List([1]),F=1,D=x().length;F<D;F++)E.push(2);return E},x=function(){var E,F,D=B.getPoints();return $||(E=new H.List,F=B.getElevation(),D.each(function(D){E.add({x:D.x,e:F,y:D.y})}),D=E),D},z=function(E,F,D){E=E.get(F),E.x=D.x,E.e=D.y,E.y=D.z},X=function(F,D,g,f,T,a,K,b,$,W){var Y=E.gv;G&&(G=!1,F=[],D=[]),P=a,q=g.slice(0),R=f.slice(0),Q=a.editing.slice(0),p=b,Y.dm().addHistory({undo:function(){E.editDetail&&B===$&&(I.editing=F.slice(0),y.editing=D.slice(0),N=T,n.setEditingPointType(K))},redo:function(){E.editDetail&&B===$&&(I.editing=g.slice(0),y.editing=f.slice(0),N=a,n.setEditingPointType(b))},editInfo:{oldEditing:F,newEditing:g,oldControlEditing:D,newControlEditing:f,oldEditingNode:T,newEditingNode:a,oldPointType:K,newPointType:b,target:$,action:W}})},w=function(){var E,F,D,g,f,T,a,K;if(B.getPoints)return E=x(),F=l(),D=-1,g=[],T=-1,a=F.length,K=B.getElevation(),F.forEach(function(b){T++;var B=1;if(3===b)B=2;else if(4===b)B=3;else if(5===b)return;D+=B,f=a<=T+1||1===F.get(T+1),b=e(E.get(D),K),g.push({pos:b,segmentIndex:T,pointIndex:D,isEnd:f})}),g},e=function(E,F){return E=new S(E),$&&"number"==typeof E.e||(E.e=F),E},A=new C,v=function(E){for(var F,D=l(),g=x(),f=w(),T=0,a=f.length;T<a;T++){var K=f[T];if(K.pointIndex===E){F=K;break}}var b,B=[];return F&&(3!==(b=D.get(F.segmentIndex))&&4!==b||(b=g.get(E-1),B.push({pos:b,index:E-1})),3!==(b=D.get(F.segmentIndex+1))&&4!==b||(D=g.get(E+1),B.push({pos:D,index:E+1}))),B},EE=(n.handleEditDetail=function(E){E?(I.attachTarget(B),y.attachTarget(B)):(I.clear(),y.clear())},n.getEditingData=function(){return E.editDetail?N:null},n.getEditingPointType=function(){return K},n.setCurrentSelectionStatus=function(F){var D=E.gv,g=I.editing.slice(0),f=y.editing.slice(0),T=I.editing[0],a=H.Default.clone(x()),b=H.Default.clone(l()),$=a.get(T),$=new H.Math.Vector3($.x,$.e,$.y);if(1===F)v(T).forEach(function(E){z(a,E.index,$)}),y.editing=[];else{for(var p,W,Y,o,h,u,U,t=w(),Z=0,m=t.length;Z<m;Z++){var r=t[Z];if(r.pointIndex===T){p=r,W=t[Z-1],Y=t[Z+1];break}}W&&(s=b.get(p.segmentIndex)),Y&&(U=b.get(Y.segmentIndex)),3!==s&&4!==s||(k=a.get(T-1)),3!==U&&4!==U||(u=a.get(T+1)),k&&(o=new H.Math.Vector3(k.x,k.e,k.y).sub($)),u&&(h=new H.Math.Vector3(u.x,u.e,u.y).sub($)),1===K?(W&&Y||(F=2),k=Y?(2===U?(a.add(H.Default.clone(Y.pos),Y.pointIndex),a.add(H.Default.clone(p.pos),Y.pointIndex),b.set(Y.segmentIndex,4)):3===U&&(a.add(H.Default.clone(p.pos),Y.pointIndex),b.set(Y.segmentIndex,4)),Y.pos):p.pos,u=W?(2===s?(a.add(H.Default.clone(p.pos),p.pointIndex),a.add(H.Default.clone(W.pos),p.pointIndex),T+=2,b.set(p.segmentIndex,4)):3===s&&(a.add(H.Default.clone(p.pos),p.pointIndex),T++,b.set(p.segmentIndex,4)),W.pos):p.pos,u=new H.Math.Vector3(u.x,u.e,u.y),U=(k=new H.Math.Vector3(k.x,k.e,k.y)).clone().sub(u).multiplyScalar(.25),W&&4===b.get(p.segmentIndex)&&z(a,T-1,$.clone().sub(U)),Y&&4===b.get(Y.segmentIndex)&&z(a,T+1,$.clone().add(U)),I.setCurrent(T,!0)):2===K?o&&h?0===F?(o.copy(h.clone().negate().setLength(h.length()).add($)),z(a,T-1,o)):3===F&&(o.copy(h.clone().negate().setLength(o.length()).add($)),z(a,T-1,o)):F=2:3===K&&(o&&h?0===F&&(o.copy(h.clone().negate().setLength(h.length()).add($)),z(a,T-1,o)):F=2)}var s=I.editing.slice(0),k=y.editing.slice(0);E.beginTransaction(),X(g,f,s,k,N,N,n.getEditingPointType(),F,B,"addPoint"),B.setSegments(b),B.setPoints3d?B.setPoints3d(a,!0):B.setPoints(a,!0),E.endTransaction(),n.setEditingPointType(F),D.fi({kind:"betweenEditDetail",event:null})},n.setEditingPointType=function(F){K=F,E.fp("shapePointStatus",D,K)},n.startEdit=function(F){b={hoverIndex:_,hoverControlIndex:L,start:new S(E.gv.lp(F)),lineIndex:O}},new S),FE=(n.handleEdit=function(F){null==b.hoverIndex&&null==b.hoverControlIndex&&null==b.lineIndex||(EE.copy(E.gv.lp(F)),1e-5<b.start.distanceToSquared(EE)&&(b.moved=!0))},n.endEdit=function(F){if(b)if(b.moved)b=null;else{var F=H.Default.isCtrlDown(F);if(N=I,y.editing=[],H.Default.isNumber(b.hoverIndex))F?I.setCurrent(b.hoverIndex):I.setCurrent(b.hoverIndex,!0),I.isSingle()&&((F=v(b.hoverIndex))[0]&&(m=F[0].pos),F[1]&&(J=F[1].pos),F=x().get(I.editing[0]),F=new H.Math.Vector3(F.x,F.e,F.y),O=new H.Math.Vector3,m&&O.set(m.x,m.e,m.y).sub(F),m=O.length(),Z=new H.Math.Vector3,J&&Z.set(J.x,J.e,J.y).sub(F),J=Z.length(),O=m<1e-5&&J<1e-5?1:!(m<1e-5||J<1e-5)&&Math.abs(1-Math.abs(O.clone().normalize().dot(Z.clone().normalize())))<1e-5?m-J<1e-5?0:3:2,n.setEditingPointType(O));else if(H.Default.isNumber(b.hoverControlIndex))y.setCurrent(b.hoverControlIndex,!0),N=y;else if(b.lineIndex){for(var D,a,K,p,Y,o,h,u,U,F=W.segmentPercent,t=b.lineIndex,Z=I.editing.slice(0),m=y.editing.slice(0),r=(E.beginTransaction(),B),s=t,k=F,V=r.getElevation(),i=H.Default.clone(x()),j=H.Default.clone(l()),P=-1,q=0,R=0,Q=(j||i).length;R<Q;R++)if(a=1,3===(D=j?j.get(R):2)?a=2:4===D?a=3:5===D&&(a=0),P+=a,1===D&&(q=P),R===s){2===D?(j&&j.add(2,s),K=e(i.get(P-1),V),p=e(i.get(P),V),Y=K.lerp(p,k),$&&Y.e!==V||delete Y.e,i.add(Y,P)):5===D?(j&&j.add(2,s),K=e(i.get(P),V),p=e(i.get(q),V),Y=K.lerp(p,k),$&&Y.e!==V||delete Y.e,i.add(Y,P+1)):4===D?(j&&j.add(4,s),K=e(i.get(P-3),V),p=e(i.get(P-2),V),Y=e(i.get(P-1),V),o=e(i.get(+P),V),u=(h=new fE(K,p,Y,o)).getTByPercentage(k),U=h.insertKnot(u),(i=i.toArray()).splice(P-2,2,U[0].p2,U[0].p3,U[0].p4,U[1].p2,U[1].p3)):3===D&&(j&&(j=j.toArray()).splice(s,1,4,4),K=e(i.get(P-2),V),p=e(i.get(P-1),V),o=e(i.get(+P),V),Y=p.clone().sub(o).multiplyScalar(2/3).add(o),p.sub(K).multiplyScalar(2/3).add(K),u=(h=new fE(K,p,Y,o)).getTByPercentage(k),U=h.insertKnot(u),(i=i.toArray()).splice(P-1,1,U[0].p2,U[0].p3,U[0].p4,U[1].p2,U[1].p3)),j&&r.setSegments(j.slice(0)),r.setPoints3d?r.setPoints3d(i,!0):r.setPoints(i,!0);break}for(var d=l(),_=-1,C=0;C<=t;C++){var S=d.get(C);1===S||2===S?_++:3===S?_+=2:4===S&&(_+=3)}I.setCurrent(_,!0);var J=I.editing.slice(0),F=y.editing.slice(0),O=n.getEditingPointType();X(Z,m,J,F,N,N,O,O,B,"insertPoint"),E.endTransaction()}Z=N.p3(),E.fi({kind:"selectPoint",x:Z[0],y:Z[2],e:Z[1]}),g(b=null),T(null),f(null)}},n._42=function(F,D){if(E.editDetail&&E._activeMod===this&&B){var g=w();if(g.length){var f=F._picking,T=B.getPointsMatrix3d(),F=n._auxEdit&&B.getEditData3dUI?B.getEditData3dUI():F.getData3dUI(B),F=F._vsTranslation,b=[0,0,0],$=(F&&(b=[F.el[12],F.el[13],F.el[14]],T.multiply(F)),o=[],Y={data:B,matrix:new J},E.getStyle("shapeDiamondColor")),p=E.getStyle("shapeStartDiamondColor"),h=E.getStyle("shapeColorGray")||E.getStyle("colorGray"),u=0,U=(u="object"==typeof h&&"number"==typeof h[3]?h[3]/255:H.Default.toColorData(h)[3]/255,E.getSubModule("Translate").isEditing()),t=l(),F=x();if(!U||!f)for(var Z=DE(F,t,B.s("shape3d.resolution")),m=Z.indexMark,r=1,s=(t||g).length;r<s;r++){Y[(TE="curveLine"+r)+".matrix"]=T;var k=t?t.get(r):2,V=m[2*r]-1,i=Y[TE+".lines.vs"]=[],j=Z[V],P=m[2*r+1]-1;if(5===k){var q=j[P],R=j[0];i.push(q.x-b[0],q.y-b[1],q.z-b[2],R.x-b[0],R.y-b[1],R.z-b[2])}else for(var Q=m[2*(r-1)+1]-1;Q<P;Q++)q=j[Q],R=j[Q+1],i.push(q.x-b[0],q.y-b[1],q.z-b[2],R.x-b[0],R.y-b[1],R.z-b[2]);f?Y[TE+".lines.color"]=E.requestPickColor(B,"curveLine"+r):U&&U.betweenMove?(Y[TE+".lines.color"]=h,u&&(Y[TE+".lines.transparent"]=!0,Y[TE+".lines.opacity"]=u)):Y[TE+".lines.color"]=r===O?E.getStyle("shapeDiamondHighlight")||E.getStyle("colorHighlight"):$,o.push({path:TE,model:"ShapeLine"})}if(I.isSingle()&&1!==K){for(var d=I.editing[0],S=0,M=g.length;S<M;S++){var G=g[S];if(G.pointIndex===d){fE=G;break}}var F=fE.pos,c=new C(F.x-b[0],F.e-b[1],F.y-b[2]),z=E.getStyle("shapeControlColor"),X=E.getStyle("shapeDashLineGap");v(d).forEach(function(F){var D=F.pos;TE="curveControlLine"+F.index,o.push({path:TE,model:"ShapeControlLine"});var g=new C(D.x-b[0],D.e-b[1],D.y-b[2]).clone().sub(c),K=g.length(),$=Math.ceil(K/X),$=(Y[TE+".dashLine.resolution"]=$,new J);$.compose(c,(new H.Math.Quaternion).setFromUnitVectors(C.AxisZ,g.normalize()),new C(0,0,K)).premultiply(T),Y[TE+".matrix"]=$,U&&U.betweenMove?(Y[TE+".dashLine.color"]=h,u&&(Y[TE+".dashLine.transparent"]=!0,Y[TE+".dashLine.opacity"]=u)):Y[TE+".dashLine.color"]=z,TE="curveControlPoint"+F.index,o.push({path:TE,model:"ShapeDiamond"}),Y[TE+".matrix"]=a(T,{x:D.x-b[0],e:D.e-b[1],y:D.y-b[2]},U),f&&!y.isActive(F.index)?Y[TE+".diamond.color"]=E.requestPickColor(B,TE):(g=z,F.index===L?g=E.getStyle("shapeDiamondHighlight")||E.getStyle("colorHighlight"):y.isActive(F.index)&&N===y?Y[TE+".diamond.visible"]=!1:U&&U.betweenMove&&(g=h,u&&(Y[TE+".diamond.transparent"]=!0,Y[TE+".diamond.opacity"]=u)),Y[TE+".diamond.color"]=g)})}for(var e,A,EE,S=0,FE=g.length;S<FE;S++){var gE,fE,TE="p"+(fE=g[S]).pointIndex;o.push({path:TE,model:"ShapeDiamond"}),Y[TE+".matrix"]=a(T,{x:fE.pos.x-b[0],e:fE.pos.e-b[1],y:fE.pos.y-b[2]},U),f?Y[TE+".diamond.color"]=E.requestPickColor(B,"curvePoint"+fE.pointIndex):(gE=$,fE.pointIndex===_?gE=E.getStyle("shapeDiamondHighlight")||E.getStyle("colorHighlight"):I.isActive(fE.pointIndex)&&N===I?Y[TE+".diamond.visible"]=!1:U&&U.betweenMove?(gE=h,u&&(Y[TE+".diamond.transparent"]=!0,Y[TE+".diamond.opacity"]=u)):0===S&&(gE=p),Y[TE+".diamond.color"]=gE)}O&&W&&W.closestPoint&&!f&&!U&&(TE="curveToBeAddedPoint",o.push({path:TE,model:"ShapeDiamond"}),F=W.closestPoint.clone().applyMatrix4(T),e=E.gv.getPositionInfo(F.toArray()).width/(E.gv.getWidth()||100)/2,A=E.getStyle("shapeDiamondSize"),(EE=new J).scale({x:A[0]*e,y:A[1]*e,z:A[2]*e}),EE.setPosition(F),Y[TE+".matrix"]=EE,Y[TE+".diamond.color"]=E.getStyle("shapeDiamondHighlight")||E.getStyle("colorHighlight")),E._jR(o,Y)}}},n.handleDelete=function(F){function D(E){T.removeAt(E),0<=(E=f.indexOf(E))&&f.splice(E,1)}var g=H.Default.isShiftDown(F),f=I.editing.slice(0),F=w(),T=B.toPoints(),a=B.toSegments();if(!a){(a=new H.List).push(1);for(var K=1,b=T.size();K<b;K++)a.push(2)}var $,p,W,Y,o;if(F.reverse().forEach(function(E){var F=E.pointIndex;if(!(f.indexOf(F)<0)){var K=a.removeAt(E.segmentIndex),b=a.get(E.segmentIndex);if(1===K){var B=b-2;for(B<0&&(B=0);0<=B;B--)D(F+B);a.set(E.segmentIndex,1)}else 2===K?(3===b&&g&&D(F+1),4===b&&(g?(D(F+2),D(F+1)):T.set(F+1,H.Default.clone(T.get(F-1)))),D(F)):3===K?(2===b?g||a.set(E.segmentIndex,3):3===b?g?D(F+1):a.set(E.segmentIndex,4):4===b&&(g&&D(F+2),D(F+1)),D(F),1!==b&&!g||D(F-1)):4===K&&(2===b?g?D(F):(T.set(F,H.Default.clone(T.get(F+1))),a.set(E.segmentIndex,4)):(3===b?g?D(F+1):a.set(E.segmentIndex,4):4===b&&(g&&D(F+2),D(F+1)),D(F)),D(F-1),1!==b&&!g&&b||D(F-2));g&&(5===b?a.removeAt(E.segmentIndex):b&&a.set(E.segmentIndex,1))}}),T.length<=1)return B.removeFromDataModel(),void(E.editDetail=!1);for(var h=H.Default.clone(a),K=h.length-1,u=T.length-1;0<=K;K--){var U=h.get(K);5!==U&&(1===U||2===U?(1!==U||1!==o&&null!=o||(a.removeAt(K),T.removeAt(u)),u--):3===U?u-=2:4===U&&($=T.get(u),p=T.get(u-1),W=T.get(u-2),Y=T.get(u-3),hE($,p)&&hE(W,Y)&&(a.set(K,2),T.removeAt(u-1),T.removeAt(u-2)),u-=3),o=U)}if(T.length<=1)return B.removeFromDataModel(),void(E.editDetail=!1);var F=I.editing.slice(0),t=y.editing.slice(0),Z=n.getEditingPointType();E.beginTransaction(),X(F,t,[],[],N,I,Z,Z,B,"deletePoint"),a.set(0,1),B.setSegments(a),B.setPoints3d?B.setPoints3d(T,!0):B.setPoints(T,!0),E.endTransaction(),I.editing=[],y.editing=[],N=I},{1:1,2:0,3:2,4:3});n.initShortcuts=function(){E.globalShortcutManager.addKeyListener(function(E){H.Default.isInput(E.event.target)||"down"===E.kind&&I.isSingle()&&(E=H.ShortcutManager.getKey(E.event),(E=FE[E])!=D&&K!==E&&(H.Default.ignoreShortcuts=!0,H.Default.callLater(function(){H.Default.ignoreShortcuts=!1}),n.setCurrentSelectionStatus(E)))})},n.handleDoubleClick=function(F){var D=E.gv,g=E.getStyle("pickRange"),D=D.getDataInfoAt(F,g);if(D&&D.edit&&(F=D.data,g=D.type,(F!==B||g&&0===g.indexOf("curvePoint"))&&(F===B||F===I)))return g=0===K?1:0,this.setCurrentSelectionStatus(g),E.gv.iv(),!0},n.canRotate=function(){return!1},n.canScale=function(){return!1},n.canTransform=function(){return!1},n.canTranslate=function(){return!0},n.handleRectSelection=function(F,D,g){var f=E.gv,T=[];f.getDatasInRect(F,function(E){if(!E.edit)return!1;var E=E.type;0===E.indexOf("curvePoint")&&(E=Math.round(E.substr(10)),T.indexOf(E)<0&&T.push(E))}),this.getEditingData().handleRectSelect(T,D,g),f.redraw()},n.isWorldSpace=function(){if($)return!0},n.isLocalSpace=function(){if(!$)return!0},n.translateInAllModes=function(){return!0}},QE.Camera=function(F){function g(E,g){var f,T,a,K=F.gv;K.isPannable()&&(a=K.getWidth(),f=K.getHeight(),g==D&&(g=F.shortcutManager.isShiftDown()?F.getStyle("shiftAcceleration"):1),T=K.getCenterInfo(),a=E.x*g/a*T.width,E=-1*E.y*g/f*T.height,K._panning=1,K.pan(-a,-E))}function f(E){E instanceof H.Math.Vector2||(E=new H.Math.Vector2(E));var D=F.shortcutManager.isShiftDown()?F.getStyle("shiftAcceleration"):1;E.multiplyScalar(-.003*F.getStyle("rotateCameraSpeed")*D),F.gv.rotate(E.x,E.y,!1,!0)}function T(E){var D;b&&(D=b.state)&&(E=E+D[0].toUpperCase()+D.slice(1),F.gv.fi({kind:E,event:B}))}function a(){return F.shortcutManager.isShiftDown()?1+.005*F.getStyle("shiftAcceleration"):1.005}function K(F){E.cancelAnimationFrame(W[F]),delete W[F]}var b,B,$=this;$.check=function(E,F,D){if(!H.Default.isCtrlDown(F))return!0},$.startEdit=function(E){B=E,b={point:F.lp(E)};var D=F.lockAngleOfView,g=F.isAltDown(E),f=H.Default.isShiftDown(E),T=H.Default.isRightButton(E);H.Default.isMiddleButton(E)?b.state="middleButtonPan":T?(b.right=!0,g?(b.state="rightButtonZoom",b.increment=Math.pow(H.Default.scrollZoomIncrement,.1*F.getStyle("mouseMoveZoomIncrement"))):b.state=D?"rightButtonPan":"rightButtonRotate"):b.state=f?"mouseShiftPan":g?D?"pan":"rotate":D?"pan":"roaming"},$.endEdit=function(E){B=E,b&&b.between&&T("end"),b=null,E=F.gv,E._panning&&delete E._panning},$.handleEdit=function(E){B=E;var D,a,K,$,E=F.lp(E),p=E.clone().sub(b.point);(p.x||p.y)&&(b.between||(b.between=!0,T("begin")),D=b.state,b.point=E,"pan"===D||"middleButtonPan"===D||"rightButtonPan"===D?g(p):"mouseShiftPan"===D?g(p,1):"rightButtonZoom"===D?(E=p,($=F.gv).isZoomable()&&(a=F.shortcutManager.isShiftDown()?F.getStyle("shiftAcceleration"):1,0!==(E=E.x+E.y)&&(K=b.increment,1!==a&&(K=(K-1)*a+1),$.setZoom(E<0?1/K:K)))):"rotate"===D||"rightButtonRotate"===D?f(p):"roaming"===D&&((a=p).multiplyScalar(-.003*F.getStyle("roamingSpeed")),F.gv.rotate(a.x,a.y,!1,!1)),T("between"))},$._42=function(E,F){};var p={"rotate.left":function(){f({x:-2,y:0})},"rotate.right":function(){f({x:2,y:0})},"rotate.up":function(){f({x:0,y:-2})},"rotate.down":function(){f({x:0,y:2})},"pan.left":function(){g({x:2,y:0})},"pan.right":function(){g({x:-2,y:0})},"pan.up":function(){g({x:0,y:-2})},"pan.down":function(){g({x:0,y:2})},"zoom.in":function(){F.gv.setZoom(a())},"zoom.out":function(){F.gv.setZoom(1/a())}},W={},Y={rotate:1,pan:1,zoom:1};$.initShortcuts=function(){var D,g=F.shortcutManager,f={},T=F.getKeysMap();for(D in T)if(Y[D]){var a,b=T[D];for(a in b){var B=D+"."+a,B={tag:f[b[a]]=B,action:function(F){var D=F.tag;if("down"===F.kind){var g=function(){T(),W[f]=E.requestAnimationFrame(g)};if(W[D])return;var f=D,T=p[D];return K(f),void g()}"up"===F.kind&&W[D]&&K(D)}};g.registerShortcut(b[a],B),g.registerShortcut("shift + "+b[a],B)}}}},{POINTS:"p",LINES:"l",FACES:"f"}),KF="clonerHighlightShader",bF=(QE.Point=function(E){var g,f,T,a=this,K=new H.Node,b={},B=new C,$=new BF(E.gv),p=new J,W=[0,0,0],Y=new H.Math.Quaternion,o=new H.Math.Matrix4,h=new H.Math.Ray,u=(h.origin=new H.Math.Vector3,h.direction=new H.Math.Vector3,new H.Math.Quaternion),U=new H.Math.Vector3([0,1,0]),t=(a._symbol3dEditMode="POINTS",a._symbol3dSelectMode="union",a._selectionVersion=0,a._lastPosition,a._lastPositionVersion=-1,a.invalidateCachedPosition=function(){a._selectionVersion++},!(a._onSelectionChange=function(F,D){K.editing=F,K._updateIndex(),a.invalidateCachedPosition(),f&&(E.gv.redraw(),!1!==D&&E.fi({kind:"editSelectionChange",selection:F,data:f}),f._comp3d&&E.gv.getData3dUI(f).setSelected(F))})),Z=(K.isPresenting=function(){return!!f&&(f instanceof H.Points||f.a("clonerInstanced")&&f.a("clonerRawPos")||f._node3m||f._comp3d||a.isCommonNode(f)?t:(t&&(E._activeMod=null,E.editDetail=!1),!1))},K._updateIndex=function(){var E=this.editing;t=E&&0<E.length?(this.a("index",E[E.length-1]),!0):(this.a("index",D),!1)},K.isCylinder=function(){return!0},a._onSelectionChange([],!1),K.isCurvePoint=!0,K.moveSelection=function(F){var D=this.editing;if(D&&0!=D.length){var g,T,K,$,p,Y=E.getStyle("moveOnSurface"),o=E.getStyle("moveAlignNormal"),t=E.getStyle("moveCheckOffset"),Z=E.getStyle("moveOnPlane"),m=E.gv,Z=(Y&&h.direction.fromArray(Z).normalize().multiplyScalar(-1),a.invalidateCachedPosition(),T=D.length,new H.Math.Matrix4);if(Z.composeFromArray([0,0,0],f.getQuaternion().toArray(),f.getFinalScale3d()),f._node3m&&Z.premultiply(f._node3mMatrix),Z.invert(),B.copy(F),B.applyMatrix4(Z),f instanceof H.Points){for($=f.getPoints(),k=0;k<T;k++)(p=$[D[k]]).x+=B.x,p.e+=B.y,p.y+=B.z;f.setPoints(H.Default.clone($))}else if(f._node3m)for(k=0;k<T;k++)(K=f.getCompPosition(D[k],!1,!0))[0]+=B.x,K[1]+=B.y,K[2]+=B.z,f.setCompPosition(D[k],K,!1,k===T-1);else if(f._comp3d)E.gv.getData3dUI(f).setCompPositions(D,B.toArray(),W);else if(f.a("clonerInstanced"))for(var r,s=(s=f.a("clonerRawPos").slice(0))&&s.slice(0),k=0;k<T;k++)g=null,Y&&(K=f.getInstancePosition(D[k],!0),h.origin.fromArray([K[0]+F.x,K[1]+F.y,K[2]+F.z]),h.origin.x+=t[0],h.origin.y+=t[1],h.origin.z+=t[2],g=m.intersectObjects(h,m.dm().getDatas().toArray(),function(E){return E!==f&&E.s("3d.selectable")&&E.s("3d.visible")})),g&&g.intersect&&g.intersect.world?(B=g.intersect.world,
f.setInstancePosition(D[k],B.toArray(),!0,!1,s),o&&(r=r||f.a("clonerRawRotation").slice(0),u.setFromUnitVectors(U,g.intersect.worldNormal),f.setInstanceQuaternion(D[k],u.toArray(),!0,!1,r))):((K=f.getInstancePosition(D[k],!1))[0]+=B.x,K[1]+=B.y,K[2]+=B.z,f.setInstancePosition(D[k],K,!1,!1,s)),f.a("clonerRawPos",s),r&&f.a("clonerRawRotation",r);else if(a.isCommonNode(f)&&b.movable)for(k=0;k<T;k++)(K=f.getCompPosition(D[k],!1))[0]+=B.x,K[1]+=B.y,K[2]+=B.z,f.setCompPosition(D[k],K,!1,k===T-1)}},K.scaleSelection=function(F){var D,g,T,K=this.editing;if(K&&0!=K.length)if(a.invalidateCachedPosition(),g=K.length,f instanceof H.Points)a._scalePoints(F,K);else if(f._comp3d)E.isLocalSpace()&&(B.fromArray(F),B.subScalar(1),B.applyQuaternion(Y),B.addScalar(1),F=B.toArray()),E.gv.getData3dUI(f).setCompScales(K,F,W);else if(f.a("clonerInstanced"))for(D=0;D<g;D++)T=f.getInstanceScale(K[D],!1),f.setInstanceScale(K[D],[F[0]*T[0],F[1]*T[1],F[2]*T[2]],!1,D===g-1);else if(a.isCommonNode(f)&&b.resizable)for(D=0;D<g;D++)T=f.getCompScale(K[D],!1),f.setCompScale(K[D],[F[0]*T[0],F[1]*T[1],F[2]*T[2]],!1,D===g-1)},K.rotateSelection=function(F){var D=this.editing;if(D&&0!=D.length){a.invalidateCachedPosition(),T=D.length;var g,T,K=new H.Math.Quaternion;if(f.a("clonerInstanced"))for(g=0;g<T;g++)K.fromArray(f.getInstanceQuaternion(D[g],!0)),K.premultiply(F),f.setInstanceQuaternion(D[g],K.toArray(),!0,g===T-1);else if(f._comp3d){var B=E.gv.getData3dUI(f);(K=f.getQuaternion()).premultiply(F),K.premultiply(f.getQuaternion().inverse()),B.setCompQuaternions(D,K.toArray(),W)}else if(a.isCommonNode(f)&&b.rotatable)for(g=0;g<T;g++)K.fromArray(f.getCompQuaternion(D[g],!0)),K.premultiply(F),f.setCompQuaternion(D[g],K.toArray(),!0,g===T-1)}},K.p3),m=(K.p3=function(){if(0===arguments.length){if(a._lastPositionVersion===a._selectionVersion)return a._lastPosition;var F,g=this.a("index");return g===D?f.p3():(f instanceof H.Points?F=[(F=f.getPoints()[g]).x,F.e,F.y]:f.a("clonerInstanced")?F=f.getInstancePosition(g,!1):f._node3m?F=f.getCompPosition(g,!1):f._comp3d?F=E.gv.getData3dUI(f).getCompPosition(a.getSelection()):a.isCommonNode(f)?F=(b.editDraw?f:E.gv.getData3dUI(f)).getHelperPosition(a.getSelection(),!1):(E.editDetail=!1,E._activeMod=null,K.a("index",0)),g=f.getAnchor3d(),g={x:.5-g.x,y:.5-g.y,z:.5-g.z},W=F,B.fromArray(F),B.applyMatrix4(f.getMatrix4().translate(g)),a._lastPosition=B.toArray(),a._lastPositionVersion=a._selectionVersion,a._lastPosition)}Z.apply(this,arguments)},K.getScale3d=function(){return f.a("clonerInstanced")||f._node3dm?f.a("clonerInstanced")?f.getInstanceScale(this.a("index"),!1):f.getCompScale(this.a("index"),!1):[1,1,1]},K.onPropertyChanged),r=(K.onPropertyChanged=function(F){m.call(this,F);var D,F=F.property,g=Z.call(this),T=this.a("index");"position"!==F&&"elevation"!==F||((F=f.getMatrix4()).invert(),B.fromArray(g),B.applyMatrix4(F),f instanceof H.Points?((D=(F=H.Default.clone(f.getPoints()))[T]).x=B.x,D.e=B.y,D.y=B.z,f.setPoints(F)):f.a("clonerInstanced")?f.setInstancePosition(T,B.toArray(),!1,!0):a.isCommonNode(f)||(E.editDetail=!1,E._activeMod=null,K.a("index",0),t=!1)),E.fi({kind:"selectPoint",x:g[0],y:g[2],e:g[1]})},K.getQuaternion=function(){if(!f)return new H.Math.Quaternion;var F,D=new H.Math.Quaternion,g=this.a("index");return f instanceof H.Points?D=f.getQuaternion():f.a("clonerInstanced")?D.fromArray(f.getInstanceQuaternion(g,!0)):a.isCommonNode(f)?D.fromArray(f.getCompQuaternion(g,!0)):(F=E.gv.getData3dUI(f),D.fromArray(F.getCompQuaternion(g,!0))),Y.copy(D),D},a.catalog="Point",a.setUp=function(){t=!1,E.gv.mi(this.handleInteractorEvent,this)},a.tearDown=function(){E.gv.umi(this.handleInteractorEvent,this)},a.handleInteractorEvent=function(F){var D,g=F.kind,T=this.getSelection();f&&0!=T.length&&(D=(D=E.gv._symbol3dEditSettings)&&D.extrude,"beginMoveDetail"!==g&&"beginScaleDetail"!==g||!D&&!F.event.altKey||(f._comp3d||E.beginTransaction(),D=a._addElements(T),E.fi({kind:"addPoints",list:D,data:f}),a._onSelectionChange(D),f._comp3d||E.endTransaction()),f._comp3d&&(T=E.gv.getData3dUI(f),"beginMoveDetail"!==g&&"endMoveDetail"!==g&&"beginScaleDetail"!==g&&"endScaleDetail"!==g&&"beginRotateDetail"!==g&&"endRotateDetail"!==g||(D=[0,0,0,1],E.isLocalSpace()&&(D=Y.toArray()),T.onEditDetail(F,this.getSelection(),W,D)),"betweenMoveDetail"===g&&T.onBetweenEditDetail(F,this.getSelection(),W)))},a.canEnterEditDetailMode=function(F){if(D=E.gv.sm().ld()){var D,g=!(b={});if(D.getSupportInteractor&&D.getSupportInteractor()===a.catalog&&(g=!0,D.getEditCapability&&(b=D.getEditCapability()),D.getEditHelperClass&&(D=new(D.getEditHelperClass())(E.gv,D))),(g||D instanceof H.Points||D.a("clonerInstanced")||D._node3m||D._comp3d)&&(!D.a("clonerInstanced")||!D.a("clonerLod"))){if(D._comp3d&&(!(g=D.s("shape3d"))||!g.mesh||g.mesh.type))return;if(g=0,D instanceof H.Points?g=D.getPoints().length:D._node3m||D._comp3d?g=1:D.a("clonerInstanced")?g=D.a("clonerRawPos").length/3:D.getCompCount&&(g=D.getCompCount()),!(0===g||1e6<g))return a._onSelectionChange([],!1),D._comp3d&&(D._isEditing=!0),a.invalidateCachedPosition(),f=D}}},a.canQuitEditDetailMode=function(F){return F=E.getDataInfoAt(F),!((F=F?F.data:null)&&F===f||(a._onSelectionChange([],!1),a._initHighlightModel(),f&&f._comp3d&&(f._isEditing=!1),f=null))},a.getEditingData=function(){return E.editDetail?K:null},a.handleEditDetail=function(E){},a.startEdit=function(F){g={start:new S(E.gv.lp(F))},t=!1,f&&f._comp3d&&E.gv.getData3dUI(f).onMouseDown(F)},new S),s=(a.handleEdit=function(F){r.copy(E.gv.lp(F)),1e-5<g.start.distanceToSquared(r)&&(g.moved=!0)},a.endEdit=function(F){var D=E.gv;if(E.editDetail)if(g&&g.moved)g=null;else{var T=H.Default.isCtrlDown(F),K=E.getStyle("pickRange"),K=D.getDataInfoAt(F,K,function(E){if("body"===E.part)return!1});if(!K)return T?void 0:void a._onSelectionChange([],!1);var b=K.part,B=K.data;if("number"==typeof b){var $=this.getSelection(),p=!1;!f._comp3d||(D=D.getData3dUI(f).onMouseUp(F,K))&&($=D,p=!0),p||(T?(F=$.indexOf(b))<0?$.push(b):$.splice(F,1):$=[b]);var W,K=[0,0,0];if(B instanceof H.Points)K=[(W=B.getPoints())[b].x,W[b].e,W[b].y];else if(f._node3m||f._comp3d)K=[0,0,0];else if(B.a("clonerInstanced")){if(!(W=B.a("clonerRawPos")))return g=null,t=!1,E.editDetail=!1,void(E._activeMod=null);K=[W[3*b],W[3*b+1],W[3*b+2]]}E.fi({kind:"selectPoint",x:K[0],y:K[2],e:K[1]}),g=null,a._onSelectionChange($)}}},a.cancelSelection=function(F){var D=E.getStyle("pickRange");E.gv.getDataInfoAt(F,D,function(E){if("body"===E.part)return!1})||a._onSelectionChange([],0<K.editing.length)},a.check=function(F,D,g,T,K){if(f){var b=E.getStyle("pickRange");if(T=f._comp3d?F.getDataInfoAt(D,b,function(E){if("body"===E.part)return!1}):F.getDataInfoAt(D,b),f._comp3d&&E.gv.getData3dUI(f).onMouseMove(T,K,D),T&&T.data===f&&(!K||H.Default.isLeftButton(D)))return f instanceof H.Points||!(!f.a("clonerInstanced")||!f.a("clonerRawPos"))||!(!f._node3m&&!f._comp3d)||!!a.isCommonNode(f)||void 0}},a._42=function(F,D){if(f&&E._activeMod===this&&(a.isCommonNode(f)&&b.editDraw&&f.editDraw(F,D),!F._picking&&!F.isReflecting(D)&&!f._comp3d)){var g=this.getSelection().length;if(0!=g){f instanceof H.Points||(o.multiplyMatrices(F._projectMatrix,F._viewMatrix),g=f.getAnchor3d(),K=f.getMatrix4(),g.x=.5-g.x,g.y=.5-g.y,g.z=.5-g.z,0===g.x&&0===g.y&&0===g.z||K.translate(g),p.multiplyMatrices(o,K),T=p.toArray()),this._updateHighlightModel();var K,B="red",W=$.getRenderTarget(D);if(this._highlightModel)delete this._highlightModel.mat.cacheKey,this._highlightModel.mat.maskColor=B,this._highlightModel.mat.pickColor=B,F.getPostProcessing().blitScreen(W,this._highlightModel);else if(this._highlightModels)for(var Y=this._highlightModels.length,h=0;h<Y;h++)this._highlightModels[h].mat.maskColor=B,F.getPostProcessing().blitScreen(W,this._highlightModels[h],{clear:0==h});$._42(F,D,B)}}},a.handleDelete=function(F){H.Default.isShiftDown(F),F=a.getSelection(),0!=F.length&&f&&(E.beginTransaction(),a._deleteElements(F),E.fi({kind:"deletePoints",list:F,data:f}),a._onSelectionChange([]),E.endTransaction())},{POINTS:"6",LINES:"7",FACES:"8"}),k=(a.initShortcuts=function(){var F,g=E.globalShortcutManager;for(F in s)g.registerShortcut(s[F],{tag:F,action:function(E,F){"down"===F.kind&&a._switchComp3dEditMode(E,!0)}.bind(D,F)})},a.handleDoubleClick=function(E){},a.canRotate=function(){return!!f&&!!(f.a("clonerInstanced")||f._node3m||f._comp3d||a.isCommonNode(f))&&(a.isCommonNode(f)?t&&b.rotatable:t)},a.canScale=function(){return!!f&&(a.isCommonNode(f)?t&&b.resizable:t)},a.canTransform=function(){return!!f&&!!(f.a("clonerInstanced")||f._node3m||f._comp3d||a.isCommonNode(f))&&(a.isCommonNode(f)?t&&b.movable&&(b.rotatable||b.resizable):t)},a.canTranslate=function(){return!!f&&t},a.handleRectSelection=function(F,D){var g,T,K,b=E.gv,B=D.slice(0),$=[],p={},W="ellipse"===E.getStyle("rectSelectShape");if(b.getDatasInRect(F,function(E,D,T){return g=E.part,E.data===f&&"number"==typeof g&&((!E.mode||E.mode===aF[a._symbol3dEditMode])&&(!(W&&(E=2*(D-F.x)/F.width-1,D=2*(T-F.y)/F.height-1,1<E*E+D*D))&&(!p[g]&&(p[g]=!0,void $.push(g)))))}),0==(o=$.length)){if(!this._lastSelection||0===this._lastSelection.length)return;this._lastSelection=$,K=B}else{f&&f._comp3d&&(Y=b.getData3dUI(f),o=($=Y.getQuadSelection($)).length);var Y,o,h=!1;if(this._lastSelection)if(this._lastSelection.length===$.length){for(T=0;T<o;T++)if(this._lastSelection[T]!==$[T]){h=!0;break}}else h=!0;else h=!0;if(!h)return;this._lastSelection=$,K=D&&0!=D.length?a._getSelection(B,$):$}a._onSelectionChange(K),f&&f._comp3d&&(Y=b.getData3dUI(f)).onRectSelection(K,$)},a._getDumMap=function(E){for(var F={},D=E.length,g=0;g<D;g++)F[E[g]]=!0;return F},a._getSelection=function(E,F){var D=this._symbol3dSelectMode;if("replace"===D)return F;var g,f,T,K,b=[],B=F.length,$=E.length;if("union"===D){for(T=a._getDumMap(E),g=0;g<B;g++)T[f=F[g]]||(E.push(f),T[f]=!0);return E}if("intersection"===D){for(T=a._getDumMap(E),g=0;g<B;g++)T[f=F[g]]&&b.push(f);return b}if("complement"===D){for(T=a._getDumMap(F),g=0;g<$;g++)T[E[g]]||b.push(E[g]);return b}if("difference"===D){for(T=a._getDumMap(E),g=0;g<B;g++)T[F[g]]||b.push(F[g]);return b}if("xor"!==D)return E;for(T=a._getDumMap(E),K=a._getDumMap(F),g=0;g<B;g++)T[f=F[g]]||b.push(f);for(g=0;g<$;g++)K[f=E[g]]||b.push(f);return b},a._initHighlightModel=function(){f instanceof H.Points?this._initPointsHighlightModel():f.a("clonerInstanced")?this._initClonerHighlightModel:a.isCommonNode(f)&&this._initCommonNodeHighlightModel()},a._initClonerHighlightModel=function(){var E={type:"CLONER_HIGHLIGHT_SHADER"};this._highlightModel={model3d:!0,instances:{aMatrixInstanced:[]},matDef:{},mat:E},this._highlightModel.matDef[KF]=E},a._initPointsHighlightModel=function(){var F=f,F=E.gv.getData3dUI(F)._material;F?(F.defines||(F.defines={}),F.defines.HIGHLIGHT=!0,F.useColor=!1,F.useUvArray=!1):F={type:"POINTS_HIGHLIGHT_SHADER",renderMode:"points"},F.picking=!0,F.useColor=!1,F.useUvArray=!1,F.alphaTest=0,F.transparent=!1,this._highlightModel={model3d:!0,matDef:{pointsHighlightShader:F},mat:F}},a._initCommonNodeHighlightModel=function(){var E={type:"CLONER_HIGHLIGHT_SHADER",defines:{COMMON_NODE:!0}};this._highlightModel={model3d:!0,matDef:{},mat:E},this._highlightModel.matDef[KF]=E},a._updateHighlightModel=function(){this._highlightModel=null,this._highlightModels=null,f instanceof H.Points?this._updatePointsHighlightModel():f._node3m?this._updateNode3mHighlightModel():a.isCommonNode(f)?this._updateCommonNodeHighlightModel():this._updateClonerHighlightModel()},a._updateNode3mHighlightModel=function(){var F=E.gv.getData3dUI(f);if(F&&F._pickModels){var D=this.getSelection();if(0!=D.length){this._highlightModels=[];for(var g,a=D.length,K=0;K<a;K++)(g=F._pickModels[D[K]]).mat.uClonerMatrix=T,this._highlightModels.push(g)}}},a._updateCommonNodeHighlightModel=function(){var F=E.gv.getData3dUI(f);if(F&&F.getHighlightModel){var D=this.getSelection();if(0!=D.length)if(!0===b.highlightModels)this._highlightModels=F.getHighlightModel(D);else{this._initCommonNodeHighlightModel();for(var g=this._highlightModel,a=F.getHighlightModel(D),K=a.length,B=g.comps=[],$=0;$<K;$++)a[$].mat=KF,B.push(a[$]);g.mat.uClonerMatrix=T}}},a._updatePointsHighlightModel=function(){var F=E.gv,D=f,g=this.getSelection(),T=g.length;if(0!=T){this._initPointsHighlightModel();for(var a,K=this._highlightModel,b=new Float32Array(3*T),B=D.getPoints(),$=F.getData3dUI(f),p=[],W=0;W<T;W++)a=B[g[W]],b.set([a.x,a.e,a.y],3*W),$.shapeModel.ss&&p.push($.shapeModel.ss[g[W]]);K.mesh={position:b,sizeArray:p,pickColor:$.shapeModel.ps}}},a.getSelection=function(){return K.editing||[]},a._updateClonerHighlightModel=function(){E.gv;var F=this.getSelection(),D=F.length;if(0!=D){this._initClonerHighlightModel();for(var g,a,K,b,B,$=this._highlightModel,p=new Float32Array(16*D),W=H.Default.getShape3dModel(f.s("shape3d")),Y=W.instances.aMatrixInstanced,o=0;o<D;o++)for(a=F[o],g=0;g<16;g++)p[16*o+g]=Y[16*a+g];$.instances.aMatrixInstanced=p,$.mat.uClonerMatrix=T,f.a("clonerPickRenderMode")?$.mat.renderMode=f.a("clonerPickRenderMode"):delete $.mat.renderMode,K=[0,0,0],b=[1,1,1],B=[0,0,0,1],W.position&&(K=W.position.slice(0)),W.scale&&(b=W.scale.slice(0)),W.quaternion&&(B=W.quaternion.slice(0)),W.mesh&&($.mesh=W.mesh),W.comps&&($.comps=this._cloneComps(W.comps,"clonerHighlightShader")),$.position=K,$.scale=b,$.quaternion=B}},a._cloneComps=function(E,D){if(!E||0==E.length)return[];for(var g,f,T,a,K,b=E.length,B=[],$=0;$<b;$++){for(g={},f=E[$],a=(T=F.keys(f)).length,K=0;K<a;K++)"comps"==T[K]?g[T[K]]=this._cloneComps(f[T[K]],D):g[T[K]]=f[T[K]];D&&(g.mat=D),B.push(g)}return B},a.isWorldSpace=function(){return f&&f instanceof H.Points},a.translateInAllModes=function(){if(3===E.editMode||!f)return!1;var F=!1;return a.isCommonNode(f)&&(F=!b.rotatable&&!b.resizable&&b.movable),f instanceof H.Points||F},a.setIsPresenting=function(E){t=E},a._addCopyPoints=function(E){for(var F=f.getPoints(),D=f.getSizes(),g=F.slice(0),T=[],a=!1,K=E.length,b=F.length,B=0;B<K;B++)g.push(H.Default.clone(F[E[B]])),T.push(b+B),D[E[B]]&&(D[b+B]=D[E[B]],a=!0);return f.setPoints(g),a&&f.setSizes(D),T},a._addElements=function(F){var D=[];return f instanceof H.Points?D=a._addCopyPoints(F):f.a("clonerRawPos")?D=f.addInstancesCopy(F):f._comp3d?D=E.gv.getData3dUI(f).extrudeFaces(F):a.isCommonNode(f)&&b.addCopy&&f.addCopyComps&&(D=f.addCopyComps(F)),D},a._deleteElements=function(F){f instanceof H.Points?a._deletePoints(F):f._comp3d?E.gv.getData3dUI(f).deleteComps(F):f._node3m?f.setCompsVisible(F,!1):f.a("clonerRawPos")?f.deleteInstances(F):a.isCommonNode(f)&&b.deletable&&f.deleteComps(F)},a._deletePoints=function(E){for(var F=f.getPoints(),D=[],g=F.length,T=0;T<g;T++)E.indexOf(T)<0&&D.push(F[T]);f.setPoints(D)},a._scalePoints=function(E,F){for(var D=f.getSizes(),g=(f.getPoints().length,F.length),T=1,a=0;a<3;a++)if(1!==E[a]){T=E[a];break}for(a=0;a<g;a++)D[F[a]]||(D[F[a]]=f.s("points.size")),D[F[a]]*=T;f.setSizes(D)},a.getTarget=function(){return f},{selectPoint:"POINTS",selectLine:"LINES",selectFace:"FACES"}),V={replace:"set",union:"union",intersection:"intersection",complement:"complement",difference:"difference",xor:"xor"};a._switchComp3dEditMode=function(F,D){E.fi({kind:"comp3dEditMode",oldMode:a._symbol3dEditMode,newMode:F,shortcut:D}),D=[],f&&f._comp3d&&(D=E.gv.getData3dUI(f).switchEditMode(a._symbol3dEditMode,F,K.editing)),a._symbol3dEditMode=F,a._onSelectionChange(D)},a.onViewCommand=function(F){"select"===F.kind&&(k[F.id]?a._symbol3dEditMode!==k[F.id]&&a._switchComp3dEditMode(k[F.id]):V[F.id]&&a._symbol3dSelectMode!==F.id&&(E.fi({kind:"selectMode",oldMode:a._symbol3dSelectMode,newMode:F.id}),a._symbol3dSelectMode=F.id))},a.getSymbol3dEditMode=function(){return a._symbol3dEditMode},a.selectAll=function(){if(!f)return!1;for(var F=0,D=E.gv.getData3dUI(f),g=(f instanceof H.Points?F=D._lastPointNumber:f.a("clonerRawPos")?F=D._lastPickNumber:f._comp3d?F=D.getPickRange(a._symbol3dEditMode):a.isCommonNode(f)&&(F=f.getCompCount()),[]),T=0;T<F;T++)g.push(T);return a._onSelectionChange(g),!0},a.setSymbol3dEditMode=function(F){E.fi({kind:"updateSelectMode",oldMode:a._symbol3dSelectMode,newMode:F})},a.isCommonNode=function(E){return!!E&&E.getSupportInteractor&&E.getSupportInteractor()===a.catalog}},"uniform vec4 maskColor;void main(void) {  gl_FragColor =  maskColor;}"),BF=(H.Default.setShader("CLONER_HIGHLIGHT_SHADER","uniform mat4 uClonerMatrix;uniform mat4 uRightMatrixInstanced;attribute vec3 aPosition;\n#ifndef COMMON_NODE\nattribute mat4 aMatrixInstanced;\n#endif\nvoid main(void) {\n#ifndef COMMON_NODE\n  vec4 transformed = aMatrixInstanced * uRightMatrixInstanced * vec4(aPosition, 1.0);\n#else\n  vec4 transformed = vec4(aPosition, 1.0);\n#endif\n  gl_Position = uClonerMatrix * transformed;}",bF),H.Default.setShader("POINTS_HIGHLIGHT_SHADER","uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 aPosition;bool isPerspectiveMatrix(mat4 m) {  return m[ 2 ][ 3 ] == - 1.0;}void main(void) {  vec4 mvPosition = modelViewMatrix * vec4(aPosition, 1.0);  if (isPerspective) gl_PointSize *= (scale / - mvPosition.z);  gl_Position = projectionMatrix * mvPosition;}",bF),QE.EditHighlightHelper=function(E){this.gv=E});t(BF,F,{getRenderTarget:function(E){var F=this,D=F.gv,g=D._camera,f=(g=g?(T=(g=g.getRenderTargetSize(D))[0],g[1]):(T=D.getWidth(),D.getHeight()),D.getDevicePixelRatio()),T=Math.floor(T*f),g=Math.floor(g*f);return(f=F._renderTarget)?f.setSize(E,T,g):F._renderTarget=f=new H.graph3d.RenderTarget(D,E,T,g),F._width=T,F._height=g,f},_42:function(E,F,D){var g=this.gv;g.getPostProcessing().blitScreen(null,{type:"highlightHard",image:this._renderTarget.texture,textureSize:[this._width,this._height],edgeWidth:g.getHighlightWidth(),edgeColor:"red",maskColor:D},{clear:!1})}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);ht.Default.setImage("editor.axis",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(138,138,138)",borderCap:"round",shadowColor:"#1ABC9C",points:[8,2.48536,8,9,1.08734,12.01256,8,9,14,13]}]}),ht.Default.setImage("editor.cube.image",{width:100,height:100,comps:[{type:"rect",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("editor.sphere.image",{width:100,height:100,comps:[{type:"oval",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("editor.floor",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5056,9.71598,12.98879,3.75]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",opacity:.2,points:[14.49439,9.71598,14.49439,1.61266,4.70858,1.61266,4.70858,9.71598]}]}),ht.Default.setImage("editor.wall",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.2,points:[2,15,10,15,14,11]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[6,2,14,2,14,11,6,11,2,15,2,6,6,2,6,11]}]}),ht.Default.setImage("editor.cancel",{background:"red",width:16,height:16,comps:[{type:"circle",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[1,1,14,14]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[10.94702,4.96729,4.99893,11.04194]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[5,4.96729,11.29505,11.29505]}]}),ht.Default.setImage("editor.pipeline",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[14.11524,6.61831,14.11524,6.61831,9.30492,12.81031,8.07676,10.14929,6.8486,7.48826,9.56079,4.00846,6.33686,4.00846,3.11293,4.00846,.86129,8.92112,.86129,8.92112],segments:[1,4,4,4]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15.28357,7.93382,15.28357,7.93382,10.47326,14.12582,9.24509,11.46479,8.01693,8.80377,10.72913,5.32397,7.50519,5.32397,4.28126,5.32397,2.02963,10.23663,2.02963,10.23663],segments:[1,4,4,4]}]}),ht.Default.setImage("editor.doorWindow",{width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"#979797",rect:[4.5,.5,7,15]},{type:"shape",borderWidth:1,borderColor:"#979797",points:[8.5469,8,10.42756,8]}]}),ht.Default.setImage("editor.selectAll",{width:16,height:16,blendMode:"override",comps:[{type:"shape",background:"#212121",pixelPerfect:!0,points:[5.08505,2.30851,5.34194,2.54013,5.36281,2.94207,5.13131,3.19905,3.23923,5.30136,3.12348,5.42963,2.95996,5.50486,2.78724,5.50931,2.61452,5.51376,2.44734,5.44704,2.32514,5.3249,1.27399,4.27375,1.04384,4.02676,1.05073,3.63654,1.28944,3.39783,1.52816,3.15911,1.91838,3.15222,2.16537,3.38237,2.74645,3.96261,4.19452,2.35476,4.42613,2.09788,4.82807,2.07701,5.08505,2.30851,6.55499,4.03829,6.55499,3.6923,6.83969,3.4076,7.18568,3.4076,14.33353,3.4076,14.67952,3.4076,14.96423,3.6923,14.96423,4.03829,14.96423,4.38428,14.67952,4.66898,14.33353,4.66898,7.18568,4.66898,6.83969,4.66898,6.55499,4.38428,6.55499,4.03829,6.55499,8.24291,6.55499,7.89692,6.83969,7.61222,7.18568,7.61222,14.33353,7.61222,14.67952,7.61222,14.96423,7.89692,14.96423,8.24291,14.96423,8.5889,14.67952,8.8736,14.33353,8.8736,7.18568,8.8736,6.83969,8.8736,6.55499,8.5889,6.55499,8.24291,7.18568,11.81684,6.83969,11.81684,6.55499,12.10154,6.55499,12.44753,6.55499,12.79352,6.83969,13.07822,7.18568,13.07822,14.33353,13.07822,14.67952,13.07822,14.96423,12.79352,14.96423,12.44753,14.96423,12.10154,14.67952,11.81684,14.33353,11.81684,7.18568,11.81684,5.13131,11.60829,5.28758,11.44203,5.34191,11.20344,5.27302,10.98591,5.20413,10.76838,5.02236,10.60456,4.79887,10.55857,4.57537,10.51259,4.34369,10.59134,4.19452,10.764,2.7456,12.37269,2.16537,11.79161,1.91959,11.554,1.52308,11.55726,1.28124,11.79887,1.0394,12.04048,1.03577,12.43699,1.27315,12.68299,2.3243,13.73414,2.4465,13.85628,2.61368,13.92299,2.7864,13.91855,2.95911,13.9141,3.12263,13.83886,3.23839,13.7106,5.13046,11.60829],segments:[1,4,2,4,4,2,4,4,2,2,4,5,1,4,2,4,4,2,4,5,1,4,2,4,4,2,4,5,1,4,4,2,4,4,2,5,1,4,4,4,2,2,4,4,2,4,4,2,5]}]}),ht.Default.setImage("editor.cube",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("editor.sphere",{background:"rgb(179,179,179)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.49999,1.5,13,13]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",arcFrom:3.22886,arcTo:5.96903,arcClose:!1,arcOval:!0,opacity:.4,rotation:2.4578,rect:[.10993,1.43114,12.94079,10.68594]}]}),ht.Default.setImage("editor.cylinder",{background:"rgb(179,179,179)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5,1.5,13,9.5]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",arcClose:!1,arcOval:!0,opacity:.4,rotation:3.14159,rect:[1.49362,6,13,9.5]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[1.49362,10.75,1.48724,6.35177]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[14.5,10.75,14.5,6.10177]}]}),ht.Default.setImage("editor.scene.cone",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[3,10,10,3.48659]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[3,12,8,2,13,12]}]}),ht.Default.setImage("editor.scene.torus",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1,4,14,10]},{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2,2,12,10]}]}),ht.Default.setImage("editor.scene.triangle",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"triangle",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"triangle",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2.09838,2,12,10]}]}),ht.Default.setImage("editor.scene.rightTriangle",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rightTriangle",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"rightTriangle",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.09838,2,10.90162,10]}]}),ht.Default.setImage("editor.scene.parallelogram",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1,5,14,8]},{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1,2,13,8]}]}),ht.Default.setImage("editor.scene.trapezoid",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"trapezoid",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[.90479,6,14,8]},{type:"trapezoid",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.40479,2.5,13,9]}]}),ht.Default.setImage("editor.scene.rect",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.2894,2.39375,9.61796,9.2125]}]}),ht.Default.setImage("editor.scene.roundRect",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"roundRect",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"roundRect",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.2894,2.39375,9.61796,9.2125]}]}),ht.Default.setImage("editor.scene.star",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"star",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.59838,2,13,13]},{type:"star",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2,1,12,12]}]}),ht.Default.setImage("editor.scene.box",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",opacity:.4,rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("editor.scene.billboard",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[8,13,6,10,3,10,3,3,13,3,13,10,10,10,8,13]}]}),ht.Default.setImage("editor.scene.plane",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[1.5,12.5,5.5,7.5,14.5,7.5,10.5,12.5,1.5,12.5]}]}),ht.Default.setImage("editor.light",{background:"rgb(179,179,179)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[14,4,12,6,8,1.51088,8,4.69022,2,4,4,6],segments:[1,2,1,2,1,2]},{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[4,6,8,8]}]}),ht.Default.setImage("editor.envmap.t",{width:20,height:20,comps:[{type:"shape",borderWidth:1,borderColor:"#979797",borderCap:"round",points:[10,1,10,19]},{type:"shape",borderWidth:1,borderColor:"#979797",borderCap:"round",points:[10,10,18,10]}]}),ht.Default.setImage("editor.envmap.l",{width:20,height:20,comps:[{type:"shape",borderWidth:1,borderColor:"#979797",borderCap:"round",points:[10,1,10,10,18,10]}]}),ht.Default.setImage("editor.refresh",{width:16,height:16,comps:[{type:"shape",background:"#ffffff",pixelPerfect:!0,scaleX:-1,rotation:4.84125,points:[12.18494,3.75768,11.01446,2.62418,9.45824,2,7.80294,2,7.80284,2,7.80306,2,7.80292,2,6.14776,2,4.59136,2.62428,3.42098,3.75768,3.4156,3.7629,3.39892,3.7791,3.37498,3.80242,3.56406,3.11914,3.6223,2.9087,3.4933,2.69236,3.276,2.63596,3.0586,2.57952,2.8353,2.70446,2.77706,2.91492,2.19456,5.02004,2.15688,5.1562,2.19708,5.30144,2.29998,5.4011,2.3774,5.47606,2.48144,5.51664,2.58806,5.51664,2.62322,5.51664,2.65864,5.51222,2.6935,5.5032,4.86732,4.93912,5.08464,4.88272,5.21362,4.6664,5.15538,4.45594,5.09716,4.2455,4.87374,4.1206,4.65644,4.17698,3.95142,4.35992,3.97002,4.34182,3.98576,4.32654,3.99708,4.31554,5.01368,3.3311,6.36528,2.78892,7.80292,2.78896,9.24056,2.78896,10.5922,3.3311,11.60876,4.31554,13.70732,6.34774,13.70732,9.65436,11.60878,11.68654,9.51024,13.71866,6.09566,13.71872,3.99708,11.68654,3.46488,11.17114,3.05778,10.56844,2.7871,9.89524,2.70548,9.69224,2.46932,9.59174,2.25968,9.67072,2.05002,9.74976,1.94622,9.97844,2.02786,10.18146,2.33974,10.9572,2.80842,11.65132,3.42098,12.24444,4.59142,13.37792,6.14766,14.0021,7.80294,14.0021,9.45826,14.0021,11.01448,13.37788,12.18494,12.24444,13.35542,11.111,14.00002,9.604,14,8.00106,14,6.39812,13.35542,4.89114,12.18494,3.75768],segments:[1,4,4,4,4,2,4,4,2,4,4,4,2,4,4,2,4,4,4,4,4,4,4,4,4,4,4,4,4,5]}]}),ht.Default.setImage("editor.material.logo",{modified:"Mon Jan 30 2023 16:03:40 GMT+0800 (GMT+08:00)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"#ffffff",borderCap:"round",points:[4.98775,4.45122,5.90406,3.77865,7.0088,3.41041,8.14537,3.39868,11.17676,3.39868,13.67121,5.89313,13.67121,8.92451,13.67121,11.95589,11.17676,14.45035,8.14537,14.45035,2.61955,14.45035,2.61955,8.97714,2.60784,8.20711,2.75847,7.44318,3.06161,6.73523,4.65094,4.39859,4.65518,3.59799,4.17314,2.87031,3.43428,2.56196,2.69542,2.25362,1.8391,2.42277,1.27298,2.98888,.70687,3.55501,.53771,4.41133,.84605,5.15019,1.1544,5.88905,1.88208,6.37109,2.68268,6.36684,4.65094,6.36684],segments:[1,4,4,4,2,2,4,1,4,4,4,4,2,5]},{type:"shape",borderWidth:1,borderColor:"#ffffff",opacity:.4,points:[1.35649,2.94609,2.94582,1.34622,2.94582,1.34622,3.3134,1.00896,3.79422,.82115,4.29307,.81996,4.8167,.81715,5.32038,1.02343,5.69165,1.39272,6.0629,1.76199,6.27186,2.26457,6.27185,2.78821,6.27185,2.78821,7.24735,2.13885,8.39445,1.79435,9.56631,1.79882,12.6633,1.7346,15.26565,4.22774,15.33423,7.32465,15.29762,9.26685,13.90114,11.62854,12.20591,12.57705,8.96636,8.72453,8.96636,11.99793,8.96636,12.45408,8.591,12.82943,8.13483,12.82943,7.27175,12.82943,7.27175,8.72453,6.13502,8.72453,5.93689,8.72453,5.74668,8.64574,5.60659,8.50565,5.4665,8.36556,5.38771,8.17535,5.38771,7.97722,5.38771,7.06152,10.12416,7.06152,10.53987,7.06152,10.88197,7.40361,10.88197,7.81935,10.88197,7.97722,10.88199,8.17718,10.80175,8.36901,10.65938,8.5094,10.51702,8.6498,10.32409,8.72735,10.12416,8.72453],segments:[1,2,2,4,4,4,2,4,4,4,1,2,4,2,2,2,4,4,2,2,4,2,4,4,5]}]}),ht.Default.setImage("editor.fileIcon",{dataBindings:[{attr:"text",valueType:"Multiline"},{attr:"textScale",valueType:"Number"}],width:64,height:64,fitSize:!0,animation:{},comps:[{type:"shape",background:"#000000",points:[56.21111,19.11398,40.59837,2.34525,40.23096,1.94622,39.70418,1.92216,39.15478,1.92216,8.11505,1.92216,7.04265,1.92216,6.07649,2.35795,6.07649,3.40366,6.07649,60.1542,6.07649,61.1999,7.04299,62.07784,8.11505,62.07784,13.93496,62.07784,15.00736,62.07784,15.87481,61.28546,15.87481,60.23975,15.87481,59.19405,15.00702,58.40166,13.93496,58.40166,9.84618,58.40166,9.84618,5.59867,35.20824,5.59867,35.20824,21.86677,35.20824,22.91248,36.27174,23.64538,37.3438,23.64538,52.6875,23.64538,52.6875,35.56255,52.6875,36.60826,53.67148,37.45412,54.74388,37.45412,55.81629,37.45412,56.80027,36.60793,56.80027,35.56255,56.80027,20.28301,56.80027,19.81747,56.52917,19.46155,56.21111,19.11398,56.21111,19.11398,39.32101,6.67546,51.68947,19.9692,39.32101,19.9692,39.32101,6.67546,39.32101,6.67546],segments:[1,2,4,2,4,2,4,2,4,4,2,2,2,2,4,2,2,4,4,2,4,2,1,2,2,2,2]}]}),"json|tga|hdr|fbx|gltf|glb|htb|cob|obj|mtl|glsl".split("|").forEach(function(E){Z(E)});var I=(function(){function E(E){this.value=E}function F(F){function D(E,F){return new Promise(function(D,f){var K={key:E,arg:F,resolve:D,reject:f,next:null};a?a=a.next=K:(T=a=K,g(E,F))})}function g(D,T){try{var a=F[D](T),K=a.value
;K instanceof E?Promise.resolve(K.value).then(function(E){g("next",E)},function(E){g("throw",E)}):f(a.done?"return":"normal",a.value)}catch(E){f("throw",E)}}function f(E,F){switch(E){case"return":T.resolve({value:F,done:!0});break;case"throw":T.reject(F);break;default:T.resolve({value:F,done:!1})}T=T.next,T?g(T.key,T.arg):a=null}var T,a;this._invoke=D,"function"!=typeof F.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(F.prototype[Symbol.asyncIterator]=function(){return this}),F.prototype.next=function(E){return this._invoke("next",E)},F.prototype.throw=function(E){return this._invoke("throw",E)},F.prototype.return=function(E){return this._invoke("return",E)}}(),function(E,F){if(!(E instanceof F))throw new TypeError("Cannot call a class as a function")}),N=function(){function E(E,F){for(var D=0;D<F.length;D++){var g=F[D];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(E,g.key,g)}}return function(F,D,g){return D&&E(F.prototype,D),g&&E(F,g),F}}(),P=function(E,F){if("function"!=typeof F&&null!==F)throw new TypeError("Super expression must either be null or a function, not "+typeof F);E.prototype=Object.create(F&&F.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),F&&(Object.setPrototypeOf?Object.setPrototypeOf(E,F):E.__proto__=F)},q=function(E,F){if(!E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!F||"object"!=typeof F&&"function"!=typeof F?E:F},R=function(){function E(F,D){var g=this;I(this,E),this.handler=F,this.editor=D,this.cookie=0,this.callbacks={},this.cmds={};var f=hteditor.config.host||window.location.hostname,T=hteditor.config.port||window.location.port,a=this.url=window.location.protocol+"//"+f+":"+T;this.socket=io.connect(a),this.socket.on("connect",function(){g.handler({type:"connected",message:a})}),this.socket.on("disconnect",function(){g.handler({type:"disconnected",message:a})}),this.socket.on("fileChanged",function(E){g.handler({type:"fileChanged",path:E.path,event:E.event})}),this.socket.on("operationDone",function(E,F){g.handleRespone(E,F)}),this.socket.on("download",function(E){g.handler({type:"download",path:E})}),this.socket.on("confirm",function(E,F){g.handler({type:"confirm",path:E,datas:F})})}return E.prototype.request=function(E,F,D){if("uploadLocalFile"===E)return void this.requestHttp(E,F,D);var g=++this.cookie;this.callbacks[g]=D,this.cmds[g]=E;var f=this.editor.sid;this.socket.emit(E,g,F,f?{sid:f}:null);var T=E;F&&(ht.Default.isString(F)?T=E+": "+F:F.path&&(T=E+": "+F.path)),this.handler({type:"request",message:T,cmd:E,data:F})},E.prototype.handleRespone=function(E,F){var D=this.callbacks[E],g=this.cmds[E];delete this.callbacks[E],delete this.cmds[E],D&&D(F),this.handler({type:"response",message:g,cmd:g,data:F})},E.prototype.requestHttp=function(E,F,D){var g=++this.cookie;this.callbacks[g]=D,this.cmds[g]=E;var f=this.editor.sid;this[E](g,F,f||null,D);var T=E;F&&(ht.Default.isString(F)?T=E+": "+F:F.path&&(T=E+": "+F.path)),this.handler({type:"request",message:T,cmd:E,data:F})},E.prototype.uploadLocalFile=function(E,F,D){var g=this,f=new FormData,T=this.url+"/uploadFile",a=F.path;T+="?sid="+D,f.append("path",F.path),f.append("file",F.file),g.send("POST",T,f,function(F){var D=F.target;if(200===D.status||0===D.status){var f=D.response;if(g.handleRespone(E,!0),f){var T=JSON.parse(f);g.handler({type:"confirm",path:T.tempName,datas:T.paths})}else g.handler({type:"fileChanged",path:a})}})},E.prototype.send=function(E,F,D,g){var f=new ht.Request,T={};T.url=encodeURI(F),T.method=E,T.data=D,g&&(f.onload=g),f.send(T)},E}(),Q=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"scenes"))}return P(F,E),F.prototype.getTreeMenuItemKeyList=function(){return["locateFile","newFolder","rename","delete","export"]},F.prototype.getListMenuItemKeyList=function(){return["locateFile","newFolder","copy","paste","rename","delete","export"]},F}(hteditor.Explorer),d=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"models"))}return P(F,E),F.prototype.getTreeMenuItemKeyList=function(){return["locateFile","newFolder","rename","delete","export"]},F.prototype.getListMenuItemKeyList=function(){return["locateFile","newFolder","copy","paste","rename","delete","export"]},F}(hteditor.Explorer),_=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"symbols"))}return P(F,E),F.prototype.getTreeMenuItemKeyList=function(){return["locateFile","newFolder","rename","delete","export"]},F.prototype.getListMenuItemKeyList=function(){return["locateFile","newFolder","copy","paste","rename","delete","export"]},F}(hteditor.Explorer),C=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"assets"))}return P(F,E),F.prototype.getTreeMenuItemKeyList=function(){return["locateFile","newFolder","rename","delete"]},F.prototype.getListMenuItemKeyList=function(){return["locateFile","newFolder","copy","paste","rename","delete"]},F}(hteditor.Explorer),S=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"materials"))}return P(F,E),F.prototype.addFileNode=function(F,D,g,f){f&&"json"===f.postfix?f.fileType="material":f&&"png"===f.postfix&&(f.fileType="unknow");var T=E.prototype.addFileNode.call(this,F,D,g,f);if(!D)return T;var a=void 0,K=void 0,B=void 0,$=void 0;return $=f&&f.uuid&&T.postfix?T.uuid+"."+T.postfix:T.url,b(g)&&"materials"===F&&(a="material",K=$.replace(".json",".png"),T.s("label",g.replace(".json",""))),Y(f)&&(o(f.fileType)?(a=f.fileType,B=f.fileIcon,K=f.fileImage||K||B,K||"dir"!==f.fileType||(K="editor.dir"),T.a(f.attrs),T.s(f.styles)):(!0===f.dir||null==f.dir&&null==f.fileType)&&(a="dir",K="editor.dir")),K||(K="editor.unknown"),T.fileType=a||"unknow",T.setIcon(B),T.setImage(K),T},F.prototype.getTreeMenuItemKeyList=function(){return["locateFile","newFolder","rename","delete","export"]},F.prototype.getListMenuItemKeyList=function(){return["locateFile","newFolder","copy","paste","rename","delete","export"]},F}(hteditor.Explorer),J=hteditor.getString,O=function(E){function F(D){I(this,F);var g=q(this,E.call(this));g.editor=D,g.editor.menus.push(g);var f=[{label:J("editor.newsceneview"),action:function(){g.editor.newScene()}},{label:J("editor.newmodel"),items:[{label:J("editor.obj"),action:function(){g.editor.newOBJModel()}},{label:J("editor.fbx"),action:function(){g.editor.newFBXModel()}},{label:J("editor.gltf"),action:function(){g.editor.newGLTFModel()}}]},{label:J("editor.newmaterial"),action:function(){g.editor.newMaterial()}}];return g.setItems(f),g}return P(F,E),F}(ht.widget.ContextMenu),L=function(E){function F(D){I(this,F);var g=q(this,E.call(this,D.gv));return g.editor=D,g}return P(F,E),F.prototype.beginTransaction=function(){this._isBeginTransaction||(this._isBeginTransaction=!0,this.dm.beginTransaction())},F.prototype.endTransaction=function(){this._isBeginTransaction&&(this._isBeginTransaction=!1,this.dm.endTransaction())},F.prototype.getDataAt=function(E){return this.gv.getDataAt(E)},F.prototype.getNodeAt=function(E){var F=this.getDataAt(E);return F instanceof ht.Node?F:null},F.prototype.setUp=function(){E.prototype.setUp.call(this),this.sm.cs()},F.prototype.$0$=function(E){},F.prototype.drawRect=function(E,F,D,g){F=this.toRect(F),g&&(E.fillStyle=g),D&&(E.strokeStyle=D),E.lineWidth=1,E.beginPath(),E.rect(F.x,F.y,F.width,F.height),E.stroke(),g&&E.fill(),D&&E.stroke()},F.prototype.drawPoint=function(E,F,D,g,f){F=this.toPoint(F),f&&(E.fillStyle=f),g&&(E.strokeStyle=g),E.lineWidth=1,E.beginPath(),E.arc(F.x,F.y,D,0,2*Math.PI,!0),f&&E.fill(),g&&E.stroke()},F.prototype.drawPoints=function(E,F,D,g,f){for(var T=0;T<F.length;T++)this.drawPoint(E,F[T],D,g,f)},F.prototype.drawLine=function(E,F,D,g){F=this.toPoint(F),D=this.toPoint(D),E.lineWidth=1,E.strokeStyle=g,E.beginPath(),E.moveTo(F.x,F.y),E.lineTo(D.x,D.y),E.stroke()},F.prototype.toRect=function(E){var F=this.zoom;return{x:E.x*F+this.tx,y:E.y*F+this.ty,width:E.width*F,height:E.height*F}},F.prototype.toPoint=function(E){return{x:E.x*this.zoom+this.tx,y:E.y*this.zoom+this.ty}},F.prototype.addData=function(E){this.dm.beginTransaction(),this.dm.add(E),this.editor.sm.ss(E),this.editor.gv.setFocus(),this.editor.fireEvent("dataCreated",{sceneView:this.editor.scene,data:E}),this.dm.endTransaction()},F.prototype.remove=function(E){this.dm.remove(E)},F.prototype.lp=function(E){return this.gv.lp(E)},N(F,[{key:"dm",get:function(){return this.gv.dm()}},{key:"sm",get:function(){return this.gv.dm().sm()}},{key:"zoom",get:function(){return this.gv.getZoom()}},{key:"tx",get:function(){return this.gv.tx()}},{key:"ty",get:function(){return this.gv.ty()}}]),F}(ht.graph.Interactor),M=function(E){function F(D,g,f){I(this,F);var T=q(this,E.call(this,D));return T.createFunc=g,T.points=[],T.segments=[],T.nextPoint=null,T.fill=f,T}return P(F,E),F.prototype.tearDown=function(){E.prototype.tearDown.call(this),this.points=[],this.segments=[],this.nextPoint=null},F.prototype.$48$=function(E){this.nextPoint?(this.nextPoint=null,this.editor.rulerView.validateCanvas()):this.createShape()},F.prototype.createShape=function(){if(this.points.length>1){var E=this.createFunc(this.points,this.segments);this.addData(E)}this.editor.resetInteractionState(),this.editor.pointsEditingMode=!0},F.prototype.handle_mousedown=function(E){this.handle_touchstart(E)},F.prototype.handle_touchstart=function(E){if(ht.Default.preventDefault(E),ht.Default.isLeftButton(E))if(this.gv.setFocus(E),ht.Default.isDoubleClick(E))this.createShape();else{var F=this.judgeNextPoint(E);if(this.points.length){var D=this.points[this.points.length-1];if(Math.abs(D.x-F.x)<.01&&Math.abs(D.y-F.y)<.01)return}this.points.push(F),this.segments.push(this.nextPoint?2:1),this.nextPoint=this.judgeNextPoint(E),this.editor.rulerView.validateCanvas()}},F.prototype.handle_mousemove=function(E){this.nextPoint&&(this.nextPoint=this.judgeNextPoint(E),this.editor.rulerView.validateCanvas())},F.prototype.judgeNextPoint=function(E){var F=this.lp(E),D=this.points;if(ht.Default.isShiftDown()&&D.length>0){var g=D[D.length-1],f=F.x-g.x,T=F.y-g.y,a=Math.atan2(T,f),K=ht.Default.getDistance(g,F),b=a%(Math.PI/4);a-=b,Math.abs(b)>Math.PI/8&&(b>0?a+=Math.PI/4:a-=Math.PI/4),F={x:g.x+Math.cos(a)*K,y:g.y+Math.sin(a)*K}}return F},F.prototype.$0$=function(E){E.beginPath();for(var F=0,D=void 0,g=void 0,f=void 0,T=0;T<this.segments.length;T++){var a=this.segments[T];1===a?(D=this.toPoint(this.points[F++]),E.moveTo(D.x,D.y)):2===a?(D=this.toPoint(this.points[F++]),E.lineTo(D.x,D.y)):3===a?(D=this.toPoint(this.points[F++]),g=this.toPoint(this.points[F++]),E.quadraticCurveTo(D.x,D.y,g.x,g.y)):4===a?(D=this.toPoint(this.points[F++]),g=this.toPoint(this.points[F++]),f=this.toPoint(this.points[F++]),E.bezierCurveTo(D.x,po,y,g.x,g.y,f.x,f.y)):5===a&&E.closePath()}if(this.nextPoint){var K=this.toPoint(this.nextPoint);E.lineTo(K.x,K.y)}E.strokeStyle=hteditor.config.color_data_border,E.lineWidth=1,E.stroke(),this.fill&&(E.fillStyle=hteditor.config.color_transparent,E.fill()),this.drawPoints(E,this.points,4,hteditor.config.color_data_border,hteditor.config.color_data_background)},F}(L),G=function(E){function F(D,g){I(this,F);var f=q(this,E.call(this,D));return f.createFunc=g,f}return P(F,E),F.prototype.tearDown=function(){E.prototype.tearDown.call(this),this.node=this.p1=this.p2=null},F.prototype.handle_mousedown=function(E){this.handle_touchstart(E)},F.prototype.handle_touchstart=function(E){ht.Default.preventDefault(E),ht.Default.isLeftButton(E)&&(this.gv.setFocus(E),this.p1=this.lp(E),this.startDragging(E))},F.prototype.handleWindowMouseMove=function(E){this.handleWindowTouchMove(E)},F.prototype.handleWindowMouseUp=function(E){this.handleWindowTouchEnd(E)},F.prototype.handleWindowTouchMove=function(E){if(ht.Default.preventDefault(E),this.p1){this.p2=this.lp(E);var F=ht.Default.unionPoint(this.p1,this.p2);if(this.node)this.node.setRect(F);else{if(!F.width||!F.height)return;this.beginTransaction(),this.createNode(F,!1)}}},F.prototype.handleWindowTouchEnd=function(E){ht.Default.preventDefault(E),this.endTransaction(),!this.node&&this.p1&&this.createNode({x:this.p1.x-25,y:this.p1.y-25,width:50,height:50},!0),hteditor.config.continuousCreating?this.node=this.p1=this.p2=null:this.editor.resetInteractionState()},F.prototype.createNode=function(E,F){this.node=this.createFunc(E,F),this.node.s3(50,50,50),F?this.node.setPosition(E.x+E.width/2,E.y+E.height/2):this.node.setRect(E),this.addData(this.node)},F.prototype.$0$=function(E){this.node&&this.drawRect(E,this.node.getRect(),hteditor.config.color_data_border)},F}(L),c=hteditor.getString,l=function(E){function F(D){I(this,F);var g=q(this,E.call(this));return g.editor=D,g.initMenu(),g.$68$(),g.enableToolTip(),g}return P(F,E),F.prototype.initMenu=function(){var E=this.editor.mainMenu=new O(this.editor),F=function(F){E.isShowing()&&!E.getView().contains(F.target)&&E.hide()};window.addEventListener("touchstart",F,!1),window.addEventListener("mousedown",F,!1)},F.prototype.$68$=function(){var E=[];E.push(this.$67$()),E.push(this.createEditItem()),E.push(this.createCubeItem()),E.push(this.createCylinderItem()),E.push(this.createSphereItem()),E.push(this.createWallItem()),E.push(this.createDoorWindowItem()),E.push(this.createFloorItem()),E.push(this.createPipelineItem()),E.push(this.createLightItem()),this.setItems(E)},F.prototype.$67$=function(){var E=this,F=hteditor.createItem("menu",c("editor.menu"),"editor.menu");return F.action=function(F,D,g){E.editor.mainMenu.isShowing()||(E.editor.mainMenu.showOnView(E,4,20),g.preventDefault(),g.stopPropagation())},F},F.prototype.createEditItem=function(){return this.editor.createSceneItem("edit",c("editor.edit"),"editor.edit")},F.prototype.createWallItem=function(){var E=m.config.color_data_background,F=m.config.color_transparent;return this.editor.createSceneItem("wall",c("editor.wall"),"editor.wall",new M(this.editor,function(D,g){var f=new ht.Shape;return f.setTall(280),f.setThickness(14),f.setElevation(f.getTall()/2),f.setPoints(D),f.setSegments(g),f.s({"all.color":E,"shape.background":null,"shape.border.width":f.getThickness(),"shape.border.color":F}),f}))},F.prototype.createDoorWindowItem=function(){return this.editor.createSceneItem("doorWindow",c("editor.doorWindow"),"editor.doorWindow",new G(this.editor,function(){var E=new ht.DoorWindow;return E.s({"all.color":m.config.color_data_background}),E},!0))},F.prototype.createFloorItem=function(){var E=m.config.color_data_background,F=m.config.color_transparent;return this.editor.createSceneItem("floor",c("editor.floor"),"editor.floor",new M(this.editor,function(D,g){var f=new ht.Shape;return f.setTall(10),f.setThickness(-1),f.setElevation(-f.getTall()/2),f.setPoints(D),f.setSegments(g),f.s({"shape3d.color":E,"shape3d.top.color":E,"shape3d.bottom.color":E,"shape.background":F}),f.setAnchor3d(.5,0,.5),f},!0))},F.prototype.createPipelineItem=function(){var E=m.config.color_data_background,F=m.config.color_transparent;return this.editor.createSceneItem("pipeline",c("editor.pipeline"),"editor.pipeline",new M(this.editor,function(D,g){var f=new ht.Polyline;return f.setPoints(D),f.setSegments(g),f.setThickness(10),f.s({shape3d:"cylinder","shape3d.color":E,"shape3d.top.color":E,"shape3d.bottom.color":E,"shape.background":null,"shape.border.width":f.getThickness(),"shape.border.color":F}),f}))},F.prototype.createCubeItem=function(){return this.editor.createSceneItem("cube",c("editor.cube"),"editor.cube",new G(this.editor,function(){var E=new ht.Node;return E.s({"all.color":m.config.color_data_background}),E.setAnchor3d(.5,0,.5),E},!0))},F.prototype.createCylinderItem=function(){return this.editor.createSceneItem("cylinder",c("editor.cylinder"),"editor.cylinder",new G(this.editor,function(){var E=new ht.Node;return E.s({shape3d:"cylinder","shape3d.color":m.config.color_data_background}),E.setAnchor3d(.5,0,.5),E},!0))},F.prototype.createSphereItem=function(){return this.editor.createSceneItem("sphere",c("editor.sphere"),"editor.sphere",new G(this.editor,function(){var E=new ht.Node;return E.s({shape3d:"sphere","shape3d.color":m.config.color_data_background}),E.setAnchor3d(.5,0,.5),E},!0))},F.prototype.createLightItem=function(){return this.editor.createSceneItem("light",c("editor.light"),"editor.light",new G(this.editor,function(){var E=new ht.Light;return E.s({"light.color":"red","light.range":200,"light.rotation.enable":!0,shape3d:"sphere","shape3d.color":"red","shape3d.reverse.cull":!0}),E},!0))},F}(ht.widget.Toolbar),x=hteditor.getString,z=hteditor.createItem,X=function(E){function F(D){I(this,F);var g=q(this,E.call(this));return g.editor=D,g.$68$(),g.enableToolTip(),g.setStickToRight(!0),g.editor.gv.addPropertyChangeListener(g.handlePropertyChange,g),g.$69$(),g}return P(F,E),F.prototype.handlePropertyChange=function(E){"zoom"===E.property&&this.$69$()},F.prototype.$69$=function(){this.label.innerHTML=parseInt(100*this.editor.gv.getZoom())+"%"},F.prototype.$68$=function(){var E=this,F=void 0,D=[];F=z("save",x("editor.save"),"editor.save"),F.action=function(){E.editor.save()},D.push(F),F=z("reload",x("editor.reload"),"editor.reload"),F.action=function(){E.editor.reload()},D.push(F),D.push({separator:!0}),F=z("rulers",x("editor.showrulers"),"editor.rulers",function(){return E.editor.isRulerEnabled()}),F.action=function(){E.editor.toggleRulerEnabled()},D.push(F),F=z("grid",x("editor.showaxis"),"editor.axis",function(){return!E.editor.dm.a("sceneEditHelperDisabled")}),F.action=function(){E.editor.dm.a("sceneEditHelperDisabled",!E.editor.dm.a("sceneEditHelperDisabled"))},D.push(F),F=z("grid",x("editor.showgrid"),"editor.grid",function(){return E.editor.dm.a("sceneGridEnabled")}),F.action=function(){E.editor.dm.a("sceneGridEnabled",!E.editor.dm.a("sceneGridEnabled"))},D.push(F),F=z("preview",x("editor.preview"),"editor.preview"),F.action=function(){E.editor.preview()},D.push(F),D.push({separator:!0}),D.push(this.createZoomItem()),F=z("zoomToFit",x("editor.zoomtofit"),"editor.zoomtofit"),F.action=function(){E.editor.zoomToFit()},D.push(F),D.push({separator:!0}),F=z("toggleLeft",x("editor.toggleleft"),"editor.toggleleft"),F.action=function(){E.editor.toggleLeft()},D.push(F),F=z("toggleRight",x("editor.toggleright"),"editor.toggleright"),F.action=function(){E.editor.toggleRight()},D.push(F),this.setItems(D)},F.prototype.createZoomItem=function(){var E=this,F=this.label=ht.Default.createDiv(!0);F.style.font=this.getLabelFont(),F.style.color=this.getLabelColor(),F.style.cursor="ew-resize",F.style.width="40px",F.style.height=ht.Default.widgetRowHeight+"px",F.style.lineHeight=ht.Default.widgetRowHeight+"px",F.style.whiteSpace="nowrap",F.style.textAlign="center";var D=function(F){F.preventDefault();var D=E.editor.gv;ht.Default.isDoubleClick(F)&&D.zoomReset();var g=D.getZoom(),f=ht.Default.getClientPoint(F).x,T=function(E){E.preventDefault();var F=ht.Default.getClientPoint(E).x-f;D.setZoom(g*(1+.005*F))};window.addEventListener("mousemove",T,!1),window.addEventListener("touchmove",T,!1);var a=function(E){E.preventDefault(),window.removeEventListener("mousemove",T,!1),window.removeEventListener("touchmove",T,!1),window.removeEventListener("mouseup",a,!1),window.removeEventListener("touchend",a,!1)};window.addEventListener("mouseup",a,!1),window.addEventListener("touchend",a,!1)};return F.addEventListener("mousedown",D,!1),F.addEventListener("touchstart",D,!1),{id:"zoom",unfocusable:!0,element:F}},F}(ht.widget.Toolbar),w=function(E){function F(D){I(this,F);var g=q(this,E.call(this,D.dm));return g.editor=D,g.setEditable(!0),g.topDiv=ht.Default.createDiv(),g.getPostProcessing().setSerializable(!1),g}return P(F,E),F.prototype.isInteractive=function(){return!1},F.prototype.handleDelete=function(){this.removeSelection()},F.prototype.isSelectable=function(F){return ht.Default.isShiftDown()?!(F instanceof ht.Block):E.prototype.isSelectable.call(this,F)},F.prototype.getBrightness=function(E){return E.s("brightness")},F.prototype.isDroppable=function(E,F){return F.view===this.editor.models.list||(F.view===this.editor.symbols.list||F.view===this.editor.assets.list)},F.prototype.$58$=function(E){if(this.dragImage){var F=hteditor.config.dragImageSize,D=ht.Default.getPagePoint(E);this.dragImage.style.left=D.x-F/2+"px",this.dragImage.style.top=D.y-F/2+"px"}},F.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},F.prototype.handleCrossDrag=function(E,F,D){var g=this,f=D.view,T=f.draggingData;if("enter"===F){if(this._view.insertBefore(this.topDiv,this._scrollBarDiv),ht.Default.layout(this.topDiv,0,0,this.getWidth(),this.getHeight()),this.topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&T&&("model"===T.fileType||"symbol"===T.fileType||"image"===T.fileType)&&ht.Default.getImage(T.getImage())!==ht.Default.getImage("editor.unknown")){var a=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(T.getImage(),a,a,"centerUniform",T,D.view,null,ht.Default.devicePixelRatio),this.$58$(E),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else if("exit"===F||"cancel"===F)ht.Default.removeHTML(this.topDiv),this.removeDragImage();else if("over"===F)this.$58$(E);else if("drop"===F&&(ht.Default.removeHTML(this.topDiv),T)){this.removeDragImage();var K=this.getHitPosition(E);f.isSelected(T)?f.sm().toSelection().each(function(F){f.handleDropToEditView?f.handleDropToEditView(g,F,K,E):g.$98$(F,K)}):f.handleDropToEditView?f.handleDropToEditView(this,T,K,E):this.$98$(T,K)}},F.prototype.$98$=function(E,F){if(E){var D=E.getFileUUID(),g=E.fileType;if("model"===g||"symbol"===g||K(D)){var f=new ht.Node;"model"===g?f.s({shape3d:D}):("symbol"===g||K(D))&&(f.s({shape3d:"billboard","shape3d.image":D,"texture.cache":!1,autorotate:!0,fixSizeOnScreen:[-1,-1]}),f.setImage(D)),f.setAnchor3d(.5,0,.5),f.p3(F),f.s("wf.visible","selected"),this.dm().beginTransaction(),this.dm().add(f),this.sm().ss(f),this.editor.fireEvent("dataCreated",{sceneView:this.editor.scene,data:f}),this.dm().endTransaction()}}},F.prototype.toImage=function(E){var F=m.config.imageSize||400,D=this.getWidth(),g=this.getHeight(),f=Math.max(D,g),T=F/f;return D=Math.floor(D*T),g=Math.floor(g*T),this.toCanvas(E,D,g).toDataURL("image/png",1)},F.prototype.invalidateAll=function(F,D){if("imageLoaded"===D||"modelLoaded"===D){var g=this.editor.inspector;g&&("modelLoaded"===D?g.filterPropertiesLater():g.$34$(),g.$85$&&g.$85$())}E.prototype.invalidateAll.call(this,F,D)},F}(ht.graph3d.Graph3dView),e={width:!0,height:!0,position:!0,rotation:!0,anchor:!0,scale:!0,expanded:!0},A=function(){function E(F,D){var g=this;I(this,E),this.editor=F,this.gv=this.graphView=D,this._rulerEnabled=!0,this._view=ht.Default.createView(!0,this),this.graphView.addViewListener(function(E){"validate"===E.kind&&g.validateCanvas()}),this._hRuler=ht.Default.createCanvas(),this._vRuler=ht.Default.createCanvas(),this._view.appendChild(this._hRuler),this._view.appendChild(this._vRuler),this._view.appendChild(this.graphView.getView()),this.graphView.addPropertyChangeListener(function(){g.iv()}),this.dm.sm().addSelectionChangeListener(function(E){g.iv()}),this.dm.addDataModelChangeListener(function(E){g.iv()}),this.dm.addDataPropertyChangeListener(function(E){g.handleDataPropertyChanged(E)}),this.dm.addPropertyChangeListener(function(E){g.handleDataModelPropertyChanged(E)}),this.dm.addHierarchyChangeListener(function(E){g.iv()}),this.dm.layout=function(E){g._autoLayout||(g._autoLayout=new ht.layout.AutoLayout(g.graphView)),g._autoLayout.layout(E,function(){g.graphView.fitContent(!0)})},this.graphView.setEditable(!0),this.graphView.getInteractors().each(function(E){E.keep=!0}),D.getEditInteractor().alignmentGuideEnabled=!0,hteditor.EditView.prototype.initRuler.call(this)}return E.prototype.handleDataPropertyChanged=function(E){e[E.property]&&this.iv()},E.prototype.handleDataModelPropertyChanged=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},E.prototype.onPropertyChanged=function(E){this.iv()},E.prototype.addData=function(E){this.dm.add(E),this.dm.sm().ss(E),this.graphView.setFocus()},E.prototype.validateCanvas=function(){var E=this.graphView._topCanvas;if(E){var F=hteditor.initContext(E);F.clearRect(0,0,E.clientWidth,E.clientHeight),this.graphView.getInteractors().each(function(E){E.$0$&&E.$0$(F)}),F.restore()}},E.prototype.redraw=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},E.prototype.validateImpl=function(){hteditor.EditView.prototype.validateImpl.apply(this,arguments)},E.prototype.drawVerticalText=function(){hteditor.EditView.prototype.drawVerticalText.apply(this,arguments)},E.prototype.drawRuler=function(){hteditor.EditView.prototype.drawRuler.apply(this,arguments)},E.prototype.updateAlignGuide=function(){hteditor.EditView.prototype.updateAlignGuide.apply(this,arguments)},E.prototype.getGridGuide=function(){return hteditor.EditView.prototype.getGridGuide.apply(this,arguments)},E.prototype.setRulerEnabled=function(E){this.dm.a("rulerEnabled",E)},E.prototype.isRulerEnabled=function(){return this.dm.a("rulerEnabled")},E.prototype._initMenu=function(){},N(E,[{key:"dm",get:function(){return this.graphView.dm()}}]),E}();hteditor.msClass(A,{ms_v:1,ms_fire:1,ms_ac:["rulerBackground","rulerFont","rulerColor","rulerSize","guideColor"],_rulerFont:hteditor.config.smallFont,_rulerBackground:hteditor.config.color_pane,_rulerColor:hteditor.config.color_dark,_rulerSize:hteditor.config.rulerSize,_guideColor:hteditor.config.color_transparent,_interactionState:void 0});var v=m.getString,EE=function(E){function F(D){I(this,F);var g=q(this,E.call(this,D.dm));return g.editor=D,g._topCanvas=ht.Default.createCanvas(),g._topDiv=ht.Default.createDiv(),g._view.insertBefore(g._topCanvas,g._scrollBarDiv),g._view.insertBefore(g._topDiv,g._scrollBarDiv),g.initMenu(),g.mi(function(E){"prepareMove"!==E.kind&&"prepareEdit"!==E.kind||!E.event.altKey||(g.editor.copy(),g.editor.paste(),g.validate())}),g.editable=!0,g}return P(F,E),F.prototype.isInteractive=function(){return!1},F.prototype.isSelectable=function(F){return ht.Default.isShiftDown()?!(F instanceof ht.Block):E.prototype.isSelectable.call(this,F)},F.prototype.initMenu=function(){var E=this,F=[];this.menu=new ht.widget.ContextMenu(F),F.push({id:"copy",label:v("editor.copy"),action:function(){E.editor.copy()},visible:function(){return!!E.editor.ld}}),F.push({id:"paste",label:v("editor.paste"),action:function(){E.editor.paste()},visible:function(){return E.editable&&E.editor.hasCopyInfo()}});var D=function(){return E.sm().size()>0},g=function(){for(var F=0;F<E.sm().size();F++){var D=E.sm().getSelection().get(F);if(D instanceof ht.Block&&!(D instanceof ht.RefGraph))return!0}return!1};F.push({separator:!0,visible:function(){return E.editable&&(D()||g())}}),F.push({id:"block",label:v("editor.block"),action:function(){E.editor.block()},visible:function(){return E.editable&&D()}}),F.push({id:"unblock",label:v("editor.unblock"),action:function(){E.editor.unblock()},visible:function(){return E.editable&&g()}}),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},F.prototype.getUnionNodeRect=function(E){var F=this,D=void 0;return E=E._as||E,E.forEach(function(E){E instanceof ht.Node&&(D=ht.Default.unionRect(D,F.getNodeRect(E)))}),D},F.prototype.getImage=function(E){var F=E.s("shape3d");if(F){var D=ht.Default.getShape3dModel(F);if(D&&D.json&&D.json.image)return D.json.image;if("sphere"===F||"cylinder"===F)return"editor.sphere.image"}var g=E.getImage();return g&&"node_image"!==g?g:E.s("shape3d.image")?E.s("shape3d.image"):"editor.cube.image"},F.prototype.getSelectWidth=function(E){return!this.isEditable(E)||E instanceof ht.Edge?E.s("select.width"):0},F.prototype.isDroppable=function(E,F){return F.view===this.editor.models.list||(F.view===this.editor.symbols.list||F.view===this.editor.assets.list)},F.prototype.$58$=function(E){if(this.dragImage){var F=hteditor.config.dragImageSize,D=ht.Default.getPagePoint(E);this.dragImage.style.left=D.x-F/2+"px",this.dragImage.style.top=D.y-F/2+"px"}},F.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},F.prototype.handleCrossDrag=function(E,F,D){var g=this,f=D.view,T=f.draggingData;if("enter"===F){if(this._topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&T&&("model"===T.fileType||"symbol"===T.fileType||"image"===T.fileType)&&ht.Default.getImage(T.getImage())!==ht.Default.getImage("editor.unknown")){var a=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(T.getImage(),a,a,"centerUniform",T,D.view,null,ht.Default.devicePixelRatio),this.$58$(E),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else"exit"===F||"cancel"===F?(this._topDiv.style.border="",this.removeDragImage()):"over"===F?this.$58$(E):"drop"===F&&(this._topDiv.style.border="",T&&(this.removeDragImage(),this.sm().cs(),f.handleDropToEditView?f.handleDropToEditView(this,T,this.lp(E),E):f.isSelected(T)?f.sm().toSelection().each(function(F){g.$98$(F,E)}):this.$98$(T,E)))},F.prototype.$98$=function(E,F){var D=E.getFileUUID(),g=this.lp(F);if("model"===E.fileType){var f=new ht.Node;f.s({shape3d:D}),f.setAnchor3d(.5,0,.5),f.setPosition(g),this.dm().beginTransaction(),this.dm().add(f),this.sm().ss(f),this.editor.fireEvent("dataCreated",{sceneView:this.editor.scene,data:f}),this.dm().endTransaction()}else if("symbol"===E.fileType||"image"===E.fileType){var T=new ht.Node;T.s({shape3d:"billboard","shape3d.image":D,"texture.cache":!1,autorotate:!0,fixSizeOnScreen:[-1,-1]}),T.setAnchor3d(.5,0,.5),T.p(g),T.setImage(D),this.dm().beginTransaction(),this.dm().add(T),this.sm().ss(T),this.editor.fireEvent("dataCreated",{sceneView:this.editor.scene,data:T}),this.dm().endTransaction()}},F}(ht.graph.GraphView),FE=function(E){function F(D){return I(this,F),q(this,E.call(this,D))}return P(F,E),F.prototype.commit=function(){this.editor.reset(!0),this.editor.dm.disableHistoryManager(),this.editor.scene.deserialize(this.content,{disableOnPostDeserialize:!0,disableOnPreDeserialize:!0}),this.editing=!1,this.editor.dm.enableHistoryManager(),this.editor.dm.clearHistoryManager()},F.prototype.updateContent=function(){this.visible&&!this.editing&&(this._updateContentLater=!1,this.content=t(this.editor.toJSON(),void 0,!1))},F.prototype.updateUrl=function(){this.v("url",this.editor.url||"")},F.prototype.$5$=function(){},F}(hteditor.DataView),DE=hteditor.getString,gE=function(E){function F(D){I(this,F);var g=q(this,E.call(this));g.editor=D,g.buttons={};var f=[];f.push(g.createItem("cluster",DE("editor.align.cluster"),[{type:"shape",points:[5,2,11,2,5,14,11,14],segments:[1,2,1,2],borderWidth:3,borderColor:hteditor.config.color_select},{type:"shape",points:[8,5,8,11,5,8,11,8],segments:[1,2,1,2],borderWidth:1,borderColor:hteditor.config.color_dark}])),f.push(g.createItem("distributeHorizontal",DE("editor.align.distributehorizontal"),[{type:"shape",points:[2,2,2,14,14,2,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[8,5,8,11],borderWidth:3}])),f.push(g.createItem("distributeVertical",DE("editor.align.distributevertical"),[{type:"shape",points:[2,2,14,2,2,14,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[5,8,11,8],borderWidth:3}])),f.push(g.createItem("alignLeft",DE("editor.align.alignleft"),[{type:"shape",points:[2,2,2,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,13,5,5,11,8,11],segments:[1,2,1,2],borderWidth:3}])),f.push(g.createItem("alignHorizontal",DE("editor.align.alignhorizontal"),[{type:"shape",points:[8,2,8,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,13,5,6,11,10,11],segments:[1,2,1,2],borderWidth:3}])),f.push(g.createItem("alignRight",DE("editor.align.alignright"),[{type:"shape",points:[14,2,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,11,5,11,11,8,11],segments:[1,2,1,2],borderWidth:3}])),
f.push(g.createItem("alignTop",DE("editor.align.aligntop"),[{type:"shape",points:[2,2,14,2],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,5,13,11,5,11,8],segments:[1,2,1,2],borderWidth:3}])),f.push(g.createItem("alignVertical",DE("editor.align.alignvertical"),[{type:"shape",points:[2,8,14,8],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,13,11,6,11,10],segments:[1,2,1,2],borderWidth:3}])),f.push(g.createItem("alignBottom",DE("editor.align.alignbottom"),[{type:"shape",points:[2,14,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,11,11,11,11,8],segments:[1,2,1,2],borderWidth:3}]));var T=.1,a=[T,T,T,T,T,T,T,T,T];return g.addRow(f,a),g.updateItems(),g.editor.sm.ms(function(){return g.updateItems()}),g}return P(F,E),F.prototype.createItem=function(E,F,D){var g=this;D.forEach(function(E){E.borderCap="round"}),D[0].borderColor=D[0].borderColor||hteditor.config.color_dark,D[1].borderColor=D[1].borderColor||hteditor.config.color_select;var f={width:16,height:16,fitSize:!0,comps:D};return this.buttons[E]=hteditor.createButton(null,F,f,function(){g[E]()})},F.prototype.updateItems=function(){var E=[];this.editor.sm.each(function(F){F instanceof ht.Node&&E.push(F)}),E.length>2?(this.buttons.cluster.setDisabled(!1),this.buttons.distributeHorizontal.setDisabled(!1),this.buttons.distributeVertical.setDisabled(!1),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):E.length>1?(this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):(this.buttons.cluster.setDisabled(!0),this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!0),this.buttons.alignHorizontal.setDisabled(!0),this.buttons.alignRight.setDisabled(!0),this.buttons.alignTop.setDisabled(!0),this.buttons.alignVertical.setDisabled(!0),this.buttons.alignBottom.setDisabled(!0))},F.prototype.getUnionRect=function(E){return this.editor.gv?this.editor.gv.getUnionNodeRect(E):null},F.prototype.isSelected=function(E){return this.editor.sm.contains(E)},F.prototype.hasSelectedGroupParent=function(E){return hteditor.InspectorTool.prototype.hasSelectedGroupParent.apply(this,arguments)},F.prototype.hasSelectedHost=function(E){return hteditor.InspectorTool.prototype.hasSelectedHost.apply(this,arguments)},F.prototype.cluster=function(){var E=this.selection;if(E.length){this.editor.beginTransaction(),this.alignHorizontal(),this.alignVertical();var F=void 0,D=void 0;E.forEach(function(E){void 0===F?F=D=E.getElevation():(F>E.getElevation()&&(F=E.getElevation()),D<E.getElevation()&&(D=E.getElevation()))}),E.sort(function(E,F){return E.getElevation()-F.getElevation()});for(var g=(D-F)/(E.length-1),f=1;f<E.length-1;f++)E[f].setElevation(F+f*g);this.editor.endTransaction()}},F.prototype.distributeHorizontal=function(){hteditor.InspectorTool.prototype.distributeHorizontal.apply(this,arguments)},F.prototype.distributeVertical=function(){hteditor.InspectorTool.prototype.distributeVertical.apply(this,arguments)},F.prototype.alignLeft=function(){hteditor.InspectorTool.prototype.alignLeft.apply(this,arguments)},F.prototype.alignHorizontal=function(){hteditor.InspectorTool.prototype.alignHorizontal.apply(this,arguments)},F.prototype.alignRight=function(){hteditor.InspectorTool.prototype.alignRight.apply(this,arguments)},F.prototype.alignTop=function(){hteditor.InspectorTool.prototype.alignTop.apply(this,arguments)},F.prototype.alignVertical=function(){hteditor.InspectorTool.prototype.alignVertical.apply(this,arguments)},F.prototype.alignBottom=function(){hteditor.InspectorTool.prototype.alignBottom.apply(this,arguments)},N(F,[{key:"selection",get:function(){var E=this,F=[];return this.editor.sm.each(function(D){D instanceof ht.Node&&(E.hasSelectedGroupParent(D.getParent())||E.hasSelectedHost(D)||F.push(D))}),F}}]),F}(ht.widget.FormPane),fE=function(E){function F(D,g,f){var T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];I(this,F);var a=q(this,E.call(this,D,g,f,T));return a.setHPadding(8),a.setVPadding(4),a.addUpdateHandler(function(){a.$85$()}),a._cacheImgObjects=[],a}return P(F,E),F.prototype.initForm=function(){E.prototype.initForm.call(this),this.addCustomProperties()},F.prototype.addOneRow=function(E,F,D){for(var g=[this.indent,.1],f=2,T=E.length;f<T;f++)g.push(20);var a=this.addRow(E,g,F?this.getRowHeight()*F:null,D);return a.index=this.getRows().length-1,a},F.prototype.$85$=function(){var E=this;this._updateDataBindingsLater||(this._updateDataBindingsLater=!0,requestAnimationFrame(function(){E.initDataBindings()}))},F.prototype.initDataBindings=function(){var E=this;this._updateDataBindingsLater=!1;var F=this.data;if(F){for(var D=[F.s("all.image"),F.s("top.image"),F.s("bottom.image"),F.s("left.image"),F.s("right.image"),F.s("front.image"),F.s("back.image"),F.s("shape3d.image"),F.s("shape3d.top.image"),F.s("shape3d.bottom.image"),F.s("shape3d.from.image"),F.s("shape3d.to.image")],g=!1,f=[],T=0,a=D.length;T<a;T++){var K=D[T];if(K){if(!(K=ht.Default.getImage(K))){g=!0;break}f.push(K)}}if(g){var B=ht.Default.handleImageLoaded;return void(ht.Default.handleImageLoaded=function(){for(var F=arguments.length,D=Array(F),g=0;g<F;g++)D[g]=arguments[g];B.apply(ht.Default,D),ht.Default.handleImageLoaded=B,E.initDataBindings()})}if(0===f.length)return void(this.$44$&&this.$44$.length>0&&(this.clearDataBinding(),this.filterProperties()));var $=this._cacheImgObjects,p=$.length!==f.length;if(!p)for(var W=0,Y=f.length;W<Y;W++)if($.indexOf(f[W])<0){p=!0;break}if(p){this.clearDataBinding(),this._cacheImgObjects=f;for(var o=[],h={},u={},U={},t=0,Z=f.length;t<Z;t++){var r=f[t];if(r.comps){r.comps.forEach(function(E){if(b(E.type)){var F=ht.Default.getCompType(E.type);if(F)for(var D in F.properties)h[D]=F.properties[D].defaultValue}H(E,u,U)});for(var s in u)void 0===U[s]&&(U[s]=h[u[s]])}r.dataBindings&&o.push.apply(o,r.dataBindings)}if(o.length>0){var k=this.updateHandlers.length;this.$44$.push(this.addTitle("TitleDataBinding"));var V={};o.forEach(function(F){var D=F.attr;V[D]||(V[D]=1,m.HTNodeInspector.prototype.$87$.call(E,F,void 0,U))}),this.dataBindingHandlers=this.updateHandlers.slice(k)}this.$46$=this._rows,this.filterProperties()}}},F.prototype.clearDataBinding=function(){var E=this;this._rows=this.$46$;var F=this.$44$;F&&F.length>0&&this.removeRows(F),this.$44$=[];var D=this.dataBindingHandlers;D&&D.length>0&&D.forEach(function(F){E.removeUpdateHandler(F)}),this.dataBindingHandlers=[],this._cacheImgObjects=[],this.$46$=this._rows},F.prototype.$87$=function(E,F){var D=[],g=E.attr,f=hteditor.config.valueTypes[E.valueType];if(!f)return this.editor.fireEvent("error",{message:"Wrong value type:"+E.valueType,dataBind:E}),!1;var T=hteditor.getString(E.name)||g,a=function(E){var D=E.a(g);return void 0===D&&(D=F[g]),D},K=function(E,F){return E.a(g,F)};return"int"===f.type||"number"===f.type?f.angle?this.addLabelRotation(D,T,a,K,f.min,f.max,f.step):this.addLabelRange(D,T,a,K,f.min,f.max,f.step,f.type):"color"===f.type?this.addLabelColor(D,T,a,K):"boolean"===f.type?this.addLabelCheckBox(D,T,a,K):"enum"===f.type?this.addLabelComboBox(D,T,a,K,f.values,f.labels,f.icons):"multiline"===f.type?this.addLabelMultiline(D,T,a,K):"font"===f.type?this.addLabelFont(D,T,a,K):"image"===f.type?this.addLabelImage(D,T,a,K):"url"===f.type?this.addLabelURL(D,T,a,K):"colorArray"===f.type?this.addLabelArray(D,T,a,K,"color"):"numberArray"===f.type?this.addLabelArray(D,T,a,K,"number"):"stringArray"===f.type?this.addLabelArray(D,T,a,K,"string"):"objectArray"===f.type?this.addLabelArray(D,T,a,K,"object"):"function"===f.type?this.addLabelFunction(D,T,a,K,g):"object"===f.type?this.addLabelObject(D,T,a,K,g):this.addLabelInput(D,T,a,K),D},F.prototype.addLabelData=function(E,F,D,g){var f=this,T=this.addLabelInput(E,F,function(E){var F=D(E);return F?F.toLabel()||F.getClassName():""}),a=T.getElement();T.isDroppable=function(E,F){return F.view.draggingData&&f.dataModel===F.view.draggingData.getDataModel()},T.handleCrossDrag=function(E,F,D){"enter"===F?a.style.border="solid "+m.config.color_select_dark+" 2px":"exit"===F||"cancel"===F?a.style.border="":"over"===F||"drop"===F&&(a.style.border="",f.setValue(g,D.view.draggingData),T.setFocus())},a.onkeydown=function(E){ht.Default.isDelete(E)&&f.setValue(g,null)};var K=new ht.widget.Image;K.drawImage=function(E,F,D,g,T,a){var b=K.data,B=f.editor.list;b&&B&&B.dm().contains(b)&&(F=B.getIcon(b))&&drawStretchImage(E,ht.Default.getImage(F),"centerUniform",D,g,T,a,b,B)},this.updateHandlers.push(function(){if(!E.hidden){var F=K.data;K.data=f.getValue(D),K.fp("data",F,K.data)}}),E.push(K)},F.prototype.addImage=function(E,F,D,g,T){var a=this,K=new ht.widget.Image;K.vectorDataBindingDisabled=!0;var b=g||function(E){if(W(E))return"editor.hdr";if(f(E))return E.replace(".json",".png");var F=ht.Default.getImage(E);return F&&F.snapshotURL?F.snapshotURL:E};this.updateHandlers.push(function(){if(!E.hidden){var D=a.getValue(F);K.rawIcon=D,K.setIcon(b(D))}});var B=K.getView();B.style.cursor="pointer";var $=function(E){E.preventDefault(),T&&!T(K)||(ht.Default.isDoubleClick(E)?a.editor.open(K.rawIcon):a.editor.selectFileNode(K.rawIcon))};return B.addEventListener("mousedown",$,!1),B.addEventListener("touchstart",$,!1),E.push(K),K},F.prototype.addLabelSlider=function(E,F,D,g,f,T,a,K){var b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return this.addLabel(E,F,D,g,void 0,b),this.addSlider(E,D,g,f,T,a,K,b.onBeginEdit,b.onEndEditing)},F.prototype.addSlider=function(E,F,D,g,f,T,a,K,b){var B=this,$=new ht.widget.Slider;return ht.Default.isNumber(g)&&$.setMin(g),ht.Default.isNumber(f)&&$.setMax(f),ht.Default.isNumber(T)&&$.setStep(T),D?($.onBeginValueChanged=function(){B.beginTransaction(),$.__editing__=!0,K&&K($)},$.onValueChanged=function(){B.setValue(D,$.getValue())},$.onEndValueChanged=function(){b&&b($),$.__editing__=!1,B.endTransaction()}):$.setDisabled(!0),$.getToolTip=function(){return Number($.getValue().toFixed(6))},a&&($.getToolTip=function(){return a($.getValue())}),this.updateHandlers.push(function(){if(!E.hidden&&!$.__editing__){var D=B.getValue(F);$.getValue()!==D&&$.setValue(D)}}),E.push($),$},F.prototype.addLabelImageOrMaterial=function(E,F,D,g){var f=function(E,F){if(!F.view.draggingData)return!1;var D=F.view.draggingData.fileType;return K(F.view.draggingData.url)||"symbol"===D||"material"===D};return this.addLabelURL(E,F,D,g,f),this.addImage(E,D,g)},F.prototype.addLabelTooltip=function(F,D,g,f){var T=E.prototype.addLabel.apply(this,arguments),a=void 0;return T.addEventListener("mousemove",function(E){a&&(clearTimeout(a),a=void 0),ht.Default.isToolTipShowing()?ht.Default.showToolTip(E,D):a=setTimeout(function(){ht.Default.showToolTip(E,D),a=void 0},ht.Default.toolTipDelay)}),T.addEventListener("mouseleave",function(){a&&clearTimeout(a),a=void 0,ht.Default.hideToolTip()}),T},N(F,[{key:"type",set:function(E){this._type=E},get:function(){return this._type}},{key:"dataModel",get:function(){return this.editor.dm}}]),F}(hteditor.Inspector),TE=hteditor.getString,aE=hteditor.createButton,KE=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"scene","scene",!0))}return P(F,E),F.prototype.initForm=function(){E.prototype.initForm.call(this),this.initSceneProperties(),this.addSkyboxProperties(),this.addBloomProperties(),this.addDofProperties(),this.addHighlightProperties(),this.addHeadlightProperties(),this.addFogProperties(),this.$77$(),this.addHueSaturation(),this.addEnvmapProperties(),this.editor.scene.shadowMap&&this.initShadowProperties()},F.prototype.initSceneProperties=function(){var E=this,F=void 0;this.addTitle("TitleScenes"),F=[],this.addLabelCheckBox(F,TE("editor.debugTip"),function(){return E.editor.scene.isDebugTipShowing()},function(F,D){var g=E.editor.scene;D?g.showDebugTip():g.hideDebugTip()}),this.addRow(F,[this.indent,.1]),F=[],this.addLabelInput(F,TE("editor.previewurl"),hteditor.getter("a","previewURL"),hteditor.setter("a","previewURL")),this.addRow(F,[this.indent,.1]),F=[],F.push(TE("editor.camera")),this.addButton(F,null,TE("editor.reset"),"editor.resetsize.state",function(){E.editor.scene.setEye(ht.Default.graph3dViewEye)}),this.addLabelInput(F,"X",function(F){return parseFloat(E.editor.scene.getEye()[0])},function(F,D){var g=E.editor.scene.getEye();E.editor.scene.setEye(D,g[1],g[2])},"int",1),this.addLabelInput(F,"Y",function(F){return parseFloat(E.editor.scene.getEye()[1])},function(F,D){var g=E.editor.scene.getEye();E.editor.scene.setEye(g[0],D,g[2])},"int",1),this.addLabelInput(F,"Z",function(F){return parseFloat(E.editor.scene.getEye()[2])},function(F,D){var g=E.editor.scene.getEye();E.editor.scene.setEye(g[0],g[1],D)},"int",1),this.addRow(F,[this.indent-40-8,20,20,.1,20,.1,20,.1]),F=[],F.push(TE("editor.center")),this.addButton(F,null,TE("editor.reset"),"editor.resetsize.state",function(){E.editor.scene.setCenter(ht.Default.graph3dViewCenter)}),this.addLabelInput(F,"X",function(F){return parseFloat(E.editor.scene.getCenter()[0])},function(F,D){var g=E.editor.scene.getCenter();E.editor.scene.setCenter(D,g[1],g[2])},"int",1),this.addLabelInput(F,"Y",function(F){return parseFloat(E.editor.scene.getCenter()[1])},function(F,D){var g=E.editor.scene.getCenter();E.editor.scene.setCenter(g[0],D,g[2])},"int",1),this.addLabelInput(F,"Z",function(F){return parseFloat(E.editor.scene.getCenter()[2])},function(F,D){var g=E.editor.scene.getCenter();E.editor.scene.setCenter(g[0],g[1],D)},"int",1),this.addRow(F,[this.indent-40-8,20,20,.1,20,.1,20,.1]),F=[],this.addLabelRange(F,TE("editor.near"),function(E){return E.a("sceneNear")},function(E,F){return E.a("sceneNear",F)},1,void 0,1,"int"),this.addLabelRange(F,TE("editor.far"),function(E){return E.a("sceneFar")},function(E,F){return E.a("sceneFar",F)},0,void 0,100,"int"),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelSlider(F,TE("editor.fovy"),function(E){return 180*(E.a("sceneFovy")||Math.PI/4)/Math.PI},function(E,F){E.a("sceneFovy",F/180*Math.PI)},1,170,.01),this.addInput(F,function(E){var F=E.a("sceneFovy")||Math.PI/4;return Number((180*F/Math.PI).toFixed(2))},function(E,F){E.a("sceneFovy",F/180*Math.PI)}),this.addRow(F,[this.indent,.1,76]),F=[],this.addLabelColor(F,TE("editor.backgroundcolor"),hteditor.getter("p","background"),hteditor.setter("p","background")),this.addRow(F,[this.indent,.1]),F=[];var D=[["any","json","editor.comment.json"],["ht.DataModel","dm","editor.comment.datamodel"],["ht.graph.Graph3dView","view","editor.comment.graph3dview"]];this.addLabelFunction(F,TE("editor.onpredeserialize"),function(E){return E.a("onPreDeserialize")},function(E,F){E.a("onPreDeserialize",F)},"onPreDeserialize",D),this.addOneRow(F),F=[],D=[["any","json","editor.comment.json"],["ht.DataModel","dm","editor.comment.datamodel"],["ht.graph.Graph3dView","view","editor.comment.graph3dview"],["ht.List<ht.Data>","datas","editor.comment.datas"]],this.addLabelFunction(F,TE("editor.onpostdeserialize"),function(E){return E.a("onPostDeserialize")},function(E,F){E.a("onPostDeserialize",F)},"onPostDeserialize",D),this.addOneRow(F)},F.prototype.updateSkyboxDiameterRange=function(E){function F(E,F){return Math.log(F)/Math.log(E)}if(!this._updatingSkyboxDiameter){var D=this.editor.dm,g=this.editor.scene;this._updatingSkyboxDiameter=!0;var f=D.a("sceneNear"),T=D.a("sceneFar");T=T*T/(T+f);var a=Math.tan(g.getFovy()/2)*f,K=g.getAspect()*a,b=Math.sqrt(3),B=1.1*Math.sqrt(K*K+a*a+f*f),$=T/b,p=F(1.1,$),W=F(1.1,B);E._max=2*Math.pow(1.1,p),E._min=2*Math.pow(1.1,W),this._updatingSkyboxDiameter=!1}},F.prototype.getSkyboxDiameterMax=function(){var E=this.editor.dm,F=E.a("sceneNear"),D=E.a("sceneFar");D=D*D/(D+F);var g=Math.sqrt(3),f=D/g,T=Math.log(f)/Math.log(1.1);return 2*Math.pow(1.1,T)},F.prototype.addSkyboxProperties=function(){var E=this;this.addTitle("TitleSkybox");var F=function(E){return"cube"===E.editor.dm.a("sceneSkyboxType")},D=function(E){return"sphere"===E.editor.dm.a("sceneSkyboxType")},g=function(E){return"color"===E.editor.dm.a("sceneSkyboxType")},f=[];this.addLabelComboBox(f,TE("editor.type"),function(E){return E.a("sceneSkyboxType")},function(E,F){return E.a("sceneSkyboxType",F)},["cube","sphere","color"],[TE("editor.cube"),TE("editor.sphere"),TE("editor.color")]),this.addRow(f,[this.indent,.1]),f=[];var T=window.diameterSlider=this.addLabelSlider(f,TE("editor.skyboxdiameter"),function(F){var D=F.a("sceneSkyboxDiameter")||E.getSkyboxDiameterMax();return E.updateSkyboxDiameterRange(T),Number(D.toFixed(0))},function(F,D){E.updateSkyboxDiameterRange(T),F.a("sceneSkyboxDiameter",Number(D.toFixed(0)))},1,100,1,function(E){return Number(E.toFixed(0))});this.addInput(f,function(F){var D=F.a("sceneSkyboxDiameter")||E.getSkyboxDiameterMax();return Number(D.toFixed(0))},function(F,D){E.updateSkyboxDiameterRange(T),F.a("sceneSkyboxDiameter",Number(D.toFixed(0)))},"number"),this.addRow(f,[this.indent,.1,76]),f=[],this.addLabelSlider(f,TE("editor.skyboxblursize"),function(E){return E.a("sceneSkyboxBlurSize")},function(E,F){E.a("sceneSkyboxBlurSize",F)},0,16,.01),this.addInput(f,function(E){return E.a("sceneSkyboxBlurSize")},function(E,F){E.a("sceneSkyboxBlurSize",F)},"number"),this.addRow(f,[this.indent,.1,76]),f=[],this.addLabelColor(f,TE("editor.blend"),function(E){return E.a("sceneSkyboxBodyColor")},function(E,F){E.a("sceneSkyboxBodyColor",F||void 0)}),this.addRow(f,[this.indent,.1]),f=[];var a=function(E){var F=this;a.superClass.constructor.call(F,E);var D=F._listView=new ht.widget.ListView;D.getView().style.background=ht.Default.comboBoxBackground,D.setCheckMode(!0),D.sm().ms(function(g){var f=D.dm().getDataByTag(4294967295);if("append"===g.kind)if(g.datas.get(0)===f)D.sm().selectAll();else{var T=D.sm().getSelection().length;T===D.dm().getDatas().length-1&&D.sm().selectAll()}else if("remove"===g.kind)if(g.datas.get(0)===f)D.sm().clearSelection();else{var a=D.sm().getSelection().toList(function(E){return E!==f});D.sm().setSelection(a)}E.setValue(F.getValue())})};ht.Default.def(a,ht.widget.BaseDropDownTemplate,{getView:function(){return this._listView.getView()},onOpened:function(E){var F=this._listView,D=new ht.Data;D.setName(TE("editor.all")),D.setTag(4294967295),F.dm().add(D);var g=new ht.Data;g.setName(TE("editor.default")),g.setTag(0),F.dm().add(g);var f=this._master.getMaskMap();E=this._master.getValue();for(var T in f){T=parseInt(T);var a=new ht.Data;a.setName(f[T]),a.setTag(T),F.dm().add(a)}if(E)if(4294967295===E)F.sm().selectAll();else{var K=new ht.List;F.dm().each(function(F){E&1<<F.getTag()&&K.add(F)}),F.sm().setSelection(K)}},onClosed:function(){},getValue:function(){var E=this._listView.dm(),F=E.sm();if(0===F.size())return 0;var D=E.getDataByTag(4294967295);if(F.contains(D))return 4294967295;var g=0;return F.each(function(E){var F=E.getTag();4294967295!==F&&E.getName()&&(g+=1<<F)}),g},getHeight:function(){return 100}});var K=new ht.widget.MultiComboBox;K.setEditable(!1),K.setDropDownComponent(a),K.drawValue=function(E,F,D,g,f){var T=K.getValue(),a=K.getMaskMap(),b=[];if(4294967295===T)b=TE("editor.all");else if(0===T)b="";else{1&T&&b.push(TE("editor.default"));for(var B in a)B=parseInt(B),T&1<<B&&b.push(a[B]);b.join(", ")}ht.Default.drawText(E,b,K.getLabelFont(),K.getLabelColor(),F+1,D,0,f)},K.getMaskMap=function(){return E.editor.dm.a("sceneLightGruopAlias")},K.getValue=function(){return E.dataModel.a("sceneSkyboxLightMask")},K.onValueChanged=function(F,D){E.dataModel.a("sceneSkyboxLightMask",D)},f.push(TE("editor.lightmask")),f.push(K),this.addLabelCheckBox(f,TE("editor.light"),hteditor.getter("a","sceneSkyboxLight"),hteditor.setter("a","sceneSkyboxLight")),this.addRow(f,[this.indent,.1,this.indent2,20]),f=[],f.push(TE("editor.rotation")),this.addButton(f,null,TE("editor.reset"),"editor.resetsize.state",function(){E.editor.scene.dm().beginTransaction(),E.editor.scene.dm().a("sceneSkyboxRotationX",0),E.editor.scene.dm().a("sceneSkyboxRotationY",0),E.editor.scene.dm().a("sceneSkyboxRotationZ",0),E.editor.scene.dm().endTransaction()}),this.addLabelInput(f,"X",function(E){return Number((180/Math.PI*E.a("sceneSkyboxRotationX")).toFixed(0))},function(E,F){E.a("sceneSkyboxRotationX",F*Math.PI/180)},"int",Math.PI/45),this.addLabelInput(f,"Y",function(E){return Number((180/Math.PI*E.a("sceneSkyboxRotationY")).toFixed(0))},function(E,F){E.a("sceneSkyboxRotationY",F*Math.PI/180)},"int",Math.PI/45),this.addLabelInput(f,"Z",function(E){return Number((180/Math.PI*E.a("sceneSkyboxRotationZ")).toFixed(0))},function(E,F){E.a("sceneSkyboxRotationZ",F*Math.PI/180)},"int",Math.PI/45),this.addRow(f,[this.indent-40-8,20,20,.1,20,.1,20,.1]),f=[],this.addLabelImage(f,TE("editor.image"),function(F){var D=F.a("sceneSkyboxImage"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("sceneSkyboxImage",F)}),this.addRow(f,[this.indent,.1,20]).visible=D,f=[],this.addLabelImage(f,TE("editor.face.front"),function(F){var D=F.a("sceneSkyboxFrontImage"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("sceneSkyboxFrontImage",F)}),this.addRow(f,[this.indent,.1,20]).visible=F,f=[],this.addLabelImage(f,TE("editor.face.back"),function(F){var D=F.a("sceneSkyboxBackImage"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("sceneSkyboxBackImage",F)}),this.addRow(f,[this.indent,.1,20]).visible=F,f=[],this.addLabelImage(f,TE("editor.face.left"),function(F){var D=F.a("sceneSkyboxLeftImage"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("sceneSkyboxLeftImage",F)}),this.addRow(f,[this.indent,.1,20]).visible=F,f=[],this.addLabelImage(f,TE("editor.face.right"),function(F){var D=F.a("sceneSkyboxRightImage"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("sceneSkyboxRightImage",F)}),this.addRow(f,[this.indent,.1,20]).visible=F,f=[],this.addLabelImage(f,TE("editor.face.top"),function(F){var D=F.a("sceneSkyboxTopImage"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("sceneSkyboxTopImage",F)}),this.addRow(f,[this.indent,.1,20]).visible=F,f=[],this.addLabelImage(f,TE("editor.face.bottom"),function(F){var D=F.a("sceneSkyboxBottomImage"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("sceneSkyboxBottomImage",F)}),this.addRow(f,[this.indent,.1,20]).visible=F,f=[],this.addLabelGradientPack(f,TE("editor.color"),function(E){return E.a("sceneSkyboxColor")},function(E,F){E.a("sceneSkyboxColor",F||void 0)}),this.addRow(f,[this.indent,.1]).visible=g},F.prototype.addBloomProperties=function(){this.addTitle("TitleBloom");var E=[];this.addLabelCheckBox(E,TE("editor.bloom"),function(E){return E.a("sceneBloom")},function(E,F){return E.a("sceneBloom",F)}),this.addLabelRange(E,TE("editor.strength"),function(E){return E.a("sceneBloomStrength")},function(E,F){return E.a("sceneBloomStrength",F)},0,void 0,.01,"number"),this.addRow(E,[this.indent,.1,this.indent2,.1]),E=[],this.addLabelRange(E,TE("editor.radius"),function(E){return E.a("sceneBloomRadius")},function(E,F){return E.a("sceneBloomRadius",F)},0,void 0,.01,"number"),this.addLabelRange(E,TE("editor.threshold"),function(E){return E.a("sceneBloomThreshold")},function(E,F){return E.a("sceneBloomThreshold",F)},0,1,.01,"number"),this.addRow(E,[this.indent,.1,this.indent2,.1]),E=[],this.addLabelCheckBox(E,TE("editor.bloomselective"),function(E){return E.a("sceneBloomSelective")},function(E,F){return E.a("sceneBloomSelective",F)}),this.addRow(E,[this.indent,.1])},F.prototype.addDofProperties=function(){var E=this;this.addTitle("TitleDOF");var F=[];this.addLabelCheckBox(F,TE("editor.dof"),function(E){return E.a("sceneDof")},function(E,F){return E.a("sceneDof",F)}),this.addLabelRange(F,TE("editor.aperture"),function(E){return E.a("sceneDofAperture")},function(E,F){return E.a("sceneDofAperture",F)},0,1,.001,"number"),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelImage(F,TE("editor.image"),function(F){var D=F.a("sceneDofImage"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("sceneDofImage",F)}),this.addRow(F,[this.indent,.1,20])},F.prototype.addHighlightProperties=function(){var E=this;this.addTitle("TitleHighlight");var F=[];this.addLabelComboBox(F,TE("editor.mode"),function(E){return E.a("sceneHighlightMode")},function(E,F){E.a("sceneHighlightMode",F)},["disabled","selected","hover","style"],[TE("editor.highlightmode.disabled"),TE("editor.highlightmode.selected"),TE("editor.highlightmode.hover"),TE("editor.highlightmode.style")]),this.addLabelComboBox(F,TE("editor.type"),function(E){return E.a("sceneHighlightType")},function(F,D){F.a("sceneHighlightType",D),E.parseHighlight(E.editor.dm.a("sceneHighlightGroups"))},["hard","soft"],[TE("editor.highlighttype.hard"),TE("editor.highlighttype.soft")]);var D=aE(null,TE("editor.add"),"editor.add",function(){E.addHighlight()});F.push(D),D.getIconColor=function(){return this.isPressed()?m.config.color_select:m.config.color_dark},this.addRow(F,[this.indent,.1,this.indent2,.1,20]),F=[],this.highlightView||(this.highlightView=this.initHighlightView()),F.push(this.highlightView),this.highlightRow=this.addRow(F,[.1],2),this.updateHandlers.push(function(){E.isHighlightChange()&&(E.highlightView._editing?E.highlightView._editing=!1:E.parseHighlight(E.editor.dm.a("sceneHighlightGroups")))})},F.prototype.addHeadlightProperties=function(){this.addTitle("TitleHeadlight");var E=[];this.addLabelCheckBox(E,TE("editor.enable"),function(E){return E.a("sceneHeadlightEnable")},function(E,F){return E.a("sceneHeadlightEnable",F)}),this.addLabelColor(E,TE("editor.color"),function(E){return E.a("sceneHeadlightColor")},function(E,F){E.a("sceneHeadlightColor",F)}),this.addRow(E,[this.indent,.1,this.indent2,.1]),E=[],this.addLabelRange(E,TE("editor.intensity"),function(E){return E.a("sceneHeadlightIntensity")},function(E,F){return E.a("sceneHeadlightIntensity",F)},0,void 0,.01,"number"),this.addLabelRange(E,TE("editor.ambient"),function(E){return void 0==E.a("sceneHeadlightAmbientIntensity")?.7:E.a("sceneHeadlightAmbientIntensity")},function(E,F){return E.a("sceneHeadlightAmbientIntensity",F)},void 0,void 0,.01,"number"),this.addRow(E,[this.indent,.1,this.indent2,.1])},F.prototype.addFogProperties=function(){var E=this,F=function(E){return"exp2"===E.editor.dm.a("sceneFogMode")},D=function(E){return"linear"===E.editor.dm.a("sceneFogMode")};this.addTitle("TitleFog");var g=[];this.addLabelCheckBox(g,TE("editor.enable"),function(E){return E.a("sceneFogEnable")},function(E,F){return E.a("sceneFogEnable",F)}),this.addLabelComboBox(g,TE("editor.mode"),function(E){return E.a("sceneFogMode")},function(F,D){F.a("sceneFogMode",D),E.editor.inspector.filterPropertiesLater()},["exp2","linear"],[TE("editor.fogmodeexp2"),TE("editor.fogmodelinear")]),this.addRow(g,[this.indent,.1,this.indent2,.1]),g=[],this.addLabelColor(g,TE("editor.color"),function(E){return E.a("sceneFogColor")},function(E,F){E.a("sceneFogColor",F)}),this.addRow(g,[this.indent,.1]),g=[],this.addLabelSlider(g,TE("editor.strength"),function(E){return 1e4*E.a("sceneFogDensity")},function(E,F){E.a("sceneFogDensity",F/1e4)},0,100,1),this.addInput(g,function(E){return 1e4*E.a("sceneFogDensity")},function(E,F){E.a("sceneFogDensity",F/1e4)},"number"),this.addRow(g,[this.indent,.1,76]).visible=F,g=[],this.addLabelRange(g,TE("editor.near"),function(E){return E.a("sceneFogNear")},function(E,F){E.a("sceneFogNear",F)},0,void 0,10,"int"),this.addLabelRange(g,TE("editor.far"),function(E){return E.a("sceneFogFar")},function(E,F){E.a("sceneFogFar",F)},0,void 0,10,"int"),this.addRow(g,[this.indent,.1,this.indent,.1]).visible=D},F.prototype.$77$=function(){this.addTitle("TitleGridsGuides");var E=[];this.addLabelColor(E,TE("editor.gridcolor"),function(E){return E.a("sceneGridColor")},function(E,F){E.a("sceneGridColor",F)}),this.addRow(E,[this.indent,.1]),E=[],this.addLabelRange(E,TE("editor.gridsize"),function(E){return E.a("sceneGridBlockCount")},function(E,F){E.a("sceneGridBlockCount",F)},0,void 0,1,"int"),this.addLabelRange(E,TE("editor.gridgap"),function(E){return E.a("sceneGridBlockSize")},function(E,F){E.a("sceneGridBlockSize",F)},1,void 0,1,"int"),this.addRow(E,[this.indent,.1,this.indent2,.1])},F.prototype.addHueSaturation=function(){this.addTitle("TitleHueSaturation");var E=[];this.addLabelCheckBox(E,TE("editor.enable"),function(E){return E.a("sceneHueSaturation")},function(E,F){return E.a("sceneHueSaturation",F)}),this.addLabelComboBox(E,TE("editor.color"),function(E){return E.a("sceneHueSaturationColorIndex")},function(E,F){E.a("sceneHueSaturationColorIndex",F)},[0,1,2,3,4,5,6],[TE("editor.huesaturationcolor.all"),TE("editor.huesaturationcolor.red"),TE("editor.huesaturationcolor.yellow"),TE("editor.huesaturationcolor.green"),TE("editor.huesaturationcolor.cyan"),TE("editor.huesaturationcolor.blue"),TE("editor.huesaturationcolor.magenta")]),this.addRow(E,[this.indent,.1,this.indent2,.1]),E=[],this.addLabelSlider(E,TE("editor.hue"),function(E){var F=E.a("sceneHueSaturationColorIndex")||0;return(E.a("sceneHueSaturationHue")||[])[F]},function(E,F){var D=E.a("sceneHueSaturationColorIndex")||0,g=ht.Default.clone(E.a("sceneHueSaturationHue"));g[D]=F,E.a("sceneHueSaturationHue",g)},-180,180,1),this.addInput(E,function(E){var F=E.a("sceneHueSaturationColorIndex")||0;return(E.a("sceneHueSaturationHue")||[])[F]},function(E,F){var D=E.a("sceneHueSaturationColorIndex")||0,g=ht.Default.clone(E.a("sceneHueSaturationHue"));g[D]=F,E.a("sceneHueSaturationHue",g)},"int"),this.addRow(E,[this.indent,.1,76]),E=[],this.addLabelSlider(E,TE("editor.saturation"),function(E){var F=E.a("sceneHueSaturationColorIndex")||0;return(E.a("sceneHueSaturationSaturation")||[])[F]},function(E,F){var D=E.a("sceneHueSaturationColorIndex")||0,g=ht.Default.clone(E.a("sceneHueSaturationSaturation"));g[D]=F,E.a("sceneHueSaturationSaturation",g)},-180,180,1),this.addInput(E,function(E){var F=E.a("sceneHueSaturationColorIndex")||0;return(E.a("sceneHueSaturationSaturation")||[])[F]},function(E,F){var D=E.a("sceneHueSaturationColorIndex")||0,g=ht.Default.clone(E.a("sceneHueSaturationSaturation"));g[D]=F,E.a("sceneHueSaturationSaturation",g)},"int"),this.addRow(E,[this.indent,.1,76]),E=[],this.addLabelSlider(E,TE("editor.lightness"),function(E){var F=E.a("sceneHueSaturationColorIndex")||0;return(E.a("sceneHueSaturationLightness")||[])[F]},function(E,F){var D=E.a("sceneHueSaturationColorIndex")||0,g=ht.Default.clone(E.a("sceneHueSaturationLightness"));g[D]=F,E.a("sceneHueSaturationLightness",g)},-180,180,1),this.addInput(E,function(E){var F=E.a("sceneHueSaturationColorIndex")||0;return(E.a("sceneHueSaturationLightness")||[])[F]},function(E,F){var D=E.a("sceneHueSaturationColorIndex")||0,g=ht.Default.clone(E.a("sceneHueSaturationLightness"));g[D]=F,E.a("sceneHueSaturationLightness",g)},"int"),this.addRow(E,[this.indent,.1,76])},F.prototype.initShadowProperties=function(){this.editor.scene,this.editor.scene.shadowMap;this.addTitle("TitleShadow");var E=[];this.addLabelCheckBox(E,TE("editor.shadow.enable"),function(E){return E.a("sceneShadowEnabled")},function(E,F){return E.a("sceneShadowEnabled",F)}),this.addRow(E,[this.indent,.1]),E=[],this.addLabelRange(E,TE("editor.shadow.degreeX"),function(E){return E.a("sceneShadowDegreeX")},function(E,F){return E.a("sceneShadowDegreeX",F)},0,360,.01,"number"),this.addRow(E,[this.indent,.1]),E=[],this.addLabelRange(E,TE("editor.shadow.degreeZ"),function(E){return E.a("sceneShadowDegreeZ")},function(E,F){return E.a("sceneShadowDegreeZ",F)},-90,90,.01,"number"),this.addRow(E,[this.indent,.1]),E=[],this.addLabelRange(E,TE("editor.shadow.intensity"),function(E){return E.a("sceneShadowIntensity")},function(E,F){
return E.a("sceneShadowIntensity",F)},0,1,.01,"number"),this.addRow(E,[this.indent,.1]),E=[],this.addLabelComboBox(E,TE("editor.shadow.quality"),function(E){return E.a("sceneShadowQuality")},function(E,F){return E.a("sceneShadowQuality",F)},["low","medium","high","ultra"],[TE("editor.shadow.quality.low"),TE("editor.shadow.quality.medium"),TE("editor.shadow.quality.high"),TE("editor.shadow.quality.ultra")]),this.addRow(E,[this.indent,.1]),E=[],this.addLabelComboBox(E,TE("editor.shadow.type"),function(E){return E.a("sceneShadowType")},function(E,F){return E.a("sceneShadowType",F)},["none","hard","soft"],[TE("editor.shadow.type.none"),TE("editor.shadow.type.hard"),TE("editor.shadow.type.soft")]),this.addRow(E,[this.indent,.1]),E=[],this.addLabelRange(E,TE("editor.shadow.radius"),function(E){return E.a("sceneShadowRadius")},function(E,F){return E.a("sceneShadowRadius",F)},0,100,.1,"number"),this.addRow(E,[this.indent,.1]),E=[],this.addLabelRange(E,TE("editor.shadow.bias"),function(E){return E.a("sceneShadowBias")},function(E,F){return E.a("sceneShadowBias",F)},-.01,.01,1e-4,"number"),this.addRow(E,[this.indent,.1])},F.prototype.addEnvmapProperties=function(){var E=this,F=function(E){return"new"!==E.editor.dm.getEnvmapType()},D=function(E){return"new"===E.editor.dm.getEnvmapType()};this.addTitle("TitleEnvmap");var g=[];this.addLabelComboBox(g,TE("editor.envmaptype"),function(E){return E.getEnvmapType()||"legacy"},function(F,D){F.setEnvmapType(D),"new"===D?F.setEnvmap([{type:"sphere"}]):F.setEnvmap(void 0),E.editor.inspector.filterPropertiesLater(),E.editor.batchView&&E.editor.batchView.updateBatchInfoDialog()},["legacy","new"],[TE("editor.envmaptype.legacy"),TE("editor.envmaptype.new")]),this.addRow(g,[this.indent,.1]).visible=F,g=[],this.addLabelComboBox(g,TE("editor.envmaptype"),function(E){return E.getEnvmapType()||"legacy"},function(F,D){F.setEnvmapType(D),"new"===D?F.setEnvmap([{type:"sphere"}]):F.setEnvmap(void 0),E.editor.inspector.filterPropertiesLater(),E.editor.batchView&&E.editor.batchView.updateBatchInfoDialog()},["legacy","new"],[TE("editor.envmaptype.legacy"),TE("editor.envmaptype.new")]);var f=aE(null,TE("editor.add"),"editor.add",function(){E.addEnvmap()});g.push(f),f.getIconColor=function(){return this.isPressed()?m.config.color_select:m.config.color_dark},this.addRow(g,[this.indent,.1,20]).visible=D,g=[],this.addLabelImage(g,TE("editor.image"),function(F){var D=F.getEnvmap();if(!o(D))return null;var g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.setEnvmap(F)}),this.addRow(g,[this.indent,.1,20]).visible=F,g=[],this.envmapView||(this.envmapView=this.initEnvmapView()),g.push(this.envmapView),this.envmapRow=this.addRow(g,[.1],2),this.envmapRow.visible=D,this.updateHandlers.push(function(){E.editor.dm&&"new"===E.editor.dm.getEnvmapType("envmapType")&&E.isEnvmapChange()&&(E.envmapView._editing?E.envmapView._editing=!1:E.parseEnvmap(E.editor.dm.getEnvmap()))})},F.prototype.initEnvmapView=function(){var E=new fE(this.editor,"Envmap","data");return E.setPadding(0),E.setLabelVPadding(0),E.getValue=function(E){return E(this.data)},E.setValue=function(E,F,D){E(this.data,D?D():F)},E.updateProperties=function(){this._updating=!0,this.updateHandlers.forEach(function(E){E()}),this._updating=!1,this._updatePropertiesLater=!1},E.data=new ht.Data,E},F.prototype.envmapViewAddRow=function(E){var F=this,D=function(F){return F.data.a(E)&&"sphere"===F.data.a(E).type},g=function(F){return F.data.a(E)&&"cube"===F.data.a(E).type},f=function(F){return F.data.a(E)&&"probe"===F.data.a(E).type},T=this.envmapView,a=[];T.addLabelInput(a,TE("editor.name"),function(F){return F.a(E).name},function(F,D){var g=ht.Default.clone(F.a(E));g.name=D,F.a(E,g)}),T.addLabelComboBox(a,TE("editor.type"),function(F){return F.a(E).type},function(D,g){var f=ht.Default.clone(D.a(E));f.type!==g&&(f="cube"===g?{type:"cube",images:[]}:"probe"===g?{type:"probe",pos:[0,0,0],size:100}:{type:g},D.a(E,f),F.resizeEnvmapRow())},["sphere","cube","skybox","probe"],[TE("editor.sphere"),TE("editor.cube"),TE("editor.skybox"),TE("editor.envmapitem.type.prob")]);var K=aE(null,TE("editor.delete"),"editor.delete",function(){F.deleteEnvmap(E)});a.push(K),K.getIconColor=function(){return this.isPressed()?m.config.color_select:m.config.color_dark},T.addRow(a,[this.indent,.1,this.indent2,.1,20]),a=[];var b=new ht.widget.Image;b.setIcon("editor.envmap.l"),a.push(b),a.push(TE("editor.image")),T.addLabelImage(a,"",function(D){var g=D.a(E).image;if(!o(g))return null;var f=F.editor.getFileNode(g);return f?f.url:g},function(F,D){var g=ht.Default.clone(F.a(E));g.image=D,F.a(E,g)}),T.addRow(a,[20,this.indent-20-8,0,.1,20]).visible=D;for(var B=["editor.face.right","editor.face.left","editor.face.top","editor.face.bottom","editor.face.front","editor.face.back"],$=0;$<6;$++)!function(D){a=[];var f=new ht.widget.Image;5===D?f.setIcon("editor.envmap.l"):f.setIcon("editor.envmap.t"),a.push(f),a.push(TE(B[D])),T.addLabelImage(a,"",function(g){var f=g.a(E).images;if(f instanceof Array){var T=F.editor.getFileNode(f[D]);return T?T.url:f[D]}},function(F,g){var f=ht.Default.clone(F.a(E));f.images[D]=g,F.a(E,f)}),T.addRow(a,[20,F.indent-20-8,0,.1,20]).visible=g}($);a=[];var p=new ht.widget.Image;p.setIcon("editor.envmap.t"),a.push(p),a.push(TE("editor.size")),T.addInput(a,function(F){return F.a(E).size},function(F,D){var g=ht.Default.clone(F.a(E));g.size=D,F.a(E,g)},"int"),T.addLabelFunction(a,TE("editor.envmapitem.filter"),function(F){return F.a(E).filter},function(D,g){var f=ht.Default.clone(D.a(E));f.filter=g,D.a(E,f),F.editor.scene.invalidateEnvmap()},"filter","data");var W=aE(null,TE("editor.refresh"),"editor.refresh",function(){F.editor.scene.invalidateEnvmap()});a.push(W),W.getIconColor=function(){return this.isPressed()?m.config.color_select:m.config.color_dark},T.addRow(a,[20,this.indent-20-4,.1,this.indent2,.1,20]).visible=f,a=[];var Y=new ht.widget.Image;Y.setIcon("editor.envmap.l"),a.push(Y),a.push(TE("editor.position")),T.addLabelInput(a,"X",function(F){if(F.a(E).pos)return F.a(E).pos[0]},function(F,D){var g=ht.Default.clone(F.a(E));g.pos[0]=D,F.a(E,g)},"int"),T.addLabelInput(a,"Y",function(F){if(F.a(E).pos)return F.a(E).pos[1]},function(F,D){var g=ht.Default.clone(F.a(E));g.pos[1]=D,F.a(E,g)},"int"),T.addLabelInput(a,"Z",function(F){if(F.a(E).pos)return F.a(E).pos[2]},function(F,D){var g=ht.Default.clone(F.a(E));g.pos[2]=D,F.a(E,g)},"int"),T.addRow(a,[20,this.indent-8-20-20,20,.1,20,.1,20,.1]).visible=f},F.prototype.parseEnvmap=function(E){var F=this,D=this.envmapView;if(this.clearEnvmap(),E){var g={};E.forEach(function(E,D){g[D]=E,F.envmapViewAddRow(D)}),D.$46$=D._rows,D._envmap=ht.Default.stringify(E),D.data.onPropertyChanged=function(E){D.updateProperties(),"attrObject"!==E.property&&F.toEnvmap(D.data)},D.data.setAttrObject(g)}this.resizeEnvmapRow()},F.prototype.resizeEnvmapRow=function(){this.envmapView.filterProperties(),this.envmapView.setRowHeight(this.getRowHeight()),this.envmapView.setVGap(this.getVGap());var E=this.envmapView.getRows().length;this.envmapRow.height=E?E*(this.getRowHeight()+this.getVGap())-this.getVGap():2,this.filterPropertiesLater()},F.prototype.toEnvmap=function(E){this.envmapView._editing=!0;var F=E.getAttrObject(),D=[];for(var g in F)D.push(F[g]);this.envmapView._envmap=ht.Default.stringify(D),this.editor.dm.setEnvmap(D)},F.prototype.isEnvmapChange=function(){return ht.Default.stringify(this.editor.dm.getEnvmap())!==this.envmapView._envmap},F.prototype.addEnvmap=function(){var E=ht.Default.clone(this.editor.dm.getEnvmap())||[];E.push({type:"sphere"}),this.editor.dm.setEnvmap(E),this.parseEnvmap(this.editor.dm.getEnvmap())},F.prototype.deleteEnvmap=function(E){var F=ht.Default.clone(this.editor.dm.getEnvmap());F.splice(E,1),this.editor.dm.setEnvmap(F),this.parseEnvmap(this.editor.dm.getEnvmap()),ht.Default.hideToolTip()},F.prototype.clearEnvmap=function(){var E=this.envmapView;E.data.onPropertyChanged=function(){},E._envmap=void 0,E.$46$=[],E.data.setAttrObject({}),E.updateHandlers=[],E.clear()},F.prototype.initHighlightView=function(){var E=new fE(this.editor,"Highlight","data");return E.setPadding(0),E.setLabelVPadding(0),E.getValue=function(E){return E(this.data)},E.setValue=function(E,F,D){E(this.data,D?D():F)},E.updateProperties=function(){this._updating=!0,this.updateHandlers.forEach(function(E){E()}),this._updating=!1,this._updatePropertiesLater=!1},E.data=new ht.Data,E},F.prototype.highlightViewAddRow=function(E){var F=this,D=this.highlightView,g=[];if(D.addLabelInput(g,TE("editor.name"),function(F){return F.a(E).name},function(F,g){if(void 0!==g){var f=ht.Default.clone(F.a(E));f.name=g,F.a(E,f)}else D.filterProperties()}),E){var f=aE(null,TE("editor.delete"),"editor.delete",function(){F.deleteHighlight(E)});g.push(f),f.getIconColor=function(){return this.isPressed()?m.config.color_select:m.config.color_dark},D.addRow(g,[this.indent,.1,20])}else D.addRow(g,[this.indent,.1]);g=[];var T=new ht.widget.Image;T.setIcon("editor.envmap.t"),g.push(T),D.addLabelColor(g,TE("editor.color"),function(F){return F.a(E).color||m.config.sceneHighlightColor},function(F,D){var g=ht.Default.clone(F.a(E));g.color=D,F.a(E,g)}),D.addRow(g,[20,this.indent,.1]),g=[];var a=new ht.widget.Image;a.setIcon("editor.envmap.l"),g.push(a),D.addLabelRange(g,TE("editor.width"),function(F){var D=F.a(E).width;return void 0===D&&(D=m.config.sceneHighlightWidth),D},function(F,D){var g=ht.Default.clone(F.a(E));g.width=D,F.a(E,g)},0,void 0,.1,"number"),D.addRow(g,[20,this.indent,.1]).visible=function(E){return"hard"===F.editor.scene.getHighlightType()},g=[];var K=new ht.widget.Image;K.setIcon("editor.envmap.t"),g.push(K),D.addLabelRange(g,TE("editor.width"),function(F){return F.a(E).width||m.config.sceneHighlightWidth},function(F,D){var g=ht.Default.clone(F.a(E));g.width=D,F.a(E,g)},0,void 0,.1,"number"),D.addRow(g,[20,this.indent,.1]).visible=function(E){return"soft"===F.editor.scene.getHighlightType()},g=[];var b=new ht.widget.Image;b.setIcon("editor.envmap.t"),g.push(b),D.addLabelSlider(g,TE("editor.highlightglow"),function(F){var D=F.a(E).glow;return void 0===D&&(D=m.config.sceneHighlightGlow),D},function(F,D){var g=ht.Default.clone(F.a(E));g.glow=D,F.a(E,g)},0,2,.02),D.addInput(g,function(F){var D=F.a(E).glow;return void 0===D&&(D=m.config.sceneHighlightGlow),D},function(F,D){var g=ht.Default.clone(F.a(E));g.glow=D,F.a(E,g)},"number"),D.addRow(g,[20,this.indent,.1,76]).visible=function(E){return"soft"===F.editor.scene.getHighlightType()},g=[];var B=new ht.widget.Image;B.setIcon("editor.envmap.l"),g.push(B),D.addLabelSlider(g,TE("editor.highlightstrength"),function(F){var D=F.a(E).strength;return void 0===D&&(D=m.config.sceneHighlightStrength),D},function(F,D){var g=ht.Default.clone(F.a(E));g.strength=D,F.a(E,g)},0,5,.05),D.addInput(g,function(F){var D=F.a(E).strength;return void 0===D&&(D=m.config.sceneHighlightStrength),D},function(F,D){var g=ht.Default.clone(F.a(E));g.strength=D,F.a(E,g)},"number"),D.addRow(g,[20,this.indent,.1,76]).visible=function(E){return"soft"===F.editor.scene.getHighlightType()}},F.prototype.parseHighlight=function(E){var F=this,D=this.highlightView;if(this.clearHighlight(),E){var g={};E.forEach(function(E,D){g[D]=E,F.highlightViewAddRow(D)}),D.$46$=D._rows,D._highlight=ht.Default.stringify(E),D.data.onPropertyChanged=function(E){D.updateProperties(),"attrObject"!==E.property&&F.toHighlight(D.data)},D.data.setAttrObject(g)}this.resizeHighlightRow()},F.prototype.resizeHighlightRow=function(){this.highlightView.filterProperties(),this.highlightView.setRowHeight(this.getRowHeight()),this.highlightView.setVGap(this.getVGap());var E=this.highlightView.getRows().length;this.highlightRow.height=E?E*(this.getRowHeight()+this.getVGap())-this.getVGap():2,this.filterPropertiesLater()},F.prototype.toHighlight=function(E){this.highlightView._editing=!0;var F=E.getAttrObject(),D=[];for(var g in F){var f={name:F[g].name};F[g].color!==m.config.sceneHighlightColor&&(f.color=F[g].color),void 0!==F[g].width&&F[g].width!==m.config.sceneHighlightWidth&&(f.width=F[g].width),"soft"===this.editor.dm.a("sceneHighlightType")&&(F[g].glow!==m.config.sceneHighlightGlow&&(f.glow=F[g].glow),F[g].strength!==m.config.sceneHighlightStrength&&(f.strength=F[g].strength)),D.push(f)}this.highlightView._highlight=ht.Default.stringify(D),this.isHighlightChange()&&this.editor.dm.a("sceneHighlightGroups",D)},F.prototype.isHighlightChange=function(){return ht.Default.stringify(this.editor.dm.a("sceneHighlightGroups"))!==this.highlightView._highlight},F.prototype.addHighlight=function(){var E=ht.Default.clone(this.editor.dm.a("sceneHighlightGroups"))||[];E.length>=4?this.editor.messageView.show(i(TE("editor.errormessage.maxhighlightgroups"),4),"error"):(E.push({name:this.createHighlightName(E),width:m.config.sceneHighlightWidth,glow:m.config.sceneHighlightGlow,strength:m.config.sceneHighlightStrength}),this.editor.dm.a("sceneHighlightGroups",E),this.parseHighlight(E))},F.prototype.deleteHighlight=function(E){var F=ht.Default.clone(this.editor.dm.a("sceneHighlightGroups"));F.splice(E,1),this.editor.dm.a("sceneHighlightGroups",F),this.parseHighlight(this.editor.dm.a("sceneHighlightGroups")),ht.Default.hideToolTip()},F.prototype.clearHighlight=function(){var E=this.highlightView;E.data.onPropertyChanged=function(){},E._highlight=void 0,E.$46$=[],E.data.setAttrObject({}),E.updateHandlers=[],E.clear()},F.prototype.createHighlightName=function(E){var F=0;return E.forEach(function(E){if(E.name.indexOf(TE("editor.untitled")+"_")>-1){var D=Number(E.name.replace(TE("editor.untitled")+"_",""));!isNaN(D)&&Math.ceil(D)>F&&(F=D)}}),TE("editor.untitled")+"_"+(F+1)},F}(fE),bE=hteditor.getString,BE={undefined:"editor.cube",null:"editor.cube",sphere:"editor.sphere",cylinder:"editor.cylinder",cone:"editor.scene.cone",torus:"editor.scene.torus",triangle:"editor.scene.triangle",rightTriangle:"editor.scene.rightTriangle",parallelogram:"editor.scene.parallelogram",trapezoid:"editor.scene.trapezoid",rect:"editor.scene.rect",roundRect:"editor.scene.roundRect",star:"editor.scene.star",box:"editor.scene.box",billboard:"editor.scene.billboard",plane:"editor.scene.plane"},$E=function(E){function F(D,g){return I(this,F),q(this,E.call(this,D,g,"data3d",!1))}return P(F,E),F.prototype.initForm=function(){E.prototype.initForm.call(this),this.$11$(),this.addTransformProperties(),this.addWireframeProperties(),this.addBloomProperties(),this.addHighlightProperties(),this.addReflectorProperties(),this.addEnvmapProperties(),this.addClipboxProperties(),this.editor.scene.shadowMap&&this.$19$()},F.prototype.$11$=function(){var E=this;this.addTitle("TitleBasic"),this.addEventProperties();var F=[];this.addLabelInput(F,bE("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(F,bE("editor.tag"),hteditor.getter("p","tag"),function(F,D){if(m.config.checkTagConflicts&&D)for(var g=E.dataModel.getDatas(),f=g.size()-1;f>=0;f--){var T=g.get(f);if(T!==F&&T.getTag()===D)return E.editor.messageView.show(i(bE("editor.errormessage.tagalreadyexists"),D),"error"),void E.$34$()}F.setTag(D)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelInput(F,bE("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(F,[this.indent,.1]);var D=[void 0,"billboard","plane","box","sphere","cone","torus","cylinder","star","rect","roundRect","triangle","rightTriangle","parallelogram","trapezoid"],g=[],f=[];D.forEach(function(E){g.push(bE("editor."+(E?E.toLowerCase():"cube"))),f.push({width:16,height:16,comps:[{type:"image",stretch:"centerUniform",color:m.config.color_dark,name:BE[E],rect:[0,0,16,16]}]})}),F=[],this.addLabelComboBoxURL(F,bE("editor.type"),function(F){var D=F.s("shape3d");if(b(D)){var g=E.editor.getFileNode(D);return g?g.url:D}return D},function(F,D){F.s("shape3d",D),E.editor.updateInspector()},D,g,f,function(E,F){return!!F.view.draggingData&&"model"===F.view.draggingData.fileType}),this.addImage(F,function(E){return E.s("shape3d")},void 0,function(E){return b(E)?E.substr(0,E.length-5)+".png":null},function(E){return hteditor.isJSON(E.rawIcon)}),this.addOneRow(F).visible=function(E){return!(E.data instanceof ht.Shape)},F=[],this.addLabelCheckBox(F,bE("editor.selectable"),function(E){return E.s("3d.selectable")},function(E,F){E.s("2d.selectable",F),E.s("3d.selectable",F)}),this.addLabelCheckBox(F,bE("editor.movable"),function(E){return E.s("3d.movable")},function(E,F){E.s("2d.movable",F),E.s("3d.movable",F)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelCheckBox(F,bE("editor.editable"),function(E){return E.s("3d.editable")},function(E,F){E.s("2d.editable",F),E.s("3d.editable",F)}),this.addLabelCheckBox(F,bE("editor.visible"),function(E){return E.s("3d.visible")},function(E,F){E.s("2d.visible",F),E.s("3d.visible",F)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[];var T=function(E){var F=E.s("fixSizeOnScreen");return null==F&&(F=E.s("shape3d.fixSizeOnScreen")),!!F};this.addLabelCheckBox(F,bE("editor.fitsize"),T,function(E,F){E.s("fixSizeOnScreen",!!F&&[-1,-1]),null!=E.s("shape3d.fixSizeOnScreen")&&E.s("shape3d.fixSizeOnScreen",void 0),F&&E.s("autorotate",!0)}),this.addObject(F,function(E){var F=E.s("fixSizeOnScreen");if(F)return F},hteditor.setter("s","fixSizeOnScreen"),bE("editor.fixsizeonscreentip"));var a=this.addLabelCheckBox(F,bE("editor.dynamic"),function(E){var F=E.s("vector.dynamic");return null==F&&(F=E.s("shape3d.vector.dynamic")),!!F},function(E,F){E.s("vector.dynamic",F),null!=E.s("shape3d.vector.dynamic")&&E.s("shape3d.vector.dynamic",void 0)});this.addRow(F,[this.indent,20,.1,this.indent2,"24+0.1"]),F=[],this.addLabelCheckBox(F,bE("editor.alwaysontop"),function(E){if(E.getRenderLayer)return"top"===E.getRenderLayer();var F=E.s("alwaysOnTop");return null==F&&(F=E.s("shape3d.alwaysOnTop")),F},function(E,F){E.setRenderLayer?(E.setRenderLayer(F?"top":null),E.s("alwaysOnTop",void 0)):E.s("alwaysOnTop",F),E.s("shape3d.alwaysOnTop",void 0)});var K=function(E){var F=E.s("autorotate");return null==F&&(F=E.s("shape3d.autorotate")),F},B=this.addLabelComboBox(F,bE("editor.autorotate"),K,function(E,F){E.s("autorotate",F),null!=E.s("shape3d.autorotate")&&E.s("shape3d.autorotate",void 0)},[!1,!0,"x","y","z"]);this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelCheckBox(F,bE("editor.texturecache"),function(E){return E.s("texture.cache")},function(F,D){F.s("texture.cache",D),null!=F.s("shape3d.image.cache")&&F.s("shape3d.image.cache",void 0),E.editor.scene.invalidateShape3dCachedImage(F)}),this.addLabelRange(F,bE("editor.texturescale"),function(E){var F=void 0;return 1!==E.s("texture.scale")?F=E.s("texture.scale"):1!==E.s("shape3d.texture.scale")&&(F=E.s("shape3d.texture.scale")),F||1},function(E,F){E.s("texture.scale",F),E.s("shape3d.texture.scale",void 0)},0,10,.1,"number"),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelColor(F,bE("editor.blend"),hteditor.getter("s","body.color"),hteditor.setter("s","body.color")),this.addRow(F,[this.indent,.1]).visible=function(E){var F=E.data,D=ht.Default.getShape3dModel(F.s("shape3d"));return!D||!D.model3d},F=[];var $=this.addLabelSlider(F,bE("editor.clip"),hteditor.getter("s","3d.clip.percentage"),hteditor.setter("s","3d.clip.percentage"),0,1,.001);this.addInput(F,hteditor.getter("s","3d.clip.percentage"),hteditor.setter("s","3d.clip.percentage"),"number"),this.addComboBox(F,function(E){return E.s("3d.clip.direction")},function(E,F){E.s("3d.clip.direction",F)},[null,"left","right","top","bottom","front","back"],["",bE("editor.clipdirection.left"),bE("editor.clipdirection.right"),bE("editor.clipdirection.top"),bE("editor.clipdirection.bottom"),bE("editor.clipdirection.front"),bE("editor.clipdirection.back")]),this.addRow(F,[this.indent,.1,52,.1]),F=[],this.addLabelSlider(F,bE("editor.transparent"),function(E){return void 0===E.s("shape3d.opacity")?1:E.s("shape3d.opacity")},hteditor.setter("s","shape3d.opacity"),0,1,.01),this.addInput(F,function(E){return void 0===E.s("shape3d.opacity")?1:E.s("shape3d.opacity")},hteditor.setter("s","shape3d.opacity"),"number"),this.addCheckBox(F,hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(F,[this.indent,.1,52,20]).visible=function(E){if(E.data instanceof ht.Shape)return!!E.data.s("shape3d")||-1===E.data.getThickness();if(E.data.s("shape3d")){var F=ht.Default.getShape3dModel(E.data.s("shape3d"));return!F||!F.model3d}return!1},F=[],this.addLabelRange(F,bE("editor.alphaTest"),hteditor.getter("s","alphaTest"),hteditor.setter("s","alphaTest"),0,1,.01,"number"),this.addLabelCheckBox(F,bE("editor.transparentmask"),hteditor.getter("s","transparent.mask"),hteditor.setter("s","transparent.mask")),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelRange(F,bE("editor.selectedBrightness"),function(E){return E.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addLabelRange(F,bE("editor.brightness"),function(E){return E.s("brightness")},hteditor.setter("s","brightness"),0,1,.01,"number"),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelObject(F,bE("editor.polygonoffset"),function(E){return E.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(F,[this.indent,.1]),F=[];var p=this.addLabelComboBox(F,bE("editor.renderlayer"),function(E){return E.getRenderLayer()},function(E,F){E.setRenderLayer(F)});this.addOneRow(F),F=[];var W=function(E){var F=this;W.superClass.constructor.call(F,E);var D=F._listView=new ht.widget.ListView;D.getView().style.background=ht.Default.comboBoxBackground,D.setCheckMode(!0),D.sm().ms(function(g){var f=D.dm().getDataByTag(4294967295);if("append"===g.kind)if(g.datas.get(0)===f)D.sm().selectAll();else{var T=D.sm().getSelection().length;T===D.dm().getDatas().length-1&&D.sm().selectAll()}else if("remove"===g.kind)if(g.datas.get(0)===f)D.sm().clearSelection();else{var a=D.sm().getSelection().toList(function(E){return E!==f});D.sm().setSelection(a)}E.setValue(F.getValue())})};ht.Default.def(W,ht.widget.BaseDropDownTemplate,{getView:function(){return this._listView.getView()},onOpened:function(E){var F=this._listView,D=new ht.Data;D.setName(bE("editor.all")),D.setTag(4294967295),F.dm().add(D);var g=new ht.Data;g.setName(bE("editor.default")),g.setTag(0),F.dm().add(g);var f=this._master.getMaskMap();E=this._master.getValue();for(var T in f){T=parseInt(T);var a=new ht.Data;a.setName(f[T]),a.setTag(T),F.dm().add(a)}if(E)if(4294967295===E)F.sm().selectAll();else{var K=new ht.List;F.dm().each(function(F){E&1<<F.getTag()&&K.add(F)}),F.sm().setSelection(K)}},onClosed:function(){},getValue:function(){var E=this._listView.dm(),F=E.sm();if(0===F.size())return 0;var D=E.getDataByTag(4294967295);if(F.contains(D))return 4294967295;var g=0;return F.each(function(E){var F=E.getTag();4294967295!==F&&E.getName()&&(g+=1<<F)}),g},getHeight:function(){return 100}});var Y=new ht.widget.MultiComboBox;Y.setEditable(!1),Y.setDropDownComponent(W),Y.drawValue=function(E,F,D,g,f){var T=Y.getValue(),a=Y.getMaskMap(),K=[];if(4294967295===T)K=bE("editor.all");else if(0===T)K="";else{1&T&&K.push(bE("editor.default"));for(var b in a)b=parseInt(b),T&1<<b&&K.push(a[b]);K.join(", ")}ht.Default.drawText(E,K,Y.getLabelFont(),Y.getLabelColor(),F+1,D,0,f)},Y.getMaskMap=function(){return E.editor.dm.a("sceneLightGruopAlias")},Y.getValue=function(){return E.data.s("light.mask")},Y.onValueChanged=function(F,D){E.editor.sm.getSelection().each(function(E){E.s("light.mask",D)})},F.push(bE("editor.lightmask")),F.push(Y),this.addLabelCheckBox(F,bE("editor.light"),hteditor.getter("s","shape3d.light"),hteditor.setter("s","shape3d.light")),this.addRow(F,[this.indent,.1,this.indent2,20]),F=[];var o=function(E){var F=this;o.superClass.constructor.call(F,E);var D=F._listView=new ht.widget.ListView;D.getView().style.background=ht.Default.comboBoxBackground,D.setCheckMode(!0),D.sm().ms(function(g){var f=D.dm().getDataByTag(4294967295);if("append"===g.kind)if(g.datas.get(0)===f)D.sm().selectAll();else{var T=D.sm().getSelection().length;T===D.dm().getDatas().length-1&&D.sm().selectAll()}else if("remove"===g.kind)if(g.datas.get(0)===f)D.sm().clearSelection();else{var a=D.sm().getSelection().toList(function(E){return E!==f});D.sm().setSelection(a)}E.setValue(F.getValue())})};ht.Default.def(o,ht.widget.BaseDropDownTemplate,{getView:function(){return this._listView.getView()},onOpened:function(E){var F=this._listView,D=new ht.Data;D.setName(bE("editor.all")),D.setTag(4294967295),F.dm().add(D);var g=new ht.Data;g.setName(bE("editor.default")),g.setTag(0),F.dm().add(g);var f=this._master.getMaskMap();E=this._master.getValue();for(var T in f){T=parseInt(T);var a=new ht.Data;a.setName(f[T]),a.setTag(T),F.dm().add(a)}if(E)if(4294967295===E)F.sm().selectAll();else{var K=new ht.List;F.dm().each(function(F){E&1<<F.getTag()&&K.add(F)}),F.sm().setSelection(K)}},onClosed:function(){},getValue:function(){var E=this._listView.dm(),F=E.sm();if(0===F.size())return 0;var D=E.getDataByTag(4294967295);if(F.contains(D))return 4294967295;var g=0;return F.each(function(E){var F=E.getTag();4294967295!==F&&E.getName()&&(g+=1<<F)}),g},getHeight:function(){return 100}});var h=new ht.widget.MultiComboBox;if(h.setEditable(!1),h.setDropDownComponent(o),h.drawValue=function(E,F,D,g,f){var T=h.getValue(),a=h.getMaskMap(),K=[];if(4294967295===T)K=bE("editor.all");else if(0===T)K="";else{1&T&&K.push(bE("editor.default"));for(var b in a)b=parseInt(b),T&1<<b&&K.push(a[b]);K.join(", ")}ht.Default.drawText(E,K,h.getLabelFont(),h.getLabelColor(),F+1,D,0,f)},h.getMaskMap=function(){return E.editor.dm.a("sceneFlowEffectGroupAlias")},h.getValue=function(){return E.data.s("effect.flow.mask")},h.onValueChanged=function(F,D){E.editor.sm.getSelection().each(function(E){E.s("effect.flow.mask",D)})},F.push(bE("editor.effect.flowmask")),F.push(h),this.addRow(F,[this.indent,.1]),m.config.batchEditable){F=[];this.addLabelComboBox(F,bE("editor.batch"),function(E){return E.s("batch")},function(E,F){return E.s("batch",F)},[],[]).getValues=function(){return E.editor.batchView.keys},this.addOneRow(F).visible=function(E){var F=E.data,D=ht.Default.getShape3dModel(F.s("shape3d"));return!D||!D.model3d},F=[];this.addLabelComboBox(F,bE("editor.batch"),function(E){return E.s("static.group")},function(E,F){return E.s("static.group",F)},["0","1","2","3","4","5","6","7"],[]).setEditable(!0),this.addCheckBox(F,hteditor.getter("s","static"),hteditor.setter("s","static")),this.addButton(F,null,null,"editor.selectAll",function(F){if(F&&F.s("static")){var D=E.editor.dm.toDatas(function(E){return!!E.s("static")&&String(E.s("static.group"))===String(F.s("static.group"))});E.editor.dm.sm().setSelection(D)}}),this.addOneRow(F).visible=function(E){var F=E.data,D=ht.Default.getShape3dModel(F.s("shape3d"));return!!D&&!!D.model3d}}this.updateHandlers.push(function(){if(E.data){var F=[],D=E.editor.scene.getRenderLayerInfoMap()||{},g=Object.values(D),f=Object.keys(D);g.forEach(function(E,F){E.name=f[F]}),g.sort(function(E,F){return E.priority-F.priority}),g.forEach(function(E){F.push(E.name)}),0===F.length&&F.push("main","top"),p.setValues(F),$.setDisabled(!E.data.s("3d.clip.direction"));var K=T(E.data);B.setDisabled(K),a.setDisabled(K)}})},F.prototype.addTransformProperties=function(){this.addTitle("TitleTransform");var E=m.config.numberPrecision,F=[];this.addLabelComboBox(F,bE("editor.rotationMode"),function(E){return E.getRotationMode()},function(E,F){return E.setRotationMode(F)},["xyz","xzy","yxz","yzx","zxy","zyx"]),this.addRow(F,[this.indent,.1]);var D=E.rotation||0;f=0===D?"int":"number",T=1/Math.pow(10,D),F=[],F.push(bE("editor.rotation")),this.addButton(F,null,bE("editor.reset"),"editor.resetsize.state",function(E){E instanceof ht.Node&&E.r3(0,0,0)}),this.addLabelInput(F,"X",function(E){return Number((180/Math.PI*E.getRotationX()).toFixed(D))},function(E,F){E instanceof ht.Node&&E.setRotationX(F*Math.PI/180)},f,T),this.addLabelInput(F,"Y",function(E){return Number((180/Math.PI*E.getRotationY()).toFixed(D))},function(E,F){E instanceof ht.Node&&E.setRotationY(F*Math.PI/180)},f,T),this.addLabelInput(F,"Z",function(E){return Number((180/Math.PI*E.getRotationZ()).toFixed(D))},function(E,F){E instanceof ht.Node&&E.setRotationZ(F*Math.PI/180)},f,T),this.addRow(F,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var g=E.position||0,f=0===g?"int":"number",T=1/Math.pow(10,g);F=[],F.push(bE("editor.position")),this.addButton(F,null,bE("editor.reset"),"editor.resetsize.state",function(E){E instanceof ht.Node&&E.p3(0,0,0)}),this.addLabelInput(F,"X",function(E){return Number(E.getX().toFixed(g))},function(E,F){return E.setX(parseFloat(F))},f,T),this.addLabelInput(F,"Y",function(E){return Number(E.getElevation().toFixed(g))},function(E,F){return E.setElevation(parseFloat(F))},f,T),this.addLabelInput(F,"Z",function(E){return Number(E.getY().toFixed(g))},function(E,F){return E.setY(parseFloat(F))},f,T),this.addRow(F,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var a=E.size||0;f=0===a?"int":"number",T=1/Math.pow(10,a),F=[],F.push(bE("editor.size")),this.addButton(F,null,bE("editor.reset"),"editor.resetsize.state",function(E){E instanceof ht.Node&&E.s3(-1,-1,-1)}),this.addLabelInput(F,"X",function(E){return Number(E.getWidth().toFixed(a))},function(E,F){return E.setWidth(parseFloat(F))},f,T),this.addLabelInput(F,"Y",function(E){return Number(E.getTall().toFixed(a))},function(E,F){return E.setTall(parseFloat(F))},f,T),this.addLabelInput(F,"Z",function(E){return Number(E.getHeight().toFixed(a))},function(E,F){return E.setHeight(parseFloat(F))},f,T),this.addRow(F,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var K=E.anchor||0;f=0===K?"int":"number",T=1/Math.pow(10,K),F=[],F.push(bE("editor.anchor")),this.addButton(F,null,bE("editor.reset"),"editor.resetsize.state",function(E){E instanceof ht.Node&&E.setAnchor3d(.5,0,.5,!0)}),this.addLabelInput(F,"X",function(E){return Number(E.getAnchorX().toFixed(K))},function(E,F){E instanceof ht.Node&&E.setAnchor3d(parseFloat(F),E.getAnchorElevation(),E.getAnchorY(),!0)},f,T),this.addLabelInput(F,"Y",function(E){return Number(E.getAnchorElevation().toFixed(K))},function(E,F){E instanceof ht.Node&&E.setAnchor3d(E.getAnchorX(),parseFloat(F),E.getAnchorY(),!0)},f,T),this.addLabelInput(F,"Z",function(E){return Number(E.getAnchorY().toFixed(K))},function(E,F){E instanceof ht.Node&&E.setAnchor3d(E.getAnchorX(),E.getAnchorElevation(),parseFloat(F),!0)},f,T),this.addRow(F,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var b=E.scale||0;f=0===b?"int":"number",T=1/Math.pow(10,b),F=[],F.push(bE("editor.scale")),this.addButton(F,null,bE("editor.reset"),"editor.resetsize.state",function(E){E instanceof ht.Node&&E.setScale3d(1,1,1)}),this.addLabelInput(F,"X",function(E){return Number(E.getScaleX().toFixed(b))},function(E,F){E instanceof ht.Node&&E.setScaleX(parseFloat(F))},f,T),this.addLabelInput(F,"Y",function(E){return Number(E.getScaleTall().toFixed(b))},function(E,F){E instanceof ht.Node&&E.setScaleTall(parseFloat(F))},f,T),this.addLabelInput(F,"Z",function(E){return Number(E.getScaleY().toFixed(b))},function(E,F){E instanceof ht.Node&&E.setScaleY(parseFloat(F))},f,T),this.addRow(F,[this.indent-40-8,20,20,.1,20,.1,20,.1])},F.prototype.addWireframeProperties=function(){this.addTitle("TitleWireFrame");var E=[];this.addLabelComboBox(E,bE("editor.visible"),hteditor.getter("s","wf.visible"),function(E,F){E.s("wf.visible",F)},[!1,!0,"selected"]),this.addLabelCheckBox(E,bE("editor.wfshort"),hteditor.getter("s","wf.short"),hteditor.setter("s","wf.short")),this.addRow(E,[this.indent,.1,this.indent2,.1]),E=[],this.addLabelColor(E,bE("editor.color"),hteditor.getter("s","wf.color"),hteditor.setter("s","wf.color")),this.addRow(E,[this.indent,.1]),E=[],this.addLabelCheckBox(E,bE("editor.wfgeometry"),hteditor.getter("s","wf.geometry"),hteditor.setter("s","wf.geometry")),
this.addLabelCheckBox(E,bE("editor.wfloadQuadWireframe"),hteditor.getter("s","wf.loadQuadWireframe"),hteditor.setter("s","wf.loadQuadWireframe")),this.addRow(E,[this.indent,.1,this.indent2,.1]),E=[],this.addLabelComboBox(E,bE("editor.wfcombineTriangle"),hteditor.getter("s","wf.combineTriangle"),hteditor.setter("s","wf.combineTriangle"),[!1,!0,2,3],[bE("editor.wfdontcombine"),bE("editor.wfcombineadjacent"),bE("editor.wfcombinecommon"),bE("editor.wfcombinesmooth")]),this.addRow(E,[this.indent,.1])},F.prototype.addHighlightProperties=function(){var E=this,F=function(E){return"style"===E.editor.dm.a("sceneHighlightMode")};this.addTitle("TitleHighlight");var D=[];this.addLabelComboBox(D,bE("editor.type"),hteditor.getter("s","highlight.mode"),hteditor.setter("s","highlight.mode"),[!1,!0,"selected","hover"],[bE("editor.no"),bE("editor.yes"),bE("editor.selected"),bE("editor.hover")]);var g=this.addLabelComboBox(D,bE("editor.highlightgroup"),hteditor.getter("s","highlight.group"),hteditor.setter("s","highlight.group"),[],[]);this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=F,g.getLabels=function(){var F=E.editor.dm.a("sceneHighlightGroups"),D=[];return F instanceof Array?F.forEach(function(E,F){D.push(F+" - "+E.name)}):D.push("0 - "+bE("editor.default")),D},g.getValues=function(){var F=E.editor.dm.a("sceneHighlightGroups"),D=[];return F instanceof Array?F.forEach(function(E,F){D.push(F)}):D.push(0),D}},F.prototype.addReflectorProperties=function(){this.addTitle("TitleReflector");var E=[];this.addLabelCheckBox(E,bE("editor.reflectable"),hteditor.getter("s","3d.reflectable"),hteditor.setter("s","3d.reflectable")),this.addRow(E,[this.indent,.1])},F.prototype.addEnvmapProperties=function(){var E=this,F=function(E){return"new"===E.editor.dm.getEnvmapType()};this.addTitle("TitleEnvmap");var D=[];this.addLabelRange(D,bE("editor.envmap.reflectivity"),function(E){return E.s("envmap")||0},function(E,F){return E.s("envmap",F)},0,1,.01,"number"),this.addLabelRange(D,bE("editor.headlight.ambientintensity"),function(E){return void 0==E.s("headlight.ambientIntensity")?.7:E.s("headlight.ambientIntensity")},function(E,F){return E.s("headlight.ambientIntensity",F)},void 0,void 0,.01,"number"),this.addRow(D,[this.indent,.1,this.indent2,.1]),D=[],this.addLabelRange(D,bE("editor.envmap.roughness"),function(E){return E.s("roughness")},function(E,F){return E.s("roughness",F)},0,1,.01,"number");var g=this.addLabelComboBox(D,bE("editor.envmap.probe"),hteditor.getter("s","envmap.probe"),hteditor.setter("s","envmap.probe"),[],[]);this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=F,g.getLabels=function(){var F=E.editor.dm.getEnvmap();if(F instanceof Array){var D=[];return F.forEach(function(E,F){var g=E.type;void 0!==E.name&&(g=E.name),D.push(F+" - "+g)}),D}},g.getValues=function(){var F=E.editor.dm.getEnvmap();if(F instanceof Array){var D=[];return F.forEach(function(E,F){D.push(F)}),D}}},F.prototype.addClipboxProperties=function(){var E=this;this.addTitle("TitleClipBox");var F=[],D=function(F){if(F.s("3d.clipbox")){var D=F.s("3d.clipbox.shape");F.s("shape3d","cube"===D?"box":D),E.editor.updateInspector()}};this.addLabelComboBox(F,bE("editor.clipbox"),hteditor.getter("s","3d.clipbox"),function(F,g){F.s("3d.clipbox",g),D(F),E.editor.inspector.filterPropertiesLater()},[void 0,"inner","outer"],["",bE("editor.clipbox.inner"),bE("editor.clipbox.outer")]),this.addLabelComboBox(F,bE("editor.clipboxshape"),hteditor.getter("s","3d.clipbox.shape"),function(E,F){E.s("3d.clipbox.shape",F),D(E)},["cube","sphere","cylinder","cone"],[bE("editor.cube"),bE("editor.sphere"),bE("editor.cylinder"),bE("editor.cone")]),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[];var g=this.addLabelComboBox(F,bE("editor.group"),hteditor.getter("s","3d.clipbox.group"),hteditor.setter("s","3d.clipbox.group"),[0],[bE("editor.default")]);this.addRow(F,[this.indent,.1,this.indent2,.1]).visible=function(E){return void 0!==E.data.s("3d.clipbox")},g.getLabels=function(){var F=E.editor.dm;if(!F)return[bE("editor.default")];var D=F.a("sceneClipboxGroupAlias");if(!D)return[bE("editor.default")];var g=ht.Default.clone(D);return[bE("editor.default")].concat(Object.values(g))},g.getValues=function(){var F=E.editor.dm;if(!F)return[bE("editor.default")];var D=F.a("sceneClipboxGroupAlias");if(!D)return[0];var g=ht.Default.clone(D),f=[0];return Object.keys(g).forEach(function(E){f.push(Number(E))}),f},F=[];var f=function(E){var F=this;f.superClass.constructor.call(F,E);var D=F._listView=new ht.widget.ListView;D.getView().style.background=ht.Default.comboBoxBackground,D.setCheckMode(!0),D.sm().ms(function(g){var f=D.dm().getDataByTag(4294967295);if("append"===g.kind)if(g.datas.get(0)===f)D.sm().selectAll();else{var T=D.sm().getSelection().length;T===D.dm().getDatas().length-1&&D.sm().selectAll()}else if("remove"===g.kind)if(g.datas.get(0)===f)D.sm().clearSelection();else{var a=D.sm().getSelection().toList(function(E){return E!==f});D.sm().setSelection(a)}E.setValue(F.getValue())})};ht.Default.def(f,ht.widget.BaseDropDownTemplate,{getView:function(){return this._listView.getView()},onOpened:function(E){var F=this._listView,D=new ht.Data;D.setName(bE("editor.all")),D.setTag(4294967295),F.dm().add(D);var g=new ht.Data;g.setName(bE("editor.default")),g.setTag(0),F.dm().add(g);var f=this._master.getMaskMap();E=this._master.getValue();for(var T in f){T=parseInt(T);var a=new ht.Data;a.setName(f[T]),a.setTag(T),F.dm().add(a)}if(E)if(4294967295===E)F.sm().selectAll();else{var K=new ht.List;F.dm().each(function(F){E&1<<F.getTag()&&K.add(F)}),F.sm().setSelection(K)}},onClosed:function(){},getValue:function(){var E=this._listView.dm(),F=E.sm();if(0===F.size())return 0;var D=E.getDataByTag(4294967295);if(F.contains(D))return 4294967295;var g=0;return F.each(function(E){var F=E.getTag();4294967295!==F&&E.getName()&&(g+=1<<F)}),g},getHeight:function(){return 100}});var T=new ht.widget.MultiComboBox;T.setEditable(!1),T.setDropDownComponent(f),T.drawValue=function(E,F,D,g,f){var a=T.getValue(),K=T.getMaskMap(),b=[];if(4294967295===a)b=bE("editor.all");else if(0===a)b="";else{1&a&&b.push(bE("editor.default"));for(var B in K)B=parseInt(B),a&1<<B&&b.push(K[B]);b.join(", ")}ht.Default.drawText(E,b,T.getLabelFont(),T.getLabelColor(),F+1,D,0,f)},T.getMaskMap=function(){return E.editor.dm.a("sceneClipboxGroupAlias")},T.getValue=function(){return E.data.s("3d.clipbox.mask")},T.onValueChanged=function(F,D){E.editor.sm.getSelection().each(function(E){E.s("3d.clipbox.mask",D)})},F.push(bE("editor.clipboxmask")),F.push(T),this.addRow(F,[this.indent,.1]).visible=function(E){return void 0===E.data.s("3d.clipbox")},this.updateHandlers.push(function(){E.data})},F.prototype.addBloomProperties=function(){var E=function(E){return E.editor.dm.a("sceneBloomSelective")};this.addTitle("TitleBloom");var F=[];this.addLabelCheckBox(F,bE("editor.enable"),hteditor.getter("s","bloom"),hteditor.setter("s","bloom")),this.addRow(F,[this.indent,.1]).visible=E},F.prototype.$19$=function(){this.addTitle("TitleShadow");var E=[];this.addLabelCheckBox(E,bE("editor.shadow.cast"),hteditor.getter("s","shadow.cast"),hteditor.setter("s","shadow.cast")),this.addLabelCheckBox(E,bE("editor.shadow.receive"),hteditor.getter("s","shadow.receive"),hteditor.setter("s","shadow.receive")),this.addRow(E,[this.indent,.1,this.indent2,.1])},F}(fE),pE=hteditor.getString,WE=["all","front","back","left","right","top","bottom"],YE=function(E,F,D){return function(g){var f=g.s(E+"."+F);return D&&void 0===f?g.s("all."+F):f}},oE=function(E){return function(F){var D=F.s(E);return D||(D=F.s("all.uv.scale")),D?D[0]:1}},hE=function(E){return function(F,D){var g=F.s(E);g||(g=F.s("all.uv.scale")),F.s(E,[D,g?g[1]:1])}},uE=function(E){return function(F){var D=F.s(E);return D||(D=F.s("all.uv.scale")),D?D[1]:1}},UE=function(E){return function(F,D){var g=F.s(E);g||(g=F.s("all.uv.scale")),F.s(E,[g?g[0]:1,D])}},HE=function(E){return function(F){F.s(E,null)}},tE=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"Cube"))}return P(F,E),F.prototype.initForm=function(){this.addCustomProperties(),this.$11$(),this.addTransformProperties(),this.addCubeImageVisibleLightProperties(),this.addCubeColoruvScaleProperties(),this.addCubeBlendUvOffsetProperties(),this.addCubeUvAnchorRotationProperties(),this.addCubeReverseColorFlipCullProperties(),this.addCubeOpacityTransparentSelectProperties(),this.addWireframeProperties(),this.addBloomProperties(),this.addHighlightProperties(),this.addReflectorProperties(),this.addEnvmapProperties(),this.addClipboxProperties(),this.editor.scene.shadowMap&&this.$19$()},F.prototype.addCubeImageVisibleLightProperties=function(){var E=this;this.addTitle("TitleCubeImageVisibleLight");for(var F=[],D=0;D<WE.length;D++)!function(D){var g=WE[D]+".image",f=WE[D]+".material";F=[],E.addLabelImageOrMaterial(F,pE("editor.face."+WE[D]),function(F){var g=YE(WE[D],"material",!0)(F),f=E.editor.getFileNode(g);if(g)return f?f.url:T;var T=YE(WE[D],"image",!0)(F),a=E.editor.getFileNode(T);return a?a.url:T},function(F,D){var T=E.editor.getFileNode(D);T&&"material"===T.fileType?(F.s(f,D),F.s(g,void 0)):(F.s(g,D),F.s(f,void 0),F.s("texture.cache")&&E.editor.scene.invalidateShape3dCachedImage(F)),E.filterPropertiesLater()});var T=WE[D]+".visible";E.addLabelCheckBox(F,pE("editor.visible"),YE(WE[D],"visible",!0),hteditor.setter("s",T));var a=WE[D]+".light";E.addLabelCheckBox(F,pE("editor.light"),YE(WE[D],"light",!0),hteditor.setter("s",a)),E.addRow(F,[40,.1,20,40,20,40,20])}(D)},F.prototype.addCubeUvProperties=function(){},F.prototype.addCubeColoruvScaleProperties=function(){var E=this;this.addTitle("TitleCubeColorUvScale");for(var F=[],D=0;D<WE.length;D++)!function(D){var g=WE[D]+".color";F=[],E.addLabelColor(F,pE("editor.face."+WE[D]),YE(WE[D],"color"),hteditor.setter("s",g));var f=WE[D]+".uv.scale";E.addLabelInput(F,"U",oE(f),hE(f),"number",1),E.addLabelInput(F,"V",uE(f),UE(f),"number",1),E.addRow(F,[40,.1,20,.05,20,.05]).visible=function(){return!YE(WE[D],"material",!0)(E.data)}}(D)},F.prototype.addCubeBlendUvOffsetProperties=function(){var E=this;this.addTitle("TitleCubeBlendUvOffset");for(var F=[],D=0;D<WE.length;D++)!function(D){var g=WE[D]+".blend";F=[],E.addLabelColor(F,pE("editor.face."+WE[D]),YE(WE[D],"blend"),hteditor.setter("s",g));var f=WE[D]+".uv.offset";E.addLabelInput(F,"U",function(E){var F=E.s(f);return F||(F=E.s("all.uv.offset")),F?F[0]:0},function(E,F){var D=E.s(f);D||(D=E.s("all.uv.offset")),E.s(f,[F,D?D[1]:0])},"number",.1),E.addLabelInput(F,"V",function(E){var F=E.s(f);return F||(F=E.s("all.uv.offset")),F?F[1]:0},function(E,F){var D=E.s(f);D||(D=E.s("all.uv.offset")),E.s(f,[D?D[0]:0,F])},"number",.1),E.addRow(F,[40,.1,20,.05,20,.05]).visible=function(){return!YE(WE[D],"material",!0)(E.data)}}(D)},F.prototype.addCubeUvAnchorRotationProperties=function(){var E=this;this.addTitle("TitleCubeUvAnchorRotation");for(var F=[],D=0;D<WE.length;D++)!function(D){F=[],E.addLabel(F,pE("editor.face."+WE[D]));var g=WE[D]+".uv.anchor";E.addLabelInput(F,"U",function(E){var F=E.s(g);return F||(F=E.s("all.uv.anchor")),F?F[0]:0},function(E,F){var D=E.s(g);D||(D=E.s("all.uv.anchor")),E.s(g,[F,D?D[1]:0])},"number",.01),E.addLabelInput(F,"V",function(E){var F=E.s(g);return F||(F=E.s("all.uv.anchor")),F?F[1]:0},function(E,F){var D=E.s(g);D||(D=E.s("all.uv.anchor")),E.s(g,[D?D[0]:0,F])},"number",.01);var f=WE[D]+".uv.rotation";E.addLabelInput(F,"R",hteditor.getter("s",f),hteditor.setter("s",f),"number",.1),E.addRow(F,[40,20,.1,20,.1,20,.1]).visible=function(){return!YE(WE[D],"material",!0)(E.data)}}(D)},F.prototype.addCubeReverseColorFlipCullProperties=function(){var E=this;this.addTitle("TitleCubeReverseColorFlipCull");for(var F=[],D=0;D<WE.length;D++)!function(D){var g=WE[D]+".reverse.color";F=[],E.addLabelColor(F,pE("editor.face."+WE[D]),YE(WE[D],"reverse.color"),hteditor.setter("s",g));var f=WE[D]+".reverse.flip";E.addLabelCheckBox(F,pE("editor.flip"),YE(WE[D],"reverse.flip",!0),hteditor.setter("s",f));var T=WE[D]+".reverse.cull";E.addLabelCheckBox(F,pE("editor.cull"),YE(WE[D],"reverse.cull",!0),hteditor.setter("s",T)),E.addRow(F,[40,.1,40,20,40,20]).visible=function(){return!YE(WE[D],"material",!0)(E.data)}}(D)},F.prototype.addCubeOpacityTransparentSelectProperties=function(){var E=this;this.addTitle("titleCubeOpacityTransparentSelect");for(var F=[],D=0;D<WE.length;D++)!function(D){var g=WE[D]+".opacity";F=[],E.addLabelRange(F,pE("editor.face."+WE[D]),hteditor.getter("s",g),hteditor.setter("s",g),0,1,.01,"number");var f=WE[D]+".transparent";E.addLabelCheckBox(F,pE("editor.transparent"),YE(WE[D],"transparent",!0),hteditor.setter("s",f));var T=WE[D]+".discard.selectable";E.addLabelCheckBox(F,pE("editor.discardselectable"),YE(WE[D],"discard.selectable",!0),hteditor.setter("s",T)),E.addRow(F,[40,.1,40,20,80,20]).visible=function(){return!YE(WE[D],"material",!0)(E.data)}}(D)},F.prototype.addCubeProperties=function(){var E=this;this.addTitle("TitleFace");var F=void 0,D=void 0,g=0,f=new ht.widget.TabView;D=new ht.widget.FormPane;for(var T=0;T<WE.length;T++)!function(){var g=WE[T]+".image";F=[];var f=YE(WE[T],"image");E.addLabelImage(F,pE("editor.face."+WE[T]),function(F){var D=f(F),g=E.editor.getFileNode(D);return g?g.url:D},hteditor.setter("s",g)),D.addRow(F,[E.indent,.1,20])}();u(f,pE("editor.image"),D,!0),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane;for(var T=0;T<WE.length;T++){var a=WE[T]+".uv.scale";F=[],this.addLabel(F,pE("editor.face."+WE[T])),this.addButton(F,null,pE("editor.reset"),"editor.resetsize.state",HE(a)),this.addLabelInput(F,"U",oE(a),hE(a),"number",1),this.addLabelInput(F,"V",uE(a),UE(a),"number",1),D.addRow(F,[this.indent-20-8,20,20,.1,20,.1])}u(f,pE("editor.repeat"),D,!0),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane;for(var T=0;T<WE.length;T++){var K=WE[T]+".color";F=[],this.addLabelColor(F,pE("editor.face."+WE[T]),YE(WE[T],"color"),hteditor.setter("s",K)),D.addRow(F,[this.indent,.1])}u(f,pE("editor.color"),D),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane;for(var T=0;T<WE.length;T++){var b=WE[T]+".transparent";F=[],this.addLabelCheckBox(F,pE("editor.face."+WE[T]),YE(WE[T],"transparent"),hteditor.setter("s",b)),D.addRow(F,[this.indent,.1])}u(f,pE("editor.transparent"),D),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane;for(var T=0;T<WE.length;T++){var B=WE[T]+".visible";F=[],this.addLabelCheckBox(F,pE("editor.face."+WE[T]),YE(WE[T],"visible",!0),hteditor.setter("s",B)),D.addRow(F,[this.indent,.1])}u(f,pE("editor.visible"),D),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane;for(var T=0;T<WE.length;T++){var $=WE[T]+".reverse.color";F=[],this.addLabelColor(F,pE("editor.face."+WE[T]),YE(WE[T],"reverse.color"),hteditor.setter("s",$)),D.addRow(F,[this.indent,.1])}u(f,pE("editor.reversecolor"),D),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane;for(var T=0;T<WE.length;T++){var p=WE[T]+".reverse.flip";F=[],this.addLabelCheckBox(F,pE("editor.face."+WE[T]),YE(WE[T],"reverse.flip",!0),hteditor.setter("s",p)),D.addRow(F,[this.indent,.1])}u(f,pE("editor.reverseflip"),D),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane;for(var T=0;T<WE.length;T++){var W=WE[T]+".reverse.cull";F=[],this.addLabelCheckBox(F,pE("editor.face."+WE[T]),YE(WE[T],"reverse.cull",!0),hteditor.setter("s",W)),D.addRow(F,[this.indent,.1])}u(f,pE("editor.reversecull"),D),D.validateImpl(),g=Math.max(g,D.getScrollHeight());var Y=f.getTabHeight()+g;F=[],F.push(f),this.addRow(F,[.1],Y)},F}($E),ZE=hteditor.getString,mE=["shape3d","shape3d.top","shape3d.bottom","shape3d.from","shape3d.to"],rE=["shape3d","shape3d.top","shape3d.bottom"],sE=function(E){return function(F){var D=F.s(E);return D?D[0]:1}},kE=function(E){return function(F,D){var g=F.s(E);F.s(E,[D,g?g[1]:1])}},VE=function(E){return function(F){var D=F.s(E);return D?D[1]:1}},iE=function(E){return function(F,D){var g=F.s(E);F.s(E,[g?g[0]:1,D])}},jE=function(E){return function(F){F.s(E,null)}},nE=function(E){function F(D,g){return I(this,F),q(this,E.call(this,D,g||"Shape3d"))}return P(F,E),F.prototype.initForm=function(){E.prototype.initForm.call(this)},F.prototype.getCurrentPoint=function(E){return this.editor.currentPoint?this.editor.currentPoint[E]:0},F.prototype.setCurrentPoint=function(E,F){this.editor.gv.getEditInteractor().getSubModule("Curve").setCurrentPoint(E,F)},F.prototype.addTopBodyBottomProperties=function(){var E=this;this.addTitle("TitleFace");var F=void 0,D=void 0,g=0,f=new ht.widget.TabView,T=this.faces;D=new ht.widget.FormPane;for(var a=0;a<T.length;a++)!function(){var g=T[a]+".image",f=T[a]+".material";F=[],E.addLabelImageOrMaterial(F,ZE("editor.face."+T[a]),function(F){var D=faceGetter(T[a],"material")(F),g=E.editor.getFileNode(D);if(D)return g?g.url:f;var f=faceGetter(T[a],"image")(F),K=E.editor.getFileNode(f);return K?K.url:f},function(F,D){var T=E.editor.getFileNode(D);T&&"material"===T.fileType?(F.s(f,D),F.s(g,void 0)):(F.s(g,D),F.s(f,void 0),F.s("texture.cache")&&E.editor.scene.invalidateShape3dCachedImage(F))}),D.addRow(F,[E.indent,.1,20])}();u(f,ZE("editor.image"),D,!0),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane;for(var a=0;a<T.length;a++){var K=T[a]+".uv.scale";F=[],this.addLabel(F,ZE("editor.face."+T[a])),this.addButton(F,null,ZE("editor.reset"),"editor.resetsize.state",jE(K)),this.addLabelInput(F,"U",sE(K),kE(K),"number",1),this.addLabelInput(F,"V",VE(K),iE(K),"number",1),D.addRow(F,[this.indent-20-8,20,20,.1,20,.1])}u(f,ZE("editor.repeat"),D,!0),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane;for(var a=0;a<T.length;a++){var b=T[a]+".color";F=[],this.addLabelColor(F,ZE("editor.face."+T[a]),hteditor.getter("s",b),hteditor.setter("s",b)),D.addRow(F,[this.indent,.1,20])}u(f,ZE("editor.color"),D),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane;for(var a=0;a<T.length;a++){var B=T[a]+".visible";F=[],this.addLabelCheckBox(F,ZE("editor.face."+T[a]),hteditor.getter("s",B),hteditor.setter("s",B)),D.addRow(F,[this.indent,.1,20])}u(f,ZE("editor.visible"),D),D.validateImpl(),g=Math.max(g,D.getScrollHeight()),D=new ht.widget.FormPane,F=[],this.addLabelColor(F,ZE("editor.color"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),D.addRow(F,[this.indent,.1]),F=[],this.addLabelCheckBox(F,ZE("editor.flip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),D.addRow(F,[this.indent,.1]),F=[],this.addLabelCheckBox(F,ZE("editor.cull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),D.addRow(F,[this.indent,.1]),u(f,ZE("editor.reverse"),D),D.validateImpl(),g=Math.max(g,D.getScrollHeight());var $=f.getTabHeight()+g;F=[],F.push(f),this.addRow(F,[.1],$)},F.prototype.addEffectProperties=function(){this.addTitle("TitleEffect");var E=[];this.addLabelCheckBox(E,ZE("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(E,[this.indent,.1]),E=[],this.addLabelColor(E,ZE("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(E,[this.indent,.1]),E=[],this.addLabelRange(E,ZE("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(E,[this.indent,.1]),E=[],this.addLabelRange(E,ZE("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addRow(E,[this.indent,.1]),this.simple||(E=[],this.addLabelRange(E,ZE("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addRow(E,[this.indent,.1]),E=[],this.addLabelRange(E,ZE("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(E,[this.indent,.1]))},F.prototype.addExtraProperties=function(E){},N(F,[{key:"simple",get:function(){return!1}},{key:"faces",get:function(){return this.simple?rE:mE}}]),F}($E),yE=hteditor.getString,IE=["shape3d","shape3d.bottom","shape3d.from","shape3d.to"],NE=function(E,F,D){return function(g){var f=g.s(E+"."+F);return D&&void 0===f?g.s("shape3d."+F):f}},PE=function(E){function F(D,g){return I(this,F),q(this,E.call(this,D,g||"Cone"))}return P(F,E),F.prototype.$11$=function(){E.prototype.$11$.call(this),this.addEffectProperties()},F.prototype.addEffectProperties=function(){var E=[];this.addLabelRange(E,yE("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addLabelCheckBox(E,yE("editor.smooth"),hteditor.getter("s","shape3d.smooth"),hteditor.setter("s","shape3d.smooth")),this.addRow(E,[this.indent,.1,this.indent2,20]),E=[],this.addLabelRange(E,yE("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addLabelRange(E,yE("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(E,[this.indent,.1,this.indent2,.1])},F.prototype.addTransformProperties=function(){E.prototype.addTransformProperties.call(this),this.addShape3dImageVisibleProperties(),this.addShape3dColoruvScaleProperties(),this.addShape3dUvOffsetSelectProperties(),this.addShape3dUvAnchorRotationProperties(),this.addShape3dReverseColorFlipCullProperties()},F.prototype.addShape3dImageVisibleProperties=function(){var E=this;this.addTitle("TitleShape3dImageVisible");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){var f=F[g]+".image",T=F[g]+".material";D=[],E.addLabelImageOrMaterial(D,yE("editor.face."+F[g]),function(D){var f=NE(F[g],"material")(D),T=E.editor.getFileNode(f);if(f)return T?T.url:a;var a=NE(F[g],"image")(D),K=E.editor.getFileNode(a);return K?K.url:a},function(F,D){var g=E.editor.getFileNode(D);g&&"material"===g.fileType?(F.s(T,D),F.s(f,void 0)):(F.s(f,D),F.s(T,void 0),F.s("texture.cache")&&E.editor.scene.invalidateShape3dCachedImage(F)),E.filterPropertiesLater()});var a=F[g]+".visible";E.addLabelCheckBox(D,yE("editor.visible"),NE(F[g],"visible",!0),hteditor.setter("s",a)),E.addRow(D,[40,.1,20,40,20])}(g)},F.prototype.addShape3dColoruvScaleProperties=function(){var E=this;this.addTitle("TitleShape3dColoruvScale");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){var f=F[g]+".color";D=[],E.addLabelColor(D,yE("editor.face."+F[g]),NE(F[g],"color"),hteditor.setter("s",f));var T=F[g]+".uv.scale";E.addLabelInput(D,"U",function(E){var F=E.s(T);return F||(F=E.s("shape3d.scale")),F?F[0]:1},function(E,F){var D=E.s(T);D||(D=E.s("shape3d.scale")),E.s(T,[F,D?D[1]:1])},"number",1),E.addLabelInput(D,"V",function(E){var F=E.s(T);return F||(F=E.s("shape3d.scale")),F?F[1]:1},function(E,F){var D=E.s(T);D||(D=E.s("shape3d.scale")),E.s(T,[D?D[0]:1,F])},"number",1),E.addRow(D,[40,.1,20,.05,20,.05]).visible=function(){return!NE(F[g],"material")(E.data)}}(g)},F.prototype.addShape3dUvOffsetSelectProperties=function(){var E=this;this.addTitle("TitleShape3dUvOffsetSelect");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){var f=F[g]+".uv.offset";D=[],E.addLabel(D,yE("editor.face."+F[g])),E.addLabelInput(D,"U",function(E){var F=E.s(f);return F||(F=E.s("shape3d.offset")),F?F[0]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.offset")),E.s(f,[F,D?D[1]:0])},"number",.1),E.addLabelInput(D,"V",function(E){var F=E.s(f);return F||(F=E.s("shape3d.offset")),F?F[1]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.offset")),E.s(f,[D?D[0]:0,F])},"number",.1);var T=F[g]+".discard.selectable";E.addLabelCheckBox(D,yE("editor.discardselectable"),NE(F[g],"discard.selectable",!0),hteditor.setter("s",T)),E.addRow(D,[40,20,.1,20,.1,E.indent,20]).visible=function(){return!NE(F[g],"material")(E.data)}}(g)},F.prototype.addShape3dUvAnchorRotationProperties=function(){var E=this;this.addTitle("TitleShape3dUvAnchorRotation");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){D=[],E.addLabel(D,yE("editor.face."+F[g]));var f=F[g]+".uv.anchor";E.addLabelInput(D,"U",function(E){var F=E.s(f);return F||(F=E.s("shape3d.anchor")),F?F[0]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.anchor")),E.s(f,[F,D?D[1]:0])},"number",.01),E.addLabelInput(D,"V",function(E){var F=E.s(f);return F||(F=E.s("shape3d.anchor")),F?F[1]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.anchor")),E.s(f,[D?D[0]:0,F])},"number",.01);var T=F[g]+".uv.rotation";E.addLabelInput(D,"R",hteditor.getter("s",T),hteditor.setter("s",T),"number",.1),E.addRow(D,[40,20,.1,20,.1,20,.1]).visible=function(){return!NE(F[g],"material")(E.data)}}(g)},F.prototype.addShape3dReverseColorFlipCullProperties=function(){var E=this;this.addTitle("TitleShape3dReverseColorFlipCull");var F=(this.faces,[]);F=[],this.addLabelColor(F,yE("editor.face.shape3d"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color"));this.addLabelCheckBox(F,yE("editor.flip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip"));this.addLabelCheckBox(F,yE("editor.cull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addRow(F,[40,.1,40,20,40,20]).visible=function(){return!NE("shape3d","material")(E.data)}},N(F,[{key:"faces",get:function(){return IE}}]),F}(nE),qE=hteditor.getString,RE=["shape3d","shape3d.top","shape3d.bottom","shape3d.from","shape3d.to"],QE=function(E,F,D){return function(g){var f=g.s(E+"."+F);return D&&void 0===f?g.s("shape3d."+F):f}},dE=function(E){function F(D,g){return I(this,F),q(this,E.call(this,D,g||"Cylinder"))}return P(F,E),F.prototype.$11$=function(){E.prototype.$11$.call(this),this.addEffectProperties()},F.prototype.addEffectProperties=function(){var E=[];this.addLabelRange(E,qE("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addLabelCheckBox(E,qE("editor.smooth"),hteditor.getter("s","shape3d.smooth"),hteditor.setter("s","shape3d.smooth")),this.addRow(E,[this.indent,.1,this.indent2,20]),E=[],this.addLabelRange(E,qE("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addLabelRange(E,qE("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(E,[this.indent,.1,this.indent2,.1])},F.prototype.addTransformProperties=function(){E.prototype.addTransformProperties.call(this),this.addShape3dImageVisibleProperties(),this.addShape3dColoruvScaleProperties(),this.addShape3dUvOffsetSelectProperties(),this.addShape3dUvAnchorRotationProperties(),this.addShape3dReverseColorFlipCullProperties()},F.prototype.addShape3dImageVisibleProperties=function(){var E=this;this.addTitle("TitleShape3dImageVisible");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){var f=F[g]+".image",T=F[g]+".material";D=[],E.addLabelImageOrMaterial(D,qE("editor.face."+F[g]),function(D){var f=QE(F[g],"material")(D),T=E.editor.getFileNode(f);if(f)return T?T.url:a;var a=QE(F[g],"image")(D),K=E.editor.getFileNode(a);return K?K.url:a},function(F,D){var g=E.editor.getFileNode(D);g&&"material"===g.fileType?(F.s(T,D),F.s(f,void 0)):(F.s(f,D),F.s(T,void 0),F.s("texture.cache")&&E.editor.scene.invalidateShape3dCachedImage(F)),E.filterPropertiesLater()});var a=F[g]+".visible";E.addLabelCheckBox(D,qE("editor.visible"),QE(F[g],"visible",!0),hteditor.setter("s",a)),E.addRow(D,[40,.1,20,40,20])}(g)},F.prototype.addShape3dColoruvScaleProperties=function(){var E=this;this.addTitle("TitleShape3dColoruvScale");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){var f=F[g]+".color";D=[],E.addLabelColor(D,qE("editor.face."+F[g]),QE(F[g],"color"),hteditor.setter("s",f));var T=F[g]+".uv.scale";E.addLabelInput(D,"U",function(E){var F=E.s(T);return F||(F=E.s("shape3d.scale")),F?F[0]:1},function(E,F){var D=E.s(T);D||(D=E.s("shape3d.scale")),E.s(T,[F,D?D[1]:1])},"number",1),E.addLabelInput(D,"V",function(E){var F=E.s(T);return F||(F=E.s("shape3d.scale")),F?F[1]:1},function(E,F){var D=E.s(T);D||(D=E.s("shape3d.scale")),E.s(T,[D?D[0]:1,F])},"number",1),E.addRow(D,[40,.1,20,.05,20,.05]).visible=function(){return!QE(F[g],"material")(E.data)}}(g)},F.prototype.addShape3dUvOffsetSelectProperties=function(){var E=this;this.addTitle("TitleShape3dUvOffsetSelect");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){var f=F[g]+".uv.offset";D=[],E.addLabel(D,qE("editor.face."+F[g])),E.addLabelInput(D,"U",function(E){var F=E.s(f);return F||(F=E.s("shape3d.offset")),F?F[0]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.offset")),E.s(f,[F,D?D[1]:0])},"number",.1),E.addLabelInput(D,"V",function(E){var F=E.s(f);return F||(F=E.s("shape3d.offset")),F?F[1]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.offset")),E.s(f,[D?D[0]:0,F])},"number",.1);var T=F[g]+".discard.selectable";E.addLabelCheckBox(D,qE("editor.discardselectable"),QE(F[g],"discard.selectable",!0),hteditor.setter("s",T)),E.addRow(D,[40,20,.1,20,.1,E.indent,20]).visible=function(){return!QE(F[g],"material")(E.data)}}(g)},F.prototype.addShape3dUvAnchorRotationProperties=function(){var E=this;this.addTitle("TitleShape3dUvAnchorRotation");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){D=[],E.addLabel(D,qE("editor.face."+F[g]));var f=F[g]+".uv.anchor";E.addLabelInput(D,"U",function(E){var F=E.s(f);return F||(F=E.s("shape3d.anchor")),F?F[0]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.anchor")),E.s(f,[F,D?D[1]:0])},"number",.01),E.addLabelInput(D,"V",function(E){var F=E.s(f);return F||(F=E.s("shape3d.anchor")),F?F[1]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.anchor")),E.s(f,[D?D[0]:0,F])},"number",.01);var T=F[g]+".uv.rotation";E.addLabelInput(D,"R",hteditor.getter("s",T),hteditor.setter("s",T),"number",.1),E.addRow(D,[40,20,.1,20,.1,20,.1]).visible=function(){return!QE(F[g],"material")(E.data)}}(g)},F.prototype.addShape3dReverseColorFlipCullProperties=function(){var E=this;this.addTitle("TitleShape3dReverseColorFlipCull");var F=(this.faces,[]);F=[],this.addLabelColor(F,qE("editor.face.shape3d"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color"));this.addLabelCheckBox(F,qE("editor.flip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip"));this.addLabelCheckBox(F,qE("editor.cull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addRow(F,[40,.1,40,20,40,20]).visible=function(){return!QE("shape3d","material")(E.data)}},N(F,[{key:"faces",get:function(){return RE}}]),F}(nE),_E=hteditor.getString,CE=["shape3d","shape3d.from","shape3d.to"],SE=function(E){function F(D,g){return I(this,F),q(this,E.call(this,D,g||"Sphere"))}return P(F,E),F.prototype.addEffectProperties=function(){var E=[];this.addLabelRange(E,_E("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addLabelRange(E,_E("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,void 0,1,"int"),this.addLabelCheckBox(E,_E("editor.smooth"),hteditor.getter("s","shape3d.smooth"),hteditor.setter("s","shape3d.smooth")),this.addRow(E,[this.indent,.1,this.indent2,.1,this.indent2,20]),E=[],this.addLabelRange(E,_E("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addLabelRange(E,_E("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(E,[this.indent,.1,this.indent2,.1])},N(F,[{key:"faces",get:function(){return CE}}]),F}(dE),JE=hteditor.getString,OE=function(E){function F(D,g){return I(this,F),q(this,E.call(this,D,g||"Sphere"))}return P(F,E),F.prototype.initForm=function(){this.addCustomProperties(),this.$11$(),this.addLightProperties(),this.addTransformProperties()},
F.prototype.$11$=function(){var E=this;this.addTitle("TitleBasic"),this.addEventProperties();var F=[];this.addLabelInput(F,JE("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(F,JE("editor.tag"),hteditor.getter("p","tag"),function(F,D){if(m.config.checkTagConflicts&&D)for(var g=E.dataModel.getDatas(),f=g.size()-1;f>=0;f--){var T=g.get(f);if(T!==F&&T.getTag()===D)return E.editor.messageView.show(i(JE("editor.errormessage.tagalreadyexists"),D),"error"),void E.$34$()}F.setTag(D)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelInput(F,JE("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(F,[this.indent,.1]),F=[],this.addLabelCheckBox(F,JE("editor.selectable"),function(E){return E.s("3d.selectable")},function(E,F){E.s("2d.selectable",F),E.s("3d.selectable",F)}),this.addLabelCheckBox(F,JE("editor.movable"),function(E){return E.s("3d.movable")},function(E,F){E.s("2d.movable",F),E.s("3d.movable",F)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelCheckBox(F,JE("editor.editable"),function(E){return E.s("3d.editable")},function(E,F){E.s("2d.editable",F),E.s("3d.editable",F)}),this.addLabelCheckBox(F,JE("editor.visible"),function(E){return E.s("3d.visible")},function(E,F){E.s("2d.visible",F),E.s("3d.visible",F)}),this.addRow(F,[this.indent,.1,this.indent2,.1])},F.prototype.addLightProperties=function(){var E=this,F=m.config.numberPrecision,D=[];this.addLabelComboBox(D,JE("editor.type"),hteditor.getter("s","light.type"),function(F,D){F.s("light.type",D),E.editor.updateInspector()},["point","spot","directional"],[JE("editor.light.point"),JE("editor.light.spot"),JE("editor.light.directional")]),this.addLabelCheckBox(D,JE("editor.disabled"),hteditor.getter("s","light.disabled"),hteditor.setter("s","light.disabled")),this.addRow(D,[this.indent,.1,this.indent2,.1]),D=[],this.addLabelColor(D,JE("editor.color"),hteditor.getter("s","light.color"),hteditor.setter("s","light.color")),this.addLabelRange(D,JE("editor.strength"),hteditor.getter("s","light.intensity"),hteditor.setter("s","light.intensity"),0,void 0,.01,"number"),this.addRow(D,[this.indent,.1,this.indent2,.1]),D=[],this.addLabelRange(D,JE("editor.range"),hteditor.getter("s","light.range"),hteditor.setter("s","light.range"),0,void 0,1,"number"),this.addRow(D,[this.indent,.1]).visible=function(E){return"directional"!==E.data.s("light.type")},D=[],this.addLabelRange(D,JE("editor.light.angle"),function(E){return Number((180/Math.PI*E.s("light.angle")).toFixed(0))},function(E,F){E.s("light.angle",F*Math.PI/180)},0,180,1,"number"),this.addLabelRange(D,JE("editor.dampingexponent"),hteditor.getter("s","light.exponent"),hteditor.setter("s","light.exponent"),0,void 0,1,"number"),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=function(E){return"spot"===E.data.s("light.type")},D=[],D.push(JE("editor.center")),this.addButton(D,null,JE("editor.reset"),"editor.resetsize.state",function(E){E.s("light.center",[0,0,0])});var g=F.position||0,f=0===g?"int":"number",T=1/Math.pow(10,g);this.addLabelInput(D,"X",function(E){return Number(E.s("light.center")[0].toFixed(g))},function(E,F){var D=ht.Default.clone(E.s("light.center"));D[0]=parseFloat(F),E.s("light.center",D)},f,T),this.addLabelInput(D,"Y",function(E){return Number(E.s("light.center")[1].toFixed(g))},function(E,F){var D=ht.Default.clone(E.s("light.center"));D[1]=parseFloat(F),E.s("light.center",D)},f,T),this.addLabelInput(D,"Z",function(E){return Number(E.s("light.center")[2].toFixed(g))},function(E,F){var D=ht.Default.clone(E.s("light.center"));D[2]=parseFloat(F),E.s("light.center",D)},f,T),this.addRow(D,[this.indent-40-8,20,20,.1,20,.1,20,.1]).visible=function(E){return"spot"===E.data.s("light.type")},D=[];var a=this.addLabelComboBox(D,JE("editor.group"),hteditor.getter("s","light.group"),hteditor.setter("s","light.group"),[0],[JE("editor.default")]);this.addRow(D,[this.indent,.1]),a.getLabels=function(){var F=E.editor.dm;if(!F)return[JE("editor.default")];var D=F.a("sceneLightGruopAlias");if(!D)return[JE("editor.default")];var g=ht.Default.clone(D);return[JE("editor.default")].concat(Object.values(g))},a.getValues=function(){var F=E.editor.dm;if(!F)return[JE("editor.default")];var D=F.a("sceneLightGruopAlias");if(!D)return[0];var g=ht.Default.clone(D),f=[0];return Object.keys(g).forEach(function(E){f.push(Number(E))}),f}},F}($E),LE=hteditor.getString,ME=function(E){function F(D,g){return I(this,F),q(this,E.call(this,D,g||"Torus"))}return P(F,E),F.prototype.addEffectProperties=function(){var E=[];this.addLabelRange(E,LE("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addLabelCheckBox(E,LE("editor.smooth"),hteditor.getter("s","shape3d.smooth"),hteditor.setter("s","shape3d.smooth")),this.addRow(E,[this.indent,.1,this.indent2,20]),E=[],this.addLabelRange(E,LE("editor.torus.radius"),hteditor.getter("s","shape3d.torus.radius"),hteditor.setter("s","shape3d.torus.radius"),0,.25,.001,"number"),this.addLabelRange(E,LE("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,void 0,1,"int"),this.addRow(E,[this.indent,.1,this.indent2,.1]),E=[],this.addLabelRange(E,LE("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addLabelRange(E,LE("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(E,[this.indent,.1,this.indent2,.1])},F}(SE),GE=hteditor.getString,cE=["shape3d","shape3d.top","shape3d.bottom"],lE=function(E,F,D){return function(g){var f=g.s(E+"."+F);return D&&void 0===f?g.s("shape3d."+F):f}},xE=function(E){function F(D,g){return I(this,F),q(this,E.call(this,D,g||"Rect"))}return P(F,E),F.prototype.$11$=function(){E.prototype.$11$.call(this)},F.prototype.addTransformProperties=function(){E.prototype.addTransformProperties.call(this),this.addShape3dImageVisibleProperties(),this.addShape3dColoruvScaleProperties(),this.addShape3dUvOffsetSelectProperties(),this.addShape3dUvAnchorRotationProperties(),this.addShape3dReverseColorFlipCullProperties()},F.prototype.addShape3dImageVisibleProperties=function(){var E=this;this.addTitle("TitleShape3dImageVisible");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){var f=F[g]+".image",T=F[g]+".material";D=[],E.addLabelImageOrMaterial(D,GE("editor.face."+F[g]),function(D){var f=lE(F[g],"material")(D),T=E.editor.getFileNode(f);if(f)return T?T.url:a;var a=lE(F[g],"image")(D),K=E.editor.getFileNode(a);return K?K.url:a},function(F,D){var g=E.editor.getFileNode(D);g&&"material"===g.fileType?(F.s(T,D),F.s(f,void 0)):(F.s(f,D),F.s(T,void 0),F.s("texture.cache")&&E.editor.scene.invalidateShape3dCachedImage(F)),E.filterPropertiesLater()});var a=F[g]+".visible";E.addLabelCheckBox(D,GE("editor.visible"),lE(F[g],"visible",!0),hteditor.setter("s",a)),E.addRow(D,[40,.1,20,40,20])}(g)},F.prototype.addShape3dColoruvScaleProperties=function(){var E=this;this.addTitle("TitleShape3dColoruvScale");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){var f=F[g]+".color";D=[],E.addLabelColor(D,GE("editor.face."+F[g]),lE(F[g],"color"),hteditor.setter("s",f));var T=F[g]+".uv.scale";E.addLabelInput(D,"U",function(E){var F=E.s(T);return F||(F=E.s("shape3d.scale")),F?F[0]:1},function(E,F){var D=E.s(T);D||(D=E.s("shape3d.scale")),E.s(T,[F,D?D[1]:1])},"number",1),E.addLabelInput(D,"V",function(E){var F=E.s(T);return F||(F=E.s("shape3d.scale")),F?F[1]:1},function(E,F){var D=E.s(T);D||(D=E.s("shape3d.scale")),E.s(T,[D?D[0]:1,F])},"number",1),E.addRow(D,[40,.1,20,.05,20,.05]).visible=function(){return!lE(F[g],"material")(E.data)}}(g)},F.prototype.addShape3dUvOffsetSelectProperties=function(){var E=this;this.addTitle("TitleShape3dUvOffsetSelect");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){var f=F[g]+".uv.offset";D=[],E.addLabel(D,GE("editor.face."+F[g])),E.addLabelInput(D,"U",function(E){var F=E.s(f);return F||(F=E.s("shape3d.offset")),F?F[0]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.offset")),E.s(f,[F,D?D[1]:0])},"number",.1),E.addLabelInput(D,"V",function(E){var F=E.s(f);return F||(F=E.s("shape3d.offset")),F?F[1]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.offset")),E.s(f,[D?D[0]:0,F])},"number",.1);var T=F[g]+".discard.selectable";E.addLabelCheckBox(D,GE("editor.discardselectable"),lE(F[g],"discard.selectable",!0),hteditor.setter("s",T)),E.addRow(D,[40,20,.1,20,.1,E.indent,20]).visible=function(){return!lE(F[g],"material")(E.data)}}(g)},F.prototype.addShape3dUvAnchorRotationProperties=function(){var E=this;this.addTitle("TitleShape3dUvAnchorRotation");for(var F=this.faces,D=[],g=0;g<F.length;g++)!function(g){D=[],E.addLabel(D,GE("editor.face."+F[g]));var f=F[g]+".uv.anchor";E.addLabelInput(D,"U",function(E){var F=E.s(f);return F||(F=E.s("shape3d.anchor")),F?F[0]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.anchor")),E.s(f,[F,D?D[1]:0])},"number",.01),E.addLabelInput(D,"V",function(E){var F=E.s(f);return F||(F=E.s("shape3d.anchor")),F?F[1]:0},function(E,F){var D=E.s(f);D||(D=E.s("shape3d.anchor")),E.s(f,[D?D[0]:0,F])},"number",.01);var T=F[g]+".uv.rotation";E.addLabelInput(D,"R",hteditor.getter("s",T),hteditor.setter("s",T),"number",.1),E.addRow(D,[40,20,.1,20,.1,20,.1]).visible=function(){return!lE(F[g],"material")(E.data)}}(g)},F.prototype.addShape3dReverseColorFlipCullProperties=function(){var E=this;this.addTitle("TitleShape3dReverseColorFlipCull");var F=(this.faces,[]);F=[],this.addLabelColor(F,GE("editor.face.shape3d"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color"));this.addLabelCheckBox(F,GE("editor.flip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip"));this.addLabelCheckBox(F,GE("editor.cull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addRow(F,[40,.1,40,20,40,20]).visible=function(){return!lE("shape3d","material")(E.data)}},N(F,[{key:"faces",get:function(){return cE}}]),F}(nE),zE=hteditor.getString,XE=ht.Default.getShape3dModel,wE=ht.Default.clone,eE=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"Model"))}return P(F,E),F.prototype.addTransformProperties=function(){var F=this;E.prototype.addTransformProperties.call(this);var D=[];this.addButton(D,zE("editor.resetposition"),null,null,function(E){var D=XE(E.s("shape3d"));D&&D.center&&(F.editor.beginTransaction(),E.setAnchor3d(.5,.5,.5),E.p3(D.center),F.editor.endTransaction())}),this.addRow(D,[.1]).visible=function(){var E=F.editor.ld;if(!E)return!1;var D=XE(E.s("shape3d"));return D&&D.center};var g=function(){var E=F.data,D=XE(E.s("shape3d"));if(D)return!D.model3d};this.addTitle("TitleShape3dStyle").visible=g,D=[],this.addLabelImageOrMaterial(D,zE("editor.imageormaterial"),function(E){var D=E.s("shape3d.material"),g=F.editor.getFileNode(D);if(D)return g?g.url:f;var f=E.s("shape3d.image"),T=F.editor.getFileNode(f);return T?T.url:f},function(E,D){var g=F.editor.getFileNode(D);g&&"material"===g.fileType?(E.s("shape3d.material",D),E.s("shape3d.image",void 0),E.setImage(void 0)):(E.s("shape3d.image",D),E.s("shape3d.material",void 0),E.setImage(D),E.s("texture.cache")&&F.editor.scene.invalidateShape3dCachedImage(E)),F.filterPropertiesLater()}),this.addOneRow(D);var f=function(){return!F.data.s("shape3d.material")};D=[],this.addLabelColor(D,zE("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addLabelCheckBox(D,zE("editor.discardselectable"),hteditor.getter("s","shape3d.discard.selectable"),hteditor.setter("s","shape3d.discard.selectable")),this.addRow(D,[this.indent,.1,this.indent,20]).visible=f,D=[],this.addLabelColor(D,zE("editor.reversecolor"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(D,[this.indent,.1]).visible=f,D=[],this.addLabelCheckBox(D,zE("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(D,zE("editor.reverseflip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=f,D=[],this.addLabelInput(D,zE("editor.uvrotation"),function(E){var F=E.s("shape3d.uv.rotation")||0;return Number((180/Math.PI*F).toFixed(1))},function(E,F){E.s("shape3d.uv.rotation",F*Math.PI/180)},"number",1),this.addRow(D,[this.indent,.1]).visible=f,D=[],D.push(zE("editor.uvscale")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.scale")||[1,1];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.scale"))||[1,1];D[0]=Number(F),E.s("shape3d.uv.scale",D)},"number",1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.scale")||[1,1];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.scale"))||[1,1];D[1]=Number(F),E.s("shape3d.uv.scale",D)},"number",1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=f,D=[],D.push(zE("editor.uvoffset")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.offset")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.offset"))||[0,0];D[0]=Number(F),E.s("shape3d.uv.offset",D)},"number",.1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.offset")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.offset"))||[0,0];D[1]=Number(F),E.s("shape3d.uv.offset",D)},"number",.1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=f,D=[],D.push(zE("editor.uvanchor")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.anchor")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.anchor"))||[0,0];D[0]=Number(F),E.s("shape3d.uv.anchor",D)},"number",.01),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.anchor")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.anchor"))||[0,0];D[1]=Number(F),E.s("shape3d.uv.anchor",D)},"number",.01),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=f,this.addMatDefProperty()},F.prototype.addMatDefProperty=function(){var E=this,F=function(){var F=E.data,D=XE(F.s("shape3d"));if(D)return!!D.model3d};this.addTitle("TitleMaterialList").visible=F;var D=this._initMaterialsInspector(),g=this._materialsRow=this.addRow([D],[.1],2);this.updateHandlers.push(function(){if(!g.items.hidden){var F=E.data,f=F.s("matDef"),T=XE(F.s("shape3d"));T?D.data._rawMatDef=T.matDef:T={};var a=Object.assign(wE(T.matDef||{}),f);E._isMatDefChange(a)&&E._updateMaterials(a)}})},F.prototype._isMatDefChange=function(E){var F=this._materialsInspector,D=F._matDef?JSON.parse(F._matDef):{},g=!1;if(JSON.stringify(E)===F._matDef)return g;for(var f in E)if(Y(E[f])){if(!Y(D[f]))return g=!0}else if(E[f]!==D[f])return g=!0;return g},F.prototype._initMaterialsInspector=function(){var E=this,F=this._materialsInspector=new fE(this.editor,"materiallist");F.setPadding(0);var D=new ht.Data;return D.onPropertyChanged=function(F){if(!D._updatingObjProperties){var g=F.property,f=F.newValue;if(g.startsWith("a:")){if(void 0===f){var T=g.split(":")[1];D.getAttrObject()[""+T]=E._materialsInspector.data._rawMatDef[T]}E._updateMatDef()}}},F.data=D,F},F.prototype._updateMaterials=function(E){var F=this._materialsInspector;F._matDef=JSON.stringify(E),F.data.setAttrObject(E);var D=F.indent;F.clear(),F.updateHandlers=[];for(var g in E)!function(E){var g=[],f=function(E,F){return!!F.view.draggingData&&"material"===F.view.draggingData.fileType};F.addLabelTooltip(g,E),F.addURL(g,function(D){return Y(F.data.a(E))?"":F.data.a(E)},function(D,g){void 0===g&&Y(F.data.a(E))||F.data.a(E,g)},f),F.addImage(g,function(F){return F.a(E)},void 0,function(E){return b(E)?E.substr(0,E.length-5)+".png":null}),F.addRow(g,[D,.1,20])}(g);F.$46$=F._rows,F.filterProperties(),F.setRowHeight(this.getRowHeight()),F.setVGap(this.getVGap());var f=F.getRows().length;this._materialsRow.height=f?f*(F.getRowHeight()+F.getHGap())-F.getHGap():2,this.filterPropertiesLater()},F.prototype._updateMatDef=function(){var E=this._materialsInspector.data.getAttrObject(),F=this.data,D={};for(var g in E)Y(E[g])||""===E[g]||E[g]===this._materialsInspector.data._rawMatDef[g]||(D[g]=E[g]);this._materialsInspector._matDef=JSON.stringify(Object.assign(wE(this._materialsInspector.data._rawMatDef),D)),F.s("matDef",D),this._materialsInspector.filterPropertiesLater()},F}($E),AE=hteditor.getString,vE=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"Box"))}return P(F,E),F.prototype.addTransformProperties=function(){var F=this;E.prototype.addTransformProperties.call(this),this.addTitle("TitleShape3dStyle");var D=[];this.addLabelImageOrMaterial(D,AE("editor.imageormaterial"),function(E){var D=E.s("shape3d.material"),g=F.editor.getFileNode(D);if(D)return g?g.url:f;var f=E.s("shape3d.image"),T=F.editor.getFileNode(f);return T?T.url:f},function(E,D){var g=F.editor.getFileNode(D);g&&"material"===g.fileType?(E.s("shape3d.material",D),E.s("shape3d.image",void 0),E.setImage(void 0)):(E.s("shape3d.image",D),E.s("shape3d.material",void 0),E.setImage(D),E.s("texture.cache")&&F.editor.scene.invalidateShape3dCachedImage(E)),F.filterPropertiesLater()}),this.addOneRow(D);var g=function(){return!F.data.s("shape3d.material")};D=[],this.addLabelColor(D,AE("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addLabelCheckBox(D,AE("editor.discardselectable"),hteditor.getter("s","shape3d.discard.selectable"),hteditor.setter("s","shape3d.discard.selectable")),this.addRow(D,[this.indent,.1,this.indent,20]).visible=g,D=[],this.addLabelColor(D,AE("editor.reversecolor"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(D,[this.indent,.1]).visible=g,D=[],this.addLabelCheckBox(D,AE("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(D,AE("editor.reverseflip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=g,D=[],this.addLabelInput(D,AE("editor.uvrotation"),function(E){var F=E.s("shape3d.uv.rotation")||0;return Number((180/Math.PI*F).toFixed(1))},function(E,F){E.s("shape3d.uv.rotation",F*Math.PI/180)},"number",1),this.addRow(D,[this.indent,.1]).visible=g,D=[],D.push(AE("editor.uvscale")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.scale")||[1,1];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.scale"))||[1,1];D[0]=Number(F),E.s("shape3d.uv.scale",D)},"number",1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.scale")||[1,1];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.scale"))||[1,1];D[1]=Number(F),E.s("shape3d.uv.scale",D)},"number",1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=g,D=[],D.push(AE("editor.uvoffset")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.offset")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.offset"))||[0,0];D[0]=Number(F),E.s("shape3d.uv.offset",D)},"number",.1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.offset")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.offset"))||[0,0];D[1]=Number(F),E.s("shape3d.uv.offset",D)},"number",.1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=g,D=[],D.push(AE("editor.uvanchor")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.anchor")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.anchor"))||[0,0];D[0]=Number(F),E.s("shape3d.uv.anchor",D)},"number",.01),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.anchor")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.anchor"))||[0,0];D[1]=Number(F),E.s("shape3d.uv.anchor",D)},"number",.01),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=g},F}($E),EF=hteditor.getString,FF=hteditor.getter,DF=hteditor.setter,gF=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"Billboard"))}return P(F,E),F.prototype.addTransformProperties=function(){var F=this;E.prototype.addTransformProperties.call(this),this.addTitle("TitleShape3dStyle");var D=[];this.addLabelImageOrMaterial(D,EF("editor.imageormaterial"),function(E){var D=E.s("shape3d.material"),g=F.editor.getFileNode(D);if(D)return g?g.url:f;var f=E.s("shape3d.image"),T=F.editor.getFileNode(f);return T?T.url:f},function(E,D){var g=F.editor.getFileNode(D);g&&"material"===g.fileType?(E.s("shape3d.material",D),E.s("shape3d.image",void 0),E.setImage(void 0)):(E.s("shape3d.image",D),E.s("shape3d.material",void 0),E.setImage(D),E.s("texture.cache")&&F.editor.scene.invalidateShape3dCachedImage(E)),F.filterPropertiesLater()}),this.addOneRow(D);var g=function(){return!F.data.s("shape3d.material")};D=[],this.addLabelColor(D,EF("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addLabelCheckBox(D,EF("editor.discardselectable"),hteditor.getter("s","shape3d.discard.selectable"),hteditor.setter("s","shape3d.discard.selectable")),this.addRow(D,[this.indent,.1,this.indent,20]).visible=g,D=[],this.addLabelColor(D,EF("editor.reversecolor"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(D,[this.indent,.1]).visible=g,D=[],this.addLabelCheckBox(D,EF("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(D,EF("editor.reverseflip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=g,D=[],this.addLabelInput(D,EF("editor.uvrotation"),function(E){var F=E.s("shape3d.uv.rotation")||0;return Number((180/Math.PI*F).toFixed(1))},function(E,F){E.s("shape3d.uv.rotation",F*Math.PI/180)},"number",1),this.addRow(D,[this.indent,.1]).visible=g,D=[],D.push(EF("editor.uvscale")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.scale")||[1,1];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.scale"))||[1,1];D[0]=Number(F),E.s("shape3d.uv.scale",D)},"number",1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.scale")||[1,1];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.scale"))||[1,1];D[1]=Number(F),E.s("shape3d.uv.scale",D)},"number",1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=g,D=[],D.push(EF("editor.uvoffset")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.offset")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.offset"))||[0,0];D[0]=Number(F),E.s("shape3d.uv.offset",D)},"number",.1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.offset")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.offset"))||[0,0];D[1]=Number(F),E.s("shape3d.uv.offset",D)},"number",.1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=g,D=[],D.push(EF("editor.uvanchor")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.anchor")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.anchor"))||[0,0];D[0]=Number(F),E.s("shape3d.uv.anchor",D)},"number",.01),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.anchor")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.anchor"))||[0,0];D[1]=Number(F),E.s("shape3d.uv.anchor",D)},"number",.01),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=g,this.addTitle("TitleEffectFlow"),D=[],this.addLabelCheckBox(D,EF("editor.effect.flowenable"),hteditor.getter("s","effect.flow"),hteditor.setter("s","effect.flow"));var f=this.addLabelComboBox(D,EF("editor.group"),hteditor.getter("s","effect.flow.group"),hteditor.setter("s","effect.flow.group"),[0],[EF("editor.default")]);this.addRow(D,[this.indent,.1,this.indent2,.1]),f.getLabels=function(){var E=F.editor.dm;if(!E)return[EF("editor.default")];var D=E.a("sceneFlowEffectGroupAlias");if(!D)return[EF("editor.default")];var g=ht.Default.clone(D);return[EF("editor.default")].concat(Object.values(g))},f.getValues=function(){var E=F.editor.dm;if(!E)return[EF("editor.default")];var D=E.a("sceneFlowEffectGroupAlias");if(!D)return[0];var g=ht.Default.clone(D),f=[0];return Object.keys(g).forEach(function(E){f.push(Number(E))}),f},D=[];var T=ht.Default.clone(hteditor.config.gradients);T[0]=EF("editor.effect.flowgradient.defaultvalue"),this.addLabelComboBox(D,EF("editor.gradient"),hteditor.getter("s","effect.flow.gradient"),hteditor.setter("s","effect.flow.gradient"),hteditor.config.gradients,T,hteditor.config.gradientIcons),this.addLabelComboBox(D,EF("editor.effect.flowuvshape"),hteditor.getter("s","effect.flow.uvshape"),hteditor.setter("s","effect.flow.uvshape"),["rect","circle","polygon3","polygon4","polygon8"],[EF("editor.effect.flowuvshape.rect"),EF("editor.effect.flowuvshape.circle"),EF("editor.effect.flowuvshape.polygon3"),EF("editor.effect.flowuvshape.polygon4"),EF("editor.effect.flowuvshape.polygon8")]),this.addRow(D,[this.indent,.1,this.indent2,.1]),D=[],this.addLabelColor(D,EF("editor.blend"),FF("s","effect.flow.blend"),DF("s","effect.flow.blend")),this.addLabelComboBox(D,EF("editor.effect.flowsize"),hteditor.getter("s","effect.flow.size"),hteditor.setter("s","effect.flow.size"),[128,256,512,1024,2048,4096,8192],[EF("editor.effect.flowsize.128"),EF("editor.effect.flowsize.256"),EF("editor.effect.flowsize.512"),EF("editor.effect.flowsize.1024"),EF("editor.effect.flowsize.2048"),EF("editor.effect.flowsize.4096"),EF("editor.effect.flowsize.8192")]),this.addRow(D,[this.indent,.1,this.indent2,.1]),D=[],this.addLabelSlider(D,EF("editor.effect.flowintensity"),hteditor.getter("s","effect.flow.intensity"),hteditor.setter("s","effect.flow.intensity"),0,1,.001),this.addInput(D,hteditor.getter("s","effect.flow.intensity"),hteditor.setter("s","effect.flow.intensity"),"number"),this.addRow(D,[this.indent,.1,76])},F.prototype.addReflectorProperties=function(){var E=this;this.addTitle("TitleReflector");var F=function(E){return!!E.data.s("shape3d.reflector")},D=[];this.addLabelCheckBox(D,EF("editor.reflector"),FF("s","shape3d.reflector"),function(F,D){F.s("shape3d.reflector",D),E.editor.inspector.filterPropertiesLater()}),this.addLabelCheckBox(D,EF("editor.reflectable"),hteditor.getter("s","3d.reflectable"),hteditor.setter("s","3d.reflectable")),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=function(E){return!E.data.s("shape3d.reflector")},D=[],this.addLabelCheckBox(D,EF("editor.reflector"),FF("s","shape3d.reflector"),function(F,D){F.s("shape3d.reflector",D),E.editor.inspector.filterPropertiesLater()}),this.addLabelRange(D,EF("editor.reflectorblur"),FF("s","shape3d.reflector.blur"),DF("s","shape3d.reflector.blur"),0,void 0,.1,"number"),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=F,D=[],this.addLabelColor(D,EF("editor.background"),FF("s","shape3d.reflector.background"),DF("s","shape3d.reflector.background")),this.addLabelColor(D,EF("editor.reflectorcolor"),FF("s","shape3d.reflector.color"),DF("s","shape3d.reflector.color")),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=F},F}($E),fF=hteditor.getString,TF=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"Wall"))}return P(F,E),F.prototype.$11$=function(){E.prototype.$11$.call(this);var F=[];this.addLabelCheckBox(F,fF("editor.closepath"),hteditor.getter("p","closePath"),hteditor.setter("p","closePath")),this.addRow(F,[this.indent,.1])},F.prototype.addTransformProperties=function(){E.prototype.addTransformProperties.call(this);var F=[];this.addLabelRange(F,fF("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(F,fF("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1,"number"),this.addLabelRange(F,fF("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(F,[this.indent,.1,30,.1,30,.1])},F}(tE),aF=["shape3d","shape3d.top","shape3d.bottom"],KF=hteditor.getString,bF=hteditor.getter,BF=hteditor.setter,$F=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"Floor"))}return P(F,E),F.prototype.addEffectProperties=function(){},F.prototype.addReflectorProperties=function(){var E=this;this.addTitle("TitleReflector");var F=function(E){return!!E.data.s("shape3d.reflector")},D=[];this.addLabelCheckBox(D,KF("editor.reflector"),bF("s","shape3d.reflector"),function(F,D){F.s("shape3d.reflector",D),E.editor.inspector.filterPropertiesLater()}),this.addLabelCheckBox(D,KF("editor.reflectable"),hteditor.getter("s","3d.reflectable"),hteditor.setter("s","3d.reflectable")),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=function(E){return!E.data.s("shape3d.reflector")},D=[],this.addLabelCheckBox(D,KF("editor.reflector"),bF("s","shape3d.reflector"),function(F,D){F.s("shape3d.reflector",D),E.editor.inspector.filterPropertiesLater()}),this.addLabelRange(D,KF("editor.reflectorblur"),bF("s","shape3d.reflector.blur"),BF("s","shape3d.reflector.blur"),0,void 0,.1,"number"),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=F,D=[],this.addLabelColor(D,KF("editor.background"),bF("s","shape3d.reflector.background"),BF("s","shape3d.reflector.background")),this.addLabelColor(D,KF("editor.reflectorcolor"),bF("s","shape3d.reflector.color"),BF("s","shape3d.reflector.color")),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=F},N(F,[{key:"faces",get:function(){return aF}}]),F}(dE),pF=hteditor.getString,WF=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"Pipeline"))}return P(F,E),F.prototype.addTransformProperties=function(){E.prototype.addTransformProperties.call(this);var F=[];this.addLabelRange(F,pF("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(F,pF("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(F,pF("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(F,[this.indent,.1,30,.1,30,.1])},F.prototype.addExtraProperties=function(F){E.prototype.addExtraProperties.call(this);var D=[];this.addLabelInput(D,pF("editor.startangle"),function(E){return Math.round(180/Math.PI*E.s("shape3d.start.angle"))},function(E,F){E.s("shape3d.start.angle",F*Math.PI/180)},"int",1),F.addRow(D,[this.indent,.1]),D=[],this.addLabelInput(D,pF("editor.sweepangle"),function(E){return Math.round(180/Math.PI*E.s("shape3d.sweep.angle"))},function(E,F){E.s("shape3d.sweep.angle",F*Math.PI/180)},"int",1),F.addRow(D,[this.indent,.1])},N(F,[{key:"simple",get:function(){return!0}}]),F}(nE),YF=hteditor.getString,oF=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"Polyline"))}return P(F,E),F.prototype.$11$=function(){var F=this;E.prototype.$11$.call(this);var D=[];this.addLabelRange(D,YF("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1,"number"),this.addLabelRange(D,YF("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addRow(D,[this.indent,.1,this.indent2,.1]),D=[],this.addLabelRange(D,YF("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),
this.addLabelRange(D,YF("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,void 0,1,"int"),this.addLabelCheckBox(D,YF("editor.smooth"),hteditor.getter("s","shape3d.smooth"),hteditor.setter("s","shape3d.smooth")),this.addRow(D,[this.indent,.1,this.indent2,.1,this.indent2,20]),D=[],this.addLabelRange(D,YF("editor.startangle"),function(E){return Number((180/Math.PI*E.s("shape3d.start.angle")).toFixed(0))},function(E,F){E.s("shape3d.start.angle",F*Math.PI/180)},void 0,void 0,1,"number"),this.addLabelRange(D,YF("editor.sweepangle"),function(E){return Number((180/Math.PI*E.s("shape3d.sweep.angle")).toFixed(0))},function(E,F){E.s("shape3d.sweep.angle",F*Math.PI/180)},0,360,1,"int"),this.addRow(D,[this.indent,.1,this.indent2,.1]),D=[],this.addLabelComboBox(D,YF("editor.topcap"),hteditor.getter("s","shape3d.top.cap"),function(E,D){E.s("shape3d.top.cap",D),F.editor.updateInspector()},[void 0,"round","flat"],["",YF("editor.cap.round"),YF("editor.cap.flat")]),this.addLabelComboBox(D,YF("editor.bottomcap"),hteditor.getter("s","shape3d.bottom.cap"),function(E,D){E.s("shape3d.bottom.cap",D),F.editor.updateInspector()},[void 0,"round","flat"],["",YF("editor.cap.round"),YF("editor.cap.flat")]),this.addRow(D,[this.indent,.1,this.indent,.1])},F.prototype.addTransformProperties=function(){var F=this;E.prototype.addTransformProperties.call(this);var D=[];D.push(YF("editor.point")),this.addButton(D,null,YF("editor.reset"),"editor.resetsize.state",function(E){F.setCurrentPoint("e",0)}),this.addLabelInput(D,"X",function(E){return F.getCurrentPoint("x")},function(E,D){F.setCurrentPoint("x",D)},"int",1),this.addLabelInput(D,"Y",function(E){return F.getCurrentPoint("e")},function(E,D){F.setCurrentPoint("e",D)},"int",1),this.addLabelInput(D,"Z",function(E){return F.getCurrentPoint("y")},function(E,D){F.setCurrentPoint("y",D)},"int",1),this.addRow(D,[this.indent-40-8,20,20,.1,20,.1,20,.1]),this.addTitle("TitleShape3dStyle"),D=[],this.addLabelImageOrMaterial(D,YF("editor.imageormaterial"),function(E){var D=E.s("shape3d.material"),g=F.editor.getFileNode(D);if(D)return g?g.url:f;var f=E.s("shape3d.image"),T=F.editor.getFileNode(f);return T?T.url:f},function(E,D){var g=F.editor.getFileNode(D);g&&"material"===g.fileType?(E.s("shape3d.material",D),E.s("shape3d.image",void 0)):(E.s("shape3d.image",D),E.s("shape3d.material",void 0),E.s("texture.cache")&&F.editor.scene.invalidateShape3dCachedImage(E)),F.filterPropertiesLater()}),this.addOneRow(D);var g=function(){return!F.data.s("shape3d.material")};D=[],this.addLabelColor(D,YF("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addLabelCheckBox(D,YF("editor.discardselectable"),hteditor.getter("s","shape3d.discard.selectable"),hteditor.setter("s","shape3d.discard.selectable")),this.addRow(D,[this.indent,.1,this.indent,20]).visible=g,D=[],this.addLabelColor(D,YF("editor.reversecolor"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(D,[this.indent,.1]).visible=g,D=[],this.addLabelCheckBox(D,YF("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(D,YF("editor.reverseflip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(D,[this.indent,.1,this.indent2,.1]).visible=g,D=[],this.addLabelInput(D,YF("editor.uvrotation"),function(E){var F=E.s("shape3d.uv.rotation")||0;return Number((180/Math.PI*F).toFixed(1))},function(E,F){E.s("shape3d.uv.rotation",F*Math.PI/180)},"number",1),this.addRow(D,[this.indent,.1]).visible=g,D=[],D.push(YF("editor.uvscale")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.scale")||[1,1];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.scale"))||[1,1];D[0]=Number(F),E.s("shape3d.uv.scale",D)},"number",1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.scale")||[1,1];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.scale"))||[1,1];D[1]=Number(F),E.s("shape3d.uv.scale",D)},"number",1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=g,D=[],D.push(YF("editor.uvoffset")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.offset")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.offset"))||[0,0];D[0]=Number(F),E.s("shape3d.uv.offset",D)},"number",.1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.offset")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.offset"))||[0,0];D[1]=Number(F),E.s("shape3d.uv.offset",D)},"number",.1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=g,D=[],D.push(YF("editor.uvanchor")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.uv.anchor")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.anchor"))||[0,0];D[0]=Number(F),E.s("shape3d.uv.anchor",D)},"number",.01),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.uv.anchor")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.uv.anchor"))||[0,0];D[1]=Number(F),E.s("shape3d.uv.anchor",D)},"number",.01),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=g,this.addTitle("TitleShape3dTopStyle").visible=function(E){return"flat"===E.data.s("shape3d.top.cap")},D=[],this.addLabelImageOrMaterial(D,YF("editor.imageormaterial"),function(E){var D=E.s("shape3d.top.material"),g=F.editor.getFileNode(D);if(D)return g?g.url:f;var f=E.s("shape3d.top.image"),T=F.editor.getFileNode(f);return T?T.url:f},function(E,D){var g=F.editor.getFileNode(D);g&&"material"===g.fileType?(E.s("shape3d.top.material",D),E.s("shape3d.top.image",void 0)):(E.s("shape3d.top.image",D),E.s("shape3d.top.material",void 0),E.s("texture.cache")&&F.editor.scene.invalidateShape3dCachedImage(E)),F.filterPropertiesLater()}),this.addOneRow(D);var f=function(){return!F.data.s("shape3d.top.material")};D=[],this.addLabelColor(D,YF("editor.color"),hteditor.getter("s","shape3d.top.color"),hteditor.setter("s","shape3d.top.color")),this.addLabelCheckBox(D,YF("editor.discardselectable"),hteditor.getter("s","shape3d.top.discard.selectable"),hteditor.setter("s","shape3d.top.discard.selectable")),this.addRow(D,[this.indent,.1,this.indent,20]).visible=f,D=[],this.addLabelInput(D,YF("editor.uvrotation"),function(E){var F=E.s("shape3d.top.uv.rotation")||0;return Number((180/Math.PI*F).toFixed(1))},function(E,F){E.s("shape3d.top.uv.rotation",F*Math.PI/180)},"number",1),this.addRow(D,[this.indent,.1]).visible=f,D=[],D.push(YF("editor.uvscale")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.top.uv.scale")||[1,1];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.top.uv.scale"))||[1,1];D[0]=Number(F),E.s("shape3d.top.uv.scale",D)},"number",1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.top.uv.scale")||[1,1];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.top.uv.scale"))||[1,1];D[1]=Number(F),E.s("shape3d.top.uv.scale",D)},"number",1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=f,D=[],D.push(YF("editor.uvoffset")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.top.uv.offset")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.top.uv.offset"))||[0,0];D[0]=Number(F),E.s("shape3d.top.uv.offset",D)},"number",.1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.top.uv.offset")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.top.uv.offset"))||[0,0];D[1]=Number(F),E.s("shape3d.top.uv.offset",D)},"number",.1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=f,D=[],D.push(YF("editor.uvanchor")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.top.uv.anchor")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.top.uv.anchor"))||[0,0];D[0]=Number(F),E.s("shape3d.top.uv.anchor",D)},"number",.01),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.top.uv.anchor")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.top.uv.anchor"))||[0,0];D[1]=Number(F),E.s("shape3d.top.uv.anchor",D)},"number",.01),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=f,this.addTitle("TitleShape3dBottomStyle").visible=function(E){return"flat"===E.data.s("shape3d.bottom.cap")},D=[],this.addLabelImageOrMaterial(D,YF("editor.imageormaterial"),function(E){var D=E.s("shape3d.bottom.material"),g=F.editor.getFileNode(D);if(D)return g?g.url:f;var f=E.s("shape3d.bottom.image"),T=F.editor.getFileNode(f);return T?T.url:f},function(E,D){var g=F.editor.getFileNode(D);g&&"material"===g.fileType?(E.s("shape3d.bottom.material",D),E.s("shape3d.bottom.image",void 0)):(E.s("shape3d.bottom.image",D),E.s("shape3d.bottom.material",void 0),E.s("texture.cache")&&F.editor.scene.invalidateShape3dCachedImage(E)),F.filterPropertiesLater()}),this.addOneRow(D);var T=function(){return!F.data.s("shape3d.bottom.material")};D=[],this.addLabelColor(D,YF("editor.color"),hteditor.getter("s","shape3d.bottom.color"),hteditor.setter("s","shape3d.bottom.color")),this.addLabelCheckBox(D,YF("editor.discardselectable"),hteditor.getter("s","shape3d.bottom.discard.selectable"),hteditor.setter("s","shape3d.bottom.discard.selectable")),this.addRow(D,[this.indent,.1,this.indent,20]).visible=T,D=[],this.addLabelInput(D,YF("editor.uvrotation"),function(E){var F=E.s("shape3d.bottom.uv.rotation")||0;return Number((180/Math.PI*F).toFixed(1))},function(E,F){E.s("shape3d.bottom.uv.rotation",F*Math.PI/180)},"number",1),this.addRow(D,[this.indent,.1]).visible=T,D=[],D.push(YF("editor.uvscale")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.bottom.uv.scale")||[1,1];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.bottom.uv.scale"))||[1,1];D[0]=Number(F),E.s("shape3d.bottom.uv.scale",D)},"number",1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.bottom.uv.scale")||[1,1];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.bottom.uv.scale"))||[1,1];D[1]=Number(F),E.s("shape3d.bottom.uv.scale",D)},"number",1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=T,D=[],D.push(YF("editor.uvoffset")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.bottom.uv.offset")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.bottom.uv.offset"))||[0,0];D[0]=Number(F),E.s("shape3d.bottom.uv.offset",D)},"number",.1),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.bottom.uv.offset")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.bottom.uv.offset"))||[0,0];D[1]=Number(F),E.s("shape3d.bottom.uv.offset",D)},"number",.1),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=T,D=[],D.push(YF("editor.uvanchor")),this.addLabelInput(D,"U",function(E){var F=E.s("shape3d.bottom.uv.anchor")||[0,0];return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.bottom.uv.anchor"))||[0,0];D[0]=Number(F),E.s("shape3d.bottom.uv.anchor",D)},"number",.01),this.addLabelInput(D,"V",function(E){var F=E.s("shape3d.bottom.uv.anchor")||[0,0];return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.s("shape3d.bottom.uv.anchor"))||[0,0];D[1]=Number(F),E.s("shape3d.bottom.uv.anchor",D)},"number",.01),this.addRow(D,[this.indent-20-4,20,.1,20,.1]).visible=T},N(F,[{key:"simple",get:function(){return!0}}]),F}(nE),hF=hteditor.getString,uF=function(E){return function(F){var D=F.s(E);return D?D[0]:1}},UF=function(E){return function(F,D){var g=F.s(E);F.s(E,[D,g?g[1]:1])}},HF=function(E){return function(F){var D=F.s(E);return D?D[1]:1}},tF=function(E){return function(F,D){var g=F.s(E);F.s(E,[g?g[0]:1,D])}},ZF=function(E){return function(F){F.s(E,null)}},mF=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"Edge"))}return P(F,E),F.prototype.initForm=function(){E.prototype.initForm.call(this),this.$88$(),this.$90$(),this.addEdgeSourceNodeProperties(),this.addEdgeTargetNodeProperties()},F.prototype.$11$=function(){var E=this;this.addTitle("TitleBasic");var F=[];this.addLabelInput(F,hF("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(F,hF("editor.tag"),hteditor.getter("p","tag"),function(F,D){if(m.config.checkTagConflicts&&D)for(var g=E.dataModel.getDatas(),f=g.size()-1;f>=0;f--){var T=g.get(f);if(T!==F&&T.getTag()===D)return E.editor.messageView.show(i(hF("editor.errormessage.tagalreadyexists"),D),"error"),void E.$34$()}F.setTag(D)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelURL(F,hF("editor.navigate"),function(E){return E.a("navigate")||""},function(E,F){E.a("navigate",F)},function(E,F){var D=F.view.draggingData;return D&&("scene"===D.fileType||"display"===D.fileType)}),this.addLabelInput(F,hF("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelComboBoxURL(F,hF("editor.type"),function(F){var D=F.s("shape3d");if(b(D)){var g=E.editor.getFileNode(D);return g?g.url:D}return D},function(F,D){F.s("shape3d",D),E.editor.updateInspector()},["","cylinder"],void 0,void 0,function(E,F){return!!F.view.draggingData&&"model"===F.view.draggingData.fileType}),this.addImage(F,function(E){return E.s("shape3d")},void 0,function(E){return hteditor.isJSON(E)?E.substr(0,E.length-5)+".png":null},function(E){return hteditor.isJSON(E.rawIcon)}),this.addOneRow(F),F=[],this.addLabelCheckBox(F,hF("editor.selectable"),function(E){return E.s("3d.selectable")},function(E,F){E.s("2d.selectable",F),E.s("3d.selectable",F)}),this.addLabelCheckBox(F,hF("editor.movable"),function(E){return E.s("3d.movable")},function(E,F){E.s("2d.movable",F),E.s("3d.movable",F)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelCheckBox(F,hF("editor.editable"),function(E){return E.s("3d.editable")},function(E,F){E.s("2d.editable",F),E.s("3d.editable",F)}),this.addLabelCheckBox(F,hF("editor.visible"),function(E){return E.s("3d.visible")},function(E,F){E.s("2d.visible",F),E.s("3d.visible",F)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelCheckBox(F,hF("editor.interactive"),function(E){return E.s("interactive")},function(E,F){return E.s("interactive",F)}),this.addRow(F,[this.indent,.1]),F=[],this.addLabelRange(F,hF("editor.envmap"),function(E){return E.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(F,[this.indent,.1]),F=[],this.addLabelRange(F,hF("editor.brightness"),function(E){return E.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(F,[this.indent,.1]),F=[],this.addLabelObject(F,hF("editor.polygonoffset"),function(E){return E.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(F,[this.indent,.1])},F.prototype.addTransformProperties=function(){},F.prototype.$88$=function(){var E=this;this.addTitle("TitleEdgeBasic");var F=[];this.addLabelComboBox(F,hF("editor.type"),hteditor.getter("s","edge.type"),hteditor.setter("s","edge.type"),[void 0,"points"]),this.addRow(F,[this.indent,.1]),F=[],this.addLabelInput(F,hF("editor.width"),hteditor.getter("s","edge.width"),hteditor.setter("s","edge.width"),"number",1),this.addLabelInput(F,hF("editor.offset"),hteditor.getter("s","edge.offset"),hteditor.setter("s","edge.offset"),"number",1),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelInput(F,hF("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),"number",1),this.addLabelInput(F,hF("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),"number",1),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelColor(F,hF("editor.color"),hteditor.getter("s","edge.color"),hteditor.setter("s","edge.color")),this.addLabelCheckBox(F,hF("editor.center"),hteditor.getter("s","edge.center"),hteditor.setter("s","edge.center")),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[];var D=hteditor.getter("s","shape3d.image");this.addLabelImage(F,hF("editor.image"),function(F){var g=D(F),f=E.editor.getFileNode(g);return f?f.url:g},hteditor.setter("s","shape3d.image")),this.addRow(F,[this.indent,.1,20]),F=[],this.addLabel(F,"UV"),this.addButton(F,null,hF("editor.reset"),"editor.resetsize.state",ZF("shape3d.uv.scale")),this.addLabelInput(F,"U",uF("shape3d.uv.scale"),UF("shape3d.uv.scale"),"number",1),this.addLabelInput(F,"V",HF("shape3d.uv.scale"),tF("shape3d.uv.scale"),"number",1),this.addRow(F,[this.indent-20-8,20,20,.1,20,.1]),F=[],this.addLabel(F,"UV "+hF("editor.offset")),this.addButton(F,null,hF("editor.reset"),"editor.resetsize.state",ZF("shape3d.uv.offset")),this.addLabelInput(F,"U",function(E){return(E.s("shape3d.uv.offset")||[0,0])[0]},function(E,F){var D=E.s("shape3d.uv.offset")||[];E.s("shape3d.uv.offset",[F,D[1]])},"number",.1),this.addLabelInput(F,"V",function(E){return(E.s("shape3d.uv.offset")||[0,0])[1]},function(E,F){var D=E.s("shape3d.uv.offset")||[];E.s("shape3d.uv.offset",[D[0],F])},"number",.1),this.addRow(F,[this.indent-20-8,20,20,.1,20,.1])},F.prototype.$90$=function(){},F.prototype.addEdgeSourceNodeProperties=function(){var E=m.config.numberPrecision;this.addTitle("TitleEdgeSourceNode");var F=[];this.addLabelData(F,hF("editor.node"),hteditor.getter("p","source"),function(E,F){E instanceof ht.Edge&&(null==F||F instanceof ht.Node||F instanceof ht.Edge)&&(E.setSource(F),E.s("edge.source.percent",.5))}),this.addRow(F,[this.indent,.1,20]);var D=E.anchor||0,g=0===D?"int":"number",f=1/Math.pow(10,D);F=[],F.push(hF("editor.anchor")),this.addButton(F,null,hF("editor.reset"),"editor.resetsize.state",function(E){E instanceof ht.Edge&&E.s({"edge.source.anchor.x":.5,"edge.source.anchor.elevation":.5,"edge.source.anchor.y":.5})}),this.addLabelInput(F,"X",function(E){var F=E.s("edge.source.anchor.x");return null==F&&(F=.5),Number(F.toFixed(D))},function(E,F){E instanceof ht.Edge&&E.s("edge.source.anchor.x",parseFloat(F))},g,f),this.addLabelInput(F,"Y",function(E){var F=E.s("edge.source.anchor.elevation");return null==F&&(F=.5),Number(F.toFixed(D))},function(E,F){E instanceof ht.Edge&&E.s("edge.source.anchor.elevation",parseFloat(F))},g,f),this.addLabelInput(F,"Z",function(E){var F=E.s("edge.source.anchor.y");return null==F&&(F=.5),Number(F.toFixed(D))},function(E,F){E instanceof ht.Edge&&E.s("edge.source.anchor.y",parseFloat(F))},g,f),this.addRow(F,[this.indent-40-8,20,20,.1,20,.1,20,.1])},F.prototype.addEdgeTargetNodeProperties=function(){var E=m.config.numberPrecision;this.addTitle("TitleEdgeTargetNode");var F=[];this.addLabelData(F,hF("editor.node"),hteditor.getter("p","target"),function(E,F){E instanceof ht.Edge&&(null==F||F instanceof ht.Node||F instanceof ht.Edge)&&(E.setTarget(F),E.s("edge.target.percent",.5))}),this.addRow(F,[this.indent,.1,20]);var D=E.anchor||0,g=0===D?"int":"number",f=1/Math.pow(10,D);F=[],F.push(hF("editor.anchor")),this.addButton(F,null,hF("editor.reset"),"editor.resetsize.state",function(E){E instanceof ht.Edge&&E.s({"edge.target.anchor.x":.5,"edge.target.anchor.elevation":.5,"edge.target.anchor.y":.5})}),this.addLabelInput(F,"X",function(E){var F=E.s("edge.target.anchor.x");return null==F&&(F=.5),Number(F.toFixed(D))},function(E,F){E instanceof ht.Edge&&E.s("edge.target.anchor.x",parseFloat(F))},g,f),this.addLabelInput(F,"Y",function(E){var F=E.s("edge.target.anchor.elevation");return null==F&&(F=.5),Number(F.toFixed(D))},function(E,F){E instanceof ht.Edge&&E.s("edge.target.anchor.elevation",parseFloat(F))},g,f),this.addLabelInput(F,"Z",function(E){var F=E.s("edge.target.anchor.y");return null==F&&(F=.5),Number(F.toFixed(D))},function(E,F){E instanceof ht.Edge&&E.s("edge.target.anchor.y",parseFloat(F))},g,f),this.addRow(F,[this.indent-40-8,20,20,.1,20,.1,20,.1])},F}($E),rF=["edit_tx","edit_ty","edit_tz","edit_rx","edit_ry","edit_rz","edit_sx","edit_sy","edit_sz"],sF=function(E){function F(D){I(this,F);var g=q(this,E.call(this,D));return g.keep=!0,g}return P(F,E),F.prototype.handle_touchstart=function(F){E.prototype.handle_touchstart.call(this,F);var D=this.getState();if(!("move"===D||rF.indexOf(D)>=0||"select"===D)){var g=ht.Default.isLeftButton(F),f=ht.Default.isMiddleButton(F),T=1===ht.Default.getTouchCount(F);(g||f)&&T&&this.setState("pan")}},F}(ht.graph3d.DefaultInteractor),kF=m.getString,VF=m.getter,iF=m.setter,jF=ht.Default.clone,nF=ht.Default.setShape3dModel,yF="__modelView.model__",IF=ht.Default.createBoxModel();ht.Default.handleUnfoundModel=function(){return IF};var NF=function(E){function F(D){I(this,F);var g=q(this,E.call(this));return g.editor=D,g.init(),g.isDrop=!1,D.addEventListener(function(E){if("fileChanged"===E.type){var F=E.params.path,D=g.g3d,f=D.getTextureMap();f&&f[F]&&D.deleteTexture(F),document.body.contains(D.getView())&&D.invalidateAll(),document.body.contains(g.inspector.getView())&&g.inspector.filterPropertiesLater()}}),g}return P(F,E),F.prototype.init=function(){var E=this.initG3d(),F=this.initInspector(),D=this.mainView=new ht.widget.SplitView(F,E,"h",300);this.setConfig({title:kF("editor.modelview"),width:m.config.modelViewSize.width,height:m.config.modelViewSize.height,maximizable:!0,content:D,resizeMode:"wh",buttonsAlign:"right",buttons:this.buttons,closable:!0,draggable:!0,titleHeight:38,titleBackground:ht.Default.dialogHeaderBackground,titleIconGap:16,borderWidth:0,contentPadding:0}),this.setModal(!1)},F.prototype.initG3d=function(){var E=this;this.dm=new ht.DataModel,this.node=new ht.Node,this.node.s({"all.visible":!1,"wf.visible":"selected","select.brightness":1,"envmap.probe":-1}),this.node.setAnchor3d(.5,.5,.5),this.dm.add(this.node);var F=this.g3d=new ht.graph3d.Graph3dView(this.dm);F.isDroppable=function(E,F){var D=F.view.draggingData;if(!D)return!1;var g=D.getFileUUID();return B(g)||p(g)};var D=ht.Default.createDiv();return F.getView().appendChild(D),F.handleCrossDrag=function(g,f,T){var a=E.inspector.v("modelType");if("fbx"===a||"gltf"===a){var K=T.view,b=K.draggingData,$=b.getFileUUID();if(("fbx"!==a||B($))&&("gltf"!==a||p($))&&("enter"===f?(D.style.border="solid "+m.config.color_select_dark+" 2px",ht.Default.layout(D,0,0,F.getWidth(),F.getHeight())):"over"!==f&&(D.style.border=""),"drop"===f)){var W=E.animSources;W||(E.animSources=W=[]),K.sm().size()>1?K.sm().each(function(E){var F=E.getFileUUID();"fbx"===a&&!B(F)||"gltf"===a&&!p(F)||W.indexOf(F)<0&&W.push(F)}):W.indexOf($)<0&&W.push($),E.updateModel()}}},F},F.prototype.initInspector=function(){var E=this,F=this.inspector=new fE(this.editor,"model");F.getView().style.background="none",F.setPadding(6),F.v=function(){if(this.data){var E=arguments[0],F=arguments[1];if(1===arguments.length)return this.data.a(E);this.data.a(E,F)}},F.getValue=function(E){if(this.data)return E(this.data)},F.setValue=function(E,F,D){this.data&&E(this.data,D?D():F)};var D=F.addTitle;F.addTitle=function(E){return m.config.expandedTitles[E]=!0,D.apply(this,arguments)};var g=new ht.Data;return g.onPropertyChanged=function(D){if(!E._updating&&!g._updating){var f=D.property;if(f.startsWith("a:")){var T=D.newValue;if("a:scene.background"===f)return void E.g3d.dm().setBackground(T);["a:modelType","a:url","a:path","a:flipY","a:obj","a:mtl","a:prefix","a:t3","a:s3","a:r3","a:ignoreImage","a:ignoreNormal","a:ignoreColor","a:center","a:reverseFlipMtls","a:rotationInterpolation","a:playAutomatically","a:matDef"].indexOf(f)>=0&&!F._labelDragging&&E.updateModel(),F.updateProperties(),F.filterPropertiesLater()}}},F.data=g,this._initBasicProperties(),this._initModelProperties(),this._init2dProperties(),F},F.prototype._initBasicProperties=function(){var E=this.inspector,F=this.inspector.indent,D=E.getHGap(),g=[];E.addLabelComboBox(g,kF("editor.type"),VF("a","modelType"),iF("a","modelType"),["obj","fbx","gltf"],["obj","fbx","gltf"]),E.addLabelCheckBox(g,kF("editor.modelview.focusmodel"),VF("a","focusModel"),iF("a","focusModel")),E.addRow(g,[F,.1,F,20]),g=[],E.addLabelColor(g,kF("editor.background"),VF("a","scene.background"),iF("a","scene.background")),E.addRow(g,[F,.1]),g=[],E.addLabelInput(g,kF("editor.path"),VF("a","modelPath"),iF("a","modelPath")).setEditable(!1),E.addRow(g,[F,.1]),g=[],this.nameInput=E.addLabelInput(g,kF("editor.name"),VF("a","name"),iF("a","name")),E.addRow(g,[F,.1]),g=[],g.push(kF("editor.translation"));var f=function(){E.setValue(iF("a","t3"),jF(E.getValue(VF("a","t3"))))};E.addLabelInput(g,"X",function(E){var F=E.a("t3")||[0,0,0];return Number(F[0].toFixed(5))},function(E,F){var D=jF(E.a("t3")||[0,0,0]);D[0]=Number(F),E.a("t3",D)},"number",.01,void 0,{onEndEditing:f}),E.addLabelInput(g,"Y",function(E){var F=E.a("t3")||[0,0,0];return Number(F[1].toFixed(5))},function(E,F){var D=jF(E.a("t3")||[0,0,0]);D[1]=Number(F),E.a("t3",D)},"number",.01,void 0,{onEndEditing:f}),E.addLabelInput(g,"Z",function(E){var F=E.a("t3")||[0,0,0];return Number(F[2].toFixed(5))},function(E,F){var D=jF(E.a("t3")||[0,0,0]);D[2]=Number(F),E.a("t3",D)},"number",.01,void 0,{onEndEditing:f}),E.addRow(g,[F-20-D,20,.1,20,.1,20,.1]),g=[],g.push(kF("editor.scale"));var T=function(){E.setValue(iF("a","s3"),jF(E.getValue(VF("a","s3"))))};E.addLabelInput(g,"X",function(E){var F=E.a("s3")||[1,1,1];return Number(F[0].toFixed(5))},function(E,F){var D=jF(E.a("s3")||[1,1,1]);D[0]=Number(F),E.a("s3",D)},"number",.01,void 0,{onEndEditing:T}),E.addLabelInput(g,"Y",function(E){var F=E.a("s3")||[1,1,1];return Number(F[1].toFixed(5))},function(E,F){var D=jF(E.a("s3")||[1,1,1]);D[1]=Number(F),E.a("s3",D)},"number",.01,void 0,{onEndEditing:T}),E.addLabelInput(g,"Z",function(E){var F=E.a("s3")||[1,1,1];return Number(F[2].toFixed(5))},function(E,F){var D=jF(E.a("s3")||[1,1,1]);D[2]=Number(F),E.a("s3",D)},"number",.01,void 0,{onEndEditing:T}),E.addRow(g,[F-20-D,20,.1,20,.1,20,.1]),g=[],g.push(kF("editor.rotation"));var a=function(){E.setValue(iF("a","r3"),jF(E.getValue(VF("a","r3"))))};E.addLabelInput(g,"X",function(E){var F=E.a("r3")||[0,0,0];return 180/Math.PI*Number(F[0])},function(E,F){var D=jF(E.a("r3")||[0,0,0]);D[0]=Number(F*Math.PI/180),E.a("r3",D)},"number",.1,void 0,{onEndEditing:a}),E.addLabelInput(g,"Y",function(E){var F=E.a("r3")||[0,0,0];return 180/Math.PI*Number(F[1])},function(E,F){var D=jF(E.a("r3")||[0,0,0]);D[1]=Number(F*Math.PI/180),E.a("r3",D)},"number",.1,void 0,{onEndEditing:a}),E.addLabelInput(g,"Z",function(E){var F=E.a("r3")||[0,0,0];return 180/Math.PI*Number(F[2])},function(E,F){var D=jF(E.a("r3")||[0,0,0]);D[2]=Number(F*Math.PI/180),E.a("r3",D)},"number",.1,void 0,{onEndEditing:a}),E.addRow(g,[F-20-D,20,.1,20,.1,20,.1])},F.prototype._initModelProperties=function(){this._initObjProjects(),this._initFbxProjects(),this._initGltfProjects()},F.prototype._initObjProjects=function(){var E=this,F=this.inspector,D=F.indent;F.addTitle("editor.modelview.title.obj").visible=function(){return"obj"===F.v("modelType")};var g=[];F.addRow([{element:"OBJ"},{id:"obj",textField:{handleChange:function(D){if(F.data._updating=!0,F.data.a("obj",D),!E.autoFillInput("obj",D))return void(F.data._updating=!1);F.data._updating=!1,E.updateModel(),F.updateProperties()}}},{image:{icon:"editor.obj",onClicked:function(D){E.editor.selectFileNode(F.v("obj"))}}}],[D,.1,20]);var f=F.getViewById("obj");this.handleDragAndDrop(f,function(E,F){return!!F.view.draggingData&&T(F.view.draggingData.getFileUUID())}),F.addRow([{element:"MTL"},{id:"mtl",textField:{handleChange:function(D){if(F.data._updating=!0,F.data.a("mtl",D),!E.autoFillInput("mtl",D))return void(F.data._updating=!1);F.data._updating=!1,E.updateModel(),F.updateProperties()}}},{image:{icon:"editor.mtl",onClicked:function(D){E.editor.selectFileNode(F.v("mtl"))}}}],[D,.1,20]);var K=F.getViewById("mtl");this.handleDragAndDrop(K,function(E,F){return!!F.view.draggingData&&a(F.view.draggingData.getFileUUID())}),F.updateHandlers.push(function(){F.data&&(f.setValue(F.data.a("obj")||""),K.setValue(F.data.a("mtl")||""))}),g=[],F.addLabelURL(g,kF("editor.prefix"),VF("a","prefix"),iF("a","prefix")),F.addRow(g,[D,.1]),g=[],F.addLabelCheckBox(g,kF("editor.ignoreimage"),VF("a","ignoreImage"),iF("a","ignoreImage")),F.addLabelCheckBox(g,kF("editor.centerpivot"),VF("a","center"),iF("a","center")),F.addRow(g,[D,20,.1,20]),g=[],F.addLabelCheckBox(g,kF("editor.ignorenormal"),VF("a","ignoreNormal"),iF("a","ignoreNormal")),F.addLabelCheckBox(g,kF("editor.flipy"),VF("a","flipY"),iF("a","flipY")),F.addRow(g,[D,20,.1,20]),g=[],F.addLabelCheckBox(g,kF("editor.ignorecolor"),VF("a","ignoreColor"),iF("a","ignoreColor")),F.addLabelCheckBox(g,kF("editor.reverseFlipMtls"),VF("a","reverseFlipMtls"),iF("a","reverseFlipMtls")),F.addRow(g,[D,20,.1,20])},F.prototype._initFbxProjects=function(){var E=this,F=this.inspector,D=F.indent;F.addTitle("editor.modelview.title.fbx").visible=function(){return"fbx"===F.v("modelType")},F.addRow([{element:kF("editor.path")},{id:"url",textField:{handleChange:function(D){F.data._updating=!0,F.data.a("url",D);var g=D.lastIndexOf("/")+1;F.data.a("path",D.substr(0,g)),E.updateModel(),F.updateProperties(),F.data._updating=!1}}},{image:{icon:"editor.fbx",onClicked:function(D){E.editor.selectFileNode(F.data.a("url"))}}}],[D,.1,20]),f=[],F.addLabelURL(f,kF("editor.prefix"),VF("a","path"),iF("a","path")),F.addRow(f,[D,.1]);var g=F.getViewById("url");this.handleDragAndDrop(g,function(E,F){return!!F.view.draggingData&&B(F.view.draggingData.getFileUUID())}),F.updateHandlers.push(function(){F.data&&g.setValue(F.data.a("url")||"")});var f=[];F.addLabelComboBox(f,kF("editor.modelview.rotationInterpolation"),VF("a","rotationInterpolation"),iF("a","rotationInterpolation"),[void 0,!0,!1],[kF("editor.auto"),kF("editor.open"),kF("editor.close")]),F.addLabelCheckBox(f,kF("editor.centerpivot"),VF("a","center"),iF("a","center")),F.addRow(f,[D,.1,D,20]),f=[],F.addLabelCheckBox(f,kF("editor.flipy"),VF("a","flipY"),iF("a","flipY")),F.addLabelCheckBox(f,kF("editor.modelview.playautomatically"),VF("a","playAutomatically"),iF("a","playAutomatically")),F.addRow(f,[D,20,.1,20]),F.addTitle(kF("editor.materials")).visible=function(){return!("fbx"!==F.v("modelType")||!F.v("matDef"))},F.fbxMaterialsInspector=this._initMaterialsInspector(),f=[F.fbxMaterialsInspector],F.fbxMaterialsRow=F.addRow(f,[.1],2),F.addTitle(kF("editor.animations")).visible=function(){return"fbx"===F.v("modelType")&&F.v("animations")}},F.prototype._initGltfProjects=function(){var E=this,F=this.inspector,D=F.indent;F.addTitle("editor.modelview.title.gltf").visible=function(){return"gltf"===F.v("modelType")},F.addRow([{element:kF("editor.path")},{id:"url",textField:{handleChange:function(D){F.data._updating=!0,F.data.a("url",D);var g=D.lastIndexOf("/")+1;F.data.a("path",D.substr(0,g)),E.updateModel(),F.updateProperties(),F.data._updating=!1}}},{image:{icon:"editor.gltf",onClicked:function(D){E.editor.selectFileNode(F.data.a("url"))}}}],[D,.1,20]),f=[],F.addLabelURL(f,kF("editor.prefix"),VF("a","path"),iF("a","path")),F.addRow(f,[D,.1]);var g=F.getViewById("url");this.handleDragAndDrop(g,function(E,F){return!!F.view.draggingData&&$(F.view.draggingData.getFileUUID())||p(F.view.draggingData.getFileUUID())}),F.updateHandlers.push(function(){F.data&&g.setValue(F.data.a("url")||"")});var f=[];F.addLabelComboBox(f,kF("editor.modelview.rotationInterpolation"),VF("a","rotationInterpolation"),iF("a","rotationInterpolation"),[void 0,!0,!1],[kF("editor.auto"),kF("editor.open"),kF("editor.close")]),F.addLabelCheckBox(f,kF("editor.centerpivot"),VF("a","center"),iF("a","center")),F.addRow(f,[D,.1,D,20]),f=[],F.addLabelCheckBox(f,kF("editor.flipy"),VF("a","flipY"),iF("a","flipY")),F.addLabelCheckBox(f,kF("editor.modelview.playautomatically"),VF("a","playAutomatically"),iF("a","playAutomatically")),F.addRow(f,[D,20,.1,20]),F.addTitle(kF("editor.materials")).visible=function(){return!("gltf"!==F.v("modelType")||!F.v("matDef"))},
F.gltfMaterialsInspector=this._initMaterialsInspector(),f=[F.gltfMaterialsInspector],F.gltfMaterialsRow=F.addRow(f,[.1],2),F.addTitle(kF("editor.animations")).visible=function(){return"gltf"===F.v("modelType")&&F.v("animations")}},F.prototype._init2dProperties=function(){},F.prototype._initMaterialsInspector=function(){var E=this,F=new fE(this.editor,"material");F.setHPadding(0),F.setVPadding(0);var D=new ht.Data;return D.onPropertyChanged=function(g){if(!D._updating&&!E._updating){g.property.startsWith("a:")&&E._updateMatDef(F)}},F.data=D,F},F.prototype._updateMaterials=function(E,F,D){var g=this;if(!this.inspector.v("url"))return F._url=this.inspector.v("url"),void F.clear();var f={};for(var T in E)o(E[T])&&""!==E[T]?f[T]=E[T]:f[T]="";F.data.setAttrObject(f);var a=F.indent;F.clear(),F.updateHandlers=[];for(var K in E)!function(E){var D=[];F.addLabelTooltip(D,E),D.push({id:E,textField:{handleChange:function(D){F.data.a(E,D)}}}),F.addImage(D,function(F){return F.a(E)},void 0,function(E){return b(E)?E.substr(0,E.length-5)+".png":null},function(E){return b(E.rawIcon)}),F.addRow(D,[a,.1,20]);var f=F.getViewById(E);g.handleDragAndDrop(f,function(E,F){return!!F.view.draggingData&&"material"===F.view.draggingData.fileType}),F.updateHandlers.push(function(){F.data&&!D.hidden&&f.setValue(Y(F.data.a(E))?"":F.data.a(E))})}(K);F.$46$=F._rows,F.filterProperties();var B=F.getRows().length;D.height=B?B*(F.getRowHeight()+F.getHGap())+2*F.getHPadding():2,this.inspector.filterPropertiesLater(),F._url=this.inspector.v("url")},F.prototype._updateMatDef=function(E){var F=E.data.getAttrObject(),D=this.inspector.data,g={};for(var f in F)o(F[f])&&""!==F[f]&&(g[f]=F[f]);D.a("matDef",g),E.filterPropertiesLater()},F.prototype.toJSON=function(){var E=this.inspector,F={modelType:E.v("modelType")};if("obj"===F.modelType){F.obj=E.v("obj"),F.mtl=E.v("mtl"),F.prefix=E.v("prefix"),F.center=E.v("center");E.v("reverseFlipMtls")&&(F.reverseFlipMtls="*"),F.ignoreImage=!!E.v("ignoreImage"),F.ignoreColor=!!E.v("ignoreColor"),F.ignoreNormal=!!E.v("ignoreNormal"),F.flipY=!!E.v("flipY"),F.s3=E.v("s3")||[1,1,1],F.r3=E.v("r3")||[0,0,0],F.t3=E.v("t3")||[0,0,0],F.image||delete F.image,F.prefix||delete F.prefix,F.center&&delete F.center,F.ignoreImage||delete F.ignoreImage,F.ignoreColor||delete F.ignoreColor,F.ignoreNormal||delete F.ignoreNormal,F.flipY&&delete F.flipY,"1,1,1"===F.s3.toString()&&delete F.s3,"0,0,0"===F.r3.toString()&&delete F.r3,"0,0,0"===F.t3.toString()&&delete F.t3}else if("fbx"===F.modelType){F.cube=!0,F.url=E.v("url"),F.path=E.v("path"),F.center=E.v("center"),F.rotationInterpolation=E.v("rotationInterpolation"),F.flipY=!!E.v("flipY"),F.s3=E.v("s3")||[1,1,1],F.r3=E.v("r3")||[0,0,0],F.t3=E.v("t3")||[0,0,0],F.playAutomatically=!!E.v("playAutomatically"),void 0===F.rotationInterpolation&&delete F.rotationInterpolation,F.flipY&&delete F.flipY,F.playAutomatically||delete F.playAutomatically;var D=E.v("matDef"),g={};for(var f in D)o(D[f])&&""!==D[f]&&(g[f]=D[f]);F.matDef=g}else{if("gltf"!==F.modelType)return this.json;F.cube=!0,F.url=E.v("url"),F.path=E.v("path"),F.center=E.v("center"),F.rotationInterpolation=E.v("rotationInterpolation"),F.flipY=!!E.v("flipY"),F.s3=E.v("s3")||[1,1,1],F.r3=E.v("r3")||[0,0,0],F.t3=E.v("t3")||[0,0,0],F.playAutomatically=!!E.v("playAutomatically"),void 0===F.rotationInterpolation&&delete F.rotationInterpolation,F.flipY||delete F.flipY,F.playAutomatically||delete F.playAutomatically;var T=E.v("matDef"),a={};for(var K in T)o(T[K])&&""!==T[K]&&(a[K]=T[K]);F.matDef=a}var b=this.animSources;return b&&b.length&&(F.animationSources=b),F},F.prototype.ok=function(E){var F=this,D=this.toJSON();if(D){var g=this.inspector.v("name"),f=this.inspector.v("modelPath");if(!g)return void this.showError("name");if("obj"===D.modelType){var K=this.inspector.v("obj");if(!K||!T(K))return void this.showError("obj");var b=this.inspector.v("mtl");if(b&&!a(b))return void this.showError("mtl")}if("gltf"===D.modelType){var B=ht.Default.getShape3dModel(yF)||{};if(B.externalAssetURIs){var $={},p=D.url||"",W=p.lastIndexOf("/")+1;B.externalAssetURIs.forEach(function(E){$[E]=p.substr(0,W)+E}),D.assetsURIMap=$}}var Y=f+g+".json";if(this.newModel&&this.editor.models.dataModel.getDataById(Y))return void this.showError("conflict",Y);this.json=D;var o={path:Y,content:t(this.json)};this.editor.request("upload",o,function(D){if(F.g3d.dm().setBackground(null),F.editor.saveImage(F.g3d,Y.substr(0,Y.length-5)+".png",function(){F.hide(),F.inspector.v("focusModel")&&F.editor.selectFileNode(Y)}),E){var g=new ht.Node;g.s("shape3d",Y),g.setAnchor3d([.5,0,.5]),F.editor.dm.add(g),F.editor.sm.ss(g)}})}},F.prototype.open=function(E,F){var D=this;this.isShowing()||(this.show(),this.__oldHandleModelLoadedFunc__=ht.Default.handleModelLoaded,ht.Default.handleModelLoaded=function(E,F){if(E===yF){D.node.s("shape3d",yF),D.node.iv(),D.updateScene(F),D._updating=!0;var g=D.inspector.data;if(F&&F.json&&("gltf"===F.json.modelType||"fbx"===F.json.modelType)){g._rawMatDef=F.matDef;var f=ht.Default.clone(g.a("matDef"))||{},T={};for(var a in F.matDef)T[a]=f[a]?f[a]:F.matDef[a];g.a("matDef",T)}else g._rawMatDef=void 0,g.a("matDef",void 0);F&&F.json&&"gltf"===F.json.modelType&&D._updateMaterials(D.inspector.v("matDef"),D.inspector.gltfMaterialsInspector,D.inspector.gltfMaterialsRow),F&&F.json&&"fbx"===F.json.modelType&&D._updateMaterials(D.inspector.v("matDef"),D.inspector.fbxMaterialsInspector,D.inspector.fbxMaterialsRow),void 0===F&&(D._updateMaterials(D.inspector.v("matDef"),D.inspector.gltfMaterialsInspector,D.inspector.gltfMaterialsRow),D._updateMaterials(D.inspector.v("matDef"),D.inspector.fbxMaterialsInspector,D.inspector.fbxMaterialsRow)),D.inspector.filterPropertiesLater(),D._updating=!1}},this.__oldHandleMaterialLoadedFunc__=ht.Default.handleMaterialLoaded,ht.Default.handleMaterialLoaded=function(E,F){D.inspector.filterPropertiesLater()}),this.newModel=!E,this.nameInput.setEditable(!E),this.url=E,this.json=F,this.node.p3(0,0,0),this.update()},F.prototype.hide=function(){E.prototype.hide.call(this),nF(yF,void 0),ht.Default.handleModelLoaded=this.__oldHandleModelLoadedFunc__,this.__oldHandleModelLoadedFunc__=null,ht.Default.handleMaterialLoaded=this.__oldHandleMaterialLoadedFunc__,this.__oldHandleMaterialLoadedFunc__=null},F.prototype.update=function(){var E=this.json,F=this.inspector,D=F.data;if(this._updating=!0,this.url){var g=this.editor.getFileNode(this.url)||this.editor.models.ld,f=g.s("label");E.modelPath=g.path+"/",E.name=f}E||(E={}),E.modelType||(E.modelType="obj"),E.modelPath||(this.editor.models.tree.sm().ld()?E.modelPath=this.editor.models.tree.sm().ld().url+"/":E.modelPath="models/"),E.name||(E.name=kF("editor.untitled")),void 0===E.center&&(E.center=!0),void 0===E.flipY&&("gltf"===E.modelType?E.flipY=!1:E.flipY=!0),D.setAttrObject(E),this.updateModel(),F.filterPropertiesLater(),delete this._updating},F.prototype.updateModel=function(){var E=this.toJSON();if("obj"===E.modelType)E&&E.obj?nF(yF,E):(nF(yF,null),ht.Default.handleModelLoaded(yF));else if("fbx"===E.modelType){var F=E.url;B(F)?(E.playAutomatically=!1,nF(yF,E)):(nF(yF,null),ht.Default.handleModelLoaded(yF))}else if("gltf"===E.modelType){var D=E.url;$(D)||p(D)?(E.playAutomatically=!1,nF(yF,E)):(nF(yF,null),ht.Default.handleModelLoaded(yF))}else nF(yF,E)},F.prototype.handleDragAndDrop=function(E,F){function D(){f.style.border=T,T=null}var g=this,f=E.getElement();E.isDroppable=F;var T=void 0;E.handleCrossDrag=function(F,a,K){if("enter"===a)T=f.style.border,f.style.border="solid "+m.config.color_select_dark+" 2px";else if("exit"===a||"cancel"===a)D();else if("over"===a);else if("drop"===a){g.isDrop=!0;var b=f.value;f.value=K.view.draggingData.getFileUUID(),D(),E.setFocus(),E.handleChange(f.value,b)}},this.handleBlurAndKeydown(f,function(F){E.isEditable()&&E.handleChange(F)})},F.prototype.handleBlurAndKeydown=function(E,F){E.onblur=function(D){F(E.value)},E.onkeydown=function(D){ht.Default.isEnter(D)&&F(E.value)}},F.prototype.autoFillInput=function(E,F){if(this.isDrop){if(F.length<=4)return!0;var D=this.inspector,g=F.length,f=F.lastIndexOf("/")+1,T=F.substr(0,g-4).substr(f),a=D.v("name");D.v("obj"),D.v("mtl"),D.v("prefix");return a&&a!==kF("editor.untitled")||D.v("name",T),"obj"===E?D.v("mtl",F.substr(0,g-3)+"mtl"):"mtl"===E&&D.v("obj",F.substr(0,g-3)+"obj"),D.v("prefix",F.substr(0,f)),this.isDrop=!1,!0}},F.prototype.showError=function(E,F){var D=this;if(!this.__error__){var g=void 0,f=void 0;"name"===E?(f=kF("editor.error.title"),g=kF("editor.error.name")):"obj"===E||"mtl"===E?(f=kF("editor.error.title"),g=kF("editor.error."+E+".file")):"conflict"===E&&(f=kF("editor.filenameconflict"),g=F),this.__error__=!0,hteditor.alert(f,g,function(){ht.Default.callLater(function(){return D.__error__=!1})})}},F.prototype.clearInput=function(){var E=this.inspector;E.v("obj",""),E.v("mtl",""),E.v("prefix",""),E.getViewById("url").isEditable()&&E.v("url","")},F.prototype.updateScene=function(E){if(E&&E.rawS3){var F=this.g3d,D=E.rawS3[0],g=E.rawS3[1],f=E.rawS3[2],T=Math.max(g,D/(F.getAspect()||1)),a=T/2/Math.tan(F.getFovy()/2);a=2*Math.max(f/2,a),F.setNear(Math.min(10,a/4)),F.setFar(Math.max(1e4,4*a)),F.flyTo(this.node,{animation:!0,direction:[1,.5,1]})}},N(F,[{key:"buttons",get:function(){var E=this,F=this._buttons;return F||(F=this._buttons=[],F.push({label:kF("editor.ok"),action:function(){E.ok()}}),F.push({label:kF("editor.cancel"),action:function(){E.hide()}})),F}},{key:"animSources",get:function(){return this.inspector.v("animationSources")},set:function(E){this.inspector.v("animationSources",E)}}]),F}(hteditor.Dialog);ht.Default.setImage("editor.animation.loop.repeat",{width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"#2C2C2C",borderCap:"round",pixelPerfect:!0,points:[12.37868,1.8808,14.5,4.00212,12.37868,6.12344,8,4.00212,14.5,4.00212,1.5,8.00212,1.5,8.00212,1.5,6.89755,1.89052,5.95474,2.67157,5.17369,3.45262,4.39264,4.39543,4.00212,5.5,4.00212,8,4.00212,3.62132,14.1192,1.5,11.99788,3.62132,9.87656,8,11.99788,1.5,11.99788,14.5,7.99788,14.5,7.99788,14.5,9.10245,14.10948,10.04526,13.32843,10.82631,12.54738,11.60736,11.60457,11.99788,10.5,11.99788,8,11.99788],segments:[1,2,2,1,2,1,2,4,4,2,1,2,2,1,2,1,2,4,4,2]}]}),ht.Default.setImage("editor.animation.loop.pingpong",{width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"#2C2C2C",borderCap:"round",pixelPerfect:!0,points:[10.44889,11.65111,12.5,9.6,3.5,9.6,5.55111,4.34889,3.5,6.4,12.5,6.4],segments:[1,2,2,1,2,2]}]}),ht.Default.setImage("editor.animation.loop.once",{width:16,height:16,comps:[{type:"text",text:"1",align:"center",color:"#2C2C2C",scaleX:.56,scaleY:.56,rect:[7.67332,8.59384,.001,.001]},{type:"shape",borderWidth:1,borderColor:"#2C2C2C",borderCap:"round",pixelPerfect:!0,points:[12.37868,1.8808,14.5,4.00212,12.37868,6.12344,8,4.00212,14.5,4.00212,14.5,8.00212,14.5,8.00212,14.5,9.10669,14.10947,10.0495,13.32843,10.83055,12.54738,11.61159,11.60457,12.00212,10.5,12.00212,5.5,12.00212,4.39543,12.00212,3.45262,11.61159,2.67157,10.83055,1.89052,10.0495,1.5,9.10669,1.5,8.00212,1.5,8.00212,1.5,6.89755,1.89052,5.95474,2.67157,5.17369,3.45262,4.39264,4.39543,4.00212,5.5,4.00212,8,4.00212],segments:[1,2,2,1,2,1,2,4,4,2,4,4,2,4,4,2]}]}),ht.Default.setImage("editor.animation.play",{width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"#2C2C2C",borderCap:"round",pixelPerfect:!0,points:[11.25,8,4.75,12.5,4.75,10.62106,4.75,8.70087,4.75,7.29073,4.75,5.39054,4.75,3.5,11.25,8],segments:[1,2,2,1,2,1,2,2]}]}),ht.Default.setImage("editor.animation.pause",{width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"#2C2C2C",borderCap:"round",pixelPerfect:!0,points:[10.8,12,10.8,4,5.2,12,5.2,4],segments:[1,2,1,2]}]}),ht.Default.setImage("editor.animation.stop",{modified:"Mon Jun 19 2023 11:47:26 GMT+0800 (GMT+08:00)",width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"#2C2C2C",borderJoin:"miter",rect:[4,4,8,8]}]});var PF=m.getString,qF=function(E){function F(D){I(this,F);var g=q(this,E.call(this));return g.editor=D,g.animations=void 0,g.duration=1,g.loop="repeat",g.formPane=new ht.widget.FormPane,g.currentDurationTextField=new ht.widget.TextField,g.durationTextField=new ht.widget.TextField,g.progressSlider=new ht.widget.Slider,g.progressSlider.setMin(0),g.progressSlider.setMax(1),g.speedSlider=new ht.widget.Slider,g.speedSlider.setMin(0),g.speedSlider.setMax(5),g.animationNamesComboBox=window.an=new ht.widget.ComboBox,g.changeModeButton=hteditor.createButton("","","editor.animation.loop.repeat",function(){"repeat"===g.loop?(g.changeModeButton.setIcon("editor.animation.loop.pingpong"),g.loop="pingpong"):"pingpong"===g.loop?(g.changeModeButton.setIcon("editor.animation.loop.once"),g.loop="once"):"once"===g.loop&&(g.changeModeButton.setIcon("editor.animation.loop.repeat"),g.loop="repeat"),g.ld.isAnimationPlaying()&&!g.ld.isAnimationPaused()&&(g.ld.pauseAnimation(),g.ld.playAnimation(g.animationNamesComboBox.getValue(),g.speedSlider.getValue(),g.progressSlider.getValue(),g.loop))}),g.playButton=hteditor.createButton("","","editor.animation.play",function(){g.playButton.play?(g.playButton.play=!1,g.ld.pauseAnimation(),g.playButton.setIcon("editor.animation.play")):(g.playButton.play=!0,g.ld.playAnimation(g.animationNamesComboBox.getValue(),g.speedSlider.getValue(),g.progressSlider.getValue(),g.loop),g.playButton.setIcon("editor.animation.pause"))}),g.playButton.play=!1,g.stopButton=hteditor.createButton("","","editor.animation.stop",function(){g.ld.stopAnimation(),g.playButton.play=!1,g.playButton.setIcon("editor.animation.play")}),g.currentSpeedTextField=new ht.widget.TextField,g.maxSpeedTextField=new ht.widget.TextField,g.init(),g.editor.scene.addViewListener(function(E){"validate"===E.kind&&(g.update(),g.updateAnimationProgressBar())}),g.editor.dm.md(function(E){"animationIteration"===E.property&&"once"===E.data.getCurrentAnimationState("loop")&&(E.data.playAnimation(E.data.getCurrentAnimationState("name"),E.data.getCurrentAnimationState("speed"),0,E.data.getCurrentAnimationState("loop")),E.data.pauseAnimation(),E.data===g.ld&&(g.playButton.play=!1,g.playButton.setIcon("editor.animation.play")))}),g}return P(F,E),F.prototype.init=function(){var E=this;this.setConfig({title:'<span style="margin-left: 8px">'+PF("editor.animation.title")+"</span>",draggable:!0,closable:!1,width:600,height:96,borderWidth:0,content:this.formPane,resizeMode:"none",titleHeight:30,titleBackground:ht.Default.dialogHeaderBackground,titleColor:"#303033",contentPadding:0}),this.formPane.setVGap(8),this.formPane.setPadding(8),this.formPane.setRowHeight(20),this.formPane.addRow([this.currentDurationTextField,this.progressSlider,this.durationTextField],[36,.1,36]),this.formPane.addRow([this.animationNamesComboBox,"",this.changeModeButton,this.playButton,this.stopButton,"",this.currentSpeedTextField,this.speedSlider,this.maxSpeedTextField],[192+2*this.formPane.getVGap(),.1,20,20,20,.1,36,120,36]),this.setTextFieldStyle(this.currentDurationTextField),this.setTextFieldStyle(this.durationTextField),this.setTextFieldStyle(this.currentSpeedTextField),this.setTextFieldStyle(this.maxSpeedTextField),this.progressSlider.onValueChanged=function(F,D){E.currentDurationTextField.setValue(D.toFixed(3)),E.progressSlider._progressEditing&&(E.ld.playAnimation(E.animationNamesComboBox.getValue(),E.speedSlider.getValue(),D,E.loop),E.ld.pauseAnimation())},this.progressSlider.onBeginValueChanged=function(){E.progressSlider._progressEditing=!0},this.progressSlider.onEndValueChanged=function(){E.progressSlider._progressEditing=!1,E.playButton.play&&E.ld.resumeAnimation()},this.progressSlider.getToolTip=function(){return E.progressSlider.getValue().toFixed(3)},this.speedSlider.onValueChanged=function(F,D){E.currentSpeedTextField.setValue(D.toFixed(2)+"x"),E.ld.changeCurrentAnimationSpeed(Number(D.toFixed(2)))},this.speedSlider.getToolTip=function(){return E.speedSlider.getValue().toFixed(2)},this.animationNamesComboBox.onValueChanged=function(F,D){if(!E.animationNamesComboBox._update){var g=E.ld.getAnimation(D);E.durationTextField.setValue(g.duration.toFixed(3)),E.currentDurationTextField.setValue("0.000"),E.progressSlider.setMax(g.duration),E.progressSlider.setValue(0),E.ld.isAnimationPlaying()&&(E.ld.isAnimationPaused()?(E.ld.playAnimation(D,E.speedSlider.getValue(),E.progressSlider.getValue(),E.loop),E.ld.pauseAnimation()):E.ld.playAnimation(D,E.speedSlider.getValue(),E.progressSlider.getValue(),E.loop))}},this.maxSpeedTextField.setValue("5.00x")},F.prototype.setTextFieldStyle=function(E){E.setDisabled(!0),E.setBorder("0px"),E.getDisabledDiv().style.backgroundColor="rgba(255, 255, 255, 0)"},F.prototype.showModelAnimDialog=function(E){if(E){var F=this.getConfig(),D=this.editor.mainSplitView.getWidth(),g=this.editor.mainSplitView.getHeight();F.position={x:(D+this.editor.leftSplitView.getPosition()+this.editor.mainSplitView.getPosition())/2-300,y:g-130},this.setConfig(F),this.show(),this.addToDOM(this.editor.mainSplitView.getView()),this.getView().childNodes[1].style.position="absolute",this.getView().style.width="0px",this.getView().style.height="0px"}else this.hide()},F.prototype.update=function(){var E=this,F=void 0;if(this.ld&&this.ld.getAnimations&&(F=this.ld.getAnimations()),this.lastData!==this.ld||F!==this.animations){this.animations=F,this.lastData=this.ld;var D=!!(F&&F.length>0);if(this.showModelAnimDialog(D),D){if(this.animationNamesComboBox._update=!0,this.animationNamesComboBox.setValues(this.ld.getAnimationNames()||[]),ht.Default.callLater(function(){E.updateDropDownWidth()}),this.ld.isAnimationPlaying()){this.ld.isAnimationPaused()?(this.playButton.play=!1,this.playButton.setIcon("editor.animation.play")):(this.playButton.play=!0,this.playButton.setIcon("editor.animation.pause"));var g=this.ld.getCurrentAnimationState();"repeat"===g.loop?(this.changeModeButton.setIcon("editor.animation.loop.repeat"),this.loop="repeat"):"pingpong"===g.loop?(this.changeModeButton.setIcon("editor.animation.loop.pingpong"),this.loop="pingpong"):"once"===g.loop&&(this.changeModeButton.setIcon("editor.animation.loop.once"),this.loop="once"),this.animationNamesComboBox.setValue(g.name),this.durationTextField.setValue(g.duration.toFixed(3)),this.currentDurationTextField.setValue(g.time),this.progressSlider.setMax(g.duration),this.progressSlider.setValue(g.time),this.currentSpeedTextField.setValue(g.speed.toFixed(2)+"x"),this.speedSlider.setValue(g.speed)}else{this.playButton.play=!1,this.changeModeButton.setIcon("editor.animation.loop.repeat"),this.loop="repeat",this.playButton.setIcon("editor.animation.play");var f=this.ld.getDefaultAnimationName();this.animationNamesComboBox.setValue(f);var T=this.ld.getAnimation(f);this.durationTextField.setValue(T.duration.toFixed(3)),this.currentDurationTextField.setValue("0.000"),this.progressSlider.setMax(T.duration),this.progressSlider.setValue(0),this.currentSpeedTextField.setValue("1.00x"),this.speedSlider.setValue(1)}this.animationNamesComboBox._update=!1}}},F.prototype.updateAnimationProgressBar=function(){if(this.ld&&!this.progressSlider._progressEditing&&this.isShowing()){var E=this.ld.getCurrentAnimationState("time");this.progressSlider.setValue(E)}},F.prototype.updateDropDownWidth=function(){var E=this,F=this.animationNamesComboBox.getWidth();this.animationNamesComboBox.getValues().forEach(function(D){var g=ht.Default.getTextSize(E.animationNamesComboBox.getLabelFont(),D).width;g>F&&(F=g)}),this.animationNamesComboBox.setDropDownWidth(F)},N(F,[{key:"ld",get:function(){var E=this.editor.ld;if(E&&E.s("static")){var F=this.editor.scene,D=F.getRenderLists().get(E.getRenderLayer()),g=D.getModel3dInstancedBatchMap(),f=E.getId(),T=void 0;for(var a in g){if(T=g[a].ds,T.indexOf(f)>=0)break;T=null}T&&(E=F.dm().getDataById(T[0]))}return E}}]),F}(ht.widget.Dialog),RF=hteditor.getString,QF=hteditor.getter,dF=hteditor.setter,_F=ht.Default.clone,CF=function(E){function F(D){I(this,F);var g=q(this,E.call(this));return g.editor=D,g.currentModel="cube",m.config.materialViewModel&&(g.currentModel="logo"),g.newMaterial=!1,g.uuid=ht.Math.generateUUID(),g.materialDefaultStyle=Object.assign(_F(ht.Default.getMaterialDefaultStyle().phong),_F(ht.Default.getMaterialDefaultStyle().pbr)),g.init(),g}return P(F,E),F.prototype.init=function(){var E=this.initG3d(),F=this.initInspector(),D=this.mainView=new ht.widget.SplitView(F,E,"h",300);this.setConfig({title:RF("editor.material.title.edit"),width:m.config.materialViewSize.width,height:m.config.materialViewSize.height,maximizable:!0,content:D,resizeMode:"wh",buttonsAlign:"right",buttons:this.buttons,closable:!0,draggable:!0,titleHeight:38,titleBackground:ht.Default.dialogHeaderBackground,titleIconGap:16,borderWidth:0,contentPadding:0}),this.setModal(!1)},F.prototype.initG3d=function(){return this.dm=new ht.DataModel,this.node=new ht.Node,this.node.s({"select.brightness":1,"envmap.probe":-1}),this.node.setAnchor3d(.5,0,.5),this.node.p3(0,0,0),this.dm.add(this.node),this.g3d=new ht.graph3d.Graph3dView(this.dm),this.g3d.setGridVisible(!0),this.g3d.setGridColor("rgb(191, 191, 191)"),this.g3d.setEye(0,600,1400),this.g3d.setCenter(0,250,0),this.g3d.setNear(10),this.g3d.setFar(1e4),this.g3d.setSelectableFunc(function(){return!1}),this.skyBox||(this.skyBox=new ht.Node),this.skyBox.s({shape3d:"sphere","shape3d.color":"rgba(0, 0, 0,0)"}),this.g3d.setSkyBox(this.skyBox),this.g3d},F.prototype.initInspector=function(){var E=this,F=this.inspector=new fE(this.editor,"material",!1);F.getView().style.background="none",F.setPadding(6),F.v=function(){if(this.data){var E=arguments[0],F=arguments[1];if(1===arguments.length)return this.data.a(E);this.data.a(E,F)}},F.getValue=function(E){if(this.data)return E(this.data)},F.setValue=function(E,F,D){this.data&&E(this.data,D?D():F)};var D=F.addTitle;F.addTitle=function(E){return m.config.expandedTitles[E]=!0,D.apply(this,arguments)};var g=new ht.Data;return g.onPropertyChanged=function(D){if(!g._updatingObjProperties&&!E._updating){var f=D.property;if(f.startsWith("a:")){var T=D.newValue;"a:type"===f&&F.filterPropertiesLater(),"a:envMap"===f&&E.g3d.getSkyBox().s("shape3d.image",T),E.refresh(),F.updateProperties()}}},F.data=g,this._initBasicProperties(),this._initProperties(),F},F.prototype._initBasicProperties=function(){var E=this,F=this.inspector,D=this.inspector.indent,g=[];if(m.config.materialViewModel){var f=hteditor.createButton(null,"","editor.material.logo",function(){E.changeModel("logo")});f.getIconColor=function(){return"logo"===E.currentModel?m.config.color_select:m.config.color_dark},g.push(f)}var T=hteditor.createButton(null,RF("editor.cube"),"editor.cube",function(){E.changeModel("cube")});T.getIconColor=function(){return"cube"===E.currentModel?m.config.color_select:m.config.color_dark},g.push(T);var a=hteditor.createButton(null,RF("editor.sphere"),"editor.sphere",function(){E.changeModel("sphere")});a.getIconColor=function(){return"sphere"===E.currentModel?m.config.color_select:m.config.color_dark},g.push(a),F.addRow(g,[20,20,20]),F.addTitle(RF("editor.material.inspector.title.basic")),g=[],F.addLabelInput(g,RF("editor.path"),QF("a","path"),dF("a","path")).setEditable(!1),F.addRow(g,[D,.1]),g=[],this.inspector.nameInput=F.addLabelInput(g,RF("editor.name"),QF("a","name"),dF("a","name")),F.addRow(g,[D,.1]),g=[],F.addLabelComboBox(g,RF("editor.type"),QF("a","type"),dF("a","type"),["pbr","phong"],["pbr","phong"]),F.addLabelComboBox(g,RF("editor.material.clipMode"),function(E){return E.a("cullFace")?E.a("flipSide")?"front":"back":"none"},function(E,F){"front"===F?(E.a("cullFace",!0),E.a("flipSide",!0)):"back"===F?(E.a("cullFace",!0),E.a("flipSide",!1)):(E.a("cullFace",!1),E.a("flipSide",!1))},["none","front","back"],[RF("editor.material.clipMode.none"),RF("editor.material.clipMode.front"),RF("editor.material.clipMode.back")]),F.addRow(g,[D,.1,D,.1]),g=[],F.addLabelInput(g,RF("editor.material.fresnelIntensity"),QF("a","fresnelIntensity"),dF("a","fresnelIntensity"),"number",.01),F.addRow(g,[D,.1]),F.addTitle(RF("editor.material.inspector.title.uv")),g=[],F.addLabelSlider(g,RF("editor.uvrotation"),function(E){return Number((180/Math.PI*E.a("uvRotation")).toFixed(.2))},function(E,F){E.a("uvRotation",F*Math.PI/180)},0,360,.01),F.addInput(g,function(E){return Number((180/Math.PI*E.a("uvRotation")).toFixed(.2))},function(E,F){E.a("uvRotation",F*Math.PI/180)},"number",.01),F.addRow(g,[D,.1,76]),g=[],g.push(RF("editor.uvscale")),F.addLabelInput(g,"U",function(E){var F=E.a("uvScale");return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.a("uvScale"));D[0]=Number(F),E.a("uvScale",D)},"number",.01),F.addLabelInput(g,"V",function(E){var F=E.a("uvScale");return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.a("uvScale"));D[1]=Number(F),E.a("uvScale",D)},"number",.01),F.addRow(g,[D-20-4,20,.1,20,.1]),g=[],g.push(RF("editor.uvoffset")),F.addLabelInput(g,"U",function(E){var F=E.a("uvOffset");return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.a("uvOffset"));D[0]=Number(F),E.a("uvOffset",D)},"number",.01),F.addLabelInput(g,"V",function(E){var F=E.a("uvOffset");return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.a("uvOffset"));D[1]=Number(F),E.a("uvOffset",D)},"number",.01),F.addRow(g,[D-20-4,20,.1,20,.1]),g=[],g.push(RF("editor.uvanchor")),F.addLabelInput(g,"U",function(E){var F=E.a("uvAnchor");return Number(F[0].toFixed(5))},function(E,F){var D=ht.Default.clone(E.a("uvAnchor"));D[0]=Number(F),E.a("uvAnchor",D)},"number",.01),F.addLabelInput(g,"V",function(E){var F=E.a("uvAnchor");return Number(F[1].toFixed(5))},function(E,F){var D=ht.Default.clone(E.a("uvAnchor"));D[1]=Number(F),E.a("uvAnchor",D)},"number",.01),F.addRow(g,[D-20-4,20,.1,20,.1])},F.prototype._initProperties=function(){var E=this,F=this.inspector,D=this.inspector.indent;F.addTitle(RF("editor.material.inspector.title.diffuse"));var g=[];F.addLabelColor(g,RF("editor.color"),function(E){var F=E.a("diffuse");return"rgb("+(255*F[0]).toFixed(0)+","+(255*F[1]).toFixed(0)+","+(255*F[2]).toFixed(0)+")"},function(F,D){if(D){var g=ht.Default.toColorData(D);F.a("diffuse",[g[0]/255,g[1]/255,g[2]/255])}else F.a("diffuse",E.materialDefaultStyle.diffuse)}),F.addRow(g,[D,.1]),g=[],F.addLabelImage(g,RF("editor.material.inspector.image"),function(F){var D=F.a("map"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("map",F)}),F.addRow(g,[D,.1,20]),F.addTitle(RF("editor.material.inspector.title.roughness")).visible=function(){return"pbr"===F.v("type")},g=[],F.addLabelImage(g,RF("editor.material.inspector.image"),function(F){var D=F.a("roughnessMap"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("roughnessMap",F)}),F.addRow(g,[D,.1,20]),g=[],F.addLabelInput(g,RF("editor.material.roughness"),QF("a","roughness"),dF("a","roughness"),"number",.01),F.addLabelComboBox(g,RF("editor.material.inspector.channel"),QF("a","roughnessChannel"),dF("a","roughnessChannel"),["R","G","B"],["R","G","B"]),F.addRow(g,[D,.1,D,.1]),F.addTitle(RF("editor.material.inspector.title.metalness")).visible=function(){return"pbr"===F.v("type")},g=[],F.addLabelImage(g,RF("editor.material.inspector.image"),function(F){var D=F.a("metalnessMap"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("metalnessMap",F)}),F.addRow(g,[D,.1,20]),g=[],F.addLabelInput(g,RF("editor.material.metalness"),QF("a","metalness"),dF("a","metalness"),"number",.01),F.addLabelComboBox(g,RF("editor.material.inspector.channel"),QF("a","metalnessChannel"),dF("a","metalnessChannel"),["R","G","B"],["R","G","B"]),F.addRow(g,[D,.1,D,.1]),F.addTitle(RF("editor.material.inspector.shininess")).visible=function(){return"phong"===F.v("type")},g=[],F.addLabelInput(g,RF("editor.material.inspector.shininess"),QF("a","shininess"),dF("a","shininess"),"number",.01),F.addRow(g,[D,.1]),F.addTitle(RF("editor.material.inspector.title.specular")).visible=function(){return"phong"===F.v("type")},g=[],F.addLabelColor(g,RF("editor.color"),function(E){var F=E.a("specular");return"rgb("+(255*F[0]).toFixed(0)+","+(255*F[1]).toFixed(0)+","+(255*F[2]).toFixed(0)+")"},function(F,D){if(D){var g=ht.Default.toColorData(D);F.a("specular",[g[0]/255,g[1]/255,g[2]/255])}else F.a("specular",E.materialDefaultStyle.specular)}),F.addRow(g,[D,.1]),g=[],F.addLabelImage(g,RF("editor.material.inspector.image"),function(F){var D=F.a("specularMap"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("specularMap",F)}),F.addRow(g,[D,.1,20]),F.addTitle("editor.material.inspector.title.ao"),g=[],F.addLabelInput(g,RF("editor.material.inspector.intensity"),QF("a","aoMapIntensity"),dF("a","aoMapIntensity"),"number",.01),F.addRow(g,[D,.1]),g=[],F.addLabelImage(g,RF("editor.material.inspector.image"),function(F){var D=F.a("aoMap"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("aoMap",F)}),F.addRow(g,[D,.1,20]),g=[],F.addLabelComboBox(g,RF("editor.material.inspector.channel"),QF("a","aoChannel"),dF("a","aoChannel"),["R","G","B"],["R","G","B"]),F.addLabelComboBox(g,RF("editor.material.inspector.uvchannel"),QF("a","aoUvChannel"),dF("a","aoUvChannel"),[1,2],[1,2]),F.addRow(g,[D,.1,D,.1]),F.addTitle(RF("editor.material.inspector.title.normal")),g=[],F.addLabelImage(g,RF("editor.material.inspector.image"),function(F){var D=F.a("normalMap"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("normalMap",F)}),F.addRow(g,[D,.1,20]),g=[],F.addLabelRange(g,RF("editor.material.inspector.intensity"),function(E){return E.a("normalScale")[0]},function(E,F){var D=_F(E.a("normalScale")),g=1;D[1]<0&&(g=-1),E.a("normalScale",[F,F*g])},0,void 0,.01,"number"),F.addLabelCheckBox(g,RF("editor.material.inspector.flipy"),function(E){return E.a("normalScale")[1]<0},function(E,F){var D=_F(E.a("normalScale")),g=1;F&&(g=-1),E.a("normalScale",[D[0],D[0]*g])}),F.addRow(g,[D,.1,D,20]),F.addTitle(RF("editor.material.inspector.title.emissive")),g=[],F.addLabelColor(g,RF("editor.color"),function(E){var F=E.a("emissive");return"rgb("+(255*F[0]).toFixed(0)+","+(255*F[1]).toFixed(0)+","+(255*F[2]).toFixed(0)+")"},function(F,D){if(D){var g=ht.Default.toColorData(D);F.a("emissive",[g[0]/255,g[1]/255,g[2]/255])}else F.a("emissive",E.materialDefaultStyle.emissive)}),F.addRow(g,[D,.1]),g=[],F.addLabelImage(g,RF("editor.material.inspector.image"),function(F){var D=F.a("emissiveMap"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("emissiveMap",F)}),F.addRow(g,[D,.1,20]),F.addTitle(RF("editor.material.inspector.title.alpha")),g=[],F.addLabelSlider(g,RF("editor.alphaTest"),QF("a","alphaTest"),dF("a","alphaTest"),0,1,.01),F.addInput(g,QF("a","alphaTest"),dF("a","alphaTest"),"number",.01),F.addRow(g,[D,.1,76]),g=[],F.addLabelCheckBox(g,RF("editor.transparent"),QF("a","transparent"),dF("a","transparent")),F.addRow(g,[D,.1]),g=[],F.addLabelSlider(g,RF("editor.material.opacity"),QF("a","opacity"),dF("a","opacity"),0,1,.001),F.addInput(g,QF("a","opacity"),dF("a","opacity"),"number",.01),F.addRow(g,[D,.1,76]),g=[],F.addLabelImage(g,RF("editor.material.inspector.image"),function(F){var D=F.a("alphaMap"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("alphaMap",F)}),F.addRow(g,[D,.1,20]),g=[],F.addLabelComboBox(g,RF("editor.material.inspector.channel"),QF("a","alphaChannel"),dF("a","alphaChannel"),["R","G","B","A"],["R","G","B","A"]),F.addRow(g,[D,.1]),F.addTitle(RF("editor.material.inspector.title.light")),g=[],F.addLabelInput(g,RF("editor.material.inspector.intensity"),QF("a","lightMapIntensity"),dF("a","lightMapIntensity"),"number",.01),F.addRow(g,[D,.1]),g=[],F.addLabelImage(g,RF("editor.material.inspector.image"),function(F){var D=F.a("lightMap"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("lightMap",F)}),F.addRow(g,[D,.1,20]),F.addTitle(RF("editor.material.inspector.title.rim")).visible=function(){return"pbr"===F.v("type")},g=[],F.addLabelColor(g,RF("editor.color"),function(E){var F=E.a("rimColor")
;return"rgb("+(255*F[0]).toFixed(0)+","+(255*F[1]).toFixed(0)+","+(255*F[2]).toFixed(0)+")"},function(F,D){if(D){var g=ht.Default.toColorData(D);F.a("rimColor",[g[0]/255,g[1]/255,g[2]/255])}else F.a("rimColor",E.materialDefaultStyle.rimColor)}),F.addRow(g,[D,.1]),g=[],F.addLabelInput(g,RF("editor.material.rimPower"),QF("a","rimPower"),dF("a","rimPower"),"number",.01),F.addRow(g,[D,.1]),F.addTitle(RF("editor.material.inspector.title.transmission")).visible=function(){return"pbr"===F.v("type")},g=[],F.addLabelCheckBox(g,RF("editor.enable"),QF("a","enableTransmission"),dF("a","enableTransmission")),F.addRow(g,[D,.1]),g=[],F.addLabelSlider(g,RF("editor.material.transmission"),QF("a","transmission"),dF("a","transmission"),0,3,.001),F.addInput(g,QF("a","transmission"),dF("a","transmission"),"number",.001),F.addRow(g,[D,.1,76]),g=[],F.addLabelSlider(g,RF("editor.thickness"),QF("a","thickness"),dF("a","thickness"),0,3,.001),F.addInput(g,QF("a","thickness"),dF("a","thickness"),"number",.001),F.addRow(g,[D,.1,76]),g=[],F.addLabelSlider(g,RF("editor.material.ior"),QF("a","ior"),dF("a","ior"),0,5,.001),F.addInput(g,QF("a","ior"),dF("a","ior"),"number",.001),F.addRow(g,[D,.1,76]),g=[],F.addLabelSlider(g,RF("editor.material.specular.intensity"),QF("a","specularIntensity"),dF("a","specularIntensity"),0,3,.001),F.addInput(g,QF("a","specularIntensity"),dF("a","specularIntensity"),"number",.001),F.addRow(g,[D,.1,76]),g=[],F.addLabelColor(g,RF("editor.material.specular.color"),function(E){var F=E.a("specularColor");return"rgb("+(255*F[0]).toFixed(0)+","+(255*F[1]).toFixed(0)+","+(255*F[2]).toFixed(0)+")"},function(F,D){if(D){var g=ht.Default.toColorData(D);F.a("specularColor",[g[0]/255,g[1]/255,g[2]/255])}else F.a("specularColor",E.materialDefaultStyle.specularColor)}),F.addRow(g,[D,.1]),F.addTitle("editor.material.inspector.title.env"),g=[],F.addLabelComboBox(g,RF("editor.mode"),QF("a","envMapCombine"),dF("a","envMapCombine"),["multiply","mix","add"],[RF("editor.material.envmapcombine.multiply"),RF("editor.material.envmapcombine.mix"),RF("editor.material.envmapcombine.add")]),F.addRow(g,[D,.1]).visible=function(){return"phong"===F.v("type")},g=[],F.addLabelInput(g,RF("editor.material.inspector.intensity"),QF("a","envMapIntensity"),dF("a","envMapIntensity"),"number",.01),F.addRow(g,[D,.1]),g=[],F.addLabelImage(g,RF("editor.material.inspector.image"),function(F){var D=F.a("envMap"),g=E.editor.getFileNode(D);return g?g.url:D},function(E,F){return E.a("envMap",F)}),F.addRow(g,[D,.1,20])},F.prototype.refresh=function(){ht.Default.setMaterial(this.url,this.toJSON()),this.g3d.invalidateAll(),this.editor.scene.invalidateAll()},F.prototype.reload=function(){this.json=_F(this.oldJson),this.update()},F.prototype.toJSON=function(){var E=_F(this.inspector.data.getAttrObject());delete E.path,delete E.name,E.cullFace||delete E.cullFace,E.flipSide||delete E.flipSide,E.transparent||delete E.transparent,0===E.uvRotation&&delete E.uvRotation,E.uvScale&&"1,1"===E.uvScale.toString()&&delete E.uvScale,E.uvOffset&&"0,0"===E.uvOffset.toString()&&delete E.uvOffset,E.uvAnchor&&"0,0"===E.uvAnchor.toString()&&delete E.uvAnchor;var F=_F(this.materialDefaultStyle);for(var D in E)F[D]===E[D]&&delete E[D],Y(F[D])&&F[D].toString()===E[D].toString()&&delete E[D];return delete E.uUvMatrix,E},F.prototype.ok=function(){var E=this,F=this.toJSON(),D=this.inspector.data.a("path"),g=this.inspector.data.a("name"),f=D+"/"+g+".json";if(F){if(!g)return void this.showError("empty");if(this.newMaterial&&this.editor.materials.dataModel.getDataById(f))return void this.showError("conflict",f);this.json=_F(F),this.oldJson=_F(F);var T={path:f,content:t(F)};this.editor.request("upload",T,function(F){E.hide();var D=E.skyBox.s("shape3d.image"),g=_F(E.g3d.getEye()),T=_F(E.g3d.getCenter()),a=E.g3d.getWidth(),K=E.g3d.getHeight();E.g3d.setSkyBox(void 0),E.g3d.setEye(0,300,1100),E.g3d.setCenter(0,250,0),E.g3d.setWidth(256),E.g3d.setHeight(256),E.node.s("shape3d","sphere"),E.node.setSize3d(500,500,500);var b={path:f.substr(0,f.length-5)+".png",content:E.g3d.toDataURL()};E.editor.request("upload",b,function(){E.editor.selectFileNode(f),E.changeModel(E.currentModel),E.g3d.setSkyBox(E.skyBox),E.g3d.getSkyBox().s("shape3d.image",D),E.g3d.setEye(g),E.g3d.setCenter(T),E.g3d.setWidth(a),E.g3d.setHeight(K)})})}},F.prototype.open=function(E,F,D,g){if(this.isShowing()&&this.reload(),this.show(),E){this.path=D,this.name=g.replace(".json",""),this.url=E,this.json=F,this.oldJson=_F(F),this.newMaterial=!1;ht.Default.getMaterial(this.url)&&ht.Default.setMaterial(E,F)}else{this.path=this.editor.materials.currentDir,this.name=RF("editor.untitled"),this.url=this.uuid,this.newMaterial=!0;var f=this.editor.getFileNode(m.config.materialViewEnvMap)?m.config.materialViewEnvMap:void 0;this.json={type:"pbr",envMap:f},this.oldJson=_F(this.json),ht.Default.setMaterial(this.url,this.json)}this.inspector.nameInput.setEditable(this.newMaterial),this.changeModel(this.currentModel),this.update(),this.g3d.moveCamera([0,600,1400],[0,250,0],!0)},F.prototype.hide=function(){this.reload(),E.prototype.hide.call(this)},F.prototype.update=function(){this.node.s("shape3d.material",this.url),this.g3d.getSkyBox().s("shape3d.image",this.json.envMap);var E=this.json,F=this.inspector,D=F.data;E||(E={}),E.type||(E.type="pbr");var g=_F(this.materialDefaultStyle);g.cullFace=!1,g.flipSide=!1,g.transparent=!1,g.uvRotation=0,g.uvScale=[1,1],g.uvOffset=[0,0],g.uvAnchor=[0,0],g.path=this.path,g.name=this.name;for(var f in E)g[f]=E[f];D.setAttrObject(g),F.filterPropertiesLater(),this.refresh()},F.prototype.handleDragAndDrop=function(E,F){function D(){g.style.border=f,f=null}var g=E.getElement();E.isDroppable=F;var f=void 0;E.handleCrossDrag=function(F,T,a){if("enter"===T)f=g.style.border,g.style.border="solid "+m.config.color_select_dark+" 2px";else if("exit"===T||"cancel"===T)D();else if("over"===T);else if("drop"===T){var K=g.value;g.value=a.view.draggingData.getFileUUID(),D(),E.setFocus(),E.handleChange(g.value,K)}},this.handleBlurAndKeydown(g,function(F){E.handleChange(F)})},F.prototype.handleBlurAndKeydown=function(E,F){E.onblur=function(D){F(E.value)},E.onkeydown=function(D){ht.Default.isEnter(D)&&F(E.value)}},F.prototype.showError=function(E,F){var D=this;if(!this.__error__){var g=void 0,f=void 0;"empty"===E?(f=RF("editor.error.title"),g=RF("editor.material.error.name")):"conflict"===E&&(f=RF("editor.filenameconflict"),g=F),this.__error__=!0,hteditor.alert(f,g,function(){ht.Default.callLater(function(){return D.__error__=!1})})}},F.prototype.changeModel=function(E){this.inspector.iv(),this.currentModel=E,"cube"===E?(this.node.s("shape3d","box"),this.node.setSize3d(450,450,450)):"sphere"===E?(this.node.s("shape3d","sphere"),this.node.setSize3d(500,500,500)):(this.node.s("shape3d",{modelType:"obj",obj:m.config.materialViewModel}),this.node.setSize3d(500,500,80))},N(F,[{key:"buttons",get:function(){var E=this,F=this._buttons;return F||(F=this._buttons=[],F.push({label:RF("editor.reload"),action:function(){E.g3d.moveCamera([0,600,1400],[0,250,0],!0),E.reload()}}),F.push({label:RF("editor.ok"),action:function(){E.ok()}}),F.push({label:RF("editor.cancel"),action:function(){E.hide()}})),F}}]),F}(hteditor.Dialog),SF=hteditor.getString,JF=function(E){function F(D){return I(this,F),q(this,E.call(this,D,"Block"))}return P(F,E),F.prototype.$19$=function(){},F.prototype.$11$=function(){var E=this;this.addTitle("TitleBasic"),this.addEventProperties();var F=[];this.addLabelInput(F,SF("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(F,SF("editor.tag"),hteditor.getter("p","tag"),function(F,D){if(m.config.checkTagConflicts&&D)for(var g=E.dataModel.getDatas(),f=g.size()-1;f>=0;f--){var T=g.get(f);if(T!==F&&T.getTag()===D)return E.editor.messageView.show(i(SF("editor.errormessage.tagalreadyexists"),D),"error"),void E.$34$()}F.setTag(D)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelInput(F,SF("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(F,[this.indent,.1]),F=[],this.addLabelCheckBox(F,SF("editor.selectable"),function(E){return E.s("3d.selectable")},function(E,F){E.s("2d.selectable",F),E.s("3d.selectable",F)}),this.addLabelCheckBox(F,SF("editor.movable"),function(E){return E.s("3d.movable")},function(E,F){E.s("2d.movable",F),E.s("3d.movable",F)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelCheckBox(F,SF("editor.editable"),function(E){return E.s("3d.editable")},function(E,F){E.s("2d.editable",F),E.s("3d.editable",F)}),this.addLabelCheckBox(F,SF("editor.visible"),function(E){return E.s("3d.visible")},function(E,F){E.s("2d.visible",F),E.s("3d.visible",F)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelCheckBox(F,SF("editor.clickthroughenabled"),function(E){return E.isClickThroughEnabled()},function(E,F){return E.setClickThroughEnabled(F)}),this.addLabelCheckBox(F,SF("editor.syncsize"),function(E){return E.isSyncSize()},function(E,F){return E.setSyncSize(F)}),this.addRow(F,[this.indent,.1,this.indent2,.1]),F=[],this.addLabelComboBox(F,SF("editor.scaleMode"),hteditor.getter("p","scaleMode"),hteditor.setter("p","scaleMode"),["2d","3d"]),this.addRow(F,[this.indent,.1])},F}($E),OF={width:20,height:16,comps:[{type:"image",stretch:"uniform",color:{func:function(E,F){if(E instanceof ht.Block)return null;if(E instanceof ht.Node){var D=E.s("shape3d");if(ht.Default.isString(D)&&hteditor.isJSON(D))return null}return E instanceof ht.Light?E.s("light.color"):hteditor.config.color_dark}},name:{func:function(E,F){if(E instanceof ht.Block)return"editor.block";if(E instanceof ht.Shape)return E.getThickness()>0?"editor.wall":"editor.floor";if(E instanceof ht.Node){var D=E.s("shape3d");if(D){if(ht.Default.isString(D)&&hteditor.isJSON(D))return D.substr(0,D.length-4)+"png";if("sphere"===D)return"editor.sphere";if("cylinder"===D)return"editor.cylinder"}return"editor.cube"}return E.getIcon()}},rect:[0,0,20,16]}]},LF=hteditor.getString,MF=function(E){function F(D){I(this,F);var g=q(this,E.call(this,D,D.dm));return g.initMenu(),g}return P(F,E),F.prototype.handleDelete=function(){this.removeSelection()},F.prototype.onDataDoubleClicked=function(E,F){F.altKey?this.editor.gv.fitData(E,!0,hteditor.config.fitDataPadding):(this.editor.gv.makeCenter(E,!0),this.editor.scene.flyTo(E,{animation:!0}))},F.prototype.getLabel=function(E){var F=E.getDisplayName()||E.getName()||E.getTag();if(!F){var D=E.s("shape3d");if(E instanceof ht.Block)F=LF(E.getClassName());else if(E instanceof ht.Light)F=LF("ht.Light");else if(E instanceof ht.Shape)F=LF("cylinder"===D?"editor.pipeline":E.getThickness()>0?"editor.wall":"editor.floor");else if(E instanceof ht.Node){var g="editor."+(D||"cube");if(!(F=LF(g))||g===F)if(hteditor.isJSON(D)){var f=this.editor.getFileNode(D),T=f?f.getName():D;F=hteditor.fileNameToDisplayName(T)}else F=D}F||(F=LF("editor.cube"))}return F||""},F.prototype.getIcon=function(E){return OF},F.prototype._endDrag=function(E,F){var D=this,g=F.type,f=F.parent,T=F.refData;if(this.isSelected(this.draggingData)){var a=this.getTopRowOrderSelection();"down"===g&&a.reverse(),a.each(function(E){D._dropData(E,g,f,T)})}else this._dropData(this.draggingData,g,f,T),this.sm().ss(this.draggingData);f&&this.expand(f)},F.prototype._dropData=function(E,F,D,g){if(E.setParent(D),"down"===F||"up"===F){var f=D?D.getChildren():this.dm().getRoots(),T=f.indexOf(g);"down"===F&&T++,f.indexOf(E)<T&&T--,this.dm().moveTo(E,T)}else D||this.dm().moveToBottom(E)},F.prototype.isEditable=function(E){return!0},F.prototype.rename=function(E,F){E.setDisplayName(F)},F.prototype.initMenu=function(){this.menu=new ht.widget.ContextMenu;var E=[],F=this.editor;this.addSelectDescendantItems(E),this.addBlockItems(E),this.menu.setItems(E),this.menu.addTo(this.getView()),F.menus.push(this.menu)},F.prototype.onPropertyChanged=function(F){"filter"===F.property&&(this.visibleMap=null,this.ivm()),E.prototype.onPropertyChanged.call(this,F)},F.prototype.handleDataPropertyChange=function(F){!this._filter||"name"!==F.property&&"displayName"!==F.property?E.prototype.handleDataPropertyChange.call(this,F):(this.visibleMap=null,this.ivm())},F.prototype.checkVisible=function(E){if(!this._filter)return!0;if(m.config.sceneTreeVisibleFunc)return m.config.sceneTreeVisibleFunc(E,this._filter);var F=this.getLabel(E),D=(this._filter+"").toLowerCase();return null!=F&&(F=(F+"").toLowerCase(),F.indexOf(D)>=0)},F.prototype.validateModel=function(){var F=this;this._filter&&!this.visibleMap&&(this.visibleMap={},this.getDataModel().each(function(E){if(F.checkVisible(E)){F.visibleMap[E._id]=!0;for(var D=E.getParent();D&&!F.visibleMap[D._id];)F.visibleMap[D._id]=!0,D=D.getParent()}})),E.prototype.validateModel.call(this)},F.prototype.isVisible=function(E,F){if(!F&&E._refGraph)return!1;var D=this.getVisibleFunc();return!(D&&!D(E))&&(!this._filter||this.visibleMap&&this.visibleMap[E._id])},F}(hteditor.DNDTree);hteditor.msClass(MF,{ms_ac:["filter"]});var GF=function(E){function F(D){I(this,F);var g=q(this,E.call(this));g.editor=D,g.tree=new MF(D),g.setCenterView(g.tree),g.controlPane=new ht.widget.FormPane,g.controlPane.addRow([{id:"filter",textField:{}}],[.1,ht.Default.isTouchable?32:18]),g.setBottomView(g.controlPane),g.setBottomHeight(ht.Default.widgetRowHeight+8);var f=!1,T=g.input=g.controlPane.getViewById("filter").getElement();return T.addEventListener("compositionstart",function(){return f=!0}),T.addEventListener("compositionend",function(){return f=!1}),T.addEventListener("keyup",function(E){f||(ht.Default.isEsc(E)&&(T.value=""),g.tree.setFilter(T.value))}),g}return P(F,E),F.prototype.makeVisible=function(E){var F=this;E instanceof ht.Data&&(E=[E]),E.forEach(function(E){return F.tree.makeVisible(E)})},F}(ht.widget.BorderPane),cF=hteditor.getString,lF=hteditor.getter,xF=hteditor.setter,zF=hteditor.createCodeEditor,XF=ht.Default.clone,wF=ht.Default.isNumber,eF=ht.Default.isArray,AF=function(E){function F(D){I(this,F);var g=q(this,E.call(this));g.editor=D,g._updateHandles=[],(g.batchInfoDialog=new ED(D)).handleComplete=function(E){var F=g.sm.ld();F&&F.a("batchInfo",E)};var f=g._tablePane=new ht.widget.TablePane;return g.initTable(),g.addRow([cF("editor.batchbrightness"),g.addChickBox(function(){return!g.editor.dm.a("sceneBatchBrightnessDisabled")},function(E){return g.editor.dm.a("sceneBatchBrightnessDisabled",!E)}),cF("editor.batchblend"),g.addChickBox(function(){return!g.editor.dm.a("sceneBatchBlendDisabled")},function(E){return g.editor.dm.a("sceneBatchBlendDisabled",!E)}),cF("editor.batchinstanced"),g.addChickBox(function(){return!g.editor.dm.a("sceneBatchInstancedDisabled")},function(E){return g.editor.dm.a("sceneBatchInstancedDisabled",!E)})],[80,.1,80,.1,80,.1]),g.addRow([f],[.1],.1),g.addRow([{button:{icon:"editor.add",toolTip:cF("editor.add"),onClicked:function(){g.addData()}}},{button:{icon:"editor.delete",toolTip:cF("editor.delete"),onClicked:function(){if(g.sm.size()){g.editor.beginTransaction();var E=[],F=g.editor.scene.getBatchInfoMap();g.sm.each(function(D){var f=D.a("name");E.push(f);var T=F[f];delete F[f],g.addBatchInfoHistory("remove",void 0,{name:f,info:T})}),g._tablePane.getTableView().removeSelection(),g.editor.scene.dm().each(function(F){var D=F.s("batch");D&&E.indexOf(D)>-1&&F.s("batch",void 0)}),E.forEach(function(E){return g.editor.scene.invalidateBatch(E)}),g.editor.endTransaction()}}}}],[20,20]),g}return P(F,E),F.prototype.isNameExist=function(E,F){for(var D=!1,g=this.dm.getDatas(),f=0,T=g.size();f<T;f++){var a=g.get(f);if(a!==F&&(D=a.a("name")===E))break}return D},F.prototype.onDataPropertyChanged=function(E){if(!this._parsing){var F=E.property,D=E.data,g=E.newValue,f=E.oldValue,T=this.editor.scene;if("a:name"===F){if(this.isNameExist(g,D))return void D.a("name",f);this.editor.beginTransaction();var a="add",K=void 0;if(f){a="rename";var b=T.getBatchInfoMap();K=b[f],delete b[f]}var B=D.a("batchInfo");T.setBatchInfo(g,B),this.addBatchInfoHistory(a,{name:g,info:D.a("batchInfo")},{name:f,info:K}),this.editor.scene.dm().each(function(E){E.s("batch")&&E.s("batch")===f&&E.s("batch",g)}),this.editor.endTransaction(),this.editor.scene.invalidateBatch(f),this.editor.scene.invalidateBatch(g)}else if("a:batchInfo"===F){var $=D.a("name");if(!$)return;var p=T.getBatchInfo($);T.setBatchInfo($,g),this.addBatchInfoHistory("updateInfo",{name:$,info:D.a("batchInfo")},{name:$,info:p}),this.editor.scene.invalidateBatch($),!this.editor.scene.isBatchInstancedDisabled()&&D.a("batchInfo").instanced&&this.editor.dm.each(function(E){E.s("batch")===$&&E.iv()})}}},F.prototype.addBatchInfoHistory=function(E,F,D){var g=this,f=this.editor.scene;f.dm().addHistory({kind:E,property:"batchInfo",undo:function(){"add"===E?delete f.getBatchInfoMap()[F.name]:"remove"===E?f.setBatchInfo(D.name,D.info):"rename"===E?(delete f.getBatchInfoMap()[F.name],D.name&&f.setBatchInfo(D.name,D.info)):"updateInfo"===E&&f.setBatchInfo(D.name,D.info),g.clearBatchInfo(),g.parseBatchInfoMap(f.getBatchInfoMap()),F&&F.name&&f.invalidateBatch(F.name),D&&D.name&&f.invalidateBatch(D.name)},redo:function(){"add"===E?f.setBatchInfo(F.name,F.info):"remove"===E?delete f.getBatchInfoMap()[D.name]:"rename"===E?(D.name&&delete f.getBatchInfoMap()[D.name],f.setBatchInfo(F.name,F.info)):"updateInfo"===E&&f.setBatchInfo(F.name,F.info),g.clearBatchInfo(),g.parseBatchInfoMap(f.getBatchInfoMap()),F&&F.name&&f.invalidateBatch(F.name),D&&D.name&&f.invalidateBatch(D.name)}})},F.prototype.onDataModelChanged=function(E){this._parsing},F.prototype.initTable=function(){var E=this,F=this._tablePane;return F.getTableView().setEditable(!0),F.addColumns([this.$73$("name",cF("editor.name"),80),this.$73$("batchInfo",cF("editor.batchInfo"),200),{name:"operation",tag:"operation",width:80,displayName:cF("editor.operation"),align:"center",editable:!1,drawCell:function(F,D,g,f,T,a,K,b){var B=D.__btn__;return B||(B=D.__btn__=new ht.widget.Button,B.setLabel(cF("editor.selectall")),B.onClicked=function(){var F=D.a("name"),g=E.editor.dm.toDatas(function(E){return E.s("batch")===F});0!==g.length&&(E.editor.sm.ss(g),E.editor.treePane.makeVisible(g),E.editor.rightBottomTabView.getTabModel().sm().ss(E.editor.treePaneTab))}),B.setWidth(K),B.setHeight(b),B.getView()}}]),F.getColumnModel().getDataByTag("batchInfo").isCellEditable=function(F,D,g,f){return E.batchInfoDialog.parseBatchInfo(F.a("batchInfo")),E.batchInfoDialog.show(),!1},this.dm.md(this.onDataPropertyChanged,this),this.dm.mm(this.onDataModelChanged,this),F},F.prototype.$73$=function(E,F,D){return{name:E,tag:E,width:D,displayName:F,align:"center",editable:!0,accessType:"attr"}},F.prototype.toBatchInfoMap=function(){var E={};return this.dm.each(function(F){var D=F.a("name");D&&(E[D]=F.a("batchInfo"))}),E},F.prototype.addData=function(E){var F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=new ht.Data;D.a({name:E,batchInfo:F}),this.dm.add(D)},F.prototype.parseBatchInfoMap=function(E){this._parsing=!0;for(var F in E)this.addData(F,E[F]);this._parsing=!1},F.prototype.clearBatchInfo=function(){this.dm.clear(),this.updateProperties()},F.prototype.addChickBox=function(E,F){var D=this,g=new ht.widget.CheckBox;return g.getValue=E,g.setValue(E()),g.onValueChanged=function(E,g){D._updatting||F(g)},this._updateHandles.push(function(){g.setValue(E())}),g},F.prototype.updateProperties=function(){this._updatting=!0,this._updateHandles.forEach(function(E){return E()}),this._updatting=!1},F.prototype.updateBatchInfoDialog=function(){this.batchInfoDialog.isShowing()&&this.batchInfoDialog._commonView.filterPropertiesLater()},N(F,[{key:"dm",get:function(){return this._tablePane.getDataModel()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"keys",get:function(){var E=[void 0];return this.dm.each(function(F){return E.push(F.a("name"))}),E}}]),F}(ht.widget.FormPane),vF={alphaTest:ht.Style.alphaTest,brightness:!1,blend:!1,color:void 0,image:void 0,material:void 0,light:!0,lightMask:ht.Style["light.mask"],reverseCull:!1,reverseFlip:!1,reverseColor:ht.Color.reverse,transparentMask:ht.Style["transparent.mask"],uvOffset:[0,0],uvScale:[1,1],discardSelectable:!0,opacity:1,transparent:!1,autoSort:!1,envmap:ht.Style.envmap,envmapProbe:ht.Style["envmap.probe"],roughness:ht.Style.roughness,shadowCast:ht.Style["shadow.cast"],shadowReceive:ht.Style["shadow.receive"],reflectable:ht.Style["3d.reflectable"],bloom:ht.Style.bloom,clipboxMask:ht.Style["3d.clipbox.mask"],headlightAmbientIntensity:ht.Style["headlight.ambientIntensity"]||ht.Default.graph3dViewHeadlightAmbientIntensity,effectFlowMask:ht.Style["effect.flow.mask"],highlight:!0},ED=function(E){function F(D){I(this,F);var g=q(this,E.call(this));g.editor=D;var f=g._tabView=g.initTabView(),T=g.initButtons();return g.setConfig({title:cF("editor.batchInfo"),closable:!0,draggable:!0,width:448,height:485,resizeMode:"wh",maximizable:!0,content:f,buttons:T,buttonsAlign:"right",titleHeight:38,titleBackground:ht.Default.dialogHeaderBackground,titleIconGap:16,borderWidth:0,contentPadding:6}),g.setModal(!1),g}return P(F,E),F.prototype.initTabView=function(){var E=this,F=new ht.widget.TabView,D=this._commonView=this.initCommonView(),g=this._commonTab=F.add(cF("editor.common"),D,!0),f=this._advanceView=this.initAdvanceView(),T=this._advanceTab=F.add(cF("editor.advance"),f),a=F.getTabModel().sm();return a.ms(function(){var F=a.ld();F===g?E.parseBatchInfo(JSON.parse(f.getValue())):F===T&&f.setValue(JSON.stringify(D.data.getAttrObject(),function(E,F){return void 0===F?null:F},4))}),F},F.prototype.initCommonView=function(){var E=new fE(this.editor,"batchInfo");E.setLabelVPadding(0),E.getValue=function(E){return E(this.data)},E.setValue=function(E,F,D){E(this.data,D?D():F)};var F=E.data=new ht.Data;F.onPropertyChanged=function(F){return E.updateProperties()};var D=E.indent,g=E.getHGap(),f=function(){return!E.getValue(function(E){return E.a("material")})},T=this.editor,a=[],B=function(E,F){if(!F.view.draggingData)return!1;var D=F.view.draggingData.fileType;return"symbol"===D||"material"===D||K(F.view.draggingData.url)};E.addLabelURL(a,cF("editor.batchview.imageormaterial"),function(E){return E.a("image")||E.a("material")},function(F,D){D?"material"===T.getFileNode(D).fileType?(F.a("image",void 0),F.a("material",D)):(F.a("image",D),F.a("material",void 0)):(F.a("image",void 0),F.a("material",void 0)),E.filterProperties()},B),E.addImage(a,function(E){return E.a("image")||E.a("material")},void 0,function(E){return b(E)?E.substr(0,E.length-5)+".png":E}),E.addLabelCheckBox(a,cF("editor.instanced"),lF("a","instanced"),xF("a","instanced")),E.addRow(a,[D,.1,20,D,20]),a=[];var $=function(E){var F=this;$.superClass.constructor.call(F,E);var D=F._listView=new ht.widget.ListView;D.getView().style.background=ht.Default.comboBoxBackground,D.setCheckMode(!0),D.sm().ms(function(g){var f=D.dm().getDataByTag(4294967295);if("append"===g.kind)if(g.datas.get(0)===f)D.sm().selectAll();else{var T=D.sm().getSelection().length;T===D.dm().getDatas().length-1&&D.sm().selectAll()}else if("remove"===g.kind)if(g.datas.get(0)===f)D.sm().clearSelection();else{var a=D.sm().getSelection().toList(function(E){return E!==f});D.sm().setSelection(a)}E.setValue(F.getValue())})};ht.Default.def($,ht.widget.BaseDropDownTemplate,{getView:function(){return this._listView.getView()},onOpened:function(E){E=p.getValue();var F=this._listView,D=new ht.Data;D.setName(cF("editor.all")),D.setTag(4294967295),F.dm().add(D);var g=new ht.Data;g.setName(cF("editor.default")),g.setTag(0),F.dm().add(g);var f=this._master.getMaskMap();for(var T in f){T=parseInt(T);var a=new ht.Data;a.setName(f[T]),a.setTag(T),F.dm().add(a)}if(E)if(4294967295===E)F.sm().selectAll();else{var K=new ht.List;F.dm().each(function(F){E&1<<F.getTag()&&K.add(F)}),F.sm().setSelection(K)}},onClosed:function(){},getValue:function(){var E=this._listView.dm(),F=E.sm();if(0===F.size())return 0;var D=E.getDataByTag(4294967295);if(F.contains(D))return 4294967295;var g=0;return F.each(function(E){var F=E.getTag();4294967295!==F&&E.getName()&&(g+=1<<F)}),g},getHeight:function(){return 100}});var p=new ht.widget.MultiComboBox;p.setEditable(!1),p.setDropDownComponent($),p.drawValue=function(E,F,D,g,f){var T=p.getValue(),a=p.getMaskMap(),K=[];if(4294967295===T)K=cF("editor.all");else if(0===T)K="";else{1&T&&K.push(cF("editor.default"));for(var b in a)b=parseInt(b),T&1<<b&&K.push(a[b]);K.join(", ")}ht.Default.drawText(E,K,p.getLabelFont(),p.getLabelColor(),F+1,D,0,f)},p.getMaskMap=function(){return T.dm.a("sceneLightGruopAlias")},p.getValue=function(){return void 0===F.a("lightMask")||null===F.a("lightMask")?vF.lightMask:F.a("lightMask")},p.onValueChanged=function(E,D){F.a("lightMask",D)},a.push(cF("editor.lightmask")),a.push(p),E.addLabelCheckBox(a,cF("editor.light"),lF("a","light"),xF("a","light")),E.addRow(a,[D,.1,D,20]),a=[],E.addLabelRange(a,cF("editor.headlight.ambientintensity"),lF("a","headlightAmbientIntensity"),xF("a","headlightAmbientIntensity"),void 0,void 0,.01,"number"),E.addLabelCheckBox(a,cF("editor.autoSort"),lF("a","autoSort"),xF("a","autoSort")),E.addLabelCheckBox(a,cF("editor.reflectable"),lF("a","reflectable"),xF("a","reflectable")),E.addRow(a,[D,.1,D,20,D,20]),a=[],E.addLabelRange(a,cF("editor.alphatest"),lF("a","alphaTest"),xF("a","alphaTest"),0,1,.01,"number"),E.addLabelCheckBox(a,cF("editor.shadow.cast"),lF("a","shadowCast"),xF("a","shadowCast")),E.addLabelCheckBox(a,cF("editor.shadow.receive"),lF("a","shadowReceive"),xF("a","shadowReceive")),E.addRow(a,[D,.1,D,20,D,20]),a=[];var W=function(E){var F=this;W.superClass.constructor.call(F,E);var D=F._listView=new ht.widget.ListView;D.getView().style.background=ht.Default.comboBoxBackground,D.setCheckMode(!0),D.sm().ms(function(g){var f=D.dm().getDataByTag(4294967295);if("append"===g.kind)if(g.datas.get(0)===f)D.sm().selectAll();else{var T=D.sm().getSelection().length;T===D.dm().getDatas().length-1&&D.sm().selectAll()}else if("remove"===g.kind)if(g.datas.get(0)===f)D.sm().clearSelection();else{var a=D.sm().getSelection().toList(function(E){return E!==f});D.sm().setSelection(a)}E.setValue(F.getValue())})};ht.Default.def(W,ht.widget.BaseDropDownTemplate,{getView:function(){return this._listView.getView()},onOpened:function(E){E=Y.getValue();var F=this._listView,D=new ht.Data;D.setName(cF("editor.all")),D.setTag(4294967295),F.dm().add(D);var g=new ht.Data;g.setName(cF("editor.default")),g.setTag(0),F.dm().add(g);var f=this._master.getMaskMap();for(var T in f){T=parseInt(T);var a=new ht.Data;a.setName(f[T]),a.setTag(T),F.dm().add(a)}if(E)if(4294967295===E)F.sm().selectAll();else{var K=new ht.List;F.dm().each(function(F){E&1<<F.getTag()&&K.add(F)}),F.sm().setSelection(K)}},onClosed:function(){},getValue:function(){var E=this._listView.dm(),F=E.sm();if(0===F.size())return 0;var D=E.getDataByTag(4294967295);if(F.contains(D))return 4294967295;var g=0;return F.each(function(E){var F=E.getTag();4294967295!==F&&E.getName()&&(g+=1<<F)}),g},getHeight:function(){return 100}});var Y=new ht.widget.MultiComboBox;Y.setEditable(!1),Y.setDropDownComponent(W),Y.drawValue=function(E,F,D,g,f){var T=Y.getValue(),a=Y.getMaskMap(),K=[];if(4294967295===T)K=cF("editor.all");else if(0===T)K="";else{1&T&&K.push(cF("editor.default"));for(var b in a)b=parseInt(b),T&1<<b&&K.push(a[b]);K.join(", ")}ht.Default.drawText(E,K,Y.getLabelFont(),Y.getLabelColor(),F+1,D,0,f)},Y.getMaskMap=function(){return T.dm.a("sceneClipboxGroupAlias")},Y.getValue=function(){return void 0===F.a("clipboxMask")||null===F.a("clipboxMask")?vF.clipboxMask:F.a("clipboxMask")},Y.onValueChanged=function(E,D){F.a("clipboxMask",D)},a.push(cF("editor.batchview.clipboxmask")),a.push(Y);var o=function(E){var F=this;o.superClass.constructor.call(F,E);var D=F._listView=new ht.widget.ListView;D.getView().style.background=ht.Default.comboBoxBackground,D.setCheckMode(!0),D.sm().ms(function(g){var f=D.dm().getDataByTag(4294967295);if("append"===g.kind)if(g.datas.get(0)===f)D.sm().selectAll();else{var T=D.sm().getSelection().length;T===D.dm().getDatas().length-1&&D.sm().selectAll()}else if("remove"===g.kind)if(g.datas.get(0)===f)D.sm().clearSelection();else{var a=D.sm().getSelection().toList(function(E){return E!==f});D.sm().setSelection(a)}E.setValue(F.getValue())})};ht.Default.def(o,ht.widget.BaseDropDownTemplate,{getView:function(){return this._listView.getView()},onOpened:function(E){E=this._master.getValue();var F=this._listView,D=new ht.Data;D.setName(cF("editor.all")),D.setTag(4294967295),F.dm().add(D);var g=new ht.Data;g.setName(cF("editor.default")),g.setTag(0),F.dm().add(g);var f=this._master.getMaskMap();for(var T in f){T=parseInt(T);var a=new ht.Data;a.setName(f[T]),a.setTag(T),F.dm().add(a)}if(E)if(4294967295===E)F.sm().selectAll();else{var K=new ht.List;F.dm().each(function(F){E&1<<F.getTag()&&K.add(F)}),F.sm().setSelection(K)}},onClosed:function(){},getValue:function(){var E=this._listView.dm(),F=E.sm();if(0===F.size())return 0;var D=E.getDataByTag(4294967295);if(F.contains(D))return 4294967295;var g=0;return F.each(function(E){var F=E.getTag();4294967295!==F&&E.getName()&&(g+=1<<F)}),g},getHeight:function(){return 100}});var h=new ht.widget.MultiComboBox;h.setEditable(!1),h.setDropDownComponent(o),h.drawValue=function(E,F,D,g,f){var T=h.getValue(),a=h.getMaskMap(),K=[];if(4294967295===T)K=cF("editor.all");else if(0===T)K="";else{1&T&&K.push(cF("editor.default"));for(var b in a)b=parseInt(b),T&1<<b&&K.push(a[b]);K.join(", ")}ht.Default.drawText(E,K,h.getLabelFont(),h.getLabelColor(),F+1,D,0,f)},h.getMaskMap=function(){return T.dm.a("sceneFlowEffectGroupAlias")},h.getValue=function(){return void 0===F.a("effectFlowMask")||null===F.a("effectFlowMask")?vF.effectFlowMask:F.a("effectFlowMask")},h.onValueChanged=function(E,D){F.a("effectFlowMask",D)},a.push(cF("editor.effect.flowmask")),a.push(h),E.addRow(a,[D,.1,D,.1]),a=[];var u=E.addLabelComboBox(a,cF("editor.envmap.probe"),lF("a","envmapProbe"),xF("a","envmapProbe"),[],[]);return E.updateHandlers.push(function(){if(E.data){var F=E.dataModel.getEnvmap();if(eF(F)){var D=F.map(function(E,F){return F});u.setValues(D);var g=F.map(function(E,F){return F+" - "+(E.name||E.type)});u.setLabels(g);var f=E.getValue(lF("a","envmapProbe"));u.getValue()!==f&&u.setValue(f)}}}),E.addLabelRange(a,cF("editor.envmap"),lF("a","envmap"),xF("a","envmap"),0,1,.01,"number"),E.addRow(a,[D,.1,D,.1]).visible=function(){return!!E.dataModel&&"legacy"!==(E.dataModel.getEnvmapType()||"legacy")},a=[],E.addLabelRange(a,cF("editor.envmap.roughness"),lF("a","roughness"),xF("a","roughness"),0,1,.01,"number"),E.addLabelCheckBox(a,cF("editor.bloom"),lF("a","bloom"),xF("a","bloom")),E.addLabelCheckBox(a,cF("editor.reverseflip"),lF("a","reverseFlip"),xF("a","reverseFlip")),E.addRow(a,[D,.1,D,20,D,20]).visible=function(){return!(!E.dataModel||!f())&&"legacy"!==(E.dataModel.getEnvmapType()||"legacy")},a=[],E.addLabelRange(a,cF("editor.envmap"),lF("a","envmap"),xF("a","envmap"),0,1,.01,"number"),E.addLabelCheckBox(a,cF("editor.bloom"),lF("a","bloom"),xF("a","bloom")),E.addLabelCheckBox(a,cF("editor.reverseflip"),lF("a","reverseFlip"),xF("a","reverseFlip")),E.addRow(a,[D,.1,D,20,D,20]).visible=function(){return!(!E.dataModel||!f())&&"legacy"===(E.dataModel.getEnvmapType()||"legacy")},a=[],E.addLabelRange(a,cF("editor.envmap"),lF("a","envmap"),xF("a","envmap"),0,1,.01,"number"),a.push(null,null,null,null),E.addRow(a,[D,.1,D,20,D,20]).visible=function(){return!(!E.dataModel||f())&&"legacy"===(E.dataModel.getEnvmapType()||"legacy")},a=[],E.addLabelRange(a,cF("editor.opacity"),lF("a","opacity"),xF("a","opacity"),0,1,.01,"number"),E.addLabelCheckBox(a,cF("editor.transparent"),lF("a","transparent"),xF("a","transparent")),E.addLabelCheckBox(a,cF("editor.discardselectable"),lF("a","discardSelectable"),xF("a","discardSelectable")),E.addRow(a,[D,.1,D,20,D,20]).visible=f,a=[],E.addLabelColor(a,cF("editor.color"),lF("a","color"),xF("a","color")),E.addLabelCheckBox(a,cF("editor.blend"),lF("a","blend"),xF("a","blend")),E.addRow(a,[D,.1,D,20]).visible=f,a=[],
E.addLabelColor(a,cF("editor.reversecolor"),lF("a","reverseColor"),xF("a","reverseColor")),E.addLabelCheckBox(a,cF("editor.reversecull"),lF("a","reverseCull"),xF("a","reverseCull")),E.addRow(a,[D,.1,D,20]).visible=f,a=[cF("editor.uvscale")],E.addLabelInput(a,"U",function(E){var F=E.a("uvScale")||vF.uvScale;return Number(F[0].toFixed(5))},function(E,F){var D=XF(E.a("uvScale")||vF.uvScale);D[0]=Number(F),E.a("uvScale",D)},"number",.01),E.addLabelInput(a,"V",function(E){var F=E.a("uvScale")||vF.uvScale;return Number(F[1].toFixed(5))},function(E,F){var D=XF(E.a("uvScale")||vF.uvScale);D[1]=Number(F),E.a("uvScale",D)},"number",.01),E.addLabelCheckBox(a,cF("editor.transparentmask"),lF("a","transparentMask"),xF("a","transparentMask")),E.addRow(a,[D-20-g,20,.1,20,.1,D,20]).visible=f,a=[cF("editor.uvoffset")],E.addLabelInput(a,"U",function(E){var F=E.a("uvOffset")||vF.uvOffset;return Number(F[0].toFixed(5))},function(E,F){var D=XF(E.a("uvOffset")||vF.uvOffset);D[0]=Number(F),E.a("uvOffset",D)},"number",.01),E.addLabelInput(a,"V",function(E){var F=E.a("uvOffset")||vF.uvOffset;return Number(F[1].toFixed(5))},function(E,F){var D=XF(E.a("uvOffset")||vF.uvOffset);D[1]=Number(F),E.a("uvOffset",D)},"number",.01),E.addLabelCheckBox(a,cF("editor.brightness"),lF("a","brightness"),xF("a","brightness")),E.addRow(a,[D-20-g,20,.1,20,.1,D,20]).visible=f,a=[],E.addLabelCheckBox(a,cF("editor.highlight"),lF("a","highlight"),xF("a","highlight")),E.addRow(a,[D,.1]),E},F.prototype.initAdvanceView=function(){return zF({value:"",language:"json",theme:m.config.codeEditorTheme,readOnly:!1,minimap:{enabled:!1}})},F.prototype.initButtons=function(){var E=this,F=[];return F.push({label:cF("editor.ok"),action:function(){E._tabView.getTabModel().sm().ld()===E._advanceTab&&E.parseBatchInfo(JSON.parse(E._advanceView.getValue())),E.handleComplete(E.toBatchInfo()),E.hide()}}),F.push({label:cF("editor.cancel"),action:function(){E.hide()}}),F},F.prototype.toBatchInfo=function(){var E=XF(this._commonView.data.getAttrObject());for(var F in vF){var D=vF[F];(eF(D)&&eF(E[F])&&E[F].join(",")===D.join(",")||E[F]===D||void 0===D&&null===E[F])&&delete E[F]}return E},F.prototype.parseBatchInfo=function(E){E=XF(E)||{};for(var F in vF)if(E.hasOwnProperty(F)){if("uvOffset"===F||"uvScale"===F){var D=E[F];wF(D)&&(E[F]=[D,D])}}else E[F]=vF[F];this._commonView.data.setAttrObject(E)},F.prototype.handleComplete=function(E){console.info(E)},F.prototype.show=function(){for(var F,D=arguments.length,g=Array(D),f=0;f<D;f++)g[f]=arguments[f];(F=E.prototype.show).call.apply(F,[this].concat(g)),this._commonView.filterProperties()},F.prototype.hide=function(){this._commonView.data.setAttrObject({}),this._tabView.getTabModel().sm().ss(this._commonTab),E.prototype.hide.call(this)},F}(hteditor.Dialog),FD=hteditor.getString,DD=hteditor.createButton,gD=function(E){function F(D){I(this,F);var g=q(this,E.call(this));g.editor=D;var f=g._tablePane=new ht.widget.TablePane;g.initTable(),g.addRow([f],[.1],.1);var T=[],a=DD(null,FD("editor.add"),"editor.add",function(){g.editor.editable&&(g._editing=!0,g.addData(g.createRenderLayerName()),g.updateRenderLayers())});T.push(a);var K=DD(null,FD("editor.delete"),"editor.delete",function(){g.editor.editable&&g.sm.size()&&(g._editing=!0,g.removeRenderLayer(),g.updateRenderLayers())});T.push(K),T.push(null);var b=DD(null,FD("editor.bringtofront"),"editor.top",function(){g.editor.editable&&g.sm.size()&&(g._editing=!0,g.moveRenderLayers("top"),g.updateRenderLayers())});T.push(b);var B=DD(null,FD("editor.bringforward"),"editor.up",function(){g.editor.editable&&g.sm.size()&&(g._editing=!0,g.moveRenderLayers("up"),g.updateRenderLayers())});T.push(B);var $=DD(null,FD("editor.sendbackward"),"editor.down",function(){g.editor.editable&&g.sm.size()&&(g._editing=!0,g.moveRenderLayers("down"),g.updateRenderLayers())});T.push($);var p=DD(null,FD("editor.sendtoback"),"editor.bottom",function(){g.editor.editable&&g.sm.size()&&(g._editing=!0,g.moveRenderLayers("bottom"),g.updateRenderLayers())});return T.push(p),T.forEach(function(E){E instanceof ht.widget.Button&&(E.getIconColor=function(){return this.isPressed()?m.config.color_select:m.config.color_dark})}),g.addRow(T,[20,20,.1,20,20,20,20]),g}return P(F,E),F.prototype.isNameExist=function(E,F){for(var D=!1,g=this.dm.getDatas(),f=0,T=g.size();f<T;f++){var a=g.get(f);if(a!==F&&(D=a.a("name")===E))break}return D},F.prototype.onDataPropertyChanged=function(E){if(!this._parsing){var F=E.property,D=E.data,g=E.newValue,f=E.oldValue;return"a:name"===F&&this.isNameExist(g,D)?void D.a("name",f):void 0}},F.prototype.onDataModelChanged=function(E){},F.prototype.initTable=function(){var E=this,F=this._tablePane;return F.getTableView().setEditable(!0),F.addColumns([this.$73$("name",FD("editor.name"),220),this.$73$("visible",FD("editor.visible"),50),this.$73$("clearDepth",FD("editor.override"),50)]),F.getTableView().isCellEditable=function(F,D,g,f){return!!E.editor.editable&&("name"!==D.getTag()||"main"!==F.a("name")&&"top"!==F.a("name"))},this.dm.md(this.onDataPropertyChanged,this),F},F.prototype.$73$=function(E,F,D){var g=this;return{name:E,tag:E,width:D,displayName:F,align:"center",editable:!0,accessType:"attr",sortable:!1,setValue:function(F,D,f){f!==F.a(E)&&(F.a(E,f),g.updateRenderLayers())}}},F.prototype.updateRenderLayers=function(){this._parsing||(this.updatePriority(),this.editor.dm.a("sceneRenderLayerInfoMap",this.toRenderLayerInfoMap()))},F.prototype.toRenderLayerInfoMap=function(){var E={};return this.dm.eachByHierarchical(function(F){var D=F.a("name");D&&(E[D]={ignore:!F.a("visible"),clearDepth:F.a("clearDepth"),priority:F.a("priority")})}),E},F.prototype.parseRenderLayerInfoMap=function(E){var F=this;if(this._editing)return void(this._editing=!1);this._parsing=!0,this.dm.clear();var D=Object.values(E),g=Object.keys(E);D.forEach(function(E,F){E.name=g[F]}),D.sort(function(E,F){return E.priority-F.priority}),D.forEach(function(E){F.addData(E.name,!E.ignore,E.clearDepth,E.priority)}),E||(this.addData("main",!0,!1,1e4),this.addData("top",!0,!0,1e7)),this._parsing=!1},F.prototype.clearRenderLayerInfo=function(){var E=ht.Default.getRenderLayerInfo("main"),F=ht.Default.getRenderLayerInfo("top");this.editor.scene.setRenderLayerInfoMap({main:E,top:F}),this.dm.clear(),this.addData("main",!E.ignore,E.clearDepth,E.priority),this.addData("top",!F.ignore,F.clearDepth,F.priority)},F.prototype.addData=function(E){var F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10000001,f=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],new ht.Data);f.a({name:E,visible:F,clearDepth:D,priority:g}),this.dm.add(f)},F.prototype.removeRenderLayer=function(){var E=this;this.sm.getSelection().toList().each(function(F){"main"!==F.a("name")&&"top"!==F.a("name")&&E.dm.remove(F)})},F.prototype.moveRenderLayers=function(E){var F=this;this.sm.getSelection().toList().each(function(E){"main"!==E.a("name")&&"top"!==E.a("name")||F.sm.rs(E)}),"top"===E?this.dm.moveSelectionToTop():"up"===E?this.dm.moveSelectionUp():"down"===E?this.dm.moveSelectionDown():"bottom"===E&&this.dm.moveSelectionToBottom()},F.prototype.updatePriority=function(){var E=0;this.dm.eachByHierarchical(function(F){1e4===F.a("priority")?E=1e4:1e7===F.a("priority")?E=1e7:(E+=1,F.a("priority",E))})},F.prototype.createRenderLayerName=function(){var E=0;return this.dm.each(function(F){if(F.a("name").indexOf(FD("editor.untitled")+"_")>-1){var D=Number(F.a("name").replace(FD("editor.untitled")+"_",""));!isNaN(D)&&Math.ceil(D)>E&&(E=D)}}),FD("editor.untitled")+"_"+(E+1)},N(F,[{key:"dm",get:function(){return this._tablePane.getDataModel()}},{key:"sm",get:function(){return this.dm.sm()}}]),F}(ht.widget.FormPane),fD=hteditor.getString,TD=function(E){function F(D){I(this,F);var g=q(this,E.call(this));g.editor=D,g._map={light:"sceneLightGruopAlias",flow:"sceneFlowEffectGroupAlias",clipbox:"sceneClipboxGroupAlias"};var f=g._comboBox=new ht.widget.ComboBox;f.setLabels([fD("editor.grouptype.light"),fD("editor.grouptype.flow"),fD("editor.grouptype.clipbox")]),f.setValues(["light","flow","clipbox"]),f.setValue("light"),f.onValueChanged=function(){g.parseGroup(g.editor.dm.a(g._map[f.getValue()])||{})},g.addRow([fD("editor.grouptype"),f],[hteditor.config.indent,.1]);var T=g._tablePane=new ht.widget.TablePane;return g.initTable(),g.addRow([T],[.1],.1),g}return P(F,E),F.prototype.isNameExist=function(E,F){for(var D=!1,g=this.dm.getDatas(),f=0,T=g.size();f<T;f++){var a=g.get(f);if(a!==F&&(D=a.a("name")===E))break}return D},F.prototype.initTable=function(){var E=this._tablePane;E.getTableView().setEditable(!0),E.addColumns([this.$73$("id",fD("editor.id"),60,!1),this.$73$("name",fD("editor.name"),260,!0)]);for(var F=1;F<32;F++)this.addData(F,void 0);return E},F.prototype.$73$=function(E,F,D,g){var f=this;return{name:E,tag:E,width:D,displayName:F,align:"center",editable:g,accessType:"attr",sortable:!1,setValue:function(F,D,g){F.a(E,g),f.updateGroup()}}},F.prototype.updateGroup=function(){this.editor.dm.a(this._map[this._comboBox.getValue()],this.toGroupMap())},F.prototype.toGroupMap=function(){var E={};return this.dm.each(function(F){var D=F.a("name");D&&(E[F.a("id")]=D)}),E},F.prototype.parseGroup=function(E){this.dm.each(function(F){F.a("name",E[F.a("id")])})},F.prototype.clearGroup=function(){this.dm.each(function(E){E.a("name",void 0)})},F.prototype.addData=function(E,F){var D=new ht.Data;D.a({id:E,name:F}),this.dm.add(D)},F.prototype.isCurrent=function(E){return this._map[this._comboBox.getValue()]===E},N(F,[{key:"dm",get:function(){return this._tablePane.getDataModel()}},{key:"sm",get:function(){return this.dm.sm()}}]),F}(ht.widget.FormPane),aD=m.getString,KD=function(){function T(E){var F=this;I(this,T),this.params=E,this._eventNotifier=new ht.Notifier,this._clones=[],this.modelDialogs={},this.$38$=E.$38$;var D=ht.Default.getClass(hteditor.config.serviceClass||R);this.$39$=new D(this.handleServiceEvent.bind(this),this),ht.Default.handleModelLoaded=function(E,D){F.inspector&&F.inspector.updateProperties()};var g=this.serializer=new ht.JSONSerializer;g.isSerializable=function(E){if(F.scene.sm().contains(E))return!0;var D=!1;return g._blocks&&g._blocks.each(function(F){E.isDescendantOf(F)&&(D=!0)}),D};var f=this.serializer.getProperties;g.getProperties=function(E){var F=f.call(g,E);return hteditor.config.cloneTag||delete F.tag,F},this.editable=!0,this.modelView,this.materialView}return T.prototype.addEventListener=function(){hteditor.Editor.prototype.addEventListener.apply(this,arguments)},T.prototype.removeEventListener=function(E,F){hteditor.Editor.prototype.removeEventListener.apply(this,arguments)},T.prototype.fireEvent=function(E,F){hteditor.Editor.prototype.fireEvent.apply(this,arguments)},T.prototype.handleServiceEvent=function(T){if("connected"===T.type)this.init&&(this.init(),this.init=null);else if("fileChanged"===T.type){var a=T.path;if(h(a)){var K=this.scene,b=K.getTextureMap();b[a]&&K.deleteTexture(a),K.invalidateAll(),this.gv.invalidateAll()}E(a)?this.requestScenes():F(a)?(this.requestModels(),this.scene.invalidateAll(),this.gv.invalidateAll()):D(a)?this.requestSymbols():g(a)?this.requestAssets():f(a)&&this.requestMaterials()}else"download"===T.type?this.downloadFile(T.path):"confirm"===T.type&&this.requestImport(T.path);this.fireEvent(T.type,T)},T.prototype.downloadFile=function(E){hteditor.Editor.prototype.downloadFile.apply(this,arguments)},T.prototype.requestImport=function(E){hteditor.Editor.prototype.requestImport.apply(this,arguments)},T.prototype.beginTransaction=function(){this.dm.beginTransaction()},T.prototype.endTransaction=function(){this.dm.endTransaction()},T.prototype.init=function(){var E=this;this.menus=[],this.dm=new ht.DataModel,this.gv=new EE(this),this.rulerView=new A(this,this.gv),this.eventView=new hteditor.EventView(this),this.scene=new w(this),this.scene.setInteractors([new ht.graph3d.EditInteractor(this.scene)]),this.functionView=new hteditor.FunctionView(this),this.fontView=new hteditor.FontView(this),this.textView=new hteditor.TextView(this),this.objectView=new hteditor.ObjectView(this),this.messageView=new hteditor.MessageView(this),this.mainToolbar=new l(this),this.fireEvent("mainToolbarCreated"),this.rightToolbar=new X(this),this.fireEvent("rightToolbarCreated"),this.topBorderPane=new ht.widget.BorderPane,this.topBorderPane.setCenterView(this.mainToolbar),this.topBorderPane.setRightView(this.rightToolbar),this.topBorderPane.setHeight(28),this.rightToolbar.onSumWidthChanged=function(){E.topBorderPane.setRightWidth(E.rightToolbar.getSumWidth())},this.resetInteractionState(),this.mainTabView=new ht.widget.TabView,this.scenes=new Q(this),this.models=new d(this),this.symbols=new _(this),this.assets=new C(this),this.materials=new S(this),this.leftTopTabView=new ht.widget.TabView,u(this.leftTopTabView,aD("editor.scenes"),this.scenes,!0),u(this.leftTopTabView,aD("editor.models"),this.models),u(this.leftTopTabView,aD("editor.symbols"),this.symbols),u(this.leftTopTabView,aD("editor.materials"),this.materials),u(this.leftTopTabView,aD("editor.assets"),this.assets),this.leftTopTabView.onTabChanged=function(E,F){if(F){var D=F.getView();0===D.tree.sm().size()&&D.tree.sm().ss(D.rootNode),F.getView().list.doLayout()}},this.treePane=new GF(this),this.dataView=new FE(this),this.rightBottomTabView=new ht.widget.TabView,this.treePaneTab=u(this.rightBottomTabView,aD("editor.list"),this.treePane,!0),u(this.rightBottomTabView,aD("editor.data"),this.dataView),this.renderLayerView=new gD(this),u(this.rightBottomTabView,aD("editor.renderlayer"),this.renderLayerView),this.groupView=new TD(this),u(this.rightBottomTabView,aD("editor.group"),this.groupView),m.config.batchEditable&&(this.batchView=new AF(this),u(this.rightBottomTabView,aD("editor.batch"),this.batchView));var F=this.rightBottomTabView.getTabModel().sm();F.ms(function(){var D=F.ld();E.dataView.visible=(D?D.getView():null)===E.dataView}),this.alignPane=new gE(this),this.rightTopBorderPane=new ht.widget.BorderPane,this.rightTopBorderPane.setTopView(this.alignPane),this.rightTopBorderPane.setCenterView(this.inspectorPane),this.rightTopBorderPane.setTopHeight(ht.Default.widgetHeaderHeight+6),this.centerSplitView=new ht.widget.SplitView(this.rulerView,this.scene,"v"),this.leftSplitView=new ht.widget.SplitView(this.leftTopTabView,this.centerSplitView,"h",m.config.leftSplitViewPosition||260),this.rightSplitView=new ht.widget.SplitView(this.rightTopBorderPane,this.rightBottomTabView,"v",m.config.rightSplitViewPosition||-300),this.mainSplitView=new ht.widget.SplitView(this.leftSplitView,this.rightSplitView,"h",m.config.mainSplitViewPosition||-360),this.mainPane=new ht.widget.BorderPane,this.mainPane.setTopView(this.topBorderPane),this.mainPane.setCenterView(this.mainSplitView),hteditor.layoutMainView(this.mainPane,this.$38$),this.modelAnimDialog=new qF(this),this.$38$&&this.$38$.addEventListener("keydown",this.handleKeydown.bind(this),!1),this.dnd=new hteditor.DND(this),this.dndFromOutside=new hteditor.DNDFromOutside(this,this.$38$),this.requestScenes(),this.requestModels(),this.requestSymbols(),this.requestMaterials(),this.requestAssets(),this.dm.addDataModelChangeListener(this.handleDataModelChange,this),this.dm.addPropertyChangeListener(this.handleDataModelPropertyChange,this),this.dm.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.sm.ms(this.handleSelectionChange,this),this.scene.addPropertyChangeListener(this.handleScenelPropertyChange,this),this.scene.mi(this.handleSceneInteractive,this),this.gv.addInteractorListener(this.handleInteractor,this),this.updateInspector(),this.fireEvent("editor3dCreated"),this.dm.enableHistoryManager(hteditor.config.maxUndoRedoSteps),this.dm.getHistoryManager().ignoredPropertyMap=Object.assign({},this.dm.getHistoryManager().ignoredPropertyMap,{animationIteration:!0,animationPause:!0,animationResume:!0,animationStart:!0,animationStop:!0}),this.initSID();var D=this.params.open||U("hteditor")||hteditor.config.open;D&&(hteditor.isJSON(D)?this._pendingOpenJSON=D:"newscene"===D&&this.newScene()),this.reset()},T.prototype.initSID=function(){var E=window.location.href.match("sid=([0-9a-z-]*)");E&&(this.sid=E[1])},T.prototype.handleDataModelPropertyChange=function(E){this.inspector&&this.inspector.global&&this.inspector.$34$(E),this.dataView.$66$(E);var F=this.scene,D=E.property,g=E.newValue;if("a:sceneSkyboxType"===D||"a:sceneSkyboxBlurSize"===D||"a:sceneSkyboxBodyColor"===D||"a:sceneSkyboxRotationX"===D||"a:sceneSkyboxRotationY"===D||"a:sceneSkyboxRotationZ"===D||"a:sceneSkyboxImage"===D||"a:sceneSkyboxFrontImage"===D||"a:sceneSkyboxBackImage"===D||"a:sceneSkyboxLeftImage"===D||"a:sceneSkyboxRightImage"===D||"a:sceneSkyboxTopImage"===D||"a:sceneSkyboxBottomImage"===D||"a:sceneSkyboxDiameter"===D||"a:sceneSkyboxColor"===D||"a:sceneSkyboxLight"===D||"a:sceneSkyboxLightMask"===D){var f=new ht.Node,T={};if(T["body.color"]=F.dm().a("sceneSkyboxBodyColor"),T["all.color"]="rgba(0,0,0,0)",T["shape3d.color"]="rgba(0,0,0,0)",T["skybox.blur.size"]=F.dm().a("sceneSkyboxBlurSize"),T["shape3d.light"]=F.dm().a("sceneSkyboxLight"),T["light.mask"]=F.dm().a("sceneSkyboxLightMask"),T["texture.wrap"]="clampToEdge",T["3d.clipbox.mask"]=0,T["effect.flow.mask"]=0,"cube"===F.dm().a("sceneSkyboxType"))T["front.image"]=F.dm().a("sceneSkyboxFrontImage"),T["back.image"]=F.dm().a("sceneSkyboxBackImage"),T["left.image"]=F.dm().a("sceneSkyboxLeftImage"),T["right.image"]=F.dm().a("sceneSkyboxRightImage"),T["top.image"]=F.dm().a("sceneSkyboxTopImage"),T["bottom.image"]=F.dm().a("sceneSkyboxBottomImage");else if("color"===F.dm().a("sceneSkyboxType")){T.shape3d="sphere";var a=F.dm().a("sceneSkyboxColor")||"rgba(0,0,0,0)",K=f.s("shape3d.image"),b=K&&ht.Default.getImage(K);b&&"CANVAS"===b.tagName||(b=document.createElement("canvas"),K=ht.Math.generateUUID(),ht.Default.setImage(K,b)),K&&F.getTextureMap()&&F.deleteTexture(K),ht.Default.setCanvas(b,2,1024,1);var B=b.getContext("2d");B.clearRect(0,0,2,1024),B.beginPath(),B.rect(0,0,2,1024),ht.Default.getInternal().createGradientByPackedData(B,a,function(E){return E},!1,{x:0,y:0,width:2,height:1024}),B.fill(),B.restore(),T["shape3d.image"]=K}else T.shape3d="sphere",T["shape3d.image"]=F.dm().a("sceneSkyboxImage");f.setRotationX(F.dm().a("sceneSkyboxRotationX")),f.setRotationY(F.dm().a("sceneSkyboxRotationY")),f.setRotationZ(F.dm().a("sceneSkyboxRotationZ")),f.s(T);var $=void 0;if(F.dm().a("sceneSkyboxDiameter"))$=F.dm().a("sceneSkyboxDiameter"),f.s3($,$,$);else{var p=F.dm().a("sceneNear"),W=F.dm().a("sceneFar");W=W*W/(W+p);var Y=Math.sqrt(3),o=W/Y,h=Math.log(o)/Math.log(1.1);$=2*Math.pow(1.1,h),F.dm().a("sceneSkyboxDiameter",$)}F.setSkybox(f),this.inspector.filterPropertiesLater()}else if("a:sceneRenderLayerInfoMap"===D){var u=g;void 0===g&&(u={main:ht.Default.getRenderLayerInfo("main"),top:ht.Default.getRenderLayerInfo("top")}),F.setRenderLayerInfoMap(u);var U=this.renderLayerView;U&&(U.parseRenderLayerInfoMap(u),this.inspector&&this.inspector.filterPropertiesLater())}else if("a:sceneLightGruopAlias"===D||"a:sceneFlowEffectGroupAlias"===D||"a:sceneClipboxGroupAlias"===D){var H=this.groupView;H&&H.isCurrent(D.replace("a:",""))&&H.parseGroup(g)}else"a:sceneDofImage"===D&&F.setPostProcessingValue("Dof","image",g);if(null!=g)if("a:sceneEditHelperDisabled"===D)F.setEditHelperDisabled(g),this.rightToolbar.iv();else if("a:sceneGridEnabled"===D)F.setGridVisible(g),F.setOriginAxisVisible(g),this.gv.getEditInteractor().gridEnabled=g,this.rightToolbar.iv();else if("a:sceneGridBlockCount"===D)F.setGridSize(g);else if("a:sceneGridBlockSize"===D)F.setGridGap(g),this.gv.setEditStyle("gridBlockSize",g);else if("a:sceneGridColor"===D){var t=ht.Default.toColorData(g);F.setGridColor([t[0]/255,t[1]/255,t[2]/255,1]),this.gv.setEditStyle("gridThickColor",g),this.gv.setEditStyle("gridLightColor","rgba("+t[0]+", "+t[1]+", "+t[2]+", 0.4)")}else if("a:sceneNear"===D)F.setNear(g);else if("a:sceneFar"===D)F.setFar(g);else if("a:sceneFovy"===D)F.setFovy(g);else if("a:sceneBloom"===D)F.setPostProcessingValue("Bloom","enable",g);else if("a:sceneBloomStrength"===D)F.setPostProcessingValue("Bloom","strength",g);else if("a:sceneBloomThreshold"===D)F.setPostProcessingValue("Bloom","threshold",g);else if("a:sceneBloomRadius"===D)F.setPostProcessingValue("Bloom","radius",g);else if("a:sceneBloomSelective"===D)F.setPostProcessingValue("Bloom","selective",g);else if("a:sceneDof"===D)F.setPostProcessingValue("Dof","enable",g);else if("a:sceneDofAperture"===D)F.setPostProcessingValue("Dof","aperture",g);else if("a:sceneHighlightMode"===D)F.setHighlightMode(g);else if("a:sceneHighlightType"===D)F.setHighlightType(g);else if("a:sceneHighlightWidth"===D)F.setHighlightWidth(g);else if("a:sceneHighlightColor"===D)F.setHighlightColor(g);else if("a:sceneHighlightGlow"===D)F.setHighlightGlow(g);else if("a:sceneHighlightGroups"===D)F.setHighlightGroups(g);else if("a:sceneHighlightStrength"===D)F.setHighlightStrength(g);else if("a:sceneDashEnable"===D)F.setDashDisabled(!g);else if("a:sceneHeadlightEnable"===D)F.setHeadlightDisabled(!g);else if("a:sceneHeadlightRange"===D)F.setHeadlightRange(g);else if("a:sceneHeadlightColor"===D)F.setHeadlightColor(g);else if("a:sceneHeadlightIntensity"===D)F.setHeadlightIntensity(g);else if("a:sceneHeadlightAmbientIntensity"===D)F.setHeadlightAmbientIntensity(g);else if("a:sceneHueSaturation"===D)F.setPostProcessingValue("HueSaturation","enable",g);else if("a:sceneHueSaturationHue"===D)F.setPostProcessingValue("HueSaturation","hue",g);else if("a:sceneHueSaturationSaturation"===D)F.setPostProcessingValue("HueSaturation","saturation",g);else if("a:sceneHueSaturationLightness"===D)F.setPostProcessingValue("HueSaturation","lightness",g);else if("a:sceneFogEnable"===D)F.setFogDisabled(!g);else if("a:sceneFogMode"===D)F.setFogMode(g);else if("a:sceneFogColor"===D)F.setFogColor(g);else if("a:sceneFogDensity"===D)F.setFogDensity(g);else if("a:sceneFogNear"===D)F.setFogNear(g);else if("a:sceneFogFar"===D)F.setFogFar(g);else if("a:sceneBatchBrightnessDisabled"===D)F.setBatchBrightnessDisabled(g);else if("a:sceneBatchBlendDisabled"===D)F.setBatchBlendDisabled(g);else if("a:sceneBatchColorDisabled"===D)F.setBatchColorDisabled(g);else if("a:sceneBatchInstancedDisabled"===D)F.setBatchInstancedDisabled(g);else if("a:sceneShadowEnabled"===D)g?F.enableShadow():F.disableShadow();else if("a:sceneShadowDegreeX"===D)F.setShadowDegreeX(g);else if("a:sceneShadowDegreeZ"===D)F.setShadowDegreeZ(g);else if("a:sceneShadowIntensity"===D)F.setShadowIntensity(g);else if("a:sceneShadowQuality"===D)F.setShadowQuality(g);else if("a:sceneShadowType"===D)F.setShadowType(g);else if("a:sceneShadowRadius"===D)F.setShadowRadius(g);else if("a:sceneShadowBias"===D)F.setShadowBias(g);else if("a:sceneBatchInfoMap"===D){F.setBatchInfoMap(g);var Z=this.batchView;Z&&(Z.parseBatchInfoMap(g),Z.updateProperties())}},T.prototype._setSceneOrtho=function(E){var F=this.scene,D=this.__updateEye__;D||(D=this.__updateEye__=function(){var E=new ht.Math.Vector3,D=new ht.Math.Vector3,g=new ht.Math.Vector3;return function(f){if(f){E.fromArray(F.getCenter()),D.fromArray(F.getEye()),D.sub(E);var T=[0,1,0];"right"===f?T=[1,0,0]:"front"===f&&(T=[0,0,1]),g.fromArray(T).setLength(D.length()).add(E),F.setEye(g.toArray())}}}());var g=this.__defaultInteractor__;if(!g)for(var f=F.getInteractors(),T=0,a=f.length;T<a;T++){var K=f.get(0);if(K instanceof ht.graph3d.EditInteractor){g=this.__defaultInteractor__=K;break}}var b=this.__orthoPanInteractor__;b||(b=this.__orthoPanInteractor__=new sF(F)),F.setOrtho(!!E),E?(F.setInteractors([b]),D(E)):F.setInteractors([g])},T.prototype.handleScenelPropertyChange=function(E){this.inspector&&this.inspector.global&&this.inspector.$34$(E),this._sceneInteracting||this.dataView.$66$(E)},T.prototype.handleSceneInteractive=function(E){this._sceneInteracting="betweenRotate"===E.kind||"betweenPan"===E.kind,this._sceneInteracting||this.dataView.$66$(E)},T.prototype.handleDataModelChange=function(E){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.dataView.$66$(E)},T.prototype.handleDataPropertyChange=function(E){var F=E.data;if("parent"===E.property&&F instanceof ht.Node&&!ht.Default.isIsolating()){var D=F.getParent();D instanceof ht.Block&&(D=null),(!D||D instanceof ht.Node)&&F.setHost(D)}this.inspector&&!this.inspector.global&&this.inspector.data===F&&"*"!==E.property&&this.inspector.$34$(E),this.dataView.$66$(E)},T.prototype.handleSelectionChange=function(){this.updateInspector()},T.prototype.handleInteractor=function(E){"selectPoint"===E.kind&&(this.currentPoint=void 0===E.x?null:{x:E.x,y:E.y,e:E.e},this.updateInspector())},T.prototype.updateInspector=function(){this.inspector=null;var E=this.ld;if(E){var F=E.s("shape3d");E instanceof ht.Block?this.inspector=this.blockInspector:E instanceof ht.Polyline?this.inspector=this.polylineInspector:E instanceof ht.Shape?"cylinder"===F?this.inspector=this.pipelineInspector:E.getThickness()>0?this.inspector=this.wallInspector:this.inspector=this.floorInspector:E instanceof ht.Light?this.inspector=this.lightInspector:E instanceof ht.Node?this.inspector=F?"billboard"===F||"plane"===F?this.billboardInspector:"cube"===F?this.cubeInspector:"box"===F?this.boxInspector:"cone"===F?this.coneInspector:"cylinder"===F?this.cylinderInspector:"sphere"===F?this.sphereInspector:"torus"===F?this.torusInspector:"star"===F||"rect"===F||"roundRect"===F||"triangle"===F||"rightTriangle"===F||"parallelogram"===F||"trapezoid"===F?this.rectInspector:this.modelInspector:this.cubeInspector:E instanceof ht.Edge&&(this.inspector=this.edgeInspector),this.inspector||(this.inspector=this.dataInspector)}else this.inspector=this.sceneInspector;this.inspector&&(this.inspector.data=E,this.inspector.filterPropertiesLater()),this.rightTopBorderPane.setCenterView(this.inspector)},T.prototype.reset=function(E){E||(this.url=null);var F=this.dm;F.disableHistoryManager(),F.setPostProcessingData(void 0),F.setName(void 0),F.setBackground(void 0),F.setHierarchicalRendering(!0),F.setLayers(void 0),F.setAttrObject(void 0),F.setEnvmap(void 0),F.setEnvmapType(void 0),F.clear();var D=this.gv;D.setZoom(1),D.tx(0),D.ty(0);var g=this.scene;g.setEye(m.config.sceneEye),g.setCenter(m.config.sceneCenter),F.a("sceneNear",m.config.sceneNear),F.a("sceneFar",m.config.sceneFar),F.a("sceneFovy",m.config.sceneFovy),F.a("connectActionType",m.config.sceneConnectActionType),F.a("sceneEditHelperDisabled",m.config.sceneEditHelperDisabled),F.a("sceneGridEnabled",m.config.sceneGridEnabled),F.a("sceneGridBlockCount",m.config.sceneGridBlockCount),F.a("sceneGridBlockSize",m.config.sceneGridBlockSize),F.a("sceneGridColor",m.config.sceneGridColor),F.a("sceneBatchBrightnessDisabled",m.config.sceneBatchBrightnessDisabled),F.a("sceneBatchBlendDisabled",m.config.sceneBatchBlendDisabled),F.a("sceneBatchColorDisabled",m.config.sceneBatchColorDisabled),F.a("sceneBatchInstancedDisabled",m.config.sceneBatchInstancedDisabled),F.a("sceneSkyboxType",m.config.sceneSkyboxType),F.a("sceneSkyboxLight",m.config.sceneSkyboxLight),F.a("sceneSkyboxLightMask",m.config.sceneSkyboxLightMask),F.a("sceneSkyboxBlurSize",m.config.sceneSkyboxBlurSize),F.a("sceneHighlightMode",m.config.sceneHighlightMode),F.a("sceneHighlightType",m.config.sceneHighlightType),F.a("sceneHighlightColor",m.config.sceneHighlightColor),F.a("sceneHighlightWidth",m.config.sceneHighlightWidth),F.a("sceneDashEnable",m.config.sceneDashEnable),F.a("sceneHeadlightEnable",m.config.sceneHeadlightEnable),F.a("sceneHeadlightRange",m.config.sceneHeadlightRange),F.a("sceneHeadlightColor",m.config.sceneHeadlightColor),F.a("sceneHeadlightIntensity",m.config.sceneHeadlightIntensity),F.a("sceneHeadlightAmbientIntensity",m.config.sceneHeadlightAmbientIntensity),F.a("sceneHighlightGlow",m.config.sceneHighlightGlow),F.a("sceneHighlightStrength",m.config.sceneHighlightStrength),F.a("sceneHighlightGroups",[{name:aD("editor.default")}]),F.a("sceneFogEnable",m.config.sceneFogEnable),F.a("sceneFogMode",m.config.sceneFogMode),F.a("sceneFogColor",m.config.sceneFogColor),F.a("sceneFogNear",m.config.sceneFogNear),F.a("sceneFogFar",m.config.sceneFogFar),F.a("sceneFogDensity",m.config.sceneFogDensity),F.a("sceneShadowEnabled",m.config.sceneShadowEnabled),F.a("sceneShadowDegreeX",m.config.sceneShadowDegreeX),F.a("sceneShadowDegreeZ",m.config.sceneShadowDegreeZ),F.a("sceneShadowIntensity",m.config.sceneShadowIntensity),F.a("sceneShadowQuality",m.config.sceneShadowQuality),F.a("sceneShadowType",m.config.sceneShadowType),F.a("sceneShadowRadius",m.config.sceneShadowRadius),F.a("sceneShadowBias",m.config.sceneShadowBias),F.a("sceneDof",m.config.sceneDof),F.a("sceneDofAperture",m.config.sceneDofAperture),F.a("sceneDofImage",m.config.sceneDofImage),F.a("sceneBloom",m.config.sceneBloom),F.a("sceneBloomStrength",m.config.sceneBloomStrength),F.a("sceneBloomThreshold",m.config.sceneBloomThreshold),F.a("sceneBloomRadius",m.config.sceneBloomRadius),F.a("sceneHueSaturation",m.config.sceneHueSaturation),F.a("sceneHueSaturationHue",m.config.sceneHueSaturationHue),F.a("sceneHueSaturationColorIndex",m.config.sceneHueSaturationColorIndex),F.a("sceneHueSaturationSaturation",m.config.sceneHueSaturationSaturation),F.a("sceneHueSaturationLightness",m.config.sceneHueSaturationLightness),g.setSkybox(null),g.setBatchInfoMap({}),this.batchView&&this.batchView.clearBatchInfo(),this.renderLayerView.clearRenderLayerInfo(),this.groupView.clearGroup(),F.enableHistoryManager(),F.clearHistoryManager()},T.prototype.getModelDialog=function(E){var F=this.modelDialogs[E];if(!F){var D=hteditor.config.modelDialogClasses?hteditor.config.modelDialogClasses[E]:null;D||(D=NF),F=this.modelDialogs[E]=new D(this)}return F},T.prototype.open=function(E,F){var D=this;if(ht.Default.isString(E)&&(E=this.getFileNode(E)),E&&!E.$33$){var g=E.url,f=E.path,T=E.getName?E.getName():void 0;"scene"===E.fileType?this.newScene(g):"model"===E.fileType?ht.Default.xhrLoad(g,function(E){E=ht.Default.parse(E),D.getModelDialog(E.modelType).open(g,E)}):"material"===E.fileType&&ht.Default.xhrLoad(g,function(E){E=ht.Default.parse(E),D.materialView.open(g,E,f,T)})}},T.prototype.newOBJModel=function(){this.modelView.open(void 0,{modelType:"obj"})},T.prototype.newFBXModel=function(){this.modelView.open(void 0,{modelType:"fbx"})},T.prototype.newGLTFModel=function(){this.modelView.open(void 0,{modelType:"gltf"})},T.prototype.newMaterial=function(){this.materialView.open()},T.prototype.newScene=function(E){E?(this.opened=!1,this.url=E,this.reload()):(this.reset(),this.fireEvent("sceneViewCreated",{sceneView:this}))},T.prototype.readForOld3dEditorFormat=function(E){var F=this.dm,D=E.scene;if(D&&(D.near&&F.a("sceneNear",D.near),D.far&&F.a("sceneFar",D.far),null!=D.shadow&&D.shadowParams)){F.a("sceneShadowEnabled",D.shadow);var g=D.shadowParams;for(var f in g){var T=g[f];null!=T&&F.a("sceneShadow"+f.charAt(0).toUpperCase()+f.substr(1),T)}}var a=F.getPostProcessingData();if(a){F.setPostProcessingData(void 0);var K=a.bloom;K&&(null!=K.enable&&F.a("sceneBloom",K.enable),null!=K.strength&&F.a("sceneBloomStrength",K.strength),null!=K.threshold&&F.a("sceneBloomThreshold",K.threshold),null!=K.radius&&F.a("sceneBloomRadius",K.radius));var b=a.dof;b&&(null!=b.enable&&F.a("sceneDof",b.enable),null!=b.aperture&&F.a("sceneDofAperture",b.aperture),null!=b.image&&F.a("sceneDofImage",b.image))}},T.prototype.reload=function(){var E=this,F=this.url;if(F){this.fireEvent(this.opened?"SceneViewReloading":"SceneViewOpening",{sceneView:this,url:F});var D=this.scene;this.reset(!0),this.dm.disableHistoryManager(),D.deserialize(F,{setId:m.config.setId,finishFunc:function(D,g){E.gv.fitContent(!0),E.readForOld3dEditorFormat(D);var f=D.scene;f&&(f.eye&&E.scene.setEye(f.eye),f.center&&E.scene.setCenter(f.center)),g.setPostProcessingData(void 0),E.dm.enableHistoryManager(),E.dm.clearHistoryManager(),E.fireEvent(E.opened?"SceneViewReloaded":"SceneViewOpened",{sceneView:E,
url:F}),E.opened=!0},disableOnPreDeserialize:!0,disableOnPostDeserialize:!0})}},T.prototype.save=function(){var E=this;if(this.url)this.saveImpl(this.url);else{var F=this.scenes.currentDir+"/",D=aD("editor.inputnewscenename"),g=function(F,D,g){if("ok"===D){var f=hteditor.isJSON(F)?hteditor.trimExtension(F):F,T=g+f+".json",a=!1;if(E.scenes.dataModel.each(function(E){E.url===T&&(a=!0)}),a){var K=[{label:aD("editor.ok"),action:function(){b.hide()}}],b=new ht.widget.Dialog({title:aD("editor.filenameconflict"),contentPadding:20,width:300,draggable:!0,content:"<p>"+T+"</p>",buttons:K});b.show()}else E.saveImpl(T)}},f={name:void 0,scene:this.scene};this.fireEvent("sceneNewNameInputing",f),f.name?g(f.name,"ok",F):hteditor.getInput(D,"",{nullable:!1,trim:!0,maxLength:hteditor.config.maxFileNameLength,path:F,editor:this,checkFunc:m.config.checkFileName,$38$:this.$38$},g)}},T.prototype.saveImpl=function(E){var F=this;if(E){this.url=E;var D={url:E,scene:this.scene};if(this.fireEvent("sceneSaving",D),D.preventDefault)return!1;D={path:D.url,content:this.serialize()},this.request("upload",D,function(g){!0===g&&(F.fireEvent("sceneSaved",D),F.messageView.show(aD("editor.savedsuccessfully")),D={path:E.substr(0,E.length-5)+".png",content:F.scene.toImage(F.dm.getBackground())},F.request("upload",D,function(D){!0===D&&F.selectFileNode(E)}))})}},T.prototype.preview=function(){var E=this.dm.a("previewURL")||"scene.html";this.url&&-1===E.indexOf("?")&&(E+="?tag="+encodeURI(this.url));var F={url:E};this.fireEvent("sceneViewPreviewing",F),window.open(F.url,F.url),F={path:"previews/scene.json",content:this.serialize()},this.request("upload",F,function(E){})},T.prototype.deserialize=function(E){this.scene.deserialize(E,function(E,F,D){})},T.prototype.serialize=function(){return t(this.toJSON())},T.prototype.toJSON=function(){var E=this.dm,F=E.toJSON(),D={},g=ht.Default.clone(this.scene.getEye());g.join(",")!==m.config.sceneEye.join(",")&&(D.eye=g);var f=ht.Default.clone(this.scene.getCenter());f.join(",")!==m.config.sceneCenter.join(",")&&(D.center=f),ht.Default.isEmptyObject(D)||(F.scene=D);var T=this.scene.getBatchInfoMap();ht.Default.isEmptyObject(T)||(F.a.sceneBatchInfoMap=T);var a=this.scene.getRenderLayerInfoMap();return ht.Default.isEmptyObject(a)||ht.Default.stringify(a)!==ht.Default.stringify({main:ht.Default.getRenderLayerInfo("main"),top:ht.Default.getRenderLayerInfo("top")})&&(F.a.sceneRenderLayerInfoMap=a),E.a("sceneNear")===m.config.sceneNear&&delete F.a.sceneNear,E.a("sceneFar")===m.config.sceneFar&&delete F.a.sceneFar,E.a("sceneFovy")===m.config.sceneFovy&&delete F.a.sceneFovy,E.a("sceneEditHelperDisabled")===m.config.sceneEditHelperDisabled&&delete F.a.sceneEditHelperDisabled,E.a("sceneGridEnabled")===m.config.sceneGridEnabled&&delete F.a.sceneGridEnabled,E.a("sceneGridBlockCount")===m.config.sceneGridBlockCount&&delete F.a.sceneGridBlockCount,E.a("sceneGridBlockSize")===m.config.sceneGridBlockSize&&delete F.a.sceneGridBlockSize,E.a("sceneGridColor")===m.config.sceneGridColor&&delete F.a.sceneGridColor,E.a("sceneBatchBrightnessDisabled")===m.config.sceneBatchBrightnessDisabled&&delete F.a.sceneBatchBrightnessDisabled,E.a("sceneBatchBlendDisabled")===m.config.sceneBatchBlendDisabled&&delete F.a.sceneBatchBlendDisabled,E.a("sceneBatchColorDisabled")===m.config.sceneBatchColorDisabled&&delete F.a.sceneBatchColorDisabled,E.a("sceneBatchInstancedDisabled")===m.config.sceneBatchInstancedDisabled&&delete F.a.sceneBatchInstancedDisabled,E.a("sceneSkyboxType")===m.config.sceneSkyboxType&&delete F.a.sceneSkyboxType,E.a("sceneHighlightMode")===m.config.sceneHighlightMode&&delete F.a.sceneHighlightMode,E.a("sceneHighlightType")===m.config.sceneHighlightType&&delete F.a.sceneHighlightType,E.a("sceneHighlightColor")===m.config.sceneHighlightColor&&delete F.a.sceneHighlightColor,E.a("sceneHighlightWidth")===m.config.sceneHighlightWidth&&delete F.a.sceneHighlightWidth,E.a("sceneHighlightGlow")===m.config.sceneHighlightGlow&&delete F.a.sceneHighlightGlow,E.a("sceneHighlightStrength")===m.config.sceneHighlightStrength&&delete F.a.sceneHighlightStrength,E.a("sceneHighlightGroups")===ht.Default.stringify([{name:aD("editor.default")}])&&delete F.a.sceneHighlightGroups,E.a("sceneDashEnable")===m.config.sceneDashEnable&&delete F.a.sceneDashEnable,E.a("sceneHeadlightEnable")===m.config.sceneHeadlightEnable&&delete F.a.sceneHeadlightEnable,E.a("sceneHeadlightRange")===m.config.sceneHeadlightRange&&delete F.a.sceneHeadlightRange,E.a("sceneHeadlightColor")===m.config.sceneHeadlightColor&&delete F.a.sceneHeadlightColor,E.a("sceneHeadlightIntensity")===m.config.sceneHeadlightIntensity&&delete F.a.sceneHeadlightIntensity,E.a("sceneHeadlightAmbientIntensity")===m.config.sceneHeadlightAmbientIntensity&&delete F.a.sceneHeadlightAmbientIntensity,E.a("sceneFogEnable")===m.config.sceneFogEnable&&delete F.a.sceneFogEnable,E.a("sceneFogColor")===m.config.sceneFogColor&&delete F.a.sceneFogColor,E.a("sceneFogNear")===m.config.sceneFogNear&&delete F.a.sceneFogNear,E.a("sceneFogFar")===m.config.sceneFogFar&&delete F.a.sceneFogFar,E.a("sceneFogMode")===m.config.sceneFogMode&&delete F.a.sceneFogMode,E.a("sceneFogDensity")===m.config.sceneFogDensity&&delete F.a.sceneFogDensity,E.a("sceneShadowEnabled")===m.config.sceneShadowEnabled&&delete F.a.sceneShadowEnabled,E.a("sceneShadowDegreeX")===m.config.sceneShadowDegreeX&&delete F.a.sceneShadowDegreeX,E.a("sceneShadowDegreeZ")===m.config.sceneShadowDegreeZ&&delete F.a.sceneShadowDegreeZ,E.a("sceneShadowIntensity")===m.config.sceneShadowIntensity&&delete F.a.sceneShadowIntensity,E.a("sceneShadowQuality")===m.config.sceneShadowQuality&&delete F.a.sceneShadowQuality,E.a("sceneShadowType")===m.config.sceneShadowType&&delete F.a.sceneShadowType,E.a("sceneShadowRadius")===m.config.sceneShadowRadius&&delete F.a.sceneShadowRadius,E.a("sceneShadowBias")===m.config.sceneShadowBias&&delete F.a.sceneShadowBias,E.a("sceneDof")===m.config.sceneDof&&delete F.a.sceneDof,E.a("sceneDofAperture")===m.config.sceneDofAperture&&delete F.a.sceneDofAperture,E.a("sceneDofImage")===m.config.sceneDofImage&&delete F.a.sceneDofImage,E.a("sceneBloom")===m.config.sceneBloom&&delete F.a.sceneBloom,E.a("sceneBloomStrength")===m.config.sceneBloomStrength&&delete F.a.sceneBloomStrength,E.a("sceneBloomThreshold")===m.config.sceneBloomThreshold&&delete F.a.sceneBloomThreshold,E.a("sceneBloomRadius")===m.config.sceneBloomRadius&&delete F.a.sceneBloomRadius,E.a("sceneHueSaturation")===m.config.sceneHueSaturation&&delete F.a.sceneHueSaturation,E.a("sceneHueSaturationHue")===m.config.sceneHueSaturationHue&&delete F.a.sceneHueSaturationHue,E.a("sceneHueSaturationColorIndex")&&delete F.a.sceneHueSaturationColorIndex,E.a("sceneHueSaturationSaturation")===m.config.sceneHueSaturationSaturation&&delete F.a.sceneHueSaturationSaturation,E.a("sceneHueSaturationLightness")===m.config.sceneHueSaturationLightness&&delete F.a.sceneHueSaturationLightness,F},T.prototype.$3$=function(){return this._interactionState},T.prototype.$4$=function(E,F){var D=this;if(this._interactionState!==E){this._interactionState=E,this.pointsEditingMode=!1;var g=[];this.gv.getInteractors().each(function(F){F.keep?F.interactiveDisabled="edit"!==E:g.push(F)}),g.forEach(function(E){E.tearDown(),D.gv.getInteractors().remove(E)}),"edit"!==E&&(F.setUp(),this.gv.getInteractors().add(F)),this.gv.invalidateSelection(),this.rulerView.validateCanvas(),this.mainToolbar.iv()}},T.prototype.request=function(E,F,D,g){var f=this;D=D||k,g?setTimeout(function(){f.$39$.request(E,F,D)},g):this.$39$.request(E,F,D)},T.prototype.requestScenes=function(){var F=this;this._requestingScenes||(this.request("explore","/scenes",function(D){F._requestingScenes=!1,F.scenes.parse(D),F._pendingOpenJSON&&E(F._pendingOpenJSON)&&(F.scenes.dataModel.getDataById(F._pendingOpenJSON)?(F.open(F._pendingOpenJSON),F.selectFileNode(F._pendingOpenJSON)):m.config.newIfFailToOpen&&(F.newScene(),F.url=F._pendingOpenJSON,F.save()),delete F._pendingOpenJSON),F._pendingSelectURL&&E(F._pendingSelectURL)&&F.selectFileNode(F._pendingSelectURL)},hteditor.config.requestDelay),this._requestingScenes=!0)},T.prototype.requestSymbols=function(){hteditor.Editor.prototype.requestSymbols.apply(this,arguments)},T.prototype.requestMaterials=function(){var E=this;this._requestingMaterials||(this.request("explore","/materials",function(F){E._requestingMaterials=!1,E.materials.parse(F),E._pendingOpenJSON&&f(E._pendingOpenJSON)&&(E.materials.dataModel.getDataById(E._pendingOpenJSON)?(E.open(E._pendingOpenJSON),E.selectFileNode(E._pendingOpenJSON)):m.config.newIfFailToOpen&&(E.newScene(),E.url=E._pendingOpenJSON,E.save()),delete E._pendingOpenJSON),E._pendingSelectURL&&f(E._pendingSelectURL)&&E.selectFileNode(E._pendingSelectURL)},hteditor.config.requestDelay),this._requestingMaterials=!0)},T.prototype.requestModels=function(){hteditor.Editor.prototype.requestModels.apply(this,arguments)},T.prototype.requestAssets=function(){hteditor.Editor.prototype.requestAssets.apply(this,arguments)},T.prototype.requestBase64=function(E,F){this.request("source",{url:E,encoding:"base64",prefix:"data:;base64,"},F)},T.prototype.copy=function(){if(this.ld){this.serializer.dm=this.scene.dm(),this.serializer._blocks=this.scene.sm().toSelection(function(E){return E instanceof ht.Block});var E=this.serializer.toJSON();delete E.p,delete E.a,this._cloneJSON=ht.Default.stringify(E)}},T.prototype.paste=function(){var E=this;if(this._cloneJSON){var F=new ht.DataModel;new ht.JSONSerializer(F).deserialize(this._cloneJSON),F.each(function(F){E.dm.getDataByTag(F.getTag())&&F.setTag(void 0)});var D=ht.Default.parse(F.serialize());delete D.p;var g=this.serializer.deserialize(D);this.scene.sm().ss(g)}},T.prototype.hasCopyInfo=function(){return!!this._cloneJSON},T.prototype.undo=function(){hteditor.Editor.prototype.undo.apply(this,arguments)},T.prototype.redo=function(){hteditor.Editor.prototype.redo.apply(this,arguments)},T.prototype.renameFile=function(){hteditor.Editor.prototype.renameFile.apply(this,arguments)},T.prototype.getFileNode=function(){return hteditor.Editor.prototype.getFileNode.apply(this,arguments)},T.prototype.moveFile=function(){hteditor.Editor.prototype.moveFile.apply(this,arguments)},T.prototype.removeFiles=function(){hteditor.Editor.prototype.removeFiles.apply(this,arguments)},T.prototype.locate=function(){hteditor.Editor.prototype.locate.apply(this,arguments)},T.prototype.newFolder=function(){hteditor.Editor.prototype.newFolder.apply(this,arguments)},T.prototype.toggleLeft=function(){"normal"===this.leftSplitView.getStatus()?this.leftSplitView.setStatus("cl"):this.leftSplitView.setStatus("normal")},T.prototype.toggleRight=function(){"normal"===this.mainSplitView.getStatus()?this.mainSplitView.setStatus("cr"):this.mainSplitView.setStatus("normal")},T.prototype.fitSelection=function(){var E=this.dm.sm().getSelection();0===E.length&&(E=null),this.zoomToFit(E)},T.prototype.$48$=function(E){hteditor.Editor.prototype.$48$.apply(this,arguments)},T.prototype.$47$=function(E){hteditor.Editor.prototype.$47$.apply(this,arguments)},T.prototype.handleKeydown=function(E){"Shift"===E.key&&this.scene.iv(),hteditor.Editor.prototype.handleKeydown.apply(this,arguments)},T.prototype.selectFileNode=function(E){hteditor.Editor.prototype.selectFileNode.apply(this,arguments)},T.prototype.dropLocalFileOnDir=function(E,F){hteditor.Editor.prototype.dropLocalFileOnDir.apply(this,arguments)},T.prototype.uploadLocalFile=function(E,F){hteditor.Editor.prototype.uploadLocalFile.apply(this,arguments)},T.prototype.zoomIn=function(){this.gv&&this.gv.zoomIn(m.config.animate),this.scene&&this.scene.zoomIn(m.config.animate)},T.prototype.zoomOut=function(){this.gv&&this.gv.zoomOut(m.config.animate),this.scene&&this.scene.zoomOut(m.config.animate)},T.prototype.zoomToFit=function(E){this.scene.flyTo(E,{animation:m.config.animate});var F=this.gv;if(!E)return void F.fitContent(m.config.animate,m.config.fitPadding);var D;E.each(function(E){D=ht.Default.unionRect(D,F.getDataUIBounds(E))}),ht.Default.grow(D,20,20),F.fitRect(D,m.config.animate)},T.prototype.zoomReset=function(){this.gv&&this.gv.zoomReset(m.config.animate),this.scene&&this.scene.isResettable()&&this.scene.reset()},T.prototype.saveImage=function(){hteditor.Editor.prototype.saveImage.apply(this,arguments)},T.prototype.createSceneItem=function(E,F,D,g){var f=this,T=function(){return f.$3$()===E},a=hteditor.createItem(E,F,D,T);return a.action=function(){f.$4$(E,g)},a},T.prototype.resetInteractionState=function(){this.$4$("edit")},T.prototype.isRulerEnabled=function(){return this.rulerView.isRulerEnabled()},T.prototype.setRulerEnabled=function(E){this.rulerView.setRulerEnabled(E)},T.prototype.toggleRulerEnabled=function(){this.setRulerEnabled(!this.isRulerEnabled())},T.prototype.block=function(){if(this.editable){var E=this.dm.sm().getSelection();if(E.length){this.beginTransaction();var F=new ht.Block;F.setScaleMode("3d"),E.forEach(function(E){E.setParent(F)}),this.dm.add(F),this.sm.ss(F),this.endTransaction()}}},T.prototype.unblock=function(){var E=this;if(this.editable){this.beginTransaction();var F=[];this.sm.toSelection().each(function(D){if(D instanceof ht.Block&&!(D instanceof ht.RefGraph)){var g=D.getParent();D.getChildren().toArray().forEach(function(E){E.setParent(g),F.push(E)}),E.dm.remove(D)}}),F.length&&this.sm.ss(F),this.endTransaction()}},T.prototype.bringToFront=function(){},T.prototype.sendToBack=function(){},T.prototype.bringForward=function(){},T.prototype.sendBackward=function(){},T.prototype.filterProperties=function(){hteditor.Editor.prototype.filterProperties.apply(this,arguments)},N(T,[{key:"url",get:function(){return this._url},set:function(E){this._url=E,this.dataView.updateUrl()}},{key:"explorer",get:function(){var E=this.leftTopTabView.getTabModel().sm().ld();return E&&E.getView()}},{key:"dir",get:function(){return this.explorer?this.explorer.tree.getSelectionModel().getLastData():null}},{key:"file",get:function(){return this.explorer?this.explorer.getFileListView().getSelectionModel().getLastData():null}},{key:"ld",get:function(){return this.sm.ld()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"editInteractor",get:function(){return this.gv.getEditInteractor()}},{key:"pointsEditingMode",get:function(){return this.editInteractor.pointsEditingMode},set:function(E){this.editInteractor.pointsEditingMode=E}},{key:"anchorVisible",get:function(){return this.editInteractor.getStyle("anchorVisible")},set:function(E){this.editInteractor.setStyle("anchorVisible",E)}},{key:"sceneInspector",get:function(){return this._sceneInspector||(this._sceneInspector=new KE(this)),this._sceneInspector}},{key:"dataInspector",get:function(){return this._dataInspector||(this._dataInspector=new $E(this)),this._dataInspector}},{key:"cubeInspector",get:function(){return this._cubeInspector||(this._cubeInspector=new tE(this)),this._cubeInspector}},{key:"coneInspector",get:function(){return this._coneInspector||(this._coneInspector=new PE(this)),this._coneInspector}},{key:"cylinderInspector",get:function(){return this._cylinderInspector||(this._cylinderInspector=new dE(this)),this._cylinderInspector}},{key:"rectInspector",get:function(){return this._rectInspector||(this._rectInspector=new xE(this)),this._rectInspector}},{key:"sphereInspector",get:function(){return this._sphereInspector||(this._sphereInspector=new SE(this)),this._sphereInspector}},{key:"lightInspector",get:function(){return this._lightInspector||(this._lightInspector=new OE(this)),this._lightInspector}},{key:"torusInspector",get:function(){return this._torusInspector||(this._torusInspector=new ME(this)),this._torusInspector}},{key:"modelInspector",get:function(){return this._modelInspector||(this._modelInspector=new eE(this)),this._modelInspector}},{key:"boxInspector",get:function(){return this._boxInspector||(this._boxInspector=new vE(this)),this._boxInspector}},{key:"billboardInspector",get:function(){return this._billboardInspector||(this._billboardInspector=new gF(this)),this._billboardInspector}},{key:"wallInspector",get:function(){return this._wallInspector||(this._wallInspector=new TF(this)),this._wallInspector}},{key:"floorInspector",get:function(){return this._floorInspector||(this._floorInspector=new $F(this)),this._floorInspector}},{key:"pipelineInspector",get:function(){return this._pipelineInspector||(this._pipelineInspector=new WF(this)),this._pipelineInspector}},{key:"polylineInspector",get:function(){return this._polylineInspector||(this._polylineInspector=new oF(this)),this._polylineInspector}},{key:"edgeInspector",get:function(){return this._edgeInspector||(this._edgeInspector=new mF(this)),this._edgeInspector}},{key:"blockInspector",get:function(){return this._blockInspector||(this._blockInspector=new JF(this)),this._blockInspector}},{key:"selection",get:function(){var E=this,F=[];return this.gv&&this.gv.each(function(D){E.gv.isSelected(D)&&F.push(D)}),F}},{key:"modelView",get:function(){return this._modelView?this._modelView:(this._modelView=new NF(this),this.modelDialogs.obj=this._modelView,this.modelDialogs.fbx=this._modelView,this.modelDialogs.gltf=this._modelView,this._modelView)}},{key:"materialView",get:function(){return this._materialView?this._materialView:(this._materialView=new CF(this),this._materialView)}},{key:"chooseDirectoryDialog",get:function(){return!this._chooseDirectoryDialog&&m.ChooseDirectoryDialog&&(this._chooseDirectoryDialog=new m.ChooseDirectoryDialog(this)),this._chooseDirectoryDialog}}]),T}();return m.Editor3d=KD,m.version="5.0.3.2",m.logEditorInfo=function(){m.config.logEditorInfo&&console.log("HT 3D Editor v5.0.3.2 powered by HT for Web v"+ht.Default.getVersion()+" from www.hightopo.com")},m.createEditor3d=function(E){if(m.logEditorInfo(),window.location.host.indexOf("hightopo")>=0){var F="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cdiv style='display:none'%3E%3Cspan id='cnzz_stat_icon_1000279011'%3E%3C/span%3E%3Cscript src='"+F+"s23.cnzz.com/z_stat.php%3Fid%3D1000279011%26show%3Dpic' type='text/javascript'%3E%3C/script%3E%3C/div%3E")),document.body.style.margin="0px",document.body.style.padding="0px"}E&&(ht.Default.isString(E)?E={container:E}:E.tagName&&E.appendChild&&(E={container:E})),E=E||{};var D=void 0,g=void 0===E.container?m.config.container:E.container;return null===g?D=null:g?ht.Default.isString(g)?D=document.getElementById(g):g.length?(D=ht.Default.createDiv(),D.style.left=g[0]+"px",D.style.top=g[1]+"px",D.style.width=g[2]+"px",D.style.height=g[3]+"px",document.body.appendChild(D)):D=g:D=document.body,E.$38$=D,new KD(E)},m.config.valueTypes||(m.config.valueTypes={}),m.config.valueTypes.HighlightEnum={type:"enum",values:[0,1,2],i18nLabels:["editor.none","editor.selected","editor.hover"]},m}();