!function(A,K,c){"use strict";var C=A.ht,_=C.Default,d=_.getInternal(),U=(_.clone,_.def),N=C.WebGLConstants,n=C.Math.Matrix4,V=C.Math.Vector3;function k(U){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(U);for(var N="",Z=0,Q=U.length;Z<Q;Z++)N+=String.fromCharCode(U[Z]);try{return decodeURIComponent(escape(N))}catch(U){return N}}var a=new RegExp("[\\[\\]\\.:\\/]","g");function p(){this.userData={},this.matrix=new n,this.matrixWorld=new n,p.superClass.constructor.apply(this,arguments)}function I(U){for(var N in this.texture=!0,U)this[N]=U[N]}function P(U,N){this.mat=N,this.mesh=U,this.userData={},P.superClass.constructor.apply(this,arguments)}function y(){this.uuid=C.Math.generateUUID(),this.name="",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null}U(p,C.Data,{add:function(U){this.addChild(U)},traverse:function(U){_.traverse(this,U)},applyMatrix4:function(U){this.matrix.premultiply(U),this.getParent()?this.matrixWorld.multiplyMatrices(this.getParent().matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix)}});var X=function(){this.type="pbr",this.setValues=function(U){if(U){for(var N in U)this[N]=U[N];return this}},this.clone=function(){var U,N=new X;for(U in this)this[U]&&(N[U]=this[U]);return N}},Z=(U(P,p,{normalizeSkinWeights:function(){var U=new C.Math.Vector4,N=this.mesh.attributes.skinWeight;if(N)for(var Z=0,Q=N.count;Z<Q;Z++){U.fromBufferAttribute(N,Z);var o=1/U.manhattanLength();o!=1/0?U.multiplyScalar(o):U.set(1,0,0,0),N.setXYZW(Z,U.x,U.y,U.z,U.w)}}}),new C.Math.Matrix4);function $(U,N,Z){this.name="",this.array=U,this.itemSize=N,this.count=U!==c?U.length/N:0,this.normalized=!0===Z,this.usage=C.WebGLConstants.STATIC_DRAW,this.updateRange={offset:0,count:-1},this.version=0}U(y,K,{setIndex:function(U){return Array.isArray(U)?this.index=new(65535<arrayMax(U)?s:f)(U,1):this.index=U,this},setAttribute:function(U,N){return this.attributes[U]=N,this},deleteAttribute:function(U){return delete this.attributes[U],this},hasAttribute:function(U){return this.attributes[U]!==c},applyMatrix4:function(U){var N=this.attributes.position,N=(N!==c&&(N.applyMatrix4(U),N.needsUpdate=!0),this.attributes.normal),Z=(N!==c&&(Z=(new C.Math.Matrix3).getNormalMatrix(U),N.applyNormalMatrix(Z),N.needsUpdate=!0),this.attributes.tangent);return Z!==c&&(Z.transformDirection(U),Z.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},applyQuaternion:function(U){return Z.makeRotationFromQuaternion(U),this.applyMatrix4(Z),this},addGroup:function(U,N,Z){this.groups.push({start:U,count:N,materialIndex:Z||0})},setFromPoints:function(U){for(var N=[],Z=0,Q=U.length;Z<Q;Z++){var o=U[Z];N.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new u(N,3)),this}}),K.defineProperty($.prototype,"needsUpdate",{set:function(U){!0===U&&this.version++}});var Q=new V;function o(U,N,Z){$.call(this,new Int8Array(U),N,Z)}function r(U,N,Z){$.call(this,new Uint8Array(U),N,Z)}function H(U,N,Z){$.call(this,new Uint8ClampedArray(U),N,Z)}function i(U,N,Z){$.call(this,new Int16Array(U),N,Z)}function f(U,N,Z){$.call(this,new Uint16Array(U),N,Z)}function G(U,N,Z){$.call(this,new Int32Array(U),N,Z)}function s(U,N,Z){$.call(this,new Uint32Array(U),N,Z)}function u(U,N,Z){$.call(this,new Float32Array(U),N,Z)}function w(U,N,Z){$.call(this,new Float64Array(U),N,Z)}K.assign($.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(U){return this.usage=U,this},copy:function(U){return this.name=U.name,this.array=new U.array.constructor(U.array),this.itemSize=U.itemSize,this.count=U.count,this.normalized=U.normalized,this.usage=U.usage,this},copyAt:function(U,N,Z){U*=this.itemSize,Z*=N.itemSize;for(var Q=0,o=this.itemSize;Q<o;Q++)this.array[U+Q]=N.array[Z+Q];return this},copyArray:function(U){return this.array.set(U),this},copyColorsArray:function(U){for(var N=this.array,Z=0,Q=0,o=U.length;Q<o;Q++){var K=U[Q];K===c?(N[Z++]=1,N[Z++]=1,N[Z++]=1):(N[Z++]=K.r,N[Z++]=K.g,N[Z++]=K.b)}return this},copyVector2sArray:function(U){for(var N=this.array,Z=0,Q=0,o=U.length;Q<o;Q++){var K=U[Q];K===c&&(K=new Vector2),N[Z++]=K.x,N[Z++]=K.y}return this},copyVector3sArray:function(U){for(var N=this.array,Z=0,Q=0,o=U.length;Q<o;Q++){var K=U[Q];K===c&&(K=new V),N[Z++]=K.x,N[Z++]=K.y,N[Z++]=K.z}return this},copyVector4sArray:function(U){for(var N=this.array,Z=0,Q=0,o=U.length;Q<o;Q++){var K=U[Q];K===c&&(K=new Vector4),N[Z++]=K.x,N[Z++]=K.y,N[Z++]=K.z,N[Z++]=K.w}return this},applyMatrix3:function(U){for(var N=0,Z=this.count;N<Z;N++)Q.x=this.getX(N),Q.y=this.getY(N),Q.z=this.getZ(N),Q.applyMatrix3(U),this.setXYZ(N,Q.x,Q.y,Q.z);return this},applyMatrix4:function(U){for(var N=0,Z=this.count;N<Z;N++)Q.x=this.getX(N),Q.y=this.getY(N),Q.z=this.getZ(N),Q.applyMatrix4(U),this.setXYZ(N,Q.x,Q.y,Q.z);return this},applyNormalMatrix:function(U){for(var N=0,Z=this.count;N<Z;N++)Q.x=this.getX(N),Q.y=this.getY(N),Q.z=this.getZ(N),Q.applyNormalMatrix(U),this.setXYZ(N,Q.x,Q.y,Q.z);return this},transformDirection:function(U){for(var N=0,Z=this.count;N<Z;N++)Q.x=this.getX(N),Q.y=this.getY(N),Q.z=this.getZ(N),Q.transformDirection(U),this.setXYZ(N,Q.x,Q.y,Q.z);return this},set:function(U,N){return this.array.set(U,N=N===c?0:N),this},getX:function(U){return this.array[U*this.itemSize]},setX:function(U,N){return this.array[U*this.itemSize]=N,this},getY:function(U){return this.array[U*this.itemSize+1]},setY:function(U,N){return this.array[U*this.itemSize+1]=N,this},getZ:function(U){return this.array[U*this.itemSize+2]},setZ:function(U,N){return this.array[U*this.itemSize+2]=N,this},getW:function(U){return this.array[U*this.itemSize+3]},setW:function(U,N){return this.array[U*this.itemSize+3]=N,this},setXY:function(U,N,Z){return U*=this.itemSize,this.array[U+0]=N,this.array[U+1]=Z,this},setXYZ:function(U,N,Z,Q){return U*=this.itemSize,this.array[U+0]=N,this.array[U+1]=Z,this.array[U+2]=Q,this},setXYZW:function(U,N,Z,Q,o){return U*=this.itemSize,this.array[U+0]=N,this.array[U+1]=Z,this.array[U+2]=Q,this.array[U+3]=o,this},onUpload:function(U){return this.onUploadCallback=U,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),(o.prototype=K.create($.prototype)).constructor=o,(r.prototype=K.create($.prototype)).constructor=r,(H.prototype=K.create($.prototype)).constructor=H,(i.prototype=K.create($.prototype)).constructor=i,f.prototype=K.create($.prototype),f.prototype.constructor=f,(G.prototype=K.create($.prototype)).constructor=G,s.prototype=K.create($.prototype),s.prototype.constructor=s,(u.prototype=K.create($.prototype)).constructor=u,(w.prototype=K.create($.prototype)).constructor=w;var F={5:"triangleStrip",6:"triangleFan",1:"lines",2:"lineLoop",3:"lineStrip"},b=(F[N.POINTS]="points",{position:"vs",normal:"ns"}),E=new n,O=C.Math.newIdGenerator(),m=function(U,N,Z,Q,o){var K=N.mat;if(K){var r=o[K.name||(K.name="material_"+O.next())]={};for(A in K)"name"!==A&&"setValues"!==A&&"clone"!==A&&(r[A]=K[A]);U.mat=K.name}var H=N.mesh;if(H){U.mesh=i={},H.index&&(i.is=H.index.array);var i,A,I=H.attributes;for(A in I){var _=b[A]||A;Z.ignoreNormal&&"ns"===_||(i[_]=I[A].array)}}N.matrix&&!N.matrix.equals(E)?decomposeTRS(U,N.matrix):(N.position&&(U.position=N.position),(N.rotation||N.quaternion)&&(U.quaternion=N.rotation||N.quaternion),N.scale&&(U.scale=N.scale)),N.userData&&(H=N.userData.transformData)&&(H.rotationOffset||H.rotationPivot||H.scalingOffset||H.scalingPivot)&&((y=U.transformData={}).translation=H.translation||[0,0,0],H.rotation?((k=H.rotation.map(degToRad)).push(H.eulerOrder),y.rotation=k):y.rotation=[0,0,0,1],y.scale=H.scale||[1,1,1],copyIfExists(y,H,"rotationOffset"),copyIfExists(y,H,"rotationPivot"),copyIfExists(y,H,"scalingOffset"),copyIfExists(y,H,"scalingPivot")),N.matrixWorld=(new n).composeFromArray(U.position,U.quaternion,U.scale),N._matrixWorldNeedUpdate=!0;N.isBone&&(U.isBone=!0),U.name=N.name,U.ID=N.ID;var d,k=N.skeleton,y=(k&&(U.skeleton=k),N.animations),p=(y&&(U.animations=y),N.getChildren().getArray());if(p){U.comps=[];for(var P=0,X=p.length;P<X;P++)U.comps.push(d={}),m(d,p[P],Z,Q,o)}};function D(U,i,A){var I=C.Math.generateUUID();_.addPendingPlaceholder(I),new B(i).parse(U,"",function(U){var N,y={model3d:!0,matDef:{}},Z=U.scene,Q=(m(y,Z,i,{},y.matDef),_.traverse(y,null,function(U){var N=y.matDef,Z=U.mat;if(Z&&(Z=N[Z])&&Z.map){N=Z.map.uvMatrix;if(N){Z=U.mesh;if(Z){var Q=Z.uv;if(Q){for(var o=new Float32Array(Q.length),K=N[0],r=N[1],H=N[3],i=N[4],A=N[6],I=N[7],_=0;_<Q.length;_+=2){var d=Q[_],k=Q[_+1];o[_]=K*d+H*k+A,o[_+1]=r*d+i*k+I}Z.uv=o}}}}},"comps"),U.animations),Q=(Q&&(y.animations=Q),U.assets),o=(Q&&(y.assets=Q),{}),K={};_.traverse(y,null,function(U){if(o[U.name]){for(U.displayName=U.name;N=U.name+"_"+C.Math.generateIncreasingID(),o[N];);U.name=N}o[U.name]=U.ID,K[U.ID]=U.name,delete U.ID},"comps"),y.animations&&y.animations.forEach(function(U){U.tracks.forEach(function(U){var N=U.name.split(".");N[0]&&K[N[0]]&&(U.name=K[N[0]]+"."+N.slice(1).join("."))})}),_.traverse(y,null,function(U){var N=U.skeleton;if(N){for(var Z=N[0],Q=Z.length,o=new Array(Q),K=0;K<Q;K++)o[K]=Z[K].name;U.skeleton={bones:o,boneMatrixInverses:N[1],bindMatrix:N[2].toArray(),bindMatrixInverse:(new n).copy(N[2]).invert().toArray()}}},"comps"),_.traverse(y,null,function(U){var N=U.comps;if(N)for(var Z=N.length-1;0<=Z;Z--){var Q=N[Z];Q.mesh||Q.isBone||Q.comps&&Q.comps.length||N.splice(Z,1)}},"comps"),d.completeCubeCenterOfModel3d(y,{scene:Z,cube:i.cube,center:i.center,rotationMode:i.rotationMode,t3:i.t3,r3:i.r3,s3:i.s3});i.flipY&&_.traverse(y,function(U){U=U.mesh;if(U&&(U.uv||U.uv2)){for(var N=1,Z=U.uv,Q=Z?Z.length:0;N<Q;N+=2)Z[N]=1-Z[N];for(N=1,Q=(Z=U.uv2)?Z.length:0;N<Q;N+=2)Z[N]=1-Z[N]}},null,"comps");var r=i.matDef;if(r)if(y.matDef)for(var H in r)y.matDef[H]=r[H];else y.matDef=r;i.shape3d&&_.setShape3dModel(i.shape3d,y),i.playAutomatically&&(y.playAutomatically=!0),U.externalAssetURIs&&(y.externalAssetURIs=U.externalAssetURIs),!i.ignoreNormal&&i.mikktTangent&&C.Math.MikktSpaceAlgorithm&&C.Math.MikktSpaceAlgorithm.generateMikktTangents(y,i.tangentFlipW),A&&A(y),_.removePendingPlaceholder(I,y)},function(U){console.error(U),A&&A(null),_.removePendingPlaceholder(I,null)})}function S(U,N,Z,Q){if("string"!=typeof U||0<=U.indexOf("data:")||0<=U.indexOf("blob:"))return Q(U,!0);if(N){N=N[U];if(N)return Q(N)}_.convertGltfAssetsURL?_.convertGltfAssetsURL(U,Z,Q):Q(Z+U)}d.addMethod(_,{loadGltf:function(Q,o){if(!(o=o||{}).path)for(var U=Q.length-1;0<=U;U--){var N=Q.charAt(U);if("/"===N||"\\"===N){o.path=Q.substring(0,U+1);break}}o.responseType="arraybuffer",_.xhrLoad(Q,function(U){var Z;U=U,Z=o.finishFunc,U||Z(null),D(U,o,function(U){var N=o.shape3d;U?Z&&Z(U,Q,N):Z&&Z(null)})},o)},parseGltf:D,convertGltfAssetsURL:null});var B=function(U){U=U||{},this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.assetsURIMap=U.assetsURIMap,this.path=U.path||"",this.register(function(U){return new j(U)}),this.register(function(U){return new UX(U)}),this.register(function(U){return new NX(U)}),this.register(function(U){return new T(U)}),this.register(function(U){return new q(U)}),this.register(function(U){return new l(U)}),this.register(function(U){return new t(U)}),this.register(function(U){return new x(U)}),this.register(function(U){return new Y(U)}),this.register(function(U){return new ZX(U)})};function z(){var Z={};return{get:function(U){return Z[U]},add:function(U,N){Z[U]=N},remove:function(U){delete Z[U]},removeAll:function(){Z={}}}}U(B,K,{getDRACOLoader:function(){var U=this.dracoLoader;return U||(U=(new nX).setDecoderPath(_.dracoLibraryPath||""),this.setDRACOLoader(U),U)},setDRACOLoader:function(U){return this.dracoLoader=U,this},setDDSLoader:function(){throw new Error('GLTFLoader: use "KHR_texture_basisu" instead.')},setKTX2Loader:function(U){return this.ktx2Loader=U,this},setMeshoptDecoder:function(U){return this.meshoptDecoder=U,this},register:function(U){return-1===this.pluginCallbacks.indexOf(U)&&this.pluginCallbacks.push(U),this},unregister:function(U){return-1!==this.pluginCallbacks.indexOf(U)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(U),1),this},parse:function(U,N,Z,Q){var o,K={},r={};if("string"==typeof U)o=U;else if(k(new Uint8Array(U,0,4))===QX){try{K[e.KHR_BINARY_GLTF]=new rX(U)}catch(U){return void(Q&&Q(U))}o=K[e.KHR_BINARY_GLTF].content}else o=k(new Uint8Array(U));var H=JSON.parse(o);if(H.asset===c||H.asset.version[0]<2)Q&&Q(new Error("GLTFLoader: only glTF versions >=2.0 are supported."));else{for(var i=new PX(H,{assetsURIMap:this.assetsURIMap,path:N||this.resourcePath||this.path||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder}),A=0;A<this.pluginCallbacks.length;A++){var I=this.pluginCallbacks[A](i);K[(r[I.name]=I).name]=!0}if(H.extensionsUsed)for(A=0;A<H.extensionsUsed.length;++A){var _=H.extensionsUsed[A],d=H.extensionsRequired||[];switch(_){case e.KHR_MATERIALS_UNLIT:K[_]=new W;break;case e.KHR_DRACO_MESH_COMPRESSION:K[_]=new HX(H,this.getDRACOLoader());break;case e.KHR_TEXTURE_TRANSFORM:K[_]=new iX;break;case e.KHR_MESH_QUANTIZATION:K[_]=new AX;break;default:0<=d.indexOf(_)&&r[_]===c&&console.warn('GLTFLoader: Unknown extension "'+_+'".')}}i.setExtensions(K),i.setPlugins(r),i.parse(Z,Q)}},parseAsync:function(Z,Q){var o=this;return new Promise(function(U,N){o.parse(Z,Q,U,N)})}});var e={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},Y=function(U){this.parser=U,this.name=e.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}},W=(U(Y,K,{_markDefs:function(){},createNodeAttachment:function(){return null}}),function(){this.name=e.KHR_MATERIALS_UNLIT}),x=(U(W,K,{getMaterialType:function(){return g},extendParams:function(U,N,Z){var Q,o=[],N=(U.diffuse=[1,1,1],U.opacity=1,N.pbrMetallicRoughness);return N&&(Array.isArray(N.baseColorFactor)&&(Q=N.baseColorFactor,U.diffuse=Q,U.opacity=Q[3]),N.baseColorTexture!==c&&o.push(Z.assignTexture(U,"map",N.baseColorTexture))),Promise.all(o)}}),function(U){this.parser=U,this.name=e.KHR_MATERIALS_SPECULAR}),N=(U(x,K,{getMaterialType:function(U){U=this.parser.json.materials[U];return U.extensions&&U.extensions[this.name]?g:null},extendParams:function(U,N,Z){if(!(N=(Z=this.parser).json.materials[materialIndex]).extensions||!N.extensions[this.name])return Promise.resolve();var Q=[],N=N.extensions[this.name],o=(U.specularIntensity=N.specularFactor!==c?N.specularFactor:1,N.specularTexture!==c&&Q.push(Z.assignTexture(U,"specularIntensityMap",N.specularTexture)),N.specularColorFactor||[1,1,1]);return U.specularColor=[o[0],o[1],o[2]],N.specularColorTexture!==c&&Q.push(Z.assignTexture(U,"specularColorMap",N.specularColorTexture)),Promise.all(Q)}}),{getMaterialType:function(U){U=this.parser.json.materials[U];return U.extensions&&U.extensions[this.name]?g:null},extendParams:function(){return Promise.resolve()}}),j=function(U){this.parser=U,this.name=e.KHR_MATERIALS_CLEARCOAT},T=(U(j,K,N),function(U){this.parser=U,this.name=e.KHR_MATERIALS_SHEEN}),q=(U(T,K,N),function(U){this.parser=U,this.name=e.KHR_MATERIALS_TRANSMISSION}),l=(U(q,K,N),function(U){this.parser=U,this.name=e.KHR_MATERIALS_VOLUME}),t=(U(l,K,N),function(U){this.parser=U,this.name=e.KHR_MATERIALS_IOR}),UX=(U(t,K,N),function(U){this.parser=U,this.name=e.KHR_TEXTURE_BASISU}),NX=(U(UX,K,{loadTexture:function(U){var N=this.parser,Z=N.json,Q=Z.textures[U];if(!Q.extensions||!Q.extensions[this.name])return null;var Q=Q.extensions[this.name],o=N.options.ktx2Loader;if(o)return N.loadTextureImage(U,Q.source,o);if(Z.extensionsRequired&&0<=Z.extensionsRequired.indexOf(this.name))throw new Error("GLTFLoader: setKTX2Loader must be called");return null}}),function(U){this.parser=U,this.name=e.EXT_TEXTURE_WEBP,this.isSupported=null}),ZX=(U(NX,K,{loadTexture:function(N){var Z=this.name,Q=this.parser,o=Q.json,U=o.textures[N];if(!U.extensions||!U.extensions[Z])return null;var U=U.extensions[Z],K=o.images[U.source],r=Q.textureLoader;return this.detectSupport().then(function(U){if(U)return Q.loadTextureImage(N,K,r);if(o.extensionsRequired&&0<=o.extensionsRequired.indexOf(Z))throw new Error("GLTFLoader: WebP required by asset but unsupported.");return Q.loadTexture(N)})},detectSupport:function(){return this.isSupported||(this.isSupported=new Promise(function(U){var N=new Image;N.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",N.onload=N.onerror=function(){U(1===N.height)}})),this.isSupported}}),function(U){this.parser=U,this.name=e.EXT_MESHOPT_COMPRESSION}),QX=(U(ZX,K,{loadBufferView:function(U){var N=this.parser.json,U=N.bufferViews[U];if(U.extensions&&U.extensions[this.name]){var r=U.extensions[this.name],U=this.parser.getDependency("buffer",r.buffer),H=this.parser.options.meshoptDecoder;if(H&&H.supported)return Promise.all([U,H.ready]).then(function(U){var N=r.byteOffset||0,Z=r.byteLength||0,Q=r.count,o=r.byteStride,K=new ArrayBuffer(Q*o),U=new Uint8Array(U[0],N,Z);return H.decodeGltfBuffer(new Uint8Array(K),Q,o,U,r.mode,r.filter),K});if(N.extensionsRequired&&0<=N.extensionsRequired.indexOf(this.name))throw new Error("GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return null}}),"glTF"),oX=1313821514,KX=5130562,rX=function(U){this.name=e.KHR_BINARY_GLTF,this.content=null,this.body=null;var N=new DataView(U,0,12);if(this.header={magic:k(new Uint8Array(U.slice(0,4))),version:N.getUint32(4,!0),length:N.getUint32(8,!0)},this.header.magic!==QX)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected.");for(var Z=this.header.length-12,Q=new DataView(U,12),o=0;o<Z;){var K,r=Q.getUint32(o,!0),H=(o+=4,Q.getUint32(o,!0));o+=4,H===oX?(K=new Uint8Array(U,12+o,r),this.content=k(K)):H===KX&&(this.body=U.slice(K=12+o,K+r)),o+=r}if(null===this.content)throw new Error("GLTFLoader: JSON content not found.")},HX=function(U,N){if(!N)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=e.KHR_DRACO_MESH_COMPRESSION,this.json=U,this.dracoLoader=N,this.dracoLoader.preload()},iX=(U(HX,K,{decodePrimitive:function(U,N){var Z,Q=this.json,o=this.dracoLoader,K=U.extensions[this.name].bufferView,r=U.extensions[this.name].attributes,H={},i={},A={};for(Z in r){var I=R[Z]||Z.toLowerCase();H[I]=r[Z]}for(Z in U.attributes){var _,d,I=R[Z]||Z.toLowerCase();r[Z]!==c&&(_=Q.accessors[U.attributes[Z]],d=L[_.componentType],A[I]=d.name,i[I]=!0===_.normalized)}return N.getDependency("bufferView",K).then(function(U){return new Promise(function(Q){o.decodeDracoFile(U,function(U){for(var N in U.attributes){var Z=U.attributes[N],N=i[N];N!==c&&(Z.normalized=N)}Q(U)},H,A)})})}}),function(){this.name=e.KHR_TEXTURE_TRANSFORM}),AX=(U(iX,K,{extendTexture:function(U,N){if(N.texCoord!==c&&console.warn('GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),N.offset===c&&N.rotation===c&&N.scale===c)return U;N=d.makeUVMatrixArray(N.rotation,N.offset,N.scale);return U.uvMatrix=N,U}}),function(){this.name=e.KHR_MESH_QUANTIZATION}),L={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},IX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},R={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},_X={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},dX="OPAQUE",kX="MASK",yX="BLEND",g=function(U){var N=(new X).setValues({type:"pbr"});return U&&N.setValues(U),N};function h(U,N,Z){for(var Q in Z.extensions)U[Q]===c&&N.userData&&(N.userData.gltfExtensions=N.userData.gltfExtensions||{},N.userData.gltfExtensions[Q]=Z.extensions[Q])}function v(U,N){var Z,N=N.extras;N!==c&&("object"==typeof N?((Z=U.userData)||(U.userData=Z={}),K.assign(Z,N)):console.warn("GLTFLoader: Ignoring primitive type .extras, "+N))}function pX(U){for(var N="",Z=K.keys(U).sort(),Q=0,o=Z.length;Q<o;Q++)N+=Z[Q]+":"+U[Z[Q]]+";";return N}function M(U){switch(U){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("GLTFLoader: Unsupported normalized accessor component type.")}}var PX=function(U,N){N=N||{},this.json=U=U||{},this.extensions={},this.plugins={},this.options=N,this.cache=new z,this.associations=new Map,this.primitiveCache={},this.assetsURIMap=N.assetsURIMap,this.path=N.path,this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={},this.assets=[],this.externalAssetURIs=[],this.nameIdGenerator=C.Math.newIdGenerator()};function XX(Z,U,Q){var N,o=U.attributes,K=[];for(N in o){var r=R[N]||N.toLowerCase();r in Z.attributes||K.push(function(U,N){return Q.getDependency("accessor",U).then(function(U){Z.setAttribute(N,U)})}(o[N],r))}U.indices===c||Z.index||(H=Q.getDependency("accessor",U.indices).then(function(U){Z.setIndex(U)}),K.push(H)),v(Z,U);var H=Z,i=Q,A=U.attributes,I=new C.Math.Box3;if(A.POSITION!==c){var _=(n=i.json.accessors[A.POSITION]).min,d=n.max;if(_===c||d===c)console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.");else{I.set(new V(_[0],_[1],_[2]),new V(d[0],d[1],d[2])),n.normalized&&(f=M(L[n.componentType]),I.min.multiplyScalar(f),I.max.multiplyScalar(f));var k=U.targets;if(k!==c){for(var y=new V,p=new V,P=0,X=k.length;P<X;P++){var n,f,G=k[P];G.POSITION!==c&&(_=(n=i.json.accessors[G.POSITION]).min,d=n.max,_!==c&&d!==c?(p.setX(Math.max(Math.abs(_[0]),Math.abs(d[0]))),p.setY(Math.max(Math.abs(_[1]),Math.abs(d[1]))),p.setZ(Math.max(Math.abs(_[2]),Math.abs(d[2]))),n.normalized&&(f=M(L[n.componentType]),p.multiplyScalar(f)),y.max(p)):console.warn("GLTFLoader: Missing min/max properties for accessor POSITION."))}I.expandByPoint(y)}H.boundingBox=I;A=new C.Math.Sphere;I.getCenter(A.center),A.radius=I.min.distanceTo(I.max)/2,H.boundingSphere=A}}return Promise.all(K).then(function(){return Z})}U(PX,K,{setExtensions:function(U){this.extensions=U},setPlugins:function(U){this.plugins=U},parse:function(Z,U){var Q=this,o=this.json,K=this.extensions,r=this.assets;this.cache.removeAll(),this._invokeAll(function(U){return U._markDefs&&U._markDefs()}),Promise.all(this._invokeAll(function(U){return U.beforeRoot&&U.beforeRoot()})).then(function(){return Promise.all([Q.getDependencies("scene"),Q.getDependencies("animation")])}).then(function(U){var N={scene:U[0][o.scene||0],scenes:U[0],animations:U[1],cameras:U[2],asset:o.asset,parser:Q,userData:{},externalAssetURIs:Q.externalAssetURIs};r.length&&(N.assets=r),h(K,N,o),v(N,o),Promise.all(Q._invokeAll(function(U){return U.afterRoot&&U.afterRoot(N)})).then(function(){Z(N)})}).catch(U)},_markDefs:function(){for(var U=this.json.nodes||[],N=this.json.skins||[],Z=this.json.meshes||[],Q=0,o=N.length;Q<o;Q++)for(var K=N[Q].joints,r=0,H=K.length;r<H;r++)U[K[r]].isBone=!0;for(var i=0,A=U.length;i<A;i++){var I=U[i];I.mesh!==c&&(this._addNodeRef(this.meshCache,I.mesh),I.skin!==c&&(Z[I.mesh].isSkinnedMesh=!0)),I.camera!==c&&this._addNodeRef(this.cameraCache,I.camera)}},_addNodeRef:function(U,N){N!==c&&(U.refs[N]===c&&(U.refs[N]=U.uses[N]=0),U.refs[N]++)},_getNodeRef:function(U,N,Z){if(U.refs[N]<=1)return Z;var Q,o,K=new P(Z.geometry,Z.material);for(Q in Z)"geometry"!==Q&&"material"!==Q&&"_id"!==Q&&(o=Z[Q],K[Q]=o&&o.clone?o.clone():o);var r=this,H=function(U,N){var Z=r.associations.get(U);null!=Z&&r.associations.set(N,Z);for(var Q=0,Z=U.children,o=Z?Z.length:0;Q<o;Q++)H(U.children[Q],N.children[Q])};return H(Z,K),K.name+="_instance_"+U.uses[N]++,K},_invokeOne:function(U){var N=K.values(this.plugins);N.push(this);for(var Z=0;Z<N.length;Z++){var Q=U(N[Z]);if(Q)return Q}return null},_invokeAll:function(U){for(var N=K.values(this.plugins),Z=(N.unshift(this),[]),Q=0;Q<N.length;Q++){var o=U(N[Q]);o&&Z.push(o)}return Z},getDependency:function(U,N){var Z=U+":"+N,Q=this.cache.get(Z);if(!Q){switch(U){case"scene":Q=this.loadScene(N);break;case"node":Q=this.loadNode(N);break;case"mesh":Q=this._invokeOne(function(U){return U.loadMesh&&U.loadMesh(N)});break;case"accessor":Q=this.loadAccessor(N);break;case"bufferView":Q=this._invokeOne(function(U){return U.loadBufferView&&U.loadBufferView(N)});break;case"buffer":Q=this.loadBuffer(N);break;case"material":Q=this._invokeOne(function(U){return U.loadMaterial&&U.loadMaterial(N)});break;case"texture":Q=this._invokeOne(function(U){return U.loadTexture&&U.loadTexture(N)});break;case"skin":Q=this.loadSkin(N);break;case"animation":Q=this.loadAnimation(N);break;case"camera":Q=this.loadCamera(N);break;default:throw new Error("Unknown type: "+U)}this.cache.add(Z,Q)}return Q},getDependencies:function(Z){var Q,U,N=this.cache.get(Z);return N||(U=(Q=this).json[Z+("mesh"===Z?"es":"s")]||[],N=Promise.all(U.map(function(U,N){return Q.getDependency(Z,N)})),this.cache.add(Z,N)),N},loadBuffer:function(U){var o=this.json.buffers[U];if(o.type&&"arraybuffer"!==o.type)throw new Error("GLTFLoader: "+o.type+" buffer type is not supported.");if(o.uri===c&&0===U)return Promise.resolve(this.extensions[e.KHR_BINARY_GLTF].body);var N=this.path,K=this.assets,r=this.externalAssetURIs,H=this.assetsURIMap;return new Promise(function(Z,Q){var U=o.uri;U.indexOf("data:")<0&&r.indexOf(U)<0&&r.push(U),S(U,H,N,function(U,N){N||K.push(U),C.Default.xhrLoad(U,function(U){U?Z(U):Q(new Error('GLTFLoader: Failed to load buffer "'+o.uri+'".'))},{responseType:"arraybuffer"})})})},loadBufferView:function(U){var Q=this.json.bufferViews[U];return this.getDependency("buffer",Q.buffer).then(function(U){var N=Q.byteLength||0,Z=Q.byteOffset||0;return U.slice(Z,Z+N)})},loadAccessor:function(U){var f=this.json,G=this.json.accessors[U];if(G.bufferView===c&&G.sparse===c)return Promise.resolve(null);U=[];return G.bufferView!==c?U.push(this.getDependency("bufferView",G.bufferView)):U.push(null),G.sparse!==c&&(U.push(this.getDependency("bufferView",G.sparse.indices.bufferView)),U.push(this.getDependency("bufferView",G.sparse.values.bufferView))),Promise.all(U).then(function(U){var N,Z=U[0],Q=IX[G.type],o=L[G.componentType],K=o.BYTES_PER_ELEMENT,r=G.byteOffset||0,H=G.bufferView!==c?f.bufferViews[G.bufferView].byteStride:c,i=!0===G.normalized;if(H&&H!==K*Q){for(var A=new o(G.count*Q),I=Math.round(H/K),_=r%H/K,d=new o(Z,Math.floor(r/H)*H,G.count*H/K),k=0;k<G.count;k++)for(var y=0;y<Q;y++){var p=k*I+y+_;A[k*Q+y]=d[p]}N=new $(A,Q,i)}else N=new $(A=null===Z?new o(G.count*Q):new o(Z,r,G.count*Q),Q,i);if(G.sparse!==c){var H=L[G.sparse.indices.componentType],K=G.sparse.indices.byteOffset||0,r=G.sparse.values.byteOffset||0,P=new H(U[1],K,G.sparse.count*IX.SCALAR),X=new o(U[2],r,G.sparse.count*Q);null!==Z&&(N=new $(N.array.slice(),N.itemSize,N.normalized));for(var k=0,n=P.length;k<n;k++){p=P[k];if(N.setX(p,X[k*Q]),2<=Q&&N.setY(p,X[k*Q+1]),3<=Q&&N.setZ(p,X[k*Q+2]),4<=Q&&N.setW(p,X[k*Q+3]),5<=Q)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return N})},loadTexture:function(U){var N=this.json.textures[U].source,Z=this.textureLoader;return this.loadTextureImage(U,N,Z)},loadTextureImage:function(Z,U,N){var Q=this,o=this.json,K=o.textures[Z],r=o.images[U],r=(r.uri||r.bufferView)+":"+K.sampler;if(this.textureCache[r])return this.textureCache[r];U=this.loadImageSource(U,N).then(function(U){U.flipY=!1,K.name&&(U.name=K.name);var N=(o.samplers||{})[K.sampler]||{};return N.magFilter!==c&&(U.magFilter=N.magFilter),N.minFilter!==c&&(U.minFilter=N.minFilter),N.wrapS!==c&&(U.wrapS=N.wrapS),N.wrapT!==c&&(U.wrapT=N.wrapT),Q.associations.set(U,{textures:Z}),U}).catch(function(){return null});return this.textureCache[r]=U},loadImageSource:function(U,N){var Z=this.json;if(this.sourceCache[U]!==c)return this.sourceCache[U].then(function(U){U.clone()});var K=Z.images[U],Q=A.URL||A.webkitURL,o=K.uri,r=("string"==typeof o&&o.indexOf("data:")<0?(Z=this.externalAssetURIs).indexOf(o)<0&&Z.push(o):o=o||"",!1);if(K.bufferView!==c)o=this.getDependency("bufferView",K.bufferView).then(function(U){r=!0;U=new Blob([U],{type:K.mimeType});return o=Q.createObjectURL(U)});else if(K.uri===c)throw new Error("GLTFLoader: Image "+U+" is missing URI and bufferView");var H=this.assetsURIMap,i=this.path,Z=Promise.resolve(o).then(function(Z){return new Promise(function(N,U){S(Z,H,i,function(U){N(U)})})}).then(function(o){return new Promise(function(U,N){var Z,Q=decodeURIComponent(o);r?((Z=new Image).src=Q,Z.onload=function(){U(new I({image:Z,mimeType:K.mimeType}))}):U(new I({image:Q}))})}).then(function(U){return!0===r&&Q.revokeObjectURL(o),U}).catch(function(U){throw console.error("GLTFLoader: Couldn't load texture",o),U});return this.sourceCache[U]=Z},assignTexture:function(Q,o,K){var r=this;return this.getDependency("texture",K.index).then(function(U){var N,Z;return K.texCoord===c||0==K.texCoord||"aoMap"===o&&1==K.texCoord||console.warn("GLTFLoader: Custom UV set "+K.texCoord+" for texture "+o+" not yet supported."),r.extensions[e.KHR_TEXTURE_TRANSFORM]&&(N=K.extensions!==c?K.extensions[e.KHR_TEXTURE_TRANSFORM]:c)&&(Z=r.associations.get(U),U=r.extensions[e.KHR_TEXTURE_TRANSFORM].extendTexture(U,N),r.associations.set(U,Z)),Q[o]=U})},assignFinalMaterial:function(U){var N,Z,Q=U.mesh,o=U.mat,K=Q.attributes.tangent===c,r=Q.attributes.color!==c,H=Q.attributes.normal===c;(K||r||H)&&(N="ClonedMaterial:"+o.uuid+":",o.isGLTFSpecularGlossinessMaterial&&(N+="specular-glossiness:"),K&&(N+="derivative-tangents:"),r&&(N+="vertex-colors:"),H&&(N+="flat-shading:"),(Z=this.cache.get(N))||(Z=o.clone(),r&&(Z.vertexColors=!0),H&&(Z.flatShading=!0),K&&(Z.normalScale&&(Z.normalScale.y*=-1),Z.clearcoatNormalScale&&(Z.clearcoatNormalScale.y*=-1)),this.cache.add(N,Z),this.associations.set(Z,this.associations.get(o))),o=Z),o.aoMap&&Q.attributes.uv2===c&&Q.attributes.uv!==c&&Q.setAttribute("uv2",Q.attributes.uv),U.material=o},getMaterialType:function(){return g},loadMaterial:function(N){var Z,Q=this,U=this.json,o=this.extensions,K=U.materials[N],r={},U=K.extensions||{},H=[],i=(U[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]?(i=o[e.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],Z=i.getMaterialType(),H.push(i.extendParams(r,K,Q))):U[e.KHR_MATERIALS_UNLIT]?(i=o[e.KHR_MATERIALS_UNLIT],Z=i.getMaterialType(),H.push(i.extendParams(r,K,Q))):(U=K.pbrMetallicRoughness||{},r.diffuse=[1,1,1],r.opacity=1,Array.isArray(U.baseColorFactor)&&(i=U.baseColorFactor,r.diffuse=i,r.opacity=i[3]),U.baseColorTexture!==c&&H.push(Q.assignTexture(r,"map",U.baseColorTexture)),r.metalness=U.metallicFactor!==c?U.metallicFactor:1,r.roughness=U.roughnessFactor!==c?U.roughnessFactor:1,U.metallicRoughnessTexture!==c&&(H.push(Q.assignTexture(r,"metalnessMap",U.metallicRoughnessTexture)),H.push(Q.assignTexture(r,"roughnessMap",U.metallicRoughnessTexture))),Z=this._invokeOne(function(U){return U.getMaterialType&&U.getMaterialType(N)}),H.push(Promise.all(this._invokeAll(function(U){return U.extendMaterialParams&&U.extendMaterialParams(N,r)})))),!0===K.doubleSided&&(r.cullFace=!1),K.alphaMode||dX);return i===yX?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,i===kX&&(r.alphaTest=K.alphaCutoff!==c?K.alphaCutoff:.5)),K.normalTexture!==c&&(H.push(Q.assignTexture(r,"normalMap",K.normalTexture)),r.normalScale=[1,1],K.normalTexture.scale!==c&&(U=K.normalTexture.scale,r.normalScale=[U,U])),K.occlusionTexture!==c&&(H.push(Q.assignTexture(r,"aoMap",K.occlusionTexture)),K.occlusionTexture.strength!==c&&(r.aoMapIntensity=K.occlusionTexture.strength)),K.emissiveFactor!==c&&(r.emissive=K.emissiveFactor),K.emissiveTexture!==c&&H.push(Q.assignTexture(r,"emissiveMap",K.emissiveTexture)),Promise.all(H).then(function(){var U=(new Z).setValues(r);return K.name&&(U.name=K.name),v(U,K),Q.associations.set(U,{materials:N}),K.extensions&&h(o,U,K),U.roughnessMap&&(U.roughnessChannel="G"),U.metalnessMap&&(U.metalnessChannel="B"),U.aoMap&&(U.aoChannel="R",U.aoUvChannel=2),U})},createUniqueName:function(U){for(var N=(U||"").replace(/\s/g,"_").replace(a,""),Z=N,Q=1;this.nodeNamesUsed[Z];++Q)Z=N+"_"+Q;return this.nodeNamesUsed[Z]=!0,Z},loadGeometries:function(U){var Z=this,Q=this.extensions,N=this.primitiveCache;for(var o=[],K=0,r=U.length;K<r;K++){var H=U[K],i=(A=void 0,A=(A=(i=H).extensions&&i.extensions[e.KHR_DRACO_MESH_COMPRESSION])?"draco:"+A.bufferView+":"+A.indices+":"+pX(A.attributes):i.indices+":"+pX(i.attributes)+":"+i.mode),A=N[i];A?o.push(A.promise):(A=H.extensions&&H.extensions[e.KHR_DRACO_MESH_COMPRESSION]?function(N){return Q[e.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(N,Z).then(function(U){return XX(U,N,Z)})}(H):XX(new y,H,Z),N[i]={primitive:H,promise:A},o.push(A))}return Promise.all(o)},loadMesh:function(I){for(var _=this,U=this.json,d=this.extensions,k=U.meshes[I],y=k.primitives,N=[],Z=0,Q=y.length;Z<Q;Z++){var o=y[Z].material===c?((o=this.cache).DefaultMaterial===c&&(o.DefaultMaterial=g()),o.DefaultMaterial):this.getDependency("material",y[Z].material);N.push(o)}return N.push(_.loadGeometries(y)),Promise.all(N).then(function(U){for(var N=U.slice(0,U.length-1),Z=U[U.length-1],Q=[],o=0,K=Z.length;o<K;o++){var r=Z[o],H=y[o],i=N[o],r=new P(r,i);H.mode!==c&&(i.renderMode=F[H.mode]||"triangles"),r.name=_.createUniqueName(k.name||"mesh_"+I),v(r,k),H.extensions&&h(d,r,H),_.assignFinalMaterial(r),r.normalizeSkinWeights(),Q.push(r)}for(o=0,K=Q.length;o<K;o++)_.associations.set(Q[o],{meshes:I,primitives:o});if(1===Q.length)return Q[0];var A=new p;_.associations.set(A,{meshes:I});for(o=0,K=Q.length;o<K;o++)A.add(Q[o]);return A})},loadCamera:function(U){return Promise.resolve(new C.Camera)},loadSkin:function(U){var U=this.json.skins[U],N={joints:U.joints};return U.inverseBindMatrices===c?Promise.resolve(N):this.getDependency("accessor",U.inverseBindMatrices).then(function(U){return N.inverseBindMatrices=U,N})},loadAnimation:function(V){for(var $=this.json.animations[V],U=[],N=[],Z=[],Q=[],o=[],s=this.nameIdGenerator,K=0,r=$.channels.length;K<r;K++){var H=$.channels[K],u=$.samplers[H.sampler],H=H.target,i=H.node,A=$.parameters!==c?$.parameters[u.input]:u.input,I=$.parameters!==c?$.parameters[u.output]:u.output;U.push(this.getDependency("node",i)),N.push(this.getDependency("accessor",A)),Z.push(this.getDependency("accessor",I)),Q.push(u),o.push(H)}return Promise.all([Promise.all(U),Promise.all(N),Promise.all(Z),Promise.all(Q),Promise.all(o)]).then(function(U){for(var N=U[0],Z=U[1],Q=U[2],o=U[4],K=[],r=0,H=N.length;r<H;r++){var i=N[r],A=Z[r],I=Q[r],_=o[r];if(i!==c){var d=u.interpolation,k="CUBICSPLINE"===d?"cubicSpline":"STEP"===d?"discrete":"linear";"rotation"===_.path&&("cubicSpline"===k?k="cubicSplineQuaternion":"linear"===k&&(k="quaternion"));var d=(d=i.name)||(i.name="node"+s.next()),y=[],p=(_.path,y.push(d),I.array);if(I.normalized){for(var P=M(p.constructor),X=new Float32Array(p.length),n=0,f=p.length;n<f;n++)X[n]=p[n]*P;p=X}for(n=0,f=y.length;n<f;n++){var G={name:y[n]+"."+_X[_.path],times:A.array,values:p,type:k};K.push(G)}}}var U=$.name||"animation_"+V,C=0;return K.forEach(function(U){C=Math.max(C,U.times[U.times.length-1])}),{name:U,duration:C,tracks:K}})},createNodeMesh:function(U){var N=this.json,Z=this,Q=N.nodes[U];return Q.mesh===c?null:Z.getDependency("mesh",Q.mesh).then(function(U){U=Z._getNodeRef(Z.meshCache,Q.mesh,U);return Q.weights!==c&&U.traverse(function(U){if(U instanceof P)for(var N=0,Z=Q.weights.length;N<Z;N++)U.morphTargetInfluences[N]=Q.weights[N]}),U})},loadNode:function(i){var N,U=this.json,A=this.extensions,I=this,_=this.nameIdGenerator,d=U.nodes[i],k=d.name?I.createUniqueName(d.name):"";return N=[],(U=I._invokeOne(function(U){return U.createNodeMesh&&U.createNodeMesh(i)}))&&N.push(U),d.camera!==c&&N.push(I.getDependency("camera",d.camera).then(function(U){return I._getNodeRef(I.cameraCache,d.camera,U)})),I._invokeAll(function(U){return U.createNodeAttachment&&U.createNodeAttachment(i)}).forEach(function(U){N.push(U)}),Promise.all(N).then(function(U){var N,Z,Q,o,K;if(!0===d.isBone?(N=new p).isBone=!0:N=!(1<U.length)&&1===U.length?U[0]:new p,N!==U[0])for(var r=0,H=U.length;r<H;r++)N.add(U[r]);return d.name&&(N.userData&&(N.userData.name=d.name),N.name=k),N.isBone&&!N.name&&(N.name="node"+_.next()),v(N,d),d.extensions&&h(A,N,d),d.matrix!==c?((Z=new C.Math.Matrix4).fromArray(d.matrix),Q=new V,o=new V,K=new C.Math.Quaternion,Z.decompose(Q,K,o),N.position=Q.toArray(),N.scale=o.toArray(),N.quaternion=K.toArray()):(d.translation!==c&&(N.position=d.translation),d.rotation!==c&&(N.quaternion=d.rotation),d.scale!==c&&(N.scale=d.scale)),I.associations.has(N)||I.associations.set(N,{}),I.associations.get(N).nodes=i,N})},loadScene:function(U){for(var N=this.json,Z=this.extensions,U=this.json.scenes[U],o=this,Q=new p,K=(U.name&&(Q.name=o.createUniqueName(U.name)),v(Q,U),U.extensions&&h(Z,Q,U),U.nodes||[]),r=[],H=0,i=K.length;H<i;H++)r.push(function r(U,H,i,A){var I=i.nodes[U];return A.getDependency("node",U).then(function(U){return I.skin===c?U:A.getDependency("skin",I.skin).then(function(U){for(var N=[],Z=0,Q=(H=U).joints.length;Z<Q;Z++)N.push(A.getDependency("node",H.joints[Z]));return Promise.all(N)}).then(function(r){return U.traverse(function(U){if(U instanceof P){for(var N=[],Z=[],Q=0,o=r.length;Q<o;Q++){var K=r[Q];K?(N.push(K),K=new n,H.inverseBindMatrices!==c&&K.fromArray(H.inverseBindMatrices.array,16*Q),K.toArray(Z,Z.length)):console.warn("Joint %s could not be found.",H.joints[Q])}U.skeleton=[N,Z,U.matrixWorld]}}),U});var H}).then(function(U){H.add(U);var N=[];if(I.children)for(var Z=I.children,Q=0,o=Z.length;Q<o;Q++){var K=Z[Q];N.push(r(K,U,i,A))}return Promise.all(N)})}(K[H],Q,N,o));return Promise.all(r).then(function(){return o.associations=function(U){var N,Z=new Map;for(N in o.associations){var Q=o.associations[N];(N instanceof X||N instanceof I)&&Z.set(N,Q)}return U.traverse(function(U){var N=o.associations.get(U);null!=N&&Z.set(U,N)}),Z}(Q),Q})}});var J=new WeakMap,nX=function(){this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};K.assign(nX.prototype,{setDecoderPath:function(U){return this.decoderPath=U,this},setDecoderConfig:function(U){return this.decoderConfig=U,this},setWorkerLimit:function(U){return this.workerLimit=U,this},load:function(U,N,Z,Q){var o=this,K=o.path+U;C.Default.xhrLoad(K,function(U){U?o.decodeDracoFile(U,N).catch(Q):Q("Failed to load "+K)},{responseType:"arraybuffer"})},decodeDracoFile:function(U,N,Z,Q){Q={attributeIDs:Z||this.defaultAttributeIDs,attributeTypes:Q||this.defaultAttributeTypes,useUniqueIDs:!!Z};return this.decodeGeometry(U,Q).then(N)},decodeGeometry:function(Z,Q){var U=JSON.stringify(Q);if(J.has(Z)){var N=J.get(Z);if(N.key===U)return N.promise;if(0===Z.byteLength)throw new Error("DRACOLoader: Unable to decode a buffer.")}var o,K=this,r=K.workerNextTaskID++,N=Z.byteLength,N=K._getWorker(r,N).then(function(U){return o=U,new Promise(function(U,N){o._callbacks[r]={resolve:U,reject:N},o.postMessage({type:"decode",id:r,taskConfig:Q,buffer:Z},[Z])})}).then(function(U){return K._createGeometry(U.geometry)});return N.catch(function(){return!0}).then(function(){o&&r&&K._releaseTask(o,r)}),J.set(Z,{key:U,promise:N}),N},_createGeometry:function(U){var N=new y;U.index&&N.setIndex(new $(U.index.array,1));for(var Z=0;Z<U.attributes.length;Z++){var Q=U.attributes[Z],o=Q.name,K=Q.array,Q=Q.itemSize;N.setAttribute(o,new $(K,Q))}return N},_loadLibrary:function(U,Q){var o=this.decoderPath+U;return new Promise(function(N,Z){C.Default.xhrLoad(o,function(U){U?N(U):Z("Failed to load "+o)},{responseType:Q})})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){var Z=this;if(Z.decoderPending)return Z.decoderPending;var Q="object"!=typeof WebAssembly||"js"===Z.decoderConfig.type,U=[];return Q?U.push(Z._loadLibrary("draco_decoder.js","text")):(U.push(Z._loadLibrary("draco_wasm_wrapper.js","text")),U.push(Z._loadLibrary("draco_decoder.wasm","arraybuffer"))),Z.decoderPending=Promise.all(U).then(function(U){var N=U[0],U=(Q||(Z.decoderConfig.wasmBinary=U[1]),function(){var Z,N;function i(U,N,Z,Q){var o,K=Q.attributeIDs,r=Q.attributeTypes,H=N.GetEncodedGeometryType(Z);if(H===U.TRIANGULAR_MESH)o=new U.Mesh,f=N.DecodeBufferToMesh(Z,o);else{if(H!==U.POINT_CLOUD)throw new Error("DRACOLoader: Unexpected geometry type.");o=new U.PointCloud,f=N.DecodeBufferToPointCloud(Z,o)}if(!f.ok()||0===o.ptr)throw new Error("DRACOLoader: Decoding failed: "+f.error_msg());var i,A,I,_,d,k,y,p,P,X,n,f,G,C,V,$={index:null,attributes:[]};for(i in K){var s,u,c=self[r[i]];if(Q.useUniqueIDs)u=K[i],s=N.GetAttributeByUniqueId(o,u);else{if(-1===(u=N.GetAttributeId(o,U[K[i]])))continue;s=N.GetAttribute(o,u)}$.attributes.push((A=U,I=N,_=o,d=i,c=c,n=X=P=p=y=void 0,y=(k=s).num_components(),p=_.num_points()*y,P=p*c.BYTES_PER_ELEMENT,X=function(U,N){switch(N){case Float32Array:return U.DT_FLOAT32;case Int8Array:return U.DT_INT8;case Int16Array:return U.DT_INT16;case Int32Array:return U.DT_INT32;case Uint8Array:return U.DT_UINT8;case Uint16Array:return U.DT_UINT16;case Uint32Array:return U.DT_UINT32}}(A,c),n=A._malloc(P),I.GetAttributeDataArrayForAllPoints(_,k,X,P,n),I=new c(A.HEAPF32.buffer,n,p).slice(),A._free(n),{name:d,array:I,itemSize:y}))}return H===U.TRIANGULAR_MESH&&($.index=(Z=U,f=N,G=3*(H=o).num_faces(),C=4*G,V=Z._malloc(C),f.GetTrianglesUInt32Array(H,C,V),f=new Uint32Array(Z.HEAPF32.buffer,V,G).slice(),Z._free(V),{array:f,itemSize:1})),U.destroy(o),$}onmessage=function(U){var K=U.data;switch(K.type){case"init":Z=K.decoderConfig,N=new Promise(function(N){Z.onModuleLoaded=function(U){N({draco:U})},DracoDecoderModule(Z)});break;case"decode":var r=K.buffer,H=K.taskConfig;N.then(function(U){var U=U.draco,N=new U.Decoder,Z=new U.DecoderBuffer;Z.Init(new Int8Array(r),r.byteLength);try{var Q=i(U,N,Z,H),o=Q.attributes.map(function(U){return U.array.buffer});Q.index&&o.push(Q.index.array.buffer),self.postMessage({type:"decode",id:K.id,geometry:Q},o)}catch(U){console.error(U),self.postMessage({type:"error",id:K.id,error:U.message})}finally{U.destroy(Z),U.destroy(N)}})}}}.toString()),N=["/* draco decoder */",N,"","/* worker */",U.substring(U.indexOf("{")+1,U.lastIndexOf("}"))].join("\n");Z.workerSourceURL=URL.createObjectURL(new Blob([N]))}),Z.decoderPending},_getWorker:function(U,N){var Q=this;return Q._initDecoder().then(function(){Q.workerPool.length<Q.workerLimit?((Z=new Worker(Q.workerSourceURL))._callbacks={},Z._taskCosts={},Z._taskLoad=0,Z.postMessage({type:"init",decoderConfig:Q.decoderConfig}),Z.onmessage=function(U){var N=U.data;switch(N.type){case"decode":Z._callbacks[N.id].resolve(N);break;case"error":Z._callbacks[N.id].reject(N);break;default:console.error('DRACOLoader: Unexpected message, "'+N.type+'"')}},Q.workerPool.push(Z)):Q.workerPool.sort(function(U,N){return U._taskLoad>N._taskLoad?-1:1});var Z=Q.workerPool[Q.workerPool.length-1];return Z._taskCosts[U]=N,Z._taskLoad+=N,Z})},_releaseTask:function(U,N){U._taskLoad-=U._taskCosts[N],delete U._callbacks[N],delete U._taskCosts[N]},debug:function(){},dispose:function(){for(var U=0;U<this.workerPool.length;++U)this.workerPool[U].terminate();return this.workerPool.length=0,this}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);