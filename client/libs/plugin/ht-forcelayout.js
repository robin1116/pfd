!function(r,p){"use strict";function t(r){return r*r}var F="ht.layout.",x=r.ht||module.parent.exports.ht,X=x.List,u=x.DataModel,z=x.Node,U=x.Edge,S=x.Group,r=Math,D=r.sqrt,$=r.random,A=r.max,O=r.min,K=(x.Default.getInternal().addMSMap({ms_force:function(r,p){r._interval=50,r._stepCount=10,r._motionLimit=.01,r._edgeRepulsion=.65,r._nodeRepulsion=.65,r._damper=1,r._maxMotion=0,r._motionRatio=0,r.init=function(r){var p=this;r instanceof u?p.dm=r:p.gv=r,p._nodeMap={},p._nodes=new X,p._edges=new X},r.start=function(){var r,F=this,p=F.gv;F._timer||((r=F.cdm=p?p.dm():F.dm).mm(F.handleDataModelChange,F),r.md(F.handleDataPropertyChange,F),p&&p.mp(F.handleGV,F),r.each(function(r){var p;F.isVisible(r)&&F.isLayoutable(r)&&r instanceof z&&(F instanceof K?(p=r.p3(),r.p3([p[0]+$(),p[1]+$(),p[2]+$()])):(p=r.p(),r.p(p.x+$(),p.y+$())))}),F._timer=setInterval(function(){F.relax()},F._interval),F._damper=1)},r.stop=function(){var r=this;r._timer&&(r.cdm.umm(r.handleDataModelChange,r),r.cdm.umd(r.handleDataPropertyChange,r),r.gv&&r.gv.ump(r.handleGV,r),clearInterval(r._timer),delete r._timer,delete r.cdm)},r.handleGV=function(r){var p,F=this;"dataModel"===r.property&&(p=r.oldValue,r=r.newValue,p&&(p.umm(F.handleDataModelChange,F),p.umd(F.handleDataPropertyChange,F)),(this.cdm=r).mm(F.handleDataModelChange,F),r.md(F.handleDataPropertyChange,F))},r.relax=function(){var p=this;if(!(p._damper<.1&&p._maxMotion<p._motionLimit)){this.cdm.each(function(r){p.isVisible(r)&&(r instanceof U?p.addEdge(r):r instanceof z&&p.addNode(r))});for(var r,F,X=0,t=p._edges,x=p._nodes,u=x.size();X<p._stepCount;X++){for(t.each(p.relaxEdge,p),r=0;r<u;r++)for(F=0;F<u;F++)p.relaxNode(x.get(r),x.get(F));p.moveNode()}p._isAdjusting=1,x.each(function(r){r.fix||(r.p?r.v.p3(r.p):r.v.p(r.x,r.y))}),delete p._isAdjusting,p._nodeMap={},x.clear(),t.clear(),p.onRelaxed()}},r.onRelaxed=function(){},r.isRunning=function(){return!!this._timer},r.isVisible=function(r){return!1!==r.s("layoutable")&&(!this.gv||this.gv.isVisible(r))},r.isLayoutable=function(r){if(!1===r.s("layoutable"))return!1;if(r instanceof S)return!1;var p=this;return p.gv?p.gv.isMovable(r)&&!p.gv.isSelected(r):!(p.cdm||p.dm).sm().co(r)},r.getNodeRepulsion=function(){return this._nodeRepulsion},r.setNodeRepulsion=function(r){this._nodeRepulsion=r,this._damper=1},r.getEdgeRepulsion=function(){return this._edgeRepulsion},r.setEdgeRepulsion=function(r){this._edgeRepulsion=r,this._damper=1},r.getStepCount=function(){return this._stepCount},r.setStepCount=function(r){this._stepCount=r,this._damper=1},r.getInterval=function(){return this._interval},r.setInterval=function(r){var p=this;p._interval!==r&&(p._interval=r,p._timer&&(clearInterval(p._timer),p._timer=setInterval(function(){p.relax()},r)))},r.handleDataPropertyChange=function(r){!this._isAdjusting&&this.isVisible(r.data)&&(this._damper=1)},r.handleDataModelChange=function(r){this._damper=1},r.damp=function(){var r=this._maxMotion,p=this._damper;this._motionRatio<=.001&&((r<.2||1<r&&p<.9)&&.01<p?this._damper-=.01:r<.4&&.003<p?this._damper-=.003:1e-4<p&&(this._damper-=1e-4)),r<this._motionLimit&&(this._damper=0)}}}),x.layout.ForceLayout=function(r){this.init(r)},x.Default.def(F+"ForceLayout",p,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(r){this._limitBounds=r,this._damper=1},getNodeSize:function(r){var p=this.gv;return p&&p.getDataUIBounds?p.getDataUIBounds(r):r.getRect()},addNode:function(r){var p=this,F=p._nodeMap[r._id];if(F)return F;var X=r.p(),X=(F={v:r,x:X.x,y:X.y,dx:0,dy:0,fix:!p.isLayoutable(r),s:p.getNodeSize(r)}).s,X=D(t(X.width)+t(X.height))*p._nodeRepulsion;return F.r=X<1?100:X,p._nodeMap[r._id]=F,p._nodes.add(F),F},addEdge:function(r){var p,F,X;r._40I&&r._41I&&(p={s:F=this.addNode(r._40I),t:r=this.addNode(r._41I)},r=r.s,F=F.s,X=r.width+F.width,r=r.height+F.height,p.length=D(X*X+r*r)*this._edgeRepulsion,p.length<=0&&(p.length=100),this._edges.add(p))},relaxEdge:function(r){var p=r.t,F=r.s,X=p.x-F.x,t=p.y-F.y,x=D(X*X+t*t),r=100*r.length,X=.25*X/r*x,t=.25*t/r*x;p.dx=p.dx-X,p.dy=p.dy-t,F.dx=F.dx+X,F.dy=F.dy+t},relaxNode:function(r,p){var F,X,t,x,u;r!==p&&((X=F=0)==(x=(u=r.x-p.x)*u+(t=r.y-p.y)*t)?(F=$(),X=$()):x<36e4&&(F=u/x,X=t/x),X*=u=r.r*p.r/400,r.dx+=F*=u,r.dy+=X,p.dx-=F,p.dy-=X)},moveNode:function(){var X=this,t=X._limitBounds,r=X._maxMotion,x=0,u=X._damper;X._nodes.each(function(r){var p,F;r.fix||(F=r.dx*u,p=r.dy*u,r.dx=F/2,r.dy=p/2,x=A(D(F*F+p*p),x),r.x+=A(-40,O(40,F)),r.y+=A(-40,O(40,p)),t&&(r.x<t.x&&(r.x=t.x,X.adjust(1,0)),r.y<t.y&&(r.y=t.y,X.adjust(0,1)),F=r.s,r.x+F.width>t.x+t.width&&(r.x=t.x+t.width-F.width,X.adjust(-1,0)),r.y+F.height>t.y+t.height&&(r.y=t.y+t.height-F.height,X.adjust(0,-1))))}),X._maxMotion=x,X._motionRatio=0<x?r/x-1:0,X.damp()},adjust:function(p,F){var X=this._limitBounds;this._nodes.each(function(r){0<p?(!X||r.x+r.s.width+p<X.x+X.width)&&(r.x+=p):(!X||r.x+p>X.x)&&(r.x+=p),0<F?(!X||r.y+r.s.height+F<X.y+X.height)&&(r.y+=F):(!X||r.y+F>X.y)&&(r.y+=F)})}}),x.layout.Force3dLayout=function(r){this.init(r)});x.Default.def(F+"Force3dLayout",p,{ms_force:1,getNodeSize3d:function(r){return r.s3()},addNode:function(r){var p=this,F=p._nodeMap[r._id];if(F)return F;var X=(F={v:r,p:r.p3(),d:[0,0,0],fix:!p.isLayoutable(r),s:p.getNodeSize3d(r)}).s,X=x.Default.getDistance(X)*p._nodeRepulsion;return F.r=X<1?100:X,p._nodeMap[r._id]=F,p._nodes.add(F),F},addEdge:function(r){var p,F;r._40I&&r._41I&&(p={s:F=this.addNode(r._40I),t:r=this.addNode(r._41I)},r=r.s,F=F.s,p.length=D(t(r[0]+F[0])+t(r[1]+F[1])+t(r[2]+F[2]))*this._edgeRepulsion,p.length<=0&&(p.length=100),this._edges.add(p))},relaxEdge:function(r){var p=r.t.p,F=r.s.p,X=r.t.d,t=r.s.d,x=p[0]-F[0],u=p[1]-F[1],p=p[2]-F[2],F=D(x*x+u*u+p*p),r=100*r.length,x=.25*x/r*F,u=.25*u/r*F,p=.25*p/r*F;X[0]-=x,X[1]-=u,X[2]-=p,t[0]+=x,t[1]+=u,t[2]+=p},relaxNode:function(r,p){var F,X,t,x,u,z,U;r!==p&&(U=r.p,x=p.p,(t=X=F=0)==(x=(u=U[0]-x[0])*u+(z=U[1]-x[1])*z+(U=U[2]-x[2])*U)?(F=$(),X=$(),t=$()):x<216e6&&(F=u/x,X=z/x,t=U/x),u=r.r*p.r/400,z=r.d,U=p.d,X*=u,t*=u,z[0]+=F*=u,z[1]+=X,z[2]+=t,U[0]-=F,U[1]-=X,U[2]-=t)},moveNode:function(){var r=this,p=r._maxMotion,x=0,u=r._damper;r._nodes.each(function(r){var p,F,X,t;r.fix||(p=r.p,F=(r=r.d)[0]*u,X=r[1]*u,t=r[2]*u,r[0]=F/2,r[1]=X/2,r[2]=t/2,x=A(D(F*F+X*X+t*t),x),p[0]+=A(-40,O(40,F)),p[1]+=A(-40,O(40,X)),p[2]+=A(-40,O(40,t)))}),r._maxMotion=x,r._motionRatio=0<x?p/x-1:0,r.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);