!function(G,z,f){"use strict";var o,s,u=G.ht;u.Astar={};function w(G){for(var z=G,s=[];z.parent;)s.unshift(z),z=z.parent;return s}function N(G,z){z=z||{},this.nodes=[],this.diagonal=!!z.diagonal,this.grid=[];for(var s=0;s<G.length;s++){this.grid[s]=[];for(var f=0,N=G[s];f<N.length;f++){var j=new i(s,f,N[f]);this.grid[s][f]=j,this.nodes.push(j)}}this.$13x()}function i(G,z,s){this.x=G,this.y=z,this.weight=s}function E(G){this.content=[],this.scoreFunction=G}o={search:function(G,z,s,f){G.$6x();var N=(N=(f=f||{}).heuristic)||(G.diagonal?o.$4x.diagonal:o.$4x.manhattan),j=f.closest||!1,i=f.punish,U=new E(function(G){return G.f}),t=z;for(z.h=N(z,s),G.$7x(z),U.push(z);0<U.size();){var D=U.pop();if(D===s)return w(D);D.closed=!0;for(var b=G.neighbors(D),d=0,k=b.length;d<k;++d){var H,n,P=b[d];P.closed||P.$9x()||(H=D.g+P.getCost(D,i),(!(n=P.visited)||H<P.g)&&(P.visited=!0,P.parent=D,P.h=P.h||N(P,s),P.g=H,P.f=P.g+P.h,G.$7x(P),j&&(P.h<t.h||P.h===t.h&&P.g<t.g)&&(t=P),n?U.$10x(P):U.push(P)))}}return j?w(t):[]},$4x:{manhattan:function(G,z){return Math.abs(z.x-G.x)+Math.abs(z.y-G.y)},diagonal:function(G,z){var s=Math.sqrt(2),f=Math.abs(z.x-G.x),z=Math.abs(z.y-G.y);return+(f+z)+(s-2)*Math.min(f,z)}},$5x:function(G){G.f=0,G.g=0,G.h=0,G.visited=!1,G.closed=!1,G.parent=null}},N.prototype.$13x=function(){this.dirtyNodes=[];for(var G=0;G<this.nodes.length;G++)o.$5x(this.nodes[G])},N.prototype.$6x=function(){for(var G=0;G<this.dirtyNodes.length;G++)o.$5x(this.dirtyNodes[G]);this.dirtyNodes=[]},N.prototype.$7x=function(G){this.dirtyNodes.push(G)},N.prototype.neighbors=function(G){var z=[],s=G.x,G=G.y,f=this.grid;return f[s-1]&&f[s-1][G]&&z.push(f[s-1][G]),f[s+1]&&f[s+1][G]&&z.push(f[s+1][G]),f[s]&&f[s][G-1]&&z.push(f[s][G-1]),f[s]&&f[s][G+1]&&z.push(f[s][G+1]),this.diagonal&&(f[s-1]&&f[s-1][G-1]&&z.push(f[s-1][G-1]),f[s+1]&&f[s+1][G-1]&&z.push(f[s+1][G-1]),f[s-1]&&f[s-1][G+1]&&z.push(f[s-1][G+1]),f[s+1]&&f[s+1][G+1]&&z.push(f[s+1][G+1])),z},N.prototype.toString=function(){for(var G=[],z=this.grid,s=0;s<z.length;s++){for(var f=[],N=z[s],j=0;j<N.length;j++)f.push(N[j].weight);G.push(f.join(" "))}return G.join("\n")},i.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},i.prototype.getCost=function(G,z){var s=G&&G.x!=this.x&&G.y!=this.y?1.41421*this.weight:this.weight;if(z){if(!G)return s;var f=G.parent;if(!f)return s;if(1e-5<Math.abs(f.x+this.x-2*G.x))return s+z;if(1e-5<Math.abs(f.y+this.y-2*G.y))return s+z}return s},i.prototype.$9x=function(){return 0===this.weight},E.prototype={push:function(G){this.content.push(G),this.$11x(this.content.length-1)},pop:function(){var G=this.content[0],z=this.content.pop();return 0<this.content.length&&(this.content[0]=z,this.$12x(0)),G},remove:function(G){var z=this.content.indexOf(G),s=this.content.pop();z!==this.content.length-1&&(this.content[z]=s,this.scoreFunction(s)<this.scoreFunction(G)?this.$11x(z):this.$12x(z))},size:function(){return this.content.length},$10x:function(G){this.$11x(this.content.indexOf(G))},$11x:function(G){for(var z=this.content[G];0<G;){var s=(G+1>>1)-1,f=this.content[s];if(!(this.scoreFunction(z)<this.scoreFunction(f)))break;this.content[s]=z,this.content[G]=f,G=s}},$12x:function(G){for(var z=this.content.length,s=this.content[G],f=this.scoreFunction(s);;){var N,j=G+1<<1,i=j-1,U=null;if(i<z&&(N=this.content[i],(N=this.scoreFunction(N))<f&&(U=i)),j<z&&(i=this.content[j],this.scoreFunction(i)<(null===U?f:N)&&(U=j)),null===U)break;this.content[G]=this.content[U],this.content[U]=s,G=U}}},s={astar:o,Graph:N},G.AStar=s.astar,G.AStar.Graph=s.Graph;G=u.Astar.Finder=function(G,z){this.gv=G,this.$13x(z),this.refreshMap()};(G.prototype={}).constructor=G,z.defineProperties(G.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(G){this.gv._astarDebugInfo=G}}}),G.prototype.$13x=function(G){var z=this.$14x={},s=(G=G||{}).gridSize||10;z.gridSizeX=G.gridSizeX||s,z.gridSizeY=G.gridSizeY||s,z.rect=G.rect,z.filter=G.filter,z.extendBlocks=G.extendBlocks||3,z.fastOverlap=G.fastOverlap===f||G.fastOverlap,z.nodeRectExtend=G.nodeRectExtend||0,z.diagonal=G.diagonal===f||G.diagonal,z.turnPunish=G.turnPunish===f?.1:G.turnPunish,z.simplify=G.simplify===f||G.simplify,z.toGridCenter=G.toGridCenter!==f&&G.toGridCenter,z.closest=G.closest===f||G.closest},G.prototype.refreshMap=function(){var G=this,z=G.$14x,s=z.gridSizeX,f=z.gridSizeY,N=z.extendBlocks,z=(z.rect?i=z.rect:(i=G.$15x(),u.Default.grow(i,s*N,f*N)),u.Default.grow(i,s,f),Math.floor(i.x/s)*s),N=Math.floor(i.y/f)*f,j=Math.ceil(i.width/s),i=Math.ceil(i.height/f);G.$16x={x:z,y:N,w:j*s,h:i*f,gridX:s,gridY:f,xLen:j,yLen:i},G.$17x(),G.$21x()},G.prototype.$15x=function(){var z,s=this.gv;if(s instanceof u.graph.GraphView)return s.getContentRect();var f=u.Default.unionRect;return s.dm().each(function(G){s.isVisible(G)&&G.getRect&&(z=f(z,G.getRect()))}),z},G.prototype.$17x=function(){for(var G,z,s=this,f=s.$16x,N=f.xLen,j=f.yLen,i=new Array(N),U=0;U<N;U++)for(i[U]=G=new Array(j),z=j;z--;)G[z]=1;var t=s.$14x.filter;for(s.gv.dm().each(function(G){t&&!1===t(G)||s._debugInfo&&(G===s._debugInfo.grid||G==s._debugInfo.path)||s.$1cw(i,G)}),U=0;U<N;U++)i[U][0]=1,i[U][j-1]=1;for(z=0;z<j;z++)i[0][z]=1,i[N-1][z]=1;s.grid=i;f=new AStar.Graph(i,{diagonal:s.$14x.diagonal});s.graph=f},G.prototype.$18x=function(G,z,s,f,N,j,i,U){var t=this.$19x,D=t(s-G,N-i,f-z,j-U);if(D<=1e-6&&-1e-6<=D)return!1;i=t(N-G,N-i,j-z,j-U)/D;if(i<0||1<i)return!1;U=t(s-G,N-G,f-z,j-z)/D;return!(U<0||1<U)},G.prototype.$19x=function(G,z,s,f){return G*f-z*s},G.prototype.$1aw=function(G,z,s,f){for(var N=[-(z[1]-G[1]),z[0]-G[0]],j=0<=N[0]*(s[0]-G[0])+N[1]*(s[1]-G[1]),i=0,U=f.length;i<U;i+=2)if(0<=N[0]*(f[i]-G[0])+N[1]*(f[i+1]-G[1])==j)return!1;return!0},G.prototype.$1bw=function(G,z){for(var s,f,N=0,j=G.length;N<j;N+=2)if(this.$1aw([G[N],G[N+1]],[G[s=N===j-2?0:N+2],G[s+1]],[G[f=s===j-2?0:s+2],G[f+1]],z))return!1;for(N=0,j=z.length;N<j;N+=2)if(this.$1aw([z[N],z[N+1]],[z[s=N===j-2?0:N+2],z[s+1]],[z[f=s===j-2?0:s+2],z[f+1]],G))return!1;return!0},G.prototype.$1cw=function(G,z){if(z.getRect){var s,f,N,j,i,U,t,D,b,d,k,H,n=this,P=z.getRect(),o=(u.Default.grow(P,n.$14x.nodeRectExtend),n.$1dw({x:P.x,y:P.y})),P=n.$1dw({x:P.x+P.width,y:P.y+P.height}),w=n.$14x.fastOverlap;for(w||(z=z.getCorners(),D=[],z.forEach(function(G){D.push(G.x,G.y)}),U=n.$14x.gridSizeX/2,t=n.$14x.gridSizeY/2),z=Math.max(0,o.x),f=Math.min(P.x,G.length-1),j=Math.max(0,o.y),i=Math.min(P.y,G.length?G[0].length-1:-1),s=z;s<=f;s++)for(N=j;N<=i;N++)w?G[s][N]=0:(b=(H=n.$1ew({x:s,y:N})).x-U,d=H.x+U,k=H.y-t,H=H.y+t,n.$1bw(D,[b,k,b,H,d,H,d,k])&&(G[s][N]=0))}},G.prototype.$1dw=function(G,z){var s=this.$16x,f=(G.x-s.x)/s.gridX,G=(G.y-s.y)/s.gridY;return!1!==z&&(f=Math.round(f),G=Math.round(G)),{x:f,y:G}},G.prototype.$1ew=function(G){var z=this.$16x;return{x:G.x*z.gridX+z.x,y:G.y*z.gridY+z.y}},G.prototype.$1fw=function(G){var z=this.$16x,s=z.xLen,z=z.yLen;if(0<=G.x&&G.x<s&&0<=G.y&&G.y<z)return G;G={x:G.x,y:G.y};return G.x<0?G.x=0:G.x>=s&&(G.x=s-1),G.y<0?G.y=0:G.y>=z&&(G.y=z-1),G},G.prototype.findPath=function(G,z){var s,f,N=this,j=N.$1dw(G),i=N.$1dw(z),U=N.$1fw(j),t=N.$1fw(i);if(U!==j&&t!==i){var D=N.$16x,b=D.x-D.gridX/2,d=D.y-D.gridY/2,k=b+D.gridX*D.xLen,D=d+D.gridY*D.yLen;if(!(N.$18x(G.x,G.y,z.x,z.y,b,d,k,d)||N.$18x(G.x,G.y,z.x,z.y,k,d,k,D)||N.$18x(G.x,G.y,z.x,z.y,k,D,b,D)||N.$18x(G.x,G.y,z.x,z.y,b,D,b,d)))return[G,z]}U!==j&&(s=!0,j=U),t!==i&&(f=!0,i=t);var k=N.graph.grid[j.x][j.y],D=N.graph.grid[i.x][i.y],H=AStar.search(N.graph,k,D,{closest:N.$14x.closest,punish:N.$14x.turnPunish});if(!H||!H.length)return null;var n=[];n.push(G),s&&n.push(N.$1ew(H[0]));for(var P=1,o=H.length;P<o-1;P++)n.push(N.$1ew(H[P]));return f?(n.push(N.$1ew(H[o-1])),n.push(z)):(b=H[o-1],i.x!==b.x||i.y!==b.y||N.$14x.toGridCenter?n.push(N.$1ew(b)):n.push(z)),N.$14x.simplify&&(n=N.simplifyPath(n)),N.$20x=n,N.$21x(),n},G.prototype.debugOn=function(G){this.debugFlag=!0,this.debugSettings=G||{},this.$21x()},G.prototype.simplifyPath=function(G){var z=G.length;if(z<=2)return G;for(var s,f=[G[0],G[1]],N=f[0],j=f[1],i=2;i<z;i++)s=G[i],Math.abs((j.x-N.x)*(s.y-N.y)-(j.y-N.y)*(s.x-N.x))<1e-5?j=f[f.length-1]=s:(N=j,f.push(j=s));return f},G.prototype.$21x=function(){var G=this;if(G.$22x(),this.debugFlag){var z=G.grid;if(z){var s=G.gv;if(!1!==G.debugSettings.$16x){for(var f,N,j,i,U=[],t=[],D=G.$14x.gridSizeX/2,b=G.$14x.gridSizeY/2,d=z.length,k=d?z[0].length:0,H=1;H<d-1;H++)for(var n=1;n<k-1;n++)z[H][n]||(f=(i=G.$1ew({x:H,y:n})).x-D,N=i.x+D,j=i.y-b,i=i.y+b,U.push({x:f,y:j},{x:f,y:i},{x:N,y:i},{x:N,y:j}),t.push(1,2,2,2,5));var P=new u.Shape;P.s("shape.border.color","rgba(50, 50, 50, 0.2)"),P.s("shape.border.width",1),P.s("shape.background","rgba(200, 50, 100, 0.2)"),P.s("2d.editable",!1),P.s("2d.selectable",!1),P.setPoints(U),P.setSegments(t),G._debugInfo={grid:P},s.dm().add(P)}!1!==G.debugSettings.path&&(U=new u.Shape,G.$20x&&(U.setPoints(G.$20x),U.s("shape.border.color","red"),U.s("shape.border.width",1),U.s("2d.editable",!1),U.s("2d.selectable",!1),U.s("shape.background",null),G._debugInfo||(G._debugInfo={}),G._debugInfo.path=U,s.dm().add(U)))}}},G.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},G.prototype.$22x=function(){var G,z,s,f=this;f._debugInfo&&(G=f._debugInfo.grid,z=f._debugInfo.path,s=f.gv,G&&s.dm().remove(G),z&&s.dm().remove(z),f._debugInfo=null)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);