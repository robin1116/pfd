!function(p){"use strict";var M=ht.AlarmSeverity=function(p,x,H,i,J){this.value=p,this.name=x,this.nickName=H,this.color=i,this.displayName=J},x=(ht.Default.def("ht.AlarmSeverity",p,{toString:function(){return this.displayName||this.name}}),M.severities=new ht.List,M._vm={},M._nm={},M._cp=function(p,x){var H;return p&&x?0<(H=p.value-x.value)?1:H<0?-1:0:p&&!x?1:!p&&x?-1:0},M.each=function(p,x){M.severities.each(p,x)},M.getSortFunction=function(){return M._cp},M.setSortFunction=function(p){M._cp=p,M.severities.sort(p)},M.add=function(p,x,H,i,J){H=new M(p,x,H,i,J);return M._vm[p]=H,M._nm[x]=H,M.severities.add(H),M.severities.sort(M._cp),H},M.remove=function(p){var x=M._nm[p];return x&&(delete M._nm[p],delete M._vm[x.value],M.severities.remove(x)),x},M.CRITICAL=M.add(500,"Critical","C","#FF0000"),M.MAJOR=M.add(400,"Major","M","#FFA000"),M.MINOR=M.add(300,"Minor","m","#FFFF00"),M.WARNING=M.add(200,"Warning","W","#00FFFF"),M.INDETERMINATE=M.add(100,"Indeterminate","N","#C800FF"),M.CLEARED=M.add(0,"Cleared","R","#00FF00"),M.isClearedAlarmSeverity=function(p){return!!p&&0===p.value},M.getByName=function(p){return M._nm[p]},M.getByValue=function(p){return M._vm[p]},M.clear=function(){M.severities.clear(),M._vm={},M._nm={}},M.compare=function(p,x){return M._cp(p,x)},ht.AlarmState=function(p){this._d=p,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0}),H=(ht.Default.def("ht.AlarmState",p,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var p,x=null;for(p in this._am)p=M.getByName(p),M.isClearedAlarmSeverity(p)||0!==this.getAcknowledgedAlarmCount(p)&&(x=x&&0<M.compare(x,p)?x:p);this._haa=x},_c2:function(){var p,x=null;for(p in this._nm)p=M.getByName(p),M.isClearedAlarmSeverity(p)||0!==this.getNewAlarmCount(p)&&(x=x&&0<M.compare(x,p)?x:p);this._hna=x},_c3:function(){if(this._hna){for(var p in this._nm)if(p=M.getByName(p),!M.isClearedAlarmSeverity(p)&&0!==this.getNewAlarmCount(p)&&0<M.compare(this._hna,p))return void(this._hls=!0);this._hls=!1}else this._hls=!1},_c4:function(){var p=this._haa,x=this._hna,H=this._ps;this._hoa=p,0<M.compare(x,this._hoa)&&(this._hoa=x),0<M.compare(H,this._hoa)&&(this._hoa=H)},_c5:function(){var p=this._haa,x=this._hna;this._hta=p,0<M.compare(x,this._hta)&&(this._hta=x)},increaseAcknowledgedAlarm:function(p,x){var H;0!==x&&(H=this._am[p.name]||0,this._am[p.name]=H+=x=x||1,this._f())},increaseNewAlarm:function(p,x){var H;0!==x&&(H=this._nm[p.name]||0,this._nm[p.name]=H+=x=x||1,this._f())},decreaseAcknowledgedAlarm:function(p,x){if(0!==x){var H=this._am[p.name]||0;if((H-=x=x||1)<0)throw"Alarm count can not be negative";this._am[p.name]=H,this._f()}},decreaseNewAlarm:function(p,x){if(0!==x){var H=this._nm[p.name]||0;if((H-=x=x||1)<0)throw"Alarm count can not be negative";this._nm[p.name]=H,this._f()}},acknowledgeAlarm:function(p){this.decreaseNewAlarm(p,1),this.increaseAcknowledgedAlarm(p,1)},acknowledgeAllAlarms:function(p){if(p){var x=this.getNewAlarmCount(p);this.decreaseNewAlarm(p,x),this.increaseAcknowledgedAlarm(p,x)}else for(var H in this._nm)this.acknowledgeAllAlarms(M.getByName(H))},_c6:function(){for(var p in this._aac=0,this._am)p=M.getByName(p),this._aac+=this.getAcknowledgedAlarmCount(p)},getAcknowledgedAlarmCount:function(p){return p?this._am[p.name]||0:this._aac},getAlarmCount:function(p){return this.getAcknowledgedAlarmCount(p)+this.getNewAlarmCount(p)},_c7:function(){for(var p in this._nac=0,this._nm)this._nac+=this.getNewAlarmCount(M.getByName(p))},getNewAlarmCount:function(p){return p?this._nm[p.name]||0:this._nac},setNewAlarmCount:function(p,x){this._nm[p.name]=x,this._f()},removeAllNewAlarms:function(p){p?delete this._nm[p]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(p,x){this._am[p.name]=x,this._f()},removeAllAcknowledgedAlarms:function(p){p?delete this._am[p.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(p){var x;this._ep||(p=null),this._ps!==p&&(x=this._ps,this._ps=p,this._f(),this._d.fp("propagateSeverity",x,p))},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(p){var x=this._ep;this._ep=p,this._d.fp("enablePropagation",x,p)&&!p&&this.setPropagateSeverity(null)}}),ht.AlarmStatePropagator=function(p){this._dataModel=p,this._enable=!1,this._isPropagating=!1}),p=(ht.Default.def("ht.AlarmStatePropagator",p,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(p){this._enable!==p&&(this._enable=p,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(p){this.propagate(p)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(p){p.data&&this.propagate(p.data)},handleDataPropertyChange:function(p){var x;"alarmState"===p.property||"enablePropagation"===p.property?this.propagate(p.data):"parent"===p.property&&((x=p.oldValue)&&this.propagate(x),this.propagate(p.data))},propagate:function(p){p&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(p),this._isPropagating=!1)},propagateToTop:function(p){for(this.propagateToParent(null,p);p&&p.getParent();)this.propagateToParent(p,p.getParent()),p=p.getParent()},propagateToParent:function(p,x){var H=null;x.getChildren().each(function(p){p=p.getAlarmState().getHighestOverallAlarmSeverity();0<M.compare(p,H)&&(H=p)}),x.getAlarmState().setPropagateSeverity(H)}}),ht.AlarmStateStatistics=function(p){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(p)},ht.Default.def("ht.AlarmStateStatistics",p,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(p){var x=this._dataModel;x!==p&&(x&&(x.umd(this.handleDataPropertyChange,this),x.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=p,this.reset(),p.md(this.handleDataPropertyChange,this),p.mm(this.handleDataModelChange,this),this.fp("dataModel",x,p))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(p){"alarmState"===p.property&&(this.increase(p.data),this.fireAlarmStateChange())},handleDataModelChange:function(p){"add"===p.kind?(this.increase(p.data),this.fireAlarmStateChange()):"remove"===p.kind?(this.decrease(p.data),this.fireAlarmStateChange()):"clear"===p.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,M.each(function(p){p=this.getSumInfo(p);this.sumAcked+=p.ackedCount,this.sumNew+=p.newCount,this.sumTotal+=p.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(p){return p?this.getSumInfo(p).newCount:this.sumNew},getAcknowledgedAlarmCount:function(p){return p?this.getSumInfo(p).ackedCount:this.sumAcked},getTotalAlarmCount:function(p){return p?this.getSumInfo(p).totalCount:this.sumTotal},getSumInfo:function(p){var x=this.severtiyMap[p.name];return x||(this.severtiyMap[p.name]=x={newCount:0,ackedCount:0,totalCount:0}),x},decrease:function(p){var H=this.dataMap[p.getId()];H&&(delete this.dataMap[p.getId()],M.each(function(p){var x=H[p.name],p=this.getSumInfo(p);p.newCount=p.newCount-x.newCount,p.ackedCount=p.ackedCount-x.ackedCount,p.totalCount=p.totalCount-x.totalCount},this))},increase:function(p){var H,i;this.decrease(p),this._filterFunc&&!this._filterFunc(p)||(H={},i=p.getAlarmState(),this.dataMap[p.getId()]=H,M.each(function(p){var x={},p=(x.newCount=i.getNewAlarmCount(p),x.ackedCount=i.getAcknowledgedAlarmCount(p),x.totalCount=i.getAlarmCount(p),H[p.name]=x,this.getSumInfo(p));p.newCount=p.newCount+x.newCount,p.ackedCount=p.ackedCount+x.ackedCount,p.totalCount=p.totalCount+x.totalCount},this))},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(p){var x=this._filterFunc;this._filterFunc=p,this.reset(),this.fp("filterFunc",x,p)},getFilterFunc:function(){return this._filterFunc}}),ht.Data.prototype),p=(p.getAlarmState=function(){return this._alarmState||(this._alarmState=new x(this))},(p=ht.DataModel.prototype).isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},p.setEnableAlarmStatePropagator=function(p){p!=this.isEnableAlarmStatePropagator()&&(p?(this._alarmStatePropagator=new H(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},(p=ht.graph.GraphView.prototype).getNote2=function(p){var x=p.getAlarmState().getHighestNewAlarmSeverity();return x?(x=p.getAlarmState().getNewAlarmCount(x)+x.nickName,p.getAlarmState().hasLessSevereNewAlarms()&&(x+="+"),x):p.s("note2")},p.getNote2Background=function(p){var x=p.getAlarmState().getHighestNewAlarmSeverity();return x?x.color:p.s("note2.background")},p.getBodyColor=function(p){var x=p.getAlarmState().getHighestNativeAlarmSeverity();return x?x.color:p.s("body.color")},p.getBorderColor=function(p){var x=p.getAlarmState().getPropagateSeverity();return x?x.color:p.s("border.color")},(p=ht.widget.TreeView.prototype).getBorderColor=function(p){var x=p.getAlarmState().getPropagateSeverity();return x?x.color:p.s("border.color")},p.getIcon=function(p){return p.getIcon()?"__alarmIcon__":null},(p=ht.widget.TreeTableView.prototype).getBorderColor=function(p){var x=p.getAlarmState().getPropagateSeverity();return x?x.color:p.s("border.color")},p.getIcon=function(p){return p.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(p){return p.getIcon()}},color:{func:function(p){var x=p.getAlarmState().getHighestNativeAlarmSeverity();return x?x.color:p.s("body.color")}},rect:[0,0,16,16]}]}),ht.Style);p["note2.expanded"]=!0,p["note2.color"]="#000"}(("undefined"==typeof global&&"undefined"==typeof self&&"undefined"==typeof window&&(0,eval)("this"),Object));