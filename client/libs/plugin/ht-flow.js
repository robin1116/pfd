!function(r){"use strict";function x(r,K){for(var Q=[],Z=r.length,V=0;V<Z;V++)for(var a=r[V],M=(a=a._as?a._as:a)[0],L=1;L<a.length;L++)Q.push([M,a[L]]),M=a[L];for(var D=[],V=0;V<Q.length;V++){var y=q(Q[V][0],Q[V][1],K);D.push(y)}return{distance:D,segments:Q}}function V(r,K,Q){if(r){for(var Z,r=x(r,K),V=r.distance,a=r.segments,M=1/0,L=null,D=0,y=V.length;D<y;D++){var B=V[D];B.z<M&&(Z=D,M=B.z,L=B)}if(L.z<(Q=null==Q?.1:Q)){for(var t=0,$=0;$<=Z;$++)t+=H.getDistance(a[$][0],$<Z?a[$][1]:L);return t}}}function Z(r,K){var Q,Z;if(r)return r=x(r,K).distance,Q=1/0,Z=null,r.forEach(function(r){r.z<Q&&(Q=r.z,Z=r)}),Z}function y(r,K,Q){if(!r)return Q;if(0===K)return m=r[0][0],$=r[0][1],Q+Math.atan2($.y-m.y,$.x-m.x);if(100===K)return m=(r=r[r.length-1])[r.length-2],$=r[r.length-1],Q+Math.atan2($.y-m.y,$.x-m.x);for(var Z=0,V=[],a=r.length,M=0;M<a;M++){var L=r[M],L=S(L);Z+=L,V.push(L)}for(var D=Z*K/100,y=f(D,V),B=0,t=0;t<y;t++)B+=V[t];for(var $=C(r[y],D-=B),x=r[y],h=0,c=0,U=0;U<x.length-1;U++){var H=x[U],u=x[U+1],b=u.x-H.x,u=u.y-H.y;if(D<(h+=Math.sqrt(b*b+u*u))){c=U;break}}var m=x[c];return Q+Math.atan2($.y-m.y,$.x-m.x)}function $(r){var K=0;if(r)if(Array.isArray(r[0]))for(var Q=r.length,Z=0;Z<Q;Z++){var V=r[Z];K+=S(V)}else K=S(r);return K}function R(r){var K=r._data,Q=t(r);if(Q){K.s("flow.reverse")&&(Q.reverse(),Q.forEach(function(r){r.reverse()}));for(var Z,V,a=0,M=[],L=Q.length,D=0;D<L;D++){var y=Q[D],y=S(y);a+=y,M.push(y)}K[Y]=M,K[d]=a,K[h]=Q,K instanceof B.Edge&&(Z=(V=H.unionPoint(Q)).x+V.width/2,V=V.y+V.height/2,K.$10e={x:Z,y:V}),w(r,!0)}}function J(r){var K,Q=r.data,Z=this.dm();Q&&"add"===r.kind&&(K=Z.$3e)&&Q.s(M)&&K.indexOf(Q)<0&&K.push(Q),"clear"===r.kind&&(Z.$3e=[])}function _(r){var K=r.property,Q=r.data,r=r.newValue,Z=this.dm().$3e;if(Z&&"s:flow"===K)if(r)Z.indexOf(Q)<0&&Z.push(Q);else for(var V=Z.length,a=0;a<V;a++)if(Z[a]===Q){Z.splice(a,1);break}K==="s:"+s&&(this.getDataUI(Q)[X]=F)}function j(H){var r,u=this,b=u._data,m=b[d],z=b[Y],n=b[h],K=b.s(i),Q=u[X],Z=b.s(A),V=b.s(l),a=b.s(e),M=b.s(I),L=b.s(U),N=b.s(c),D=(L-M)/(a-1),y=(Z-V)/(a-1),G=b.getRotation?b.getRotation():0,O=b.getPosition?b.p():b.$10e,s=[],S=[];if(Q!=F){if(1===a)s.push(Z);else if(2===a)s.push(Z),s.push(V);else{if(!(2<a))return;s.push(Z);for(var B=a-2;0<B;B--)s.push(V+y*B);s.push(V)}if(1===a)S.push(L);else if(2===a)S.push(L),S.push(M);else{if(!(2<a))return;S.push(L);for(B=a-2;0<B;B--)S.push(M+D*B);S.push(M)}var R=0,t=0;s.forEach(function(r){R<a-1&&(t+=b.getFlowElementSpace(r)),R++}),r=(m-K*(t+=(Z+V)/2)+t)/K,H.save();for(B=0;B<K;B++){var J=Q,_=0,$=u._overCount,j=0;b.s("flow.autoreverse")&&$&&K-(B+1)<$||(J-=B*(r+t),R=0,s.forEach(function(r){var K,Q,Z,V=J-_;if(0<=V&&V<m){for(var a=f(V,z),M=j=0;M<a;M++)j+=z[M];V-=j;var L=C(n[a],V),D=G;if(N){for(var y=n[a],B=0,t=0,$=0;$<y.length-1;$++){var x=y[$],h=y[$+1],c=h.x-x.x,h=h.y-x.y;if(V<(B+=Math.sqrt(c*c+h*h))){t=$;break}}var U=y[t];D+=Math.atan2(L.y-U.y,L.x-U.x)}G&&(U=O,K=L.x-O.x,Q=L.y-O.y,Z=G,k.set(K,Q).rotateAround(null,Z),L=U?{x:U.x+k.x,y:U.y+k.y}:{x:k.x,y:k.y}),u.$5e(H,L,r,S[R],D)}_+=b.getFlowElementSpace(s[R]),R++}))}H.restore()}}function W(){var r=this,K=r._data,Q=K.s(A),Z=K.s(O),V=!1,a=F,Q=Math.max(Q,Q*Z);return r._6I||(V=!0),a=(K instanceof B.Edge?Kb:Qb).call(r),K.s(M)&&V&&(Z=K.s(U),0<(Q=K.s(N)&&Q<Z?Z:Q)&&H.grow(a,Math.ceil(Q/2)),R(r)),!K.s(M)&&V&&(K[Y]=K[d]=K[h]=r[X]=F),a}function o(r){this.__flowBatchGroup={}}function P(K){var r=this.__flowBatchGroup;if(r){for(var Q in K.save(),r)K.fillStyle=Q,K.beginPath(),r[Q].forEach(function(r){K.moveTo(r[0],r[1]),K.arc(r[0],r[1],r[2],0,2*Math.PI,!0)}),K.fill();K.restore()}}var B=r.ht,H=B.Default,u=H.getInternal(),r=u.ui(),F=null,Y="__segmentLengths",d="__lineTotalLength",h="__linePoints",X="__distance0",i="flow.count",b="flow.step",A="flow.element.max",e="flow.element.count",l="flow.element.min",K="flow.element.space",c="flow.element.autorotate",m="flow.element.background",U="flow.element.shadow.max",I="flow.element.shadow.min",z="flow.element.shadow.begincolor",n="flow.element.shadow.endcolor",N="flow.element.shadow.visible",M="flow",G="flow.element.image.stretch",O="flow.element.image.ratio",s="flow.begin.percent",Q=B.Math.Vector2,k=new Q,Q=(new Q,new Q,B.List,B.Default._edgeProtectMethod),t=Q.getStraightLinePoints,q=function(r,K,Q){var Z=r.x,V=r.y,a=K.x,M=K.y,L=Q.x,Q=Q.y,a=a-Z,M=M-V,D=Math.sqrt(a*a+M*M),y=a/D,D=M/D,B=(-Z+L)*y+(-V+Q)*D,Z={x:Z+B*y,y:V+B*D};return Z.x>=Math.min(r.x,K.x)&&Z.x<=Math.max(r.x,K.x)&&Z.y>=Math.min(r.y,K.y)&&Z.y<=Math.max(r.y,K.y)||(Z.x=(Math.abs(Z.x-r.x)<Math.abs(Z.x-K.x)?r:K).x,Z.y=(Math.abs(Z.y-r.y)<Math.abs(Z.y-K.y)?r:K).y),a=L-Z.x,M=Q-Z.y,Z.z=Math.sqrt(a*a+M*M),Z},S=Q.calculateLineLength,f=Q.calcSegmentIndexByDistance,C=Q.calculatePointAlongLine,T=Q.getPercentPosition,w=function(r,K){var Q,Z=r._data,V=Z[d],a=Z.s(i),M=Z.s(b),L=Z[Y],D=Z.s(A),y=Z.s(l),B=Z.s(e),t=(D-y)/(B-1),$=[],x=Z.s(s);if(L&&!isNaN(a)&&0!==a){if(1===B)$.push(D);else if(2===B)$.push(D),$.push(y);else{if(!(2<B))return;$.push(D);for(var h=B-2;0<h;h--)$.push(y+t*h);$.push(y)}var c=0,U=0,H=($.forEach(function(r){c<B-1&&(U+=Z.getFlowElementSpace(r)),c++}),Q=(V-a*(U+=(D+y)/2)+U)/a,r[X]);for(null==H&&(H=V*x),K||(H+=M);V+U<H;){var u=r._overCount;u?u++:u=1,a<=u&&(u=null),r._overCount=u,!Z.s("flow.autoreverse")||u?H-=Q+U:(H=0,Z.s("flow.reverse",!Z.s("flow.reverse")))}r[X]=H}},Q="prototype",a=B.graph.GraphView[Q],v=B.Data[Q],g=r.DataUI[Q],L=r.ShapeUI[Q],r=r.EdgeUI[Q],Q=B.DataModel[Q],D=B.Style,E=(D[A]==F&&(D[A]=7),D[l]==F&&(D[l]=0),D[i]==F&&(D[i]=1),D[b]==F&&(D[b]=3),D[e]==F&&(D[e]=10),D[K]==F&&(D[K]=3.5),D[c]==F&&(D[c]=!1),D[m]==F&&(D[m]="rgba(255, 255, 114, 0.4)"),D[z]==F&&(D[z]="rgba(255, 255, 0, 0.3)"),D[n]==F&&(D[n]="rgba(255, 255, 0, 0)"),D[N]==F&&(D[N]=1),D[U]==F&&(D[U]=22),D[I]==F&&(D[I]=4),D[G]==F&&(D[G]="fill"),D[O]==F&&(D[O]=1),D[s]==F&&(D[s]=0),a.calculatePointLength=function(r,K,Q){r=this.getDataUI(r),r=t(r);return V(r,K,Q)},H.calculatePointLength=function(r,K,Q,Z){r=t(F,r,K);return V(r,Q,Z)},H.calculateClosestPointOnLine=q,a.calculateClosestPoint=function(r,K){r=this.getDataUI(r),r=t(r);return Z(r,K)},H.calculateClosestPoint=function(r,K,Q){r=t(F,r,K);return Z(r,Q)},a.getPercentAngle=function(r,K){var Q=this.getDataUI(r),Q=t(Q);r.getRotation&&r.getRotation();return y(Q,K,r.getRotation?r.getRotation():0)},H.getPercentAngle=function(r,K,Q){r=t(F,r,K);return y(r,Q,0)},a.calculateLength=function(r){r=this.getDataUI(r),r=t(r);return $(r)},H.calculateLength=function(r,K){r=t(F,r,K);return $(r)},a.getPercentPosition=function(r,K){r=this.getDataUI(r),r=t(r);return T(r,K)},H.getPercentPositionOnPoints=function(r,K,Q){r=t(F,r,K);return T(r,Q)},a.setDataModel),p=(a.setDataModel=function(r){var K,Q=this,Z=Q._dataModel;Z!==r&&(Z&&(Z.umm(J,Q),Z.umd(_,Q),Z.$3e=[]),r.mm(J,Q),r.md(_,Q),K=r.$3e=[],r.each(function(r){r.s(M)&&K.indexOf(r)<0&&K.push(r)}),E.call(Q,r))},v.getFlowElementSpace=function(r){return this.s(K)},r.drawBody),rb=(r.drawBody=function(r){p.call(this,r);var K=this._data,Q=this.gv;K.s(M)&&Q.$7e!=F&&j.call(this,r)},L.drawBody),Kb=(L.drawBody=function(r){rb.call(this,r);var K=this._data,Q=this.gv;K.s(M)&&Q.$7e!=F&&j.call(this,r)},r._79o),Qb=L._79o,Zb=(L._79o=W,r._79o=W,g.$5e=function(r,K,Q,Z,V){var a,M,L=this._data,D=this.gv,y=L.s(m),B=L.s(z),t=L.s(n),$=L.s(N),x=D.$8e,h=L.s("flow.element.image"),c=L.s(G),U=L.s(O);x==F&&(x=D.$8e={}),r.beginPath(),h!=F?(H.isArray(h)&&(a=h.length,h=h[index%a]),a=H.getImage(h),M=Q/2,r.translate(K.x,K.y),r.rotate(V),r.translate(-K.x,-K.y),H.drawStretchImage(r,a,c,K.x-M,K.y-M*U,Q,Q*U,L),r.translate(K.x,K.y),r.rotate(-V),r.translate(-K.x,-K.y)):D.__flowBatch?(h=(h=D.__flowBatchGroup)||(D.__flowBatchGroup={}),a=[K.x,K.y,Q/2],h[y]?h[y].push(a):h[y]=[a]):(r.fillStyle=y,r.arc(K.x,K.y,Q/2,0,2*Math.PI,!0),r.fill()),$&&((U=x[c="22_"+B+"_"+t])==F&&(V=document.createElement("canvas"),u.setCanvas(V,22,22),D=V.getContext("2d"),u.translateAndScale(D,0,0,1),D.beginPath(),(h=D.createRadialGradient(11,11,0,11,11,11)).addColorStop(0,B),h.addColorStop(1,t),D.fillStyle=h,D.arc(11,11,11,0,2*Math.PI,!0),D.fill(),U=x[c]=V),H.drawImage(r,U,K.x-(M=Z/2),K.y-M,Z,Z,L))},a.$9e=function(){var K=this,r=K.dm().$3e;K._24I;r.forEach(function(r){K._24I[r._id]=r}),K.iv()},Q.prepareRemove);Q.prepareRemove=function(r){Zb.call(this,r);var K=r._dataModel.$3e;if(K)for(var Q=K.length,Z=0;Z<Q;Z++)if(K[Z]===r){K.splice(Z,1);break}},a.setFlowInterval=function(r){var K=this,Q=K.$11e;K.$11e=r,K.fp("flowInterval",Q,r),K.$7e!=F&&(clearInterval(K.$7e),delete K.$7e,K.enableFlow(r))},a.getFlowInterval=function(){return this.$11e},a.enableFlow=function(r){var K=this,Q=K.dm(),Z=Q.$3e;K.$7e==F&&(Z.forEach(function(r){r=K.getDataUI(r);R(r)}),K.$7e=setInterval(function(){Q.$3e.forEach(function(r){w(K.getDataUI(r))}),K.$9e()},r||K.$11e||50))},a.disableFlow=function(){clearInterval(this.$7e),delete this.$7e,this.dm().$3e&&this.$9e()};a.setFlowBatch=function(r){var K=this;!!K.__flowBatch!=!!r&&((K.__flowBatch=r)?(K.addBottomPainter(o),K.addTopPainter(P)):(K.removeBottomPainter(o),K.removeTopPainter(P)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);