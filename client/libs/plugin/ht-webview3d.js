!function(W){"use strict";var T=W.ht,S=T.Default,C=S.getInternal(),I=C.superCall,W=T.graph3d.Graph3dView,Z=W.prototype.validateImpl;function l(k){var _,K,m,e,U,t,N=[],f=0,w=S.createDiv(!0),Z=k.getView(),y=(Z.insertBefore(w,k.getCanvas()),(_=T.Default.createDiv()).style.WebkitTransformStyle="preserve-3d",_.style.MozTransformStyle="preserve-3d",_.style.transformStyle="preserve-3d",w.appendChild(_),[{event:"mousedown",style:"none"},{event:"mouseup",style:"auto"},{event:"touchstart",style:"none"},{event:"touchend",style:"auto"}].forEach(function(W){var I=W.style;C.addEventListener(Z,W.event,function(){k.isDragProtectForWebView()&&(w.style.pointerEvents=I)})}),new T.Math.Vector3(0,0,1)),F=new T.Math.Vector3(0,0,1),M=new T.Math.Quaternion,s=new T.Math.Matrix4,p=T.Math.randomFloat,q=new T.Math.Euler,H=new T.Math.Matrix4,O=new T.Math.Matrix4,v=new T.Math.Matrix4,V=(this.updateWebView=function(){if(k.getWidth()&&k.getHeight()){var W,I,Z,C,l,$=k.getCanvas(),s=+$.style.width.slice(0,-2),$=+$.style.height.slice(0,-2),s=(N[0]===s&&N[1]===$||(N[0]=s,N[1]=$,w.style.width=s+"px",w.style.height=$+"px",_.style.width=s+"px",_.style.height=$+"px"),k._projectMatrix[5]*N[1]/2),V=(s!==K&&(K=s,w.style.WebkitPerspective=K+"px",w.style.MozPerspective=K+"px",w.style.perspective=K+"px"),[]),S=(k.dm().each(function(W){W.isWebView&&V.push(W)}),W=V.length,100),u=k.getCamera();do{for(l=!0,o=0;o<=W;o++)if((o===W?u:V[o]).getQuaternion(M),I&&M.premultiply(I),Z=F.set(1,0,0).applyQuaternion(M).dot(y),C=F.set(0,1,0).applyQuaternion(M).dot(y),Math.abs(Math.abs(Z)-1)<.1||Math.abs(Math.abs(C)-1)<.1){l=!1,t?(I=t,t=null):(I=I||new T.Math.Quaternion,q.set(0,p(-Math.PI,Math.PI),0),I.setFromEuler(q));break}}while(S--&&!l);for(var x,$=k._viewMatrix,$=(I&&($=H.makeRotationFromQuaternion(I.inverse()).premultiply($).toArray(),H.makeRotationFromQuaternion(I.inverse())),O.fromArray($),O.setPosition(F.set(0,0,-100)),v.copy(O).invert().multiply($),$=O.toArray(),(U="translateZ("+K+"px)"+("matrix3d("+n((s=$)[0])+","+n(-s[1])+","+n(s[2])+","+n(s[3])+","+n(s[4])+","+n(-s[5])+","+n(s[6])+","+n(s[7])+","+n(s[8])+","+n(-s[9])+","+n(s[10])+","+n(s[11])+","+n(s[12])+","+n(-s[13])+","+n(s[14])+","+n(s[15])+")"))+"translate("+N[0]/2+"px,"+N[1]/2+"px)"),R=(m===$||e||(_.style.WebkitTransform=$,_.style.MozTransform=$,_.style.transform=$,m=$),f++,V.forEach(function(W){A(W,I?H:null,v)}),_.children),d=[],o=0,r=R.length;o<r;o++)(x=R[o])._isHtWebView&&x._renderCookie!==f&&d.push(x);d.length&&d.forEach(function(W){_.removeChild(W)}),t=I}},new Array(16)),A=function(W,I,Z){var C,l,$=W.getAttach();$&&((l=k.isVisible(W))&&$.parentNode!==_?_.appendChild($):!l&&$.parentNode&&S.removeHTML($),l&&($._renderCookie=f,l=W.getFinalScale3d(),(C=W._prefrenceSize)&&C[0]?C[1]||(C[1]=C[0]/l[0]*l[1]):C=[l[0],l[1]],$.style.width=C[0]+"px",$.style.height=C[1]+"px",l=1/C[0],C=1/C[1],W=W.mat,V[0]=W[0]*l,V[1]=W[1]*l,V[2]=W[2]*l,V[3]=W[3]*l,V[4]=W[4]*C,V[5]=W[5]*C,V[6]=W[6]*C,V[7]=W[7]*C,V[8]=+W[8],V[9]=+W[9],V[10]=+W[10],V[11]=+W[11],V[12]=W[12],V[13]=W[13],V[14]=W[14],V[15]=W[15],I&&(V=s.multiplyMatrices(I,V).toArray()),l=function(W,I){W="matrix3d("+n(W[0])+","+n(W[1])+","+n(W[2])+","+n(W[3])+","+n(-W[4])+","+n(-W[5])+","+n(-W[6])+","+n(-W[7])+","+n(W[8])+","+n(W[9])+","+n(W[10])+","+n(W[11])+","+n(W[12])+","+n(W[13])+","+n(W[14])+","+n(W[15])+")";return"translate(-50%,-50%)"+(I||"")+W}(V=Z?s.multiplyMatrices(Z,V).toArray():V,e?"translate("+N[0]/2+"px,"+N[1]/2+"px)"+U:""),$.$a2!==l&&($.$a2=l,$.style.WebkitTransform=l,$.style.MozTransform=l,$.style.transform=l)))}}function n(W){return Math.abs(W)<1e-10?0:W}W.prototype.validateImpl=function(){Z.call(this),(this._webViewRenderer||(this._webViewRenderer=new l(this))).updateWebView()},W.prototype.isDragProtectForWebView=function(){return this._dragProtectForWebView},W.prototype.setDragProtectForWebView=function(W){this._dragProtectForWebView=W},T.Default.setShader("htWebView3d",["attribute vec3 aPosition;","uniform mat4 uModelViewMatrix ;","uniform mat4 uProjectMatrix;","void main(void) {","gl_Position = uProjectMatrix * uModelViewMatrix  * vec4(aPosition, 1.0);","}","// FS","void main(void) {","gl_FragColor = vec4(0.0);","}"].join("\n"));var $={type:"htWebView3d"},s=T.WebView3d=function(){I(s,this),this.s({shape3d:"billboard","shape3d.reverse.flip":!0})};S.def("ht.WebView3d",T.Node,{ms_ac:["attach"],isWebView:!0,attachDOM:function(W,I,Z){if(!W)return this.detachDOM();"string"==typeof W&&((C=document.createElement("iframe")).src=W,W=C);var C=W.style;C.position="absolute",C.outline=0,C.margin=0,W._isHtWebView=!0,this.setAttach(W),this._prefrenceSize=[I,Z],this.s("shape3d.material",$)},detachDOM:function(){this.setAttach(null),this.s("shape3d.material",void 0)}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);