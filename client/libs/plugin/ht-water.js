!function(){"use strict";var t=ht.Default;t.clone,t.isArray,t.isObject,new ht.Notifier;function e(t,e,r){for(var n,a,i,A,s,o="",h=r||0;h<t.length;)n=e.indexOf(t.charAt(h++))<<2|(i=e.indexOf(t.charAt(h++)))>>4,a=(15&i)<<4|(A=e.indexOf(t.charAt(h++)))>>2,i=(3&A)<<6|(s=e.indexOf(t.charAt(h++))),o+=String.fromCharCode(n),64!=A&&(o+=String.fromCharCode(a)),64!=s&&(o+=String.fromCharCode(i));return o=decodeURIComponent(escape(o))}var r="BTtU9oYpnesL3jQgSvJqf5V0dAu+16DiHhWmyMCINr=ZFPbxGXl8O/7K2cR4zwkEa",n="waterRealSimBaseShader",a="waterRealSimClipShader",i="waterPointSimBaseShader",A="waterPointSimSlipShader",s="waterRealSimBaseShaderFog",o="waterRealSimClipShaderFog",h="waterPointSimBaseShaderFog",l="waterPointSimSlipShaderFog",u=e("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",r),d=e("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",r),t=e("1peMd7M8uVwbnYhrA7hGnYAF+7oOQGNs6ColDVMbAlT7AV38npAj6MTx17MOuVwbQGNs6VcrACwl+JT8dV/G+Y5l3ySH65w8uYoGA5vMDpv/1Cf4tI5buVAx1COHACXxd0SH65wh+pTNd5vM1KS4tI5buVAx1COHACXxd0SH65wx1Yomu0vcQGNstWjrACvMAWTUq9MStI5buVAx1COH17oP1YXM1me9np5id7Xr1ovMDpv/1Cf4tIAh1IMr+C1H6C5m3WT707jx+KeyuVch6Y58S7Xr1UFsn75bAYMCtHr7+7MynY/huV2HspAxuVSrnpFsn7MCAY5Cn9j3J5BsntBHnpAMd8nH6p57nUOHd7Xh+0BN6Mwm+7wlAYMbd0vM1OjFu0BFnUBb3UBXLtBGLmycQJy4tWBHntTC+Ywh6tTm+YMGJVcC+lBwnpvMDpv/1Cflvth/07jFu0TfA0hO60eMLtTO60drLC94tWBHntTrAWhm+YMGJVcC+lBznUBbjJyHDGNHntBHntBHnYvr17jh1CS4tWBHntTwtWjM+CvrAHNstWBHntTI+owY1CoIS7wF+KnHgJTOA0hO60eM3ySN65w8uYoGA5vMDpv/1CfFnY6F0/TxuVcOS7wx1CSrQGNHntBHuVdNA7XivIehAOjx+YwlLC9HgUOH65wh+pTNd5vM1KSrnpFsntBHntBHntTyu0jmd0eyQGNHntBHntBHnpeM6p5l+mFsntBHnpOsntBHnY6F0OAldV6U+7Xx1WchnUOH65wx1Yomu0vcQGNsn7MCAY5Cn9j3J5BsntBHnY6F0OAldV6U+7Xx1WchnUOHA7XivIehAOjx+YwlLC9HsWTm+YMGJVcC+lB=np5i+KThd7MODqFsn75bAYMCtHNHntBH6C5mjtTeAtBwnY6F0OAldV6U+7Xx1mFsntBHntjr+CjF6VvMnUXC+71bAI3bdCwyDq2sntBHnY6F0OAldV6U+7Xx1WBwn9MyQGrw",r),r=e("1peMd7M8uVwbnYhrA7hGnYAF+7oOQGrh6pvluVe/6YfH6C5m3lThfYw8u0vr+724tCoO6perdI5OAJT7AV3lnYoU+7wlAUFs6ColDVMbAlT7AV38npAi1Yw8u0vr+724tIAh1IMr+C1H6C5m3WT707jx+KeyuVch6Y58QGr/+CMC+KePnY/h6USH65Tl+7rMdKvjd0vlu0H4tI5buVAx1COH+VoOjtT/qVwyAVXVuV5KqVoO1CM2QGr/+CMC+KePnY/h6USH6f/xAY5FqVoO1CM2QGr/+CMC+KePnpAMd83H65wIAVwPA0vlD5jrDC5Jd0vr+8Fs6VcrACwl+JT8dV/G+Y5l3ySH65wyu0jG+YomAV/M+Ivjd0B4tI5buVAx1COHACXxd0SH65wG+7Mb6ojrDCf4tHr/+CMC+KePnpAMd8nH65wlA0TMd0S4tI5buVAx1COH6C5m3WT/0KvldVc8+YoOAqFstHr7d0ecuVcInpAMd8SHd7Xr1ojGdVjMQGNs6ColDVMbAlT7AV38npAj6MTx17MOuVwbQGNsn7MCAY5Cn9j3J5Bs6ColDVMbAlT7AV3lnpAid7wx1Cvr+CoOA0jU+YMGQGNmAVcyuVdstIAxuVSH+Vor+WBN6CwrAtyHDGNHnpAMd83H1Yw8u0vr+72HgJThfYw8u0vr+72HntFH6Y526p5lAqe9sp5iAYM81YXhd75PAVcOqVoGLtTC1Com6thhS7wx1CSHsWT/0KeM1Y5h6tBZnp5i6peh+IjFd0vMsJyb1C6WntNH65wIAVwPA0vlD5jrDC5Jd0vr+8Fsn7MCAY5Cn9j3J5BsntT707jx+KeyuVch6Y58S7Xr1tBwnpTx17MOuVwbLIhRntFH3t2/QGNmAVcyuVdstWBH6y/7fYw8u0vr+72HgJBN6f/xAY5F5CMM6O/h6perDtB=npAMd8SNnpTx17MOuVwbLtBXLmBrsJc2D0N4tWBHA7XifYwr+Ivqu0rMnUOH65wG+7Mb6ojrDCfHLlThdI3NL0Aj6MTx17MOuVwbLINrQlBstWBH6Mwm+7wlAYMbd0vM1lBwnYoU+7wlAUFsntT70KTx17MOuVwbnUOHsp5j+7vM+9/h6perDtB=npAMd8SN1Yw8u0vr+72FnU9b3tyrLIhcDmFsntTm+YMGfKThd7fHgJT/fpexuC5m69/h6perDtB=np5j+7vM+oArA06jd0vlu0HHsWT7AV3OspTx17MOuVwbLtBXLmBrQGNHnY6F0/Tx17MOuVwbnUOHd7Xr1ojGdVjMQGrw",r);ht.Default.setShader("waterSimBaseShader",r,u),ht.Default.setShader(n,r,d),ht.Default.setShader(a,"#define CLIP\r\n"+r,"#define CLIP\r\n"+d),ht.Default.setShader(i,r,t),ht.Default.setShader(A,"#define CLIP\r\n"+r,"#define CLIP\r\n"+t),ht.Default.setShader(s,r,"#define FOG\r\n#include <fog.fs.head>\r\n"+d),ht.Default.setShader(o,"#define CLIP\r\n"+r,"#define CLIP\r\n#define FOG\r\n#include <fog.fs.head>\r\n"+d),ht.Default.setShader(h,r,"#define FOG\r\n#include <fog.fs.head>\r\n"+t),ht.Default.setShader(l,"#define CLIP\r\n"+r,"#define CLIP\r\n#define FOG\r\n#include <fog.fs.head>\r\n"+t);var C="waterSimMatName",w=1;function p(t,e){t=function(t,e){for(var r=[],n=[],a=[],i=0;i<e;i++)for(var A=0;A<t;A++)n.push(A*w/(t-1)-w/2),n.push(0),n.push(i*w/(e-1)-w/2),a.push(A/(t-1),i/(e-1));for(var s=0;s<e-1;s++)for(var o=0;o<t-1;o++)r.push(s*t+o),r.push((s+1)*t+o),r.push((s+1)*t+o+1),r.push((s+1)*t+o+1),r.push(s*t+o+1),r.push(s*t+o);return{vs:n,is:r,aCoord:a}}(t[0],t[1]),e=e||"waterSimModelName";return ht.Default.setShape3dModel(e,{model3d:!0,mesh:t,mat:C}),e}var v="waterSimCicle";ht.Default.setImage(v,"data:image/png;base64,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");var B=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},d=function(t,e,r){return e&&M(t.prototype,e),r&&M(t,r),t};function M(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function g(t,e,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(r):void 0:null===(t=Object.getPrototypeOf(t))?void 0:g(t,e,r)}var r=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},H=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},f=(t=ht.graph3d.Node3dUI,r(m,t),d(m,[{key:"_initRenderTarget",value:function(){var t=this.gv,e=new ht.Camera;e.s("camera.renderSky",!1),e.s("camera.renderShadowMap",!1),(this._camera=e).setCullingMask("main");var r=void 0,r=1!==this._ratio?new ht.graph3d.RenderTarget(t,t.getGL(),1,1,{autoSize:!1}):new ht.graph3d.RenderTarget(t,t.getGL(),null,null,{autoSize:!0});this._camera=e,this._renderTarget=r,this._camera.attachRenderTarget(this._renderTarget)}},{key:"validate",value:function(t,e){var r=this;g(m.prototype.__proto__||Object.getPrototypeOf(m.prototype),"validate",this).call(this,t,e);t=this.data;t._modelDirty&&(t._modelDirty=!1,t.initModel()),t._uidDirty&&(this._uidDirty=!1,e=t._waterUid+"refraction",this.gv.setTexture(e,this._renderTarget.texture),t.s("matDef")[C].u_refractionTexture=e),t._childrenDirty&&(t._childrenDirty=!1,0<t.getChildren().length?this.gv.addOnPreFrameFunc(t.getId(),function(){r._drawClipScene()}):this.gv.removeOnPreFrameFunc(t.getId())),t._clipInfoDirty&&(t.updateClipInfo(),t._clipInfoDirty=!1),this._updateReflect()}},{key:"_updateReflect",value:function(){var t,e,r=this.data;r._reflectDirty&&(!(t=r.a("waterReflect"))||(e=this.gv.dm().getDataByTag(t))&&(t="waterReflector"+t,(e=this.gv.getData3dUI(e)._reflectorRenderTarget)&&(this.gv.setTexture(t,e.texture),r._reflectDirty=!1,r.iv())))}},{key:"drawBody",value:function(t,e,r){this._updateReflect(),g(m.prototype.__proto__||Object.getPrototypeOf(m.prototype),"drawBody",this).call(this,t,e,r)}},{key:"_drawClipScene",value:function(){var t,r=this.data;!1!==r.a("waterRefractStarted")&&0!=r.getChildren().length&&r.s("3d.visible")&&(t=!1,r._clipBox&&r.a("waterClipBelow")&&(t=!0,r._clipBox.s("3d.clipbox","inner"),this.gv.updateScene()),this.gv.isVisible=function(t){var e=t instanceof ht.plugin.Wave;return t.getParent()===r&&t.s("3d.visible")&&!e},1!==this._ratio&&this._renderTarget.setSize(this.gv.getGL(),this.gv.getWidth()*this._ratio,this.gv.getHeight()*this._ratio),this.gv.getCamera(this._camera),this._camera.render(this.gv),this.gv.isVisible=this._visibleFunc,t&&r._clipBox.s("3d.clipbox","outer"))}}]),m);function m(t,e){B(this,m);e=H(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,t,e));return e._ratio=.5,e._initRenderTarget(),e._visibleFunc=t.isVisible,e}var Y=(t=ht.Node,r(V,t),d(V,[{key:"_myInit",value:function(){this._waterUid=ht.Math.generateUUID(),this._uidDirty=!0,this._material={type:n,u_geometrySizeRatio:[.002,.002,.002],u_geometrySize:1,u_exposure:.7,u_reflectivity:1,u_fresnel:.5,u_distortion:.03,u_shineDamper:20,u_shallowWaterColor:[12/255,76/255,135/255,1],u_sunlightColor:[.5,.5,.5],u_normalParam:1,u_point_size:2e3,lineAlpha:.3,lineColor:[1,1,1],u_alphaTest:.5,u_repeat:[1,1],u_translate:[0,0],u_opacity:1},this.getDisplayName()||this.setDisplayName("Water Sim");var t={};t[C]=this._material,this.s("matDef",t),this._updateNormalMatrix(),this.a({waterWaveScale:20,waterWaveSize:500,waterGrid:[128,128],waterNormalAdj:1,waterColor:"rgba(199, 226, 255, 1.0)",waterLightColor:"rgba(204, 204, 204, 1.0)",waterLightDir:[2.9,-61.6],waterMode:0,waterDistortion:.02,waterLightDamper:40,waterReflectivity:.8,waterFresnel:2}),this.initModel(),this.s({"shadow.cast":!1,"shadow.receive":!1,"shape3d.transparent":!0,"shape3d.opacity":1}),this._readBuffer=new Float32Array(125)}},{key:"_updateNormalMatrix",value:function(){var t=new ht.Math.Matrix4;t.makeRotationFromEuler(this.getEuler()),this.s("matDef")[C].u_normalMatrix=t.toArray(),this.iv()}},{key:"initModel",value:function(){this._lineMesh=null;var t=p(this.a("waterGrid"));this.s("shape3d",t),this.iv()}},{key:"_getSunLightDir",value:function(t,e){var r=new ht.Math.Vector3([-1,-1,.5]),n=-Math.sin(t/180*Math.PI),a=-Math.sin(e/180*Math.PI),e=[n,-Math.cos(t/180*Math.PI)*Math.cos(e/180*Math.PI),a,t,e];return r.fromArray(e),r.normalize(),r.toArray()}},{key:"get3dUIClass",value:function(){return f}},{key:"getClass",value:function(){return V}},{key:"getSuperClass",value:function(){return ht.Node}},{key:"getClassName",value:function(){return"ht.plugin.Water"}},{key:"_updateShader",value:function(){var t="triangles",e=n,r=this.a("waterFog");switch(r&&(e=s),this.a("waterMode")){case 1:this.a("waterClip")&&(e=r?o:a),t="lines";break;case 0:this.a("waterClip")&&(e=r?o:a),t="triangles";break;case 2:e=this.a("waterClip")?r?l:A:r?h:i,t="points",this.s("matDef")[C].u_shapeTexture=this.a("waterPointShape")||v}this.s("matDef")[C].type=e,this.s("matDef")[C].renderMode=t}},{key:"onPropertyChanged",value:function(t){g(V.prototype.__proto__||Object.getPrototypeOf(V.prototype),"onPropertyChanged",this).call(this,t);var e=t.property;if("*"!=e)if("a:waterWave"!=e)if("a:waterReflect"!=e){if("a:waterClip"==e){var r=this.a("waterClip");return this.s("matDef")[C].u_clipTexture=r,this._updateShader(),void this.iv()}if("s:shape3d.transparent"==e)return this.s("matDef")[C].transparent=this.s("shape3d.transparent"),void this.iv();if("a:waterNormalAdj"==e)return this.s("matDef")[C].u_normalParam=t.newValue,void this.iv();if("a:waterColor"==e)return this.s("matDef")[C].u_shallowWaterColor=t.newValue,void this.iv();if("a:waterLightColor"==e)return this.s("matDef")[C].u_sunlightColor=t.newValue,void this.iv();if("a:waterLightDir"==e)return this.s("matDef")[C].u_sunlightDir=this._getSunLightDir(t.newValue[0],t.newValue[1]),void this.iv();if("a:waterGrid"==e)return this._modelDirty=!0,void this.iv();if("a:waterWaveScale"==e)return this._updateWaveScale(),void this.iv();if("a:waterWaveSize"==e)return this._updateWaveScale(),void this.iv();if("a:waterMode"==e)return this._updateShader(),void this.iv();if("s:shape3d.opacity"==e)return this.s("matDef")[C].u_opacity=t.newValue,void this.iv();if("a:waterDistortion"==e)return this.s("matDef")[C].u_distortion=t.newValue,void this.iv();if("a:waterLightDamper"==e)return this.s("matDef")[C].u_shineDamper=t.newValue,void this.iv();if("a:waterReflectivity"==e)return this.s("matDef")[C].u_reflectivity=t.newValue,void this.iv();if("a:waterFresnel"==e)return this.s("matDef")[C].u_fresnel=t.newValue,void this.iv();if("a:waterRepeat"==e)return this.s("matDef")[C].u_repeat=t.newValue,void this.iv();if("a:waterTranslate"==e)return this.s("matDef")[C].u_translate=t.newValue,void this.iv();if("a:waterPointSize"==e)return this.s("matDef")[C].u_pointSize=t.newValue,void this.iv();if("s:alphaTest"==e)return this.s("matDef")[C].u_alphaTest=t.newValue,void this.iv();if("rotation"!=e&&"rotationZ"!=e&&"rotationX"!=e&&"rotation3d"!=e)return"children"==e?(this._childrenDirty=!0,this._updateChildClipInfo(t),void this.iv()):"a:waterClipGroup"==e?(this.updateClipInfo(),void this.iv()):"a:waterClipBelow"==e?(this.updateClipInfo(),this.getDataModel()||(this._clipInfoDirty=!0),void this.iv()):"a:waterFog"==e?(this._updateShader(),void this.iv()):"a:waterPointShape"==e?(this.s("matDef")[C].u_shapeTexture=this.a("waterPointShape")||v,void this.iv()):void 0;this._updateNormalMatrix()}else{var n=this.a("waterReflect");n&&(this.s("matDef")[C].u_reflectionTexture="waterReflector"+n,this._reflectDirty=!0,this.iv())}else{n=this.a("waterWave");n&&(this.s("matDef")[C].u_displacementMap=n,this.s("matDef")[C].u_normalMap=n+"Normal",this.iv())}}},{key:"_updateWaveScale",value:function(){var t=1/this.a("waterWaveSize"),t=[t,this.a("waterWaveScale")*t,t];this.s("matDef")[C].u_geometrySizeRatio=t}},{key:"autoConfig",value:function(){var t,e,r,n;this._autoConfigDone||(n=this.getDataModel())&&(t=new ht.plugin.Wave,n.add(t),e="wave"+t.getId(),t.setTag(e),t.setDisplayName(""),r=new ht.Node,n.add(r),n="reflector"+t.getId(),r.setTag(n),r.s((c(t={shape3d:"plane","shape3d.reflector":!0,"shape3d.reflector.ratio":.5,"shadow.cast":!1,"shadow.receive":!1,"3d.reflectable":!1},"shape3d.reflector",!0),c(t,"shape3d.reflector.visible",!1),t)),r.p3(this.p3()),r.setRotation3d(this.getRotation3d()),r.setHost(this),this.a("waterWave",e),this.a("waterReflect",n),n=this.s3(),this.s3([n[0],n[1],n[0]]),this.a("waterWaveScale",n[0]/16),this._autoConfigDone=!0)}},{key:"getClipBox",value:function(){return this._clipBox}},{key:"_addClipBox",value:function(){var t,e=this.getDataModel();return!!e&&(this._clipBox||(t=this.a("waterClipBox"),this._clipBox=e.getDataByTag(t),this._clipBox||(this._clipBox=new ht.Node,this._clipBox.s({"transparent.mask":!0,"3d.selectable":!1,"3d.visible":!1,"shadow.cast":!1,"shadow.receive":!1,shape3d:"box","3d.clipbox.group":this.a("waterClipGroup")}),t="waterClipBox"+this.getId(),this._clipBox.setTag(t),this.a("waterClipBox",t)),this._clipBox.s3([15e3,15e3,15e3])),this._clipBox.setAnchor3d([.5,1,.5]),this._clipBox.getDataModel()||e.add(this._clipBox),this._clipBox.s("3d.clipbox.group",this.a("waterClipGroup")),!0)}},{key:"_removeClipBox",value:function(){var t=this.getDataModel();return!!t&&(!!this._clipBox&&(this._clipBox.getDataModel()&&t.remove(this._clipBox),!0))}},{key:"_syncClipBox",value:function(){this._clipBox&&(this._clipBox.p3(this.p3()),this._clipBox.setEuler(this.getEuler()))}},{key:"updateClipInfo",value:function(){this.a("waterClipBelow")?(this._addClipBox(),this._syncClipBox()):this._removeClipBox(),this._updateChildrenClipInfo()}},{key:"_updateChildrenClipInfo",value:function(){var t=this.a("waterClipBelow"),e=this.a("waterClipGroup"),r=0;t&&0<e&&(r=Math.pow(2,e));e=this.getChildren();e&&e.each(function(t){t.s("3d.clipbox.mask",r)})}},{key:"_updateChildClipInfo",value:function(t){var e,r=void 0,n=void 0;t.oldValue&&(r=t.oldValue,n=0),t.newValue&&(r=t.newValue,e=this.a("waterClipBelow"),t=this.a("waterClipGroup"),e&&0<t&&(n=Math.pow(t))),r.s("3d.clipbox.mask",n)}},{key:"readWaterAsync",value:function(e,r,t){var n,a,i,A,s,o,h,l=this.getDataModel();!l||(n=l.getDataByTag(this.a("waterWave")))&&(a=this.p3(),i=this.getFinalScale3d(),s=A=void 0,A=(e[0]-a[0])/i[0]+.5,s=(e[2]-a[2])/i[2]+.5,o=this.a("waterRepeat")||[1,1],l=this.a("waterTranslate")||[0,0],A=((A*o[0]+l[0])%1+1)%1,s=((s*o[1]+l[1])%1+1)%1,h=this.getMaterial(C,"u_geometrySizeRatio"),n.readWaveAsync(A,s,1,1,t||this._readBuffer,function(t){r&&r([e[0]+i[0]*t[0]*h[0],a[1]+i[1]*t[1]*h[1],e[2]+i[2]*t[2]*h[2]])}))}}]),V);function V(){B(this,V);var t=H(this,(V.__proto__||Object.getPrototypeOf(V)).call(this));return t._myInit(),t}(ht.plugin||(ht.plugin={})).Water=Y;var d=ht.graph3d.Graph3dView.prototype,T=d.handleDataModelChange,F=d.handleDataPropertyChange,O=[],y=[];d.handleDataModelChange=function(e){var t,r;return T.call(this,e),e.data instanceof Y?("remove"==e.kind&&(O=O.filter(function(t){e.data}),this.removeOnPreFrameFunc(e.data.getId())),void("add"==e.kind&&O.push(e.data))):e.data instanceof ht.plugin.Wave?("remove"==e.kind&&(y=y.filter(function(t){e.data}),this.removeOnPreFrameFunc(e.data.getId())),void("add"==e.kind&&y.push(e.data))):void("add"!=e.kind||!e.data.s("shape3d.reflector")||(t=e.data.getTag())&&(t="waterReflector"+t,(r=this.getData3dUI(e.data)._reflectorRenderTarget)&&this.setTexture(t,r.texture)))},d.handleDataPropertyChange=function(t){F.call(this,t);var e,r=t.property,n=t.data;if("*"!=r)if(n.s("shape3d.reflector"))"tag"!=r&&"s:shape3d.reflector"!=r||(t=n.getTag())&&(t="waterReflector"+t,(e=this.getData3dUI(n)._reflectorRenderTarget)&&this.setTexture(t,e.texture));else if("a:waveSize"!=r){return"a:waveWave"==r?(e=this,void(!(a=(r=n).getTag())||(a=e.dm().getDataByTag(a))&&(a=a.a("waveSize"),r.a("waterWaveSize",a)))):void 0}else{var a=n.getTag();a&&function(t,e){for(var r=t.a("waveSize"),n=O.length,a=0;a<n;a++)O[a].a("waterWave")==e&&O[a].a("waterWaveSize",r)}(n,a)}};var b=d.onPreFrame;d.getOnPreFrameFuncMap=function(){return this._onPreFrameFunMap||(this._onPreFrameFunMap={}),gOnPreFrameFunc},d.addOnPreFrameFunc=function(t,e){return this._onPreFrameFunMap||(this._onPreFrameFunMap={}),this._onPreFrameFunMap[t]=e,t},d.removeOnPreFrameFunc=function(t){this._onPreFrameFunMap||(this._onPreFrameFunMap={}),delete this._onPreFrameFunMap[t]},d.onPreFrame=function(){if(b.call(this),this._onPreFrameFunMap)for(var t in this._onPreFrameFunMap){var e=this._onPreFrameFunMap[t];e&&e()}}}();
